(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{127:function(t,e,n){(function(e,n,r){t.exports=function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),p(t)},d.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},d.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),p(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(t,e){return new Promise(function(n,i){var o=new w(t,e),a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:function(t){var e=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e}(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new E(e,t))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}function o(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var a=setTimeout;function s(t){return Boolean(t&&void 0!==t.length)}function u(){}function c(t){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],y(t,this)}function h(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,c._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(n){return void f(e.promise,n)}l(e.promise,r)}else(1===t._state?l:f)(e.promise,t._value)})):t._deferreds.push(e)}function l(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof c)return t._state=3,t._value=e,void p(t);if("function"==typeof n)return void y(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,p(t)}catch(e){f(t,e)}}function f(t,e){t._state=2,t._value=e,p(t)}function p(t){2===t._state&&0===t._deferreds.length&&c._immediateFn(function(){t._handled||c._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)h(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function y(t,e){var n=!1;try{t(function(t){n||(n=!0,l(e,t))},function(t){n||(n=!0,f(e,t))})}catch(t){if(n)return;n=!0,f(e,t)}}c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var n=new this.constructor(u);return h(this,new d(t,e,n)),n},c.prototype.finally=o,c.all=function(t){return new c(function(e,n){if(!s(t))return n(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(t,e)},n)}r[t]=a,0==--i&&e(r)}catch(a){n(a)}}for(var a=0;a<r.length;a++)o(a,r[a])})},c.resolve=function(t){return t&&"object"==typeof t&&t.constructor===c?t:new c(function(e){e(t)})},c.reject=function(t){return new c(function(e,n){n(t)})},c.race=function(t){return new c(function(e,n){if(!s(t))return n(new TypeError("Promise.race accepts an array"));for(var r=0,i=t.length;r<i;r++)c.resolve(t[r]).then(e,n)})},c._immediateFn="function"==typeof n&&function(t){n(t)}||function(t){a(t,0)},c._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var m=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();function v(t){return t&&t.Math==Math&&t}function g(t){try{return!!t()}catch(t){return!0}}function b(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function w(t){return V.call(t).slice(8,-1)}function _(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function E(t){return j(_(t))}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function S(t,e){if(!T(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!T(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function I(t,e){return W.call(t,e)}function C(t){return Q?K.createElement(t):{}}function N(t){if(!T(t))throw TypeError(String(t)+" is not an object");return t}function A(t,e){try{J(x,t,e)}catch(n){x[t]=e}return e}function k(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++rt+it).toString(36)}function D(t){return ot[t]||(ot[t]=k(t))}"Promise"in m?m.Promise.prototype.finally||(m.Promise.prototype.finally=o):m.Promise=c;var R,O,P,M="object",x=v(typeof globalThis==M&&globalThis)||v(typeof window==M&&window)||v(typeof self==M&&self)||v(typeof t==M&&t)||Function("return this")(),L=!g(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),F={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,q={f:U&&!F.call({1:2},1)?function(t){var e=U(this,t);return!!e&&e.enumerable}:F},V={}.toString,B="".split,j=g(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==w(t)?B.call(t,""):Object(t)}:Object,W={}.hasOwnProperty,K=x.document,Q=T(K)&&T(K.createElement),H=!L&&!g(function(){return 7!=Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a}),G=Object.getOwnPropertyDescriptor,z={f:L?G:function(t,e){if(t=E(t),e=S(e,!0),H)try{return G(t,e)}catch(t){}if(I(t,e))return b(!q.f.call(t,e),t[e])}},Y=Object.defineProperty,X={f:L?Y:function(t,e,n){if(N(t),e=S(e,!0),N(n),H)try{return Y(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},J=L?function(t,e,n){return X.f(t,e,b(1,n))}:function(t,e,n){return t[e]=n,t},$=!1,Z=i(function(t){var e="__core-js_shared__",n=x[e]||A(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),tt=Z("native-function-to-string",Function.toString),et=x.WeakMap,nt="function"==typeof et&&/native code/.test(tt.call(et)),rt=0,it=Math.random(),ot=Z("keys"),at={},st=x.WeakMap;if(nt){var ut=new st,ct=ut.get,ht=ut.has,lt=ut.set;R=function(t,e){return lt.call(ut,t,e),e},O=function(t){return ct.call(ut,t)||{}},P=function(t){return ht.call(ut,t)}}else{var ft=D("state");at[ft]=!0,R=function(t,e){return J(t,ft,e),e},O=function(t){return I(t,ft)?t[ft]:{}},P=function(t){return I(t,ft)}}function pt(t){return"function"==typeof t?t:void 0}function dt(t,e){return arguments.length<2?pt(Rt[t])||pt(x[t]):Rt[t]&&Rt[t][e]||x[t]&&x[t][e]}function yt(t){return isNaN(t=+t)?0:(0<t?Pt:Ot)(t)}function mt(t){return 0<t?Mt(yt(t),9007199254740991):0}function vt(t){return function(e,n,r){var i,o=E(e),a=mt(o.length),s=function(t,e){var n=yt(t);return n<0?xt(n+e,0):Lt(n,e)}(r,a);if(t&&n!=n){for(;s<a;)if((i=o[s++])!=i)return!0}else for(;s<a;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}function gt(t,e){var n,r=E(t),i=0,o=[];for(n in r)!I(at,n)&&I(r,n)&&o.push(n);for(;e.length>i;)I(r,n=e[i++])&&(~Ft(o,n)||o.push(n));return o}function bt(t,e){for(var n=jt(e),r=X.f,i=z.f,o=0;o<n.length;o++){var a=n[o];I(t,a)||r(t,a,i(e,a))}}function wt(t,e){var n=Qt[Kt(t)];return n==Gt||n!=Ht&&("function"==typeof e?g(e):!!e)}function _t(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?x:c?x[s]||A(s,{}):(x[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Yt(n,r))&&a.value:n[r],!zt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;bt(o,i)}(t.sham||i&&i.sham)&&J(o,"sham",!0),Dt(n,r,o,t)}}function Et(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Tt(t,e,n){if(Et(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}function St(t){return Object(_(t))}function It(t){return Zt[t]||(Zt[t]=Jt&&$t[t]||(Jt?$t:k)("Symbol."+t))}function Ct(t,e){var n;return Xt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Xt(n.prototype)?T(n)&&null===(n=n[te])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Nt(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=5==t||o;return function(s,u,c,h){for(var l,f,p=St(s),d=j(p),y=Tt(u,c,3),m=mt(d.length),v=0,g=h||Ct,b=e?g(s,m):n?g(s,0):void 0;v<m;v++)if((a||v in d)&&(f=y(l=d[v],v,p),t))if(e)b[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:ee.call(b,l)}else if(i)return!1;return o?-1:r||i?i:b}}function At(){}var kt={set:R,get:O,has:P,enforce:function(t){return P(t)?O(t):R(t,{})},getterFor:function(t){return function(e){var n;if(!T(e)||(n=O(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Dt=i(function(t){var e=kt.get,n=kt.enforce,r=String(tt).split("toString");Z("inspectSource",function(t){return tt.call(t)}),(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||I(i,"name")||J(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==x?(a?!u&&t[e]&&(s=!0):delete t[e],s?t[e]=i:J(t,e,i)):s?t[e]=i:A(e,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||tt.call(this)})}),Rt=x,Ot=Math.ceil,Pt=Math.floor,Mt=Math.min,xt=Math.max,Lt=Math.min,Ft=(vt(!0),vt(!1)),Ut=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qt=Ut.concat("length","prototype"),Vt={f:Object.getOwnPropertyNames||function(t){return gt(t,qt)}},Bt={f:Object.getOwnPropertySymbols},jt=dt("Reflect","ownKeys")||function(t){var e=Vt.f(N(t)),n=Bt.f;return n?e.concat(n(t)):e},Wt=/#|\.prototype\./,Kt=wt.normalize=function(t){return String(t).replace(Wt,".").toLowerCase()},Qt=wt.data={},Ht=wt.NATIVE="N",Gt=wt.POLYFILL="P",zt=wt,Yt=z.f,Xt=Array.isArray||function(t){return"Array"==w(t)},Jt=!!Object.getOwnPropertySymbols&&!g(function(){return!String(Symbol())}),$t=x.Symbol,Zt=Z("wks"),te=It("species"),ee=[].push,ne={forEach:Nt(0),map:Nt(1),filter:Nt(2),some:Nt(3),every:Nt(4),find:Nt(5),findIndex:Nt(6)},re=Object.keys||function(t){return gt(t,Ut)},ie=L?Object.defineProperties:function(t,e){N(t);for(var n,r=re(e),i=r.length,o=0;o<i;)X.f(t,n=r[o++],e[n]);return t},oe=dt("document","documentElement"),ae=D("IE_PROTO"),se="prototype",ue=function(){var t,e=C("iframe"),n=Ut.length;for(e.style.display="none",oe.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ue=t.F;n--;)delete ue[se][Ut[n]];return ue()},ce=Object.create||function(t,e){var n;return null!==t?(At[se]=N(t),n=new At,At[se]=null,n[ae]=t):n=ue(),void 0===e?n:ie(n,e)};at[ae]=!0;var he=It("unscopables"),le=Array.prototype;function fe(t){le[he][t]=!0}null==le[he]&&J(le,he,ce(null));var pe=ne.find,de="find",ye=!0;function me(t,e,n){return Tt(ve,x[t].prototype[e],n)}de in[]&&Array(1)[de](function(){ye=!1}),_t({target:"Array",proto:!0,forced:ye},{find:function(t,e){return pe(this,t,1<arguments.length?e:void 0)}}),fe(de);var ve=Function.call,ge=(me("Array","find"),ne.findIndex),be="findIndex",we=!0;function _e(t){return function(e,n){var r,i,o=String(_(e)),a=yt(n),s=o.length;return a<0||s<=a?t?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(i=o.charCodeAt(a+1))<56320||57343<i?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}be in[]&&Array(1)[be](function(){we=!1}),_t({target:"Array",proto:!0,forced:we},{findIndex:function(t,e){return ge(this,t,1<arguments.length?e:void 0)}}),fe(be),me("Array","findIndex");var Ee,Te,Se,Ie={codeAt:_e(!1),charAt:_e(!0)},Ce=!g(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ne=D("IE_PROTO"),Ae=Object.prototype,ke=Ce?Object.getPrototypeOf:function(t){return I(t=St(t),Ne)?t[Ne]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ae:null},De=It("iterator"),Re=!1;function Oe(t,e,n){t&&!I(t=n?t:t.prototype,Ue)&&Fe(t,Ue,{configurable:!0,value:e})}function Pe(){return this}function Me(){return this}function xe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!We&&t in p)return p[t];switch(t){case"keys":case Qe:case He:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ce(Ve,{next:b(1,n)}),Oe(t,r,!1),qe[r]=Pe}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Ke]||p["@@iterator"]||i&&p[i],y=!We&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=ke(m.call(new t)),je!==Object.prototype&&u.next&&(ke(u)!==je&&(Be?Be(u,je):"function"!=typeof u[Ke]&&J(u,Ke,Me)),Oe(u,l,!0))),i==Qe&&d&&d.name!==Qe&&(f=!0,y=function(){return d.call(this)}),p[Ke]!==y&&J(p,Ke,y),qe[e]=y,i)if(c={values:s(Qe),keys:o?y:s("keys"),entries:s(He)},a)for(h in c)!We&&!f&&h in p||Dt(p,h,c[h]);else _t({target:e,proto:!0,forced:We||f},c);return c}[].keys&&("next"in(Se=[].keys())?(Te=ke(ke(Se)))!==Object.prototype&&(Ee=Te):Re=!0),null==Ee&&(Ee={}),I(Ee,De)||J(Ee,De,function(){return this});var Le={IteratorPrototype:Ee,BUGGY_SAFARI_ITERATORS:Re},Fe=X.f,Ue=It("toStringTag"),qe={},Ve=Le.IteratorPrototype,Be=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(n){}return function(n,r){return N(n),function(t){if(!T(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),je=Le.IteratorPrototype,We=Le.BUGGY_SAFARI_ITERATORS,Ke=It("iterator"),Qe="values",He="entries",Ge=Ie.charAt,ze="String Iterator",Ye=kt.set,Xe=kt.getterFor(ze);function Je(t,e,n,r){try{return r?e(N(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&N(i.call(t)),e}}function $e(t){return void 0!==t&&(qe.Array===t||rn[nn]===t)}function Ze(t,e,n){var r=S(e);r in t?X.f(t,r,b(0,n)):t[r]=n}function tn(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),on))?n:an?w(e):"Object"==(r=w(e))&&"function"==typeof e.callee?"Arguments":r}function en(t){if(null!=t)return t[sn]||t["@@iterator"]||qe[tn(t)]}xe(String,"String",function(t){Ye(this,{type:ze,string:String(t),index:0})},function(){var t,e=Xe(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ge(n,r),e.index+=t.length,{value:t,done:!1})});var nn=It("iterator"),rn=Array.prototype,on=It("toStringTag"),an="Arguments"==w(function(){return arguments}()),sn=It("iterator"),un=It("iterator"),cn=!1;try{var hn=0,ln={next:function(){return{done:!!hn++}},return:function(){cn=!0}};ln[un]=function(){return this},Array.from(ln,function(){throw 2})}catch(So){}function fn(t,e){if(!e&&!cn)return!1;var n=!1;try{var r={};r[un]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}_t({target:"Array",stat:!0,forced:!fn(function(t){Array.from(t)})},{from:function(t,e,n){var r,i,o,a,s=St(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=en(s);if(l&&(h=Tt(h,2<c?n:void 0,2)),null==p||u==Array&&$e(p))for(i=new u(r=mt(s.length));f<r;f++)Ze(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Ze(i,f,l?Je(a,h,[o.value,f],!0):o.value);return i.length=f,i}}),Rt.Array.from;var pn=Object.assign,dn=!pn||g(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=pn({},t)[n]||re(pn({},e)).join("")!=r})?function(t,e){for(var n=St(t),r=arguments.length,i=1,o=Bt.f,a=q.f;i<r;)for(var s,u=j(arguments[i++]),c=o?re(u).concat(o(u)):re(u),h=c.length,l=0;l<h;)s=c[l++],L&&!a.call(u,s)||(n[s]=u[s]);return n}:pn;function yn(t){return function(e){for(var n,r=E(e),i=re(r),o=i.length,a=0,s=[];a<o;)n=i[a++],L&&!mn.call(r,n)||s.push(t?[n,r[n]]:r[n]);return s}}_t({target:"Object",stat:!0,forced:Object.assign!==dn},{assign:dn}),Rt.Object.assign;var mn=q.f,vn={entries:yn(!0),values:yn(!1)},gn=vn.entries;_t({target:"Object",stat:!0},{entries:function(t){return gn(t)}}),Rt.Object.entries;var bn=vn.values;function wn(t){if(function(t){var e;return T(t)&&(void 0!==(e=t[_n])?!!e:"RegExp"==w(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}_t({target:"Object",stat:!0},{values:function(t){return bn(t)}}),Rt.Object.values;var _n=It("match"),En=It("match"),Tn="".startsWith,Sn=Math.min;function In(t){if(!T(t))return!1;var e=t[Nn];return void 0!==e?!!e:Xt(t)}_t({target:"String",proto:!0,forced:!function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[En]=!1,"/./"[t](e)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(_(this));wn(t);var r=mt(Sn(1<arguments.length?e:void 0,n.length)),i=String(t);return Tn?Tn.call(n,i,r):n.slice(r,r+i.length)===i}}),me("String","startsWith"),_t({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(_(this)),n="",r=yt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),me("String","repeat");var Cn=It("species"),Nn=It("isConcatSpreadable"),An=9007199254740991,kn="Maximum allowed index exceeded",Dn=!g(function(){var t=[];return t[Nn]=!1,t.concat()[0]!==t}),Rn=!g(function(){var t=[];return(t.constructor={})[Cn]=function(){return{foo:1}},1!==t.concat(Boolean).foo});_t({target:"Array",proto:!0,forced:!Dn||!Rn},{concat:function(t){var e,n,r,i,o,a=St(this),s=Ct(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(In(o=-1===e?a:arguments[e])){if(i=mt(o.length),An<u+i)throw TypeError(kn);for(n=0;n<i;n++,u++)n in o&&Ze(s,u,o[n])}else{if(An<=u)throw TypeError(kn);Ze(s,u++,o)}return s.length=u,s}});var On={};On[It("toStringTag")]="z";var Pn="[object z]"!==String(On)?function(){return"[object "+tn(this)+"]"}:On.toString,Mn=Object.prototype;function xn(t){var e=Rt.Symbol||(Rt.Symbol={});I(e,t)||Qn(e,t,{value:Kn.f(t)})}function Ln(t,e){var n=sr[t]=ce(tr[Yn]);return Jn(n,{type:zn,tag:t,description:e}),L||(n.description=e),n}function Fn(t,e){N(t);var n=E(e),r=re(n).concat(gr(n));return Hn(r,function(e){L&&!vr.call(n,e)||mr(t,e,n[e])}),t}function Un(t,e){var n=E(t),r=S(e,!0);if(n!==Zn||!I(sr,r)||I(ur,r)){var i=rr(n,r);return!i||!I(sr,r)||I(n,Gn)&&n[Gn][r]||(i.enumerable=!0),i}}function qn(t){var e=or(E(t)),n=[];return Hn(e,function(t){I(sr,t)||I(at,t)||n.push(t)}),n}Pn!==Mn.toString&&Dt(Mn,"toString",Pn,{unsafe:!0});var Vn=Vt.f,Bn={}.toString,jn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Wn={f:function(t){return jn&&"[object Window]"==Bn.call(t)?function(t){try{return Vn(t)}catch(t){return jn.slice()}}(t):Vn(E(t))}},Kn={f:It},Qn=X.f,Hn=ne.forEach,Gn=D("hidden"),zn="Symbol",Yn="prototype",Xn=It("toPrimitive"),Jn=kt.set,$n=kt.getterFor(zn),Zn=Object[Yn],tr=x.Symbol,er=x.JSON,nr=er&&er.stringify,rr=z.f,ir=X.f,or=Wn.f,ar=q.f,sr=Z("symbols"),ur=Z("op-symbols"),cr=Z("string-to-symbol-registry"),hr=Z("symbol-to-string-registry"),lr=Z("wks"),fr=x.QObject,pr=!fr||!fr[Yn]||!fr[Yn].findChild,dr=L&&g(function(){return 7!=ce(ir({},"a",{get:function(){return ir(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=rr(Zn,e);r&&delete Zn[e],ir(t,e,n),r&&t!==Zn&&ir(Zn,e,r)}:ir,yr=Jt&&"symbol"==typeof tr.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof tr},mr=function(t,e,n){t===Zn&&mr(ur,e,n),N(t);var r=S(e,!0);return N(n),I(sr,r)?(n.enumerable?(I(t,Gn)&&t[Gn][r]&&(t[Gn][r]=!1),n=ce(n,{enumerable:b(0,!1)})):(I(t,Gn)||ir(t,Gn,b(1,{})),t[Gn][r]=!0),dr(t,r,n)):ir(t,r,n)},vr=function(t){var e=S(t,!0),n=ar.call(this,e);return!(this===Zn&&I(sr,e)&&!I(ur,e))&&(!(n||!I(this,e)||!I(sr,e)||I(this,Gn)&&this[Gn][e])||n)},gr=function(t){var e=t===Zn,n=or(e?ur:E(t)),r=[];return Hn(n,function(t){!I(sr,t)||e&&!I(Zn,t)||r.push(sr[t])}),r};Jt||(Dt((tr=function(t){if(this instanceof tr)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=k(e),r=function(t){this===Zn&&r.call(ur,t),I(this,Gn)&&I(this[Gn],n)&&(this[Gn][n]=!1),dr(this,n,b(1,t))};return L&&pr&&dr(Zn,n,{configurable:!0,set:r}),Ln(n,e)})[Yn],"toString",function(){return $n(this).tag}),q.f=vr,X.f=mr,z.f=Un,Vt.f=Wn.f=qn,Bt.f=gr,L&&(ir(tr[Yn],"description",{configurable:!0,get:function(){return $n(this).description}}),Dt(Zn,"propertyIsEnumerable",vr,{unsafe:!0})),Kn.f=function(t){return Ln(It(t),t)}),_t({global:!0,wrap:!0,forced:!Jt,sham:!Jt},{Symbol:tr}),Hn(re(lr),function(t){xn(t)}),_t({target:zn,stat:!0,forced:!Jt},{for:function(t){var e=String(t);if(I(cr,e))return cr[e];var n=tr(e);return cr[e]=n,hr[n]=e,n},keyFor:function(t){if(!yr(t))throw TypeError(t+" is not a symbol");if(I(hr,t))return hr[t]},useSetter:function(){pr=!0},useSimple:function(){pr=!1}}),_t({target:"Object",stat:!0,forced:!Jt,sham:!L},{create:function(t,e){return void 0===e?ce(t):Fn(ce(t),e)},defineProperty:mr,defineProperties:Fn,getOwnPropertyDescriptor:Un}),_t({target:"Object",stat:!0,forced:!Jt},{getOwnPropertyNames:qn,getOwnPropertySymbols:gr}),_t({target:"Object",stat:!0,forced:g(function(){Bt.f(1)})},{getOwnPropertySymbols:function(t){return Bt.f(St(t))}}),er&&_t({target:"JSON",stat:!0,forced:!Jt||g(function(){var t=tr();return"[null]"!=nr([t])||"{}"!=nr({a:t})||"{}"!=nr(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(T(e)||void 0!==t)&&!yr(t))return Xt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!yr(e))return e}),r[1]=e,nr.apply(er,r)}}),tr[Yn][Xn]||J(tr[Yn],Xn,tr[Yn].valueOf),Oe(tr,zn),at[Gn]=!0,xn("asyncIterator");var br=X.f,wr=x.Symbol;if(L&&"function"==typeof wr&&!("description"in wr.prototype&&void 0===wr().description)){var _r={},Er=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Er?new wr(e):void 0===e?wr():wr(e);return""===e&&(_r[n]=!0),n};bt(Er,wr);var Tr=Er.prototype=wr.prototype;Tr.constructor=Er;var Sr=Tr.toString,Ir="Symbol(test)"==String(wr("test")),Cr=/^Symbol\((.*)\)[^)]+$/;br(Tr,"description",{configurable:!0,get:function(){var t=T(this)?this.valueOf():this,e=Sr.call(t);if(I(_r,t))return"";var n=Ir?e.slice(7,-1):e.replace(Cr,"$1");return""===n?void 0:n}}),_t({global:!0,forced:!0},{Symbol:Er})}xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split"),xn("toPrimitive"),xn("toStringTag"),xn("unscopables"),Oe(Math,"Math",!0),Oe(x.JSON,"JSON",!0),Rt.Symbol,xn("dispose"),xn("observable"),xn("patternMatch"),xn("replaceAll");var Nr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ar="Array Iterator",kr=kt.set,Dr=kt.getterFor(Ar),Rr=xe(Array,"Array",function(t,e){kr(this,{type:Ar,target:E(t),index:0,kind:e})},function(){var t=Dr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");qe.Arguments=qe.Array,fe("keys"),fe("values"),fe("entries");var Or=It("iterator"),Pr=It("toStringTag"),Mr=Rr.values;for(var xr in Nr){var Lr=x[xr],Fr=Lr&&Lr.prototype;if(Fr){if(Fr[Or]!==Mr)try{J(Fr,Or,Mr)}catch(So){Fr[Or]=Mr}if(Fr[Pr]||J(Fr,Pr,xr),Nr[xr])for(var Ur in Rr)if(Fr[Ur]!==Rr[Ur])try{J(Fr,Ur,Rr[Ur])}catch(So){Fr[Ur]=Rr[Ur]}}}function qr(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function Vr(t,e,n,r,i){function o(t){var e=s[t];Dt(s,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return i&&!T(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})}var a=x[t],s=a&&a.prototype,u=a,c=r?"set":"add",h={};if(zt(t,"function"!=typeof a||!(i||s.forEach&&!g(function(){(new a).entries().next()}))))u=n.getConstructor(e,t,r,c),Kr.REQUIRED=!0;else if(zt(t,!0)){var l=new u,f=l[c](i?{}:-0,1)!=l,p=g(function(){l.has(1)}),d=fn(function(t){new a(t)}),y=!i&&g(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=e(function(e,n){qr(e,u,t);var i=function(t,e,n){var r,i;return Be&&"function"==typeof(r=e.constructor)&&r!==n&&T(i=r.prototype)&&i!==n.prototype&&Be(t,i),t}(new a,e,u);return null!=n&&Qr(n,i[c],i,r),i})).prototype=s).constructor=u),(p||y)&&(o("delete"),o("has"),r&&o("get")),(y||f)&&o(c),i&&s.clear&&delete s.clear}return h[t]=u,_t({global:!0,forced:u!=a},h),Oe(u,t),i||n.setStrong(u,t,r),u}function Br(t,e,n){for(var r in e)Dt(t,r,e[r],n);return t}function jr(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Et(this),(r=void 0!==u)&&Et(u),null==t?new this:(i=[],r?(o=0,a=Tt(u,2<s?n:void 0,2),Qr(t,function(t){i.push(a(t,o++))})):Qr(t,i.push,i),new this(i))}Kn.f("iterator");var Wr=!g(function(){return Object.isExtensible(Object.preventExtensions({}))}),Kr=i(function(t){function e(t){n(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var n=X.f,r=k("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,n){if(!T(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!I(t,r)){if(!o(t))return"F";if(!n)return"E";e(t)}return t[r].objectID},getWeakData:function(t,n){if(!I(t,r)){if(!o(t))return!0;if(!n)return!1;e(t)}return t[r].weakData},onFreeze:function(t){return Wr&&a.REQUIRED&&o(t)&&!I(t,r)&&e(t),t}};at[r]=!0}),Qr=(Kr.REQUIRED,Kr.fastKey,Kr.getWeakData,Kr.onFreeze,i(function(t){function e(t,e){this.stopped=t,this.result=e}(t.exports=function(t,n,r,i,o){var a,s,u,c,h,l,f=Tt(n,r,i?2:1);if(o)a=t;else{if("function"!=typeof(s=en(t)))throw TypeError("Target is not iterable");if($e(s)){for(u=0,c=mt(t.length);u<c;u++)if((h=i?f(N(l=t[u])[0],l[1]):f(t[u]))&&h instanceof e)return h;return new e(!1)}a=s.call(t)}for(;!(l=a.next()).done;)if((h=Je(a,f,l.value,i))&&h instanceof e)return h;return new e(!1)}).stop=function(t){return new e(!0,t)}})),Hr=It("species"),Gr=X.f,zr=Kr.fastKey,Yr=kt.set,Xr=kt.getterFor,Jr={getConstructor:function(t,e,n,r){function i(t,e,n){var r,i,o=a(t),u=s(t,e);return u?u.value=n:(o.last=u={index:i=zr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=u),r&&(r.next=u),L?o.size++:t.size++,"F"!==i&&(o.index[i]=u)),t}var o=t(function(t,i){qr(t,o,e),Yr(t,{type:e,index:ce(null),first:void 0,last:void 0,size:0}),L||(t.size=0),null!=i&&Qr(i,t[r],t,n)}),a=Xr(e),s=function(t,e){var n,r=a(t),i=zr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Br(o.prototype,{clear:function(){for(var t=a(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,L?t.size=0:this.size=0},delete:function(t){var e=a(this),n=s(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),L?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=a(this),i=Tt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!s(this,t)}}),Br(o.prototype,n?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return i(this,0===t?0:t,e)}}:{add:function(t){return i(this,t=0===t?0:t,t)}}),L&&Gr(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,n){var r=e+" Iterator",i=Xr(e),o=Xr(r);xe(t,e,function(t,e){Yr(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),function(t){var e=dt(t),n=X.f;L&&e&&!e[Hr]&&n(e,Hr,{configurable:!0,get:function(){return this}})}(e)}};function $r(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}function Zr(){for(var t=N(this),e=Et(t.delete),n=!0,r=0,i=arguments.length;r<i;r++)n=n&&e.call(t,arguments[r]);return!!n}function ti(t){return Map.prototype.entries.call(t)}function ei(t,e){var n,r=N(t).constructor;return void 0===r||null==(n=N(r)[ni])?e:Et(n)}Vr("Map",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Jr,!0),Rt.Map,_t({target:"Map",stat:!0},{from:jr}),_t({target:"Map",stat:!0},{of:$r}),_t({target:"Map",proto:!0,real:!0,forced:$},{deleteAll:function(){return Zr.apply(this,arguments)}}),_t({target:"Map",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3);return!Qr(r,function(t,e){if(!i(e,t,n))return Qr.stop()},void 0,!0,!0).stopped}});var ni=It("species");function ri(t){return Set.prototype.values.call(t)}_t({target:"Map",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ei(n,dt("Map"))),a=Et(o.set);return Qr(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3);return Qr(r,function(t,e){if(i(e,t,n))return Qr.stop(e)},void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{findKey:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3);return Qr(r,function(t,e){if(i(e,t,n))return Qr.stop(t)},void 0,!0,!0).result}}),_t({target:"Map",stat:!0},{groupBy:function(t,e){var n=new this;Et(e);var r=Et(n.has),i=Et(n.get),o=Et(n.set);return Qr(t,function(t){var a=e(t);r.call(n,a)?i.call(n,a).push(t):o.call(n,a,[t])}),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{includes:function(t){return Qr(ti(N(this)),function(e,n){if(function(e,n){return e===t||e!=e&&t!=t}(n))return Qr.stop()},void 0,!0,!0).stopped}}),_t({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Et(e);var r=Et(n.set);return Qr(t,function(t){r.call(n,e(t),t)}),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{keyOf:function(t){return Qr(ti(N(this)),function(e,n){if(n===t)return Qr.stop(e)},void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapKeys:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ei(n,dt("Map"))),a=Et(o.set);return Qr(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapValues:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ei(n,dt("Map"))),a=Et(o.set);return Qr(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{merge:function(t){for(var e=N(this),n=Et(e.set),r=0;r<arguments.length;)Qr(arguments[r++],n,e,!0);return e}}),_t({target:"Map",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=ti(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty map with no initial value");n=r.value[1]}return Qr(o,function(e,r){n=t(n,r,e,i)},void 0,!0,!0),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=ti(n),i=Tt(t,1<arguments.length?e:void 0,3);return Qr(r,function(t,e){if(i(e,t,n))return Qr.stop()},void 0,!0,!0).stopped}}),_t({target:"Map",proto:!0,real:!0,forced:$},{update:function(t,e,n){var r=N(this),i=arguments.length;Et(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Et(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}}),Vr("Set",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Jr),Rt.Set,_t({target:"Set",stat:!0},{from:jr}),_t({target:"Set",stat:!0},{of:$r}),_t({target:"Set",proto:!0,real:!0,forced:$},{addAll:function(){return function(){for(var t=N(this),e=Et(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{deleteAll:function(){return Zr.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return!Qr(r,function(t){if(!i(t,t,n))return Qr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{difference:function(t){var e=N(this),n=new(ei(e,dt("Set")))(e),r=Et(n.delete);return Qr(t,function(t){r.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=ri(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ei(n,dt("Set"))),a=Et(o.add);return Qr(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return Qr(r,function(t){if(i(t,t,n))return Qr.stop(t)},void 0,!1,!0).result}}),_t({target:"Set",proto:!0,real:!0,forced:$},{intersection:function(t){var e=N(this),n=new(ei(e,dt("Set"))),r=Et(e.has),i=Et(n.add);return Qr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isDisjointFrom:function(t){var e=N(this),n=Et(e.has);return!Qr(t,function(t){if(!0===n.call(e,t))return Qr.stop()}).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSubsetOf:function(t){var e=function(t){var e=en(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return N(e.call(t))}(this),n=N(t),r=n.has;return"function"!=typeof r&&(n=new(dt("Set"))(t),r=Et(n.has)),!Qr(e,function(t){if(!1===r.call(n,t))return Qr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSupersetOf:function(t){var e=N(this),n=Et(e.has);return!Qr(t,function(t){if(!1===n.call(e,t))return Qr.stop()}).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{join:function(t){var e=ri(N(this)),n=void 0===t?",":String(t),r=[];return Qr(e,r.push,r,!1,!0),r.join(n)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{map:function(t,e){var n=N(this),r=ri(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ei(n,dt("Set"))),a=Et(o.add);return Qr(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=ri(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return Qr(o,function(e){n=t(n,e,e,i)},void 0,!1,!0),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return Qr(r,function(t){if(i(t,t,n))return Qr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{symmetricDifference:function(t){var e=N(this),n=new(ei(e,dt("Set")))(e),r=Et(n.delete),i=Et(n.add);return Qr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{union:function(t){var e=N(this),n=new(ei(e,dt("Set")))(e);return Qr(t,Et(n.add),n),n}});var ii=function(t,e){return(ii=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function oi(t,e){function n(){this.constructor=t}ii(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ai=function(){return(ai=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function si(t,e,n,r){return new(n=n||Promise)(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function ui(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function ci(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function hi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function li(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(hi(arguments[e]));return t}function fi(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function pi(t){try{return vi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var di={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},yi=function(t,e){if(!t)throw mi(e)},mi=function(t){return new Error("Firebase Database ("+di.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},vi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(fi(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function gi(t){return bi(void 0,t)}function bi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=bi(t[n],e[n]));return t}var wi=(_i.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},_i);function _i(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}function Ei(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ti(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ei())}function Si(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ii(){return!0===di.NODE_ADMIN}var Ci,Ni=(oi(Ai,Ci=Error),Ai);function Ai(t,e){var n=Ci.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Ai.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,ki.prototype.create),n}var ki=(Di.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return o.replace(Ri,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(0,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Ni(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Di);function Di(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Ri=/\{\$([^}]+)}/g;function Oi(t){return JSON.parse(t)}function Pi(t){return JSON.stringify(t)}function Mi(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Oi(pi(o[0])||""),n=Oi(pi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function xi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Li(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Fi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ui(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var qi=(Vi.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Vi.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},Vi.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},Vi.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},Vi);function Vi(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Bi(t,e){var n=new Ki(t,e);return n.subscribe.bind(n)}var ji,Wi,Ki=(Qi.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},Qi.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},Qi.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Qi.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=Hi),void 0===r.error&&(r.error=Hi),void 0===r.complete&&(r.complete=Hi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Qi.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Qi.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Qi.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Qi.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Qi);function Qi(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Hi(){}function Gi(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function zi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function Yi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(zi(t,e,r)+"must be a valid function.")}function Xi(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(zi(t,e,r)+"must be a valid context object.")}function Ji(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}function $i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case ji.DEBUG:case ji.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ji.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(Wi=ji=ji||{})[Wi.DEBUG=0]="DEBUG",Wi[Wi.VERBOSE=1]="VERBOSE",Wi[Wi.INFO=2]="INFO",Wi[Wi.WARN=3]="WARN",Wi[Wi.ERROR=4]="ERROR",Wi[Wi.SILENT=5]="SILENT";var Zi,to=ji.INFO,eo=(Object.defineProperty(no.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in ji))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(no.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),no.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.DEBUG].concat(t))},no.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.VERBOSE].concat(t))},no.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.INFO].concat(t))},no.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.WARN].concat(t))},no.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ji.ERROR].concat(t))},no);function no(t){this.name=t,this._logLevel=to,this._logHandler=$i}var ro=((Zi={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Zi["bad-app-name"]="Illegal App name: '{$appName}",Zi["duplicate-app"]="Firebase App named '{$appName}' already exists",Zi["app-deleted"]="Firebase App named '{$appName}' already deleted",Zi["duplicate-service"]="Firebase service named '{$appName}' already registered",Zi["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Zi),io=new ki("app","Firebase",ro),oo="[DEFAULT]",ao=[],so=(Object.defineProperty(uo.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),uo.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},uo.prototype._getService=function(t,e){if(void 0===e&&(e=oo),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==oo?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},uo.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=oo),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},uo.prototype.extendApp=function(t){var e=this;bi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(ao.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),ao=[])},uo.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw io.create("app-deleted",{appName:this.name_})},uo);function uo(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=gi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){ao.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){ao=ao.filter(function(e){return e!==t})}}}so.prototype.name&&so.prototype.options||so.prototype.delete||console.log("dc");var co=new eo("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){co.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ho=self.firebase.SDK_VERSION;ho&&0<=ho.indexOf("LITE")&&co.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var lo=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var o=r;void 0===o.name&&(o.name=oo);var a=o.name;if("string"!=typeof a||!a)throw io.create("bad-app-name",{appName:String(a)});if(xi(e,a))throw io.create("duplicate-app",{appName:a});var u=new t(n,o,i);return s(e[a]=u,"create"),u},app:o,apps:null,SDK_VERSION:"6.4.0",INTERNAL:{registerService:function(e,s,u,c,h){if(void 0===h&&(h=!1),n[e])throw io.create("duplicate-service",{appName:e});function l(t){if(void 0===t&&(t=o()),"function"!=typeof t[e])throw io.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=s,c&&(r[e]=c,a().forEach(function(t){c("create",t)})),void 0!==u&&bi(l,u),i[e]=l,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,h?t:[])},l},removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u}};function o(t){if(!xi(e,t=t||oo))throw io.create("no-app",{appName:t});return e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=u(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function u(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:a}),o.App=t,i}(so);return e.INTERNAL=ai({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){bi(e,t)},createSubscribe:Bi,ErrorFactory:ki,deepExtend:bi}),e}(),fo=lo.initializeApp;lo.initializeApp=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}()&&co.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),fo.apply(void 0,t)};var po=lo;(function(){var t,n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},r="undefined"!=typeof window&&window===this?this:void 0!==e&&null!=e?e:this;function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var i=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(e=e(o=i[t=t[t.length-1]]))!=o&&null!=e&&n(i,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.a=null}function o(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var a=r.setTimeout;n.prototype.c=function(t){a(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},n.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.o),reject:t(this.g)}},e.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.u(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.l(t):this.h(t)}},e.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},e.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.u=function(t){var e=this.f();t.Ha(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(e){o(e)}}:e}var i,o,a=new e(function(t,e){i=t,o=e});return this.Ha(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ha=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).Ha(e,n)})},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e(function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}for(var a=[],s=0;a.push(void 0),s++,o(r.value).Ha(i(a.length-1),e),!(r=n.next()).done;);})},e});var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+\/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function d(t){return"array"==f(t)}function y(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==f(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),b=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function _(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:_).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function I(t,e){function n(){}n.prototype=e.prototype,t.mb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).ad=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function C(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function N(t){if(Error.captureStackTrace)Error.captureStackTrace(this,N);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function A(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");N.call(this,n+t[r])}function k(t,e){throw new A("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function D(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function R(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function O(){this.b=this.a=null}I(N,Error),N.prototype.name="CustomError",I(A,N),A.prototype.name="AssertionError",D.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var P=new D(function(){return new M},function(t){t.reset()});function M(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;k("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}O.prototype.add=function(t,e){var n=P.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},M.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},M.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},q=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=L(t,e)}function B(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function j(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length})}function W(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function H(t){for(var e in t)return!1;return!0}function G(t){var e,n={};for(e in t)n[e]=t[e];return n}var z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<z.length;o++)n=z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t,e){this.a=t===Z&&e||"",this.b=$}function J(t){return t instanceof X&&t.constructor===X&&t.b===$?t.a:(k("expected object of type Const, got '"+t+"'"),"type_error:Const")}X.prototype.na=!0,X.prototype.ma=function(){return this.a},X.prototype.toString=function(){return"Const{"+this.a+"}"};var $={},Z={},tt=new X(Z,"");function et(){this.a="",this.b=at}function nt(t){return t instanceof et&&t.constructor===et&&t.b===at?t.a:(k("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function rt(t,e){var n=J(t);if(!ot.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return st(t=n.replace(it,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof X?J(t):encodeURIComponent(String(t))}))}et.prototype.na=!0,et.prototype.ma=function(){return this.a.toString()},et.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var it=/%{(\w+)}/g,ot=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,at={};function st(t){var e=new et;return e.a=t,e}var ut=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ct=/&/g,ht=/</g,lt=/>/g,ft=/"/g,pt=/'/g,dt=/\x00/g,yt=/[\x00&<>"']/;function mt(t,e){return-1!=t.indexOf(e)}function vt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function bt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(k("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}gt.prototype.na=!0,gt.prototype.ma=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var wt=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function _t(t){return t instanceof gt?t:(t="object"==typeof t&&t.na?t.ma():String(t),wt.test(t)||(t="about:invalid#zClosurez"),St(t))}var Et,Tt={};function St(t){var e=new gt;return e.a=t,e}St("about:blank");t:{var It=a.navigator;if(It){var Ct=It.userAgent;if(Ct){Et=Ct;break t}}Et=""}function Nt(t){return mt(Et,t)}function At(){this.a="",this.b=Dt}function kt(t){return t instanceof At&&t.constructor===At&&t.b===Dt?t.a:(k("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}At.prototype.na=!0,At.prototype.ma=function(){return this.a.toString()},At.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Dt={};function Rt(t){var e=new At;return e.a=t,e}Rt("<!DOCTYPE html>");var Ot,Pt,Mt=Rt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return yt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ct,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ht,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(lt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(ft,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(pt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(dt,"&#0;"))),t}function Ft(t){a.setTimeout(function(){throw t},0)}function Ut(t,e){Pt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Pt=function(){t.then(Bt)}}else Pt=function(){var t=Bt;!m(a.setImmediate)||a.Window&&a.Window.prototype&&!Nt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Ot=Ot||function(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Nt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=st(J(tt));x(t,"HTMLIFrameElement"),t.src=nt(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(kt(Mt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=E(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Nt("Trident")||Nt("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).ub;n.ub=null,t()}},function(t){r.next={ub:t},r=r.next,e.port2.postMessage(0)}}())(t):a.setImmediate(t)}}(),qt||(Pt(),qt=!0),Vt.add(t,e)}Rt("<br>");var qt=!1,Vt=new O;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Ft(t)}R(P,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new D(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(l);return ee(e,Kt,t),e}function Xt(t){return new jt(function(e,n){n(t)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(t){return new jt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Cb:!0,value:o}:{Cb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Jt(t[o],T(i,o,!0),T(i,o,!1));else e(r)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,e,n,r){var i=zt(null,null,null);return i.a=new jt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof ue?o(e):t(i)}catch(e){o(e)}}:o}),Zt(i.a.c=t,i),i.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Jc,t.Kc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||l,n||null,r)),!0;if(C(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Ub,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}R(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ha=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Jc=function(t){this.a=Wt,ee(this,Kt,t)},t.Kc=function(t){this.a=Wt,ee(this,Qt,t)},t.Ub=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Ft;function ue(t){N.call(this,t)}function ce(){this.qa=this.qa,this.ia=this.ia}I(ue,N);var he=0;function le(t){t.qa||(t.qa=!0,t.va(),0==he)||t[g]||(t[g]=++b)}function fe(t){return fe[" "](t),t}ce.prototype.qa=!(ue.prototype.name="cancel"),ce.prototype.va=function(){if(this.ia)for(;this.ia.length;)this.ia.shift()()},fe[" "]=l;var pe,de,ye=Nt("Opera"),me=Nt("Trident")||Nt("MSIE"),ve=Nt("Edge"),ge=ve||me,be=Nt("Gecko")&&!(mt(Et.toLowerCase(),"webkit")&&!Nt("Edge"))&&!(Nt("Trident")||Nt("MSIE"))&&!Nt("Edge"),we=mt(Et.toLowerCase(),"webkit")&&!Nt("Edge");function _e(){var t=a.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=Et,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(t){return function(e,n){var r=Ce;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=ut(String(pe)).split("."),r=ut(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=vt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||vt(0==a[2].length,0==s[2].length)||vt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}Ie=a.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Ib=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Ib=!1},I(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.mb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++Le,this.oa=this.Ga=!1}function Ue(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&B(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ga=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ga=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=$e,e=ke?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.m,(e=String(e).toString())in t.a&&-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[xe])Ve(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.La||t.src;return t.Ga&&ze(t),n.call(r,e)}function $e(t,e){if(t.oa)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(t){return m(t)?t:(t[tn]||(t[tn]=function(e){return t.handleEvent(e)}),t[tn])}function nn(){ce.call(this),this.m=new qe(this),(this.Nb=this).Ua=null}function rn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.La||a.src;a.Ga&&Ve(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ib}function sn(t,e,n){if(m(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function un(t){var e=null;return new jt(function(n,r){-1==(e=sn(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw a.clearTimeout(e),t})}function cn(t){if(t.S&&"function"==typeof t.S)return t.S();if(s(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}I(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Ua;if(n)for(e=[];n;n=n.Ua)e.push(n);n=this.Nb;var r=t.type||t;if(s(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;Y(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.va=function(){if(nn.mb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Ua=null},(t=ln.prototype).S=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.m),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return s(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)vn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(mt(i,"./")||mt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(t){t.a||(t.a=new ln,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),K(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){On(this),this.a.forEach(function(n,r){F(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){On(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){On(this);var e=[];if(s(t))xn(this,t)&&(e=W(e,this.a.get(Un(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return s(t)?e.getElementById(t):t}function Bn(t,e){Q(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:jn.hasOwnProperty(n)?t.setAttribute(jn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Kn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),zn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":zn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Qn,t,e),e.join("")}function Qn(){}var Hn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Gn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function zn(t,e){e.push('"',t.replace(Gn,function(t){var e=Hn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Hn[t]=e),e}),'"')}function Yn(){var t=dr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Xn(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function Jn(t,e){e=e||a.window;var n="about:blank";t&&(n=bt(_t(t)).toString()),e.location.href=n}function $n(t){return!!((t=(t||dr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Zn(t){t=t||a.window;try{t.close()}catch(t){}}function tr(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=dr().toLowerCase(),r&&(e.target=r,mt(n,"crios/")&&(e.target="_blank")),lr(dr())==cr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:_t(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Nt("iPhone")&&!Nt("iPod")&&!Nt("iPad")||Nt("iPad")||Nt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.na?e.ma():String(e),wt.test(e)||(e="about:invalid#zClosurez"),e=St(e)),a.href=bt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=bt(e).toString(),a&&(ge&&mt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Rt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(kt(t)),a.document.close())):(a=r.open(bt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var er=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nr=/^[^@]+@[^@]+$/;function rr(){var t=null;return new jt(function(e){"complete"==a.document.readyState?e():(t=function(){e()},He(window,"load",t))}).s(function(e){throw Ge(window,"load",t),e})}function ir(t){return t=t||dr(),!("file:"!==br()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function or(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function ar(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function sr(){return po.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":po.INTERNAL.hasOwnProperty("node")?"Node":ar()?"Worker":"Browser"}function ur(){var t=sr();return"ReactNative"===t||"Node"===t}var cr="Firefox",hr="Chrome";function lr(t){var e=t.toLowerCase();return mt(e,"opera/")||mt(e,"opr/")||mt(e,"opios/")?"Opera":mt(e,"iemobile")?"IEMobile":mt(e,"msie")||mt(e,"trident/")?"IE":mt(e,"edge/")?"Edge":mt(e,"firefox/")?cr:mt(e,"silk/")?"Silk":mt(e,"blackberry")?"Blackberry":mt(e,"webos")?"Webos":!mt(e,"safari/")||mt(e,"chrome/")||mt(e,"crios/")||mt(e,"android")?!mt(e,"chrome/")&&!mt(e,"crios/")||mt(e,"edge/")?mt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":hr:"Safari"}var fr={Qc:"FirebaseCore-web",Sc:"FirebaseUI-web"};function pr(t,e){e=e||[];var n,r=[],i={};for(n in fr)i[fr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=sr())?r=lr(i=dr()):"Worker"===r&&(r=lr(i=dr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function dr(){return a.navigator&&a.navigator.userAgent||""}function yr(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function mr(){try{var t=a.localStorage,e=Sr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Yn()||!!a.indexedDB}catch(t){return ar()&&!!a.indexedDB}return!1}function vr(){return(gr()||"chrome-extension:"===br()||ir())&&!ur()&&mr()&&!ar()}function gr(){return"http:"===br()||"https:"===br()}function br(){return a.location&&a.location.protocol||null}function wr(t){return!$n(t=t||dr())&&lr(t)!=cr}function _r(t){return void 0===t?null:Kn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Tr(t){if(null!==t)return JSON.parse(t)}function Sr(t){return t||Math.floor(1e9*Math.random()).toString()}function Ir(t){return"Safari"!=lr(t=t||dr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Cr(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Nr(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=dr(),e=sr(),this.b=$n(t)||"ReactNative"===e}function Ar(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function kr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Dr(){return!(!yr("fireauth.oauthhelper",a)&&!yr("fireauth.iframe",a))}Nr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!gr()&&"chrome-extension:"!==br()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Rr,Or={};function Pr(t){Or[t]||(Or[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Rr=2==Mr.abcd}catch(t){Rr=!1}function xr(t,e,n){Rr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Lr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Fr(t){var e={};return Lr(e,t),e}function Ur(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Ur(t[n]));return e}function qr(t){var e={},n=t[Br],r=t[jr];if(!(t=t[Wr])||t!=Vr&&!n)throw Error("Invalid provider user info!");e[Qr]=r||null,e[Kr]=n||null,xr(this,Gr,t),xr(this,Hr,Ur(e))}var Vr="EMAIL_SIGNIN",Br="email",jr="newEmail",Wr="requestType",Kr="email",Qr="fromEmail",Hr="data",Gr="operation";function zr(t,e){this.code=Xr+t,this.message=e||Jr[t]||""}function Yr(t){var e=t&&t.code;return e?new zr(e.substring(Xr.length),t.message):null}I(zr,Error),zr.prototype.A=function(){return{code:this.code,message:this.message}},zr.prototype.toJSON=function(){return this.A()};var Xr="auth/",Jr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function $r(t){var e=t[ri];if(void 0===e)throw new zr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new zr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Zr];if(n&&"object"==typeof n){e=n[ai];var r=n[ii];if(n=n[oi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new zr("argument-error",ii+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new zr("argument-error",oi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new zr("argument-error",ai+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new zr("missing-android-pkg-name")}}else if(void 0!==n)throw new zr("argument-error",Zr+" property must be a non null object when specified.");if(this.f=null,(e=t[ni])&&"object"==typeof e){if("string"==typeof(e=e[si])&&e.length)this.f=e;else if(void 0!==e)throw new zr("argument-error",si+" property must be a non empty string when specified.")}else if(void 0!==e)throw new zr("argument-error",ni+" property must be a non null object when specified.");if(void 0!==(e=t[ei])&&"boolean"!=typeof e)throw new zr("argument-error",ei+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ti])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new zr("argument-error",ti+" property must be a non empty string when specified.");this.i=t||null}var Zr="android",ti="dynamicLinkDomain",ei="handleCodeInApp",ni="iOS",ri="url",ii="installApp",oi="minimumVersion",ai="packageName",si="bundleId";function ui(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ci=null,hi=null;function li(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function fi(t){return(t=pi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new li(t):null}function pi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=hi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ci){ci={},hi={};for(var t=0;t<65;t++)ci[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(hi[ci[t]]=t)&&(hi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}(t))}catch(t){}return null}li.prototype.f=function(){return this.b};var di,yi={Wc:{Za:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://securetoken.googleapis.com/v1/token",id:"p"},Yc:{Za:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Zc:{Za:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",fb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function mi(t){for(var e in yi)if(yi[e].id===t)return{firebaseEndpoint:(t=yi[e]).Za,secureTokenEndpoint:t.fb};return null}di=mi("__EID__")?"__EID__":void 0;var vi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),gi=["client_id","response_type","scope","redirect_uri","state"],bi={Rc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",eb:gi},Tc:{Ma:null,Ba:500,Aa:620,Na:"github.com",eb:gi},Uc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",eb:gi},$c:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",eb:vi}};function wi(t){for(var e in bi)if(bi[e].Na==t)return bi[e];return null}function _i(t){var e={};e["facebook.com"]=Ci,e["google.com"]=Ai,e["github.com"]=Ni,e["twitter.com"]=ki;var n=t&&t[Ti];try{if(n)return e[n]?new e[n](t):new Ii(t);if(void 0!==t[Ei])return new Si(t)}catch(t){}return null}var Ei="idToken",Ti="providerId";function Si(t){var e=t[Ti];if(!e&&t[Ei]){var n=fi(t[Ei]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function Ii(t){Si.call(this,t),xr(this,"profile",Ur((t=Tr(t.rawUserInfo||"{}"))||{}))}function Ci(t){if(Ii.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ni(t){if(Ii.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Ai(t){if(Ii.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function ki(t){if(Ii.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function Di(t){this.a=_n(t)}function Ri(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function Oi(){}function Pi(t,e){return t.then(function(t){if(t[Ea]){var n=fi(t[Ea]);if(!n||e!=n.c)throw new zr("user-mismatch");return t}throw new zr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Xr+"user-not-found"?new zr("user-mismatch"):t})}function Mi(t,e){if(!e)throw new zr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function xi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Li(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Mi(t.providerId,t.pendingToken)}catch(t){}return null}function Fi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new zr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function Ui(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function qi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Fi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Vi(t,e){this.Ac=e||[],Lr(this,{providerId:t,isOAuthProvider:!0}),this.vb={},this.$a=(wi(t)||{}).Ma||null,this.Ya=null}function Bi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new zr("argument-error",'SAML provider IDs must be prefixed with "saml."');Vi.call(this,t,[])}function ji(t){Vi.call(this,t,gi),this.a=[]}function Wi(){ji.call(this,"facebook.com")}function Ki(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Wi).credential({accessToken:e})}function Qi(){ji.call(this,"github.com")}function Hi(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Qi).credential({accessToken:e})}function Gi(){ji.call(this,"google.com"),this.ua("profile")}function zi(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new Gi).credential({idToken:n,accessToken:e})}function Yi(){Vi.call(this,"twitter.com",vi)}function Xi(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new zr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Fi("twitter.com",n,"twitter.com")}function Ji(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===Zi.EMAIL_LINK_SIGN_IN_METHOD?Zi.EMAIL_LINK_SIGN_IN_METHOD:Zi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function $i(t){return t&&t.email&&t.password?new Ji(t.email,t.password,t.signInMethod):null}function Zi(){Lr(this,{providerId:"password",isOAuthProvider:!1})}function to(t,e){if(!(e=eo(e)))throw new zr("argument-error","Invalid email link!");return new Ji(t,e,Zi.EMAIL_LINK_SIGN_IN_METHOD)}function eo(t){var e=wn((t=new Di(t=Ri(t))).a,"oobCode")||null;return"signIn"===(wn(t.a,"mode")||null)&&e?e:null}function no(t){if(!(t.Sa&&t.Ra||t.Da&&t.$))throw new zr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function ro(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new no(e)}return null}function io(t){return t.a.Da&&t.a.$?{temporaryProof:t.a.Da,phoneNumber:t.a.$}:{sessionInfo:t.a.Sa,code:t.a.Ra}}function oo(t){try{this.a=t||po.auth()}catch(t){throw new zr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Lr(this,{providerId:"phone",isOAuthProvider:!1})}function ao(t,e){if(!t)throw new zr("missing-verification-id");if(!e)throw new zr("missing-verification-code");return new no({Sa:t,Ra:e})}function so(t){if(t.temporaryProof&&t.phoneNumber)return new no({Da:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return zi(o,n);case"facebook.com":return Ki(n);case"github.com":return Hi(n);case"twitter.com":return Xi(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Mi(e,a):new Fi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new ji(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function uo(t){if(!t.isOAuthProvider)throw new zr("invalid-oauth-provider")}function co(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new zr("invalid-auth-event");if(this.g&&this.a)throw new zr("invalid-auth-event");if(this.g&&!this.f)throw new zr("invalid-auth-event")}function ho(t){return(t=t||{}).type?new co(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Yr(t.error),t.postBody):null}function lo(){this.b=null,this.a=[]}I(Ii,Si),I(Ci,Ii),I(Ni,Ii),I(Ai,Ii),I(ki,Ii),Mi.prototype.ka=function(t){return Va(t,xi(this))},Mi.prototype.b=function(t,e){var n=xi(this);return n.idToken=e,Ba(t,n)},Mi.prototype.f=function(t,e){return Pi(ja(t,xi(this)),e)},Mi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Fi.prototype.ka=function(t){return Va(t,Ui(this))},Fi.prototype.b=function(t,e){var n=Ui(this);return n.idToken=e,Ba(t,n)},Fi.prototype.f=function(t,e){return Pi(ja(t,Ui(this)),e)},Fi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Vi.prototype.Ca=function(t){return this.vb=G(t),this},I(Bi,Vi),I(ji,Vi),ji.prototype.ua=function(t){return V(this.a,t)||this.a.push(t),this},ji.prototype.Db=function(){return K(this.a)},ji.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new zr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Fi(this.providerId,n,this.providerId)},I(Wi,ji),xr(Wi,"PROVIDER_ID","facebook.com"),xr(Wi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),I(Qi,ji),xr(Qi,"PROVIDER_ID","github.com"),xr(Qi,"GITHUB_SIGN_IN_METHOD","github.com"),I(Gi,ji),xr(Gi,"PROVIDER_ID","google.com"),xr(Gi,"GOOGLE_SIGN_IN_METHOD","google.com"),I(Yi,Vi),xr(Yi,"PROVIDER_ID","twitter.com"),xr(Yi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Ji.prototype.ka=function(t){return this.signInMethod==Zi.EMAIL_LINK_SIGN_IN_METHOD?vs(t,Xa,{email:this.a,oobCode:this.c}):vs(t,ps,{email:this.a,password:this.c})},Ji.prototype.b=function(t,e){return this.signInMethod==Zi.EMAIL_LINK_SIGN_IN_METHOD?vs(t,Ja,{idToken:e,email:this.a,oobCode:this.c}):vs(t,ss,{idToken:e,email:this.a,password:this.c})},Ji.prototype.f=function(t,e){return Pi(this.ka(t),e)},Ji.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Lr(Zi,{PROVIDER_ID:"password"}),Lr(Zi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Lr(Zi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),no.prototype.ka=function(t){return t.Ta(io(this))},no.prototype.b=function(t,e){var n=io(this);return n.idToken=e,vs(t,ys,n)},no.prototype.f=function(t,e){var n=io(this);return n.operation="REAUTH",Pi(t=vs(t,ms,n),e)},no.prototype.A=function(){var t={providerId:"phone"};return this.a.Sa&&(t.verificationId=this.a.Sa),this.a.Ra&&(t.verificationCode=this.a.Ra),this.a.Da&&(t.temporaryProof=this.a.Da),this.a.$&&(t.phoneNumber=this.a.$),t},oo.prototype.Ta=function(t,e){var n=this.a.c;return Yt(e.verify()).then(function(r){if(!s(r))throw new zr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return vs(n,os,e)}(0,{phoneNumber:t,recaptchaToken:r}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new zr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Lr(oo,{PROVIDER_ID:"phone"}),Lr(oo,{PHONE_SIGN_IN_METHOD:"phone"}),co.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},co.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.A()}};var fo,yo=null;function mo(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",zr.call(this,e,n)}function vo(t,e,n){zr.call(this,t,n),(t=e||{}).wb&&xr(this,"email",t.wb),t.$&&xr(this,"phoneNumber",t.$),t.credential&&xr(this,"credential",t.credential)}function go(t){if(t.code){var e=t.code||"";0==e.indexOf(Xr)&&(e=e.substring(Xr.length));var n={credential:so(t)};if(t.email)n.wb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new zr(e,t.message||void 0);return new vo(e,n,t.message)}return null}function bo(){}function wo(t){return t.c||(t.c=t.b())}function _o(){}function Eo(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function To(){}function So(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.ac,this),this.a.onerror=E(this.Eb,this),this.a.onprogress=E(this.bc,this),this.a.ontimeout=E(this.fc,this)}function Io(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Co(t,e,n){this.reset(t,e,n,void 0,void 0)}function No(t){this.f=t,this.b=this.c=this.a=null}function Ao(t,e){this.name=t,this.value=e}I(mo,zr),I(vo,zr),vo.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.A();return e&&Y(t,e),t},vo.prototype.toJSON=function(){return this.A()},bo.prototype.c=null,I(_o,bo),_o.prototype.a=function(){var t=Eo(this);return t?new ActiveXObject(t):new XMLHttpRequest},_o.prototype.b=function(){var t={};return Eo(this)&&(t[0]=!0,t[1]=!0),t},fo=new _o,I(To,bo),To.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new So;throw Error("Unsupported browser")},To.prototype.b=function(){return{}},(t=So.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.ac=function(){this.status=200,this.response=this.responseText=this.a.responseText,Io(this,4)},t.Eb=function(){this.status=500,this.response=this.responseText="",Io(this,4)},t.fc=function(){this.Eb()},t.bc=function(){this.status=200,Io(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Co.prototype.a=null,Co.prototype.reset=function(t,e,n,r,i){delete this.a},Ao.prototype.toString=function(){return this.name};var ko=new Ao("SEVERE",1e3),Do=new Ao("WARNING",900),Ro=new Ao("CONFIG",700),Oo=new Ao("FINE",500);No.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(k("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Co(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Po,Mo={},xo=null;function Lo(t){var e;if(xo||(xo=new No(""),(Mo[""]=xo).c=Ro),!(e=Mo[t])){e=new No(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Lo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Mo[t]=e}return e}function Fo(t,e){t&&t.log(Oo,e,void 0)}function Uo(t){this.f=t}function qo(t){nn.call(this),this.u=t,this.readyState=Vo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Lo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}I(Uo,bo),Uo.prototype.a=function(){return new qo(this.f)},Uo.prototype.b=(Po={},function(){return Po}),I(qo,nn);var Vo=0;function Bo(t){t.c.read().then(t.$b.bind(t)).catch(t.Ka.bind(t))}function jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Wo(t)}function Wo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ko(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Qo,this.v=this.O=!1}(t=qo.prototype).open=function(t,e){if(this.readyState!=Vo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Wo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.ec.bind(this),this.Ka.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,jo(this,!1)),this.readyState=Vo},t.ec=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Wo(this)),this.a&&(this.readyState=3,Wo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.cc.bind(this),this.Ka.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Bo(this)):t.text().then(this.dc.bind(this),this.Ka.bind(this)))))},t.$b=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?jo(this,!0):Wo(this),3==this.readyState&&Bo(this)}},t.dc=function(t){this.a&&(this.response=this.responseText=t,jo(this,!0))},t.cc=function(t){this.a&&(this.response=t,jo(this,!0))},t.Ka=function(t){var e=this.h;e&&e.log(Do,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Do,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Do,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},I(Ko,nn);var Qo="";Ko.prototype.b=Lo("goog.net.XhrIo");var Ho=/^https?$/i,Go=["POST","PUT"];function zo(t){return"content-type"==t.toLowerCase()}function Yo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Xo(t),$o(t)}function Xo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Jo(t){if(t.c&&void 0!==o)if(t.w[1]&&4==ta(t)&&2==ea(t))Fo(t.b,na(t,"Local request error detected and ignored"));else if(t.i&&4==ta(t))sn(t.Hb,0,t);else if(t.dispatchEvent("readystatechange"),4==ta(t)){Fo(t.b,na(t,"Request complete")),t.c=!1;try{var e,n=ea(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(dn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!Ho.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<ta(t)?t.a.statusText:""}catch(e){Fo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+ea(t)+"]",Xo(t)}}finally{$o(t)}}}function $o(t,e){if(t.a){Zo(t);var n=t.a,r=t.w[0]?l:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(ko,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Zo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(a.clearTimeout(t.u),t.u=null)}function ta(t){return t.a?t.a.readyState:0}function ea(t){try{return 2<ta(t)?t.a.status:-1}catch(t){return-1}}function na(t,e){return e+" ["+t.N+" "+t.l+" "+ea(t)+"]"}function ra(t){var e=da;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.m=0}function ia(t,e,n){t.a=!0,t.c=n,t.f=!e,ua(t)}function oa(t){if(t.a){if(!t.l)throw new ca(t);t.l=!1}}function aa(t,e,n,r){t.g.push([e,n,r]),t.a&&ua(t)}function sa(t){return q(t.g,function(t){return m(t[1])})}function ua(t){if(t.h&&t.a&&sa(t)){var e=t.h,n=fa[e];n&&(a.clearTimeout(n.a),delete fa[e]),t.h=0}t.b&&(t.b.m--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(C(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,sa(t)||(n=!0)}}t.c=e,r&&(u=E(t.o,t,!0),r=E(t.o,t,!1),e instanceof ra?(aa(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new la(e),fa[e.a]=e,t.h=e.a)}function ca(){N.call(this)}function ha(){N.call(this)}function la(t){this.a=a.setTimeout(E(this.c,this),0),this.b=t}(t=Ko.prototype).Ea=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Fo(this.b,na(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Fo(this.b,na(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),$o(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),$o(this,!0)),Ko.mb.va.call(this)},t.Hb=function(){this.qa||(this.I||this.i||this.f?Jo(this):this.tc())},t.tc=function(){Jo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Qo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(ko,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Fo(this.b,"Can not get response: "+t.message),null}},ra.prototype.cancel=function(t){if(this.a)this.c instanceof ra&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new ha(this),oa(this),ia(this,!1,t))}},ra.prototype.o=function(t,e){this.i=!1,ia(this,t,e)},ra.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return aa(this,r,function(t){t instanceof ha?o.cancel():i(t)}),o.then(t,e,n)},ra.prototype.$goog_Thenable=!0,I(ca,N),ca.prototype.message="Deferred has already fired",ca.prototype.name="AlreadyCalledError",I(ha,N),ha.prototype.message="Deferred was canceled",ha.prototype.name="CanceledError",la.prototype.c=function(){throw delete fa[this.a],this.b};var fa={};function pa(t){var e,n=document,r=nt(t).toString(),i=document.createElement("SCRIPT"),o={Jb:i,Ea:void 0},s=new ra(o);return e=window.setTimeout(function(){ya(i,!0);var t=new ga(va,"Timeout reached for loading script "+r);oa(s),ia(s,!1,t)},5e3),o.Ea=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(ya(i,!1,e),oa(s),ia(s,!0,null))},i.onerror=function(){ya(i,!0,e);var t=new ga(ma,"Error while loading script "+r);oa(s),ia(s,!1,t)},Y(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=nt(e),null===h&&(h=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function da(){if(this&&this.Jb){var t=this.Jb;t&&"SCRIPT"==t.tagName&&ya(t,!0,this.Ea)}}function ya(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ma=0,va=1;function ga(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),N.call(this,n),this.code=t}function ba(t){this.f=t}function wa(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ta,this.f=G(t.secureTokenHeaders||Sa),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Ia,this.a=G(t.firebaseHeaders||Ca),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==sr(),!(n=a.XMLHttpRequest||n&&po.INTERNAL.node&&po.INTERNAL.node.XMLHttpRequest)&&!ar())throw new zr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,ar()?this.c=new Uo(self):ur()?this.c=new ba(n):this.c=new To}I(ga,N),I(ba,bo),ba.prototype.a=function(){return new this.f},ba.prototype.b=function(){return{}};var _a,Ea="idToken",Ta=new Nr(3e4,6e4),Sa={"Content-Type":"application/x-www-form-urlencoded"},Ia=new Nr(3e4,6e4),Ca={"Content-Type":"application/json"};function Na(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Aa(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function ka(t,e,n,r,i,o,s){(t=function(){var t=dr();return!((t=lr(t)!=hr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30||me&&Ie&&!(9<Ie))}()||ar()?E(t.o,t):(_a=_a||new jt(function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(a[Ra]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){aa(pa(rt(Da,{onload:Ra})),null,e,void 0)}(0,function(){e(Error("CORS_UNSUPPORTED"))}))}(t,e)}),E(t.l,t)))(e,n,r,i,o,s)}wa.prototype.o=function(t,e,n,r,i,o){if(ar()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new zr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new Ko(this.c);if(o){u.g=Math.max(0,o);var c=setTimeout(function(){u.dispatchEvent("timeout")},o)}rn(u,"complete",function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Fo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),on(u,"ready",function(){c&&clearTimeout(c),le(this)}),on(u,"timeout",function(){c&&clearTimeout(c),le(this),e&&e(null)}),function(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.N=n,t.G=!1,t.c=!0,t.a=t.B?t.B.a():fo.a(),t.w=t.B?wo(t.B):wo(fo),t.a.onreadystatechange=E(t.Hb,t);try{Fo(t.b,na(t,"Opening Xhr")),t.I=!0,t.a.open(n,String(e),!0),t.I=!1}catch(e){return Fo(t.b,na(t,"Error opening Xhr: "+e.message)),void Yo(t,e)}e=r||"";var o=new ln(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||s(t))F(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=zo,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:s(t)?t.charAt(e):t[e]}(o.U()),r=a.FormData&&e instanceof a.FormData,!V(Go,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.o&&(t.a.responseType=t.o),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{Zo(t),0<t.g&&(t.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Fo(t.b,na(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ea,t)):t.u=sn(t.Ea,t.g,t)),Fo(t.b,na(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Fo(t.b,na(t,"Send error: "+e.message)),Yo(t,e)}}(u,t,n,r,i)};var Da=new X(Z,"https://apis.google.com/js/client.js?onload=%{onload}"),Ra="__fcb"+Math.floor(1e6*Math.random()).toString();function Oa(t){if(!s(t=t.email)||!nr.test(t))throw new zr("invalid-email")}function Pa(t){"email"in t&&Oa(t)}function Ma(t){if(!t[Ea])throw new zr("internal-error")}function xa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new zr("internal-error")}else{if(!t.sessionInfo)throw new zr("missing-verification-id");if(!t.code)throw new zr("missing-verification-code")}}wa.prototype.l=function(t,e,n,r,i){var o=this;_a.then(function(){window.gapi.client.setApiKey(o.b);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},wa.prototype.kb=function(){return vs(this,us,{})},wa.prototype.nb=function(t,e){return vs(this,as,{idToken:t,email:e})},wa.prototype.ob=function(t,e){return vs(this,ss,{idToken:t,password:e})};var La={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Fa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new zr("internal-error")}function Ua(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function qa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=go(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=go(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=go(t)):t.errorMessage&&(e=gs(t.errorMessage)),e)throw e;if(!t[Ea])throw new zr("internal-error")}function Va(t,e){return e.returnIdpCredential=!0,vs(t,cs,e)}function Ba(t,e){return e.returnIdpCredential=!0,vs(t,ls,e)}function ja(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,vs(t,hs,e)}function Wa(t){if(!t.oobCode)throw new zr("invalid-action-code")}(t=wa.prototype).pb=function(t,e){var n={idToken:t},r=[];return Q(La,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),vs(this,as,n)},t.hb=function(t,e){return Y(t={requestType:"PASSWORD_RESET",email:t},e),vs(this,es,t)},t.ib=function(t,e){return Y(t={requestType:"EMAIL_SIGNIN",email:t},e),vs(this,Za,t)},t.gb=function(t,e){return Y(t={requestType:"VERIFY_EMAIL",idToken:t},e),vs(this,ts,t)},t.Ta=function(t){return vs(this,ds,t)},t.Xa=function(t,e){return vs(this,is,{oobCode:t,newPassword:e})},t.Ia=function(t){return vs(this,Qa,{oobCode:t})},t.Va=function(t){return vs(this,Ka,{oobCode:t})};var Ka={endpoint:"setAccountInfo",D:Wa,da:"email"},Qa={endpoint:"resetPassword",D:Wa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new zr("internal-error")}},Ha={endpoint:"signupNewUser",D:function(t){if(Oa(t),!t.password)throw new zr("weak-password")},J:Ma,R:!0},Ga={endpoint:"createAuthUri"},za={endpoint:"deleteAccount",T:["idToken"]},Ya={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new zr("internal-error")}},Xa={endpoint:"emailLinkSignin",T:["email","oobCode"],D:Oa,J:Ma,R:!0},Ja={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],D:Oa,J:Ma,R:!0},$a={endpoint:"getAccountInfo"},Za={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new zr("internal-error");Oa(t)},da:"email"},ts={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new zr("internal-error")},da:"email"},es={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new zr("internal-error");Oa(t)},da:"email"},ns={sb:!0,endpoint:"getProjectConfig",Gb:"GET"},rs={sb:!0,endpoint:"getRecaptchaParam",Gb:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new zr("internal-error")}},is={endpoint:"resetPassword",D:Wa,da:"email"},os={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},as={endpoint:"setAccountInfo",T:["idToken"],D:Pa,R:!0},ss={endpoint:"setAccountInfo",T:["idToken"],D:function(t){if(Pa(t),!t.password)throw new zr("weak-password")},J:Ma,R:!0},us={endpoint:"signupNewUser",J:Ma,R:!0},cs={endpoint:"verifyAssertion",D:Fa,Oa:Ua,J:qa,R:!0},hs={endpoint:"verifyAssertion",D:Fa,Oa:Ua,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new zr("user-not-found");if(t.errorMessage)throw gs(t.errorMessage);if(!t[Ea])throw new zr("internal-error")},R:!0},ls={endpoint:"verifyAssertion",D:function(t){if(Fa(t),!t.idToken)throw new zr("internal-error")},Oa:Ua,J:qa,R:!0},fs={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new zr("invalid-custom-token")},J:Ma,R:!0},ps={endpoint:"verifyPassword",D:function(t){if(Oa(t),!t.password)throw new zr("wrong-password")},J:Ma,R:!0},ds={endpoint:"verifyPhoneNumber",D:xa,J:Ma},ys={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new zr("internal-error");xa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",go(t);Ma(t)}},ms={Tb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:xa,J:Ma};function vs(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Xt(new zr("internal-error"));var r,i=e.Gb||"POST";return Yt(n).then(e.D).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var a=_n(t.g+e);bn(a,"key",t.b),o&&bn(a,"cb",S().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&bn(a,u,r[u]);return new jt(function(e,o){ka(t,a.toString(),function(t){t?t.error?o(bs(t,i||{})):e(t):o(new zr("network-request-failed"))},n,s?void 0:Kn(Er(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Tb,e.sb||!1)}).then(function(t){return r=t,e.Oa?e.Oa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new zr("internal-error");return r[e.da]})}function gs(t){return bs({error:{errors:[{message:t}],code:400,message:t}})}function bs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new zr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",Y(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new zr(r[i],e);return!e&&t&&(e=_r(t)),new zr("internal-error",e)}function ws(t){this.b=t,this.a=null,this.bb=function(t){return(Ss=Ss||new jt(function(t,e){function n(){Cr(),yr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Cr(),e(Error("Network Error"))},timeout:Es.get()})}if(yr("gapi.iframes.Iframe"))t();else if(yr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){yr("gapi.load")?n():e(Error("Network Error"))},Yt(pa(r=rt(_s,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ss=null,t})).then(function(){return new jt(function(e,n){yr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},Ts.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var _s=new X(Z,"https://apis.google.com/js/api.js?onload=%{onload}"),Es=new Nr(3e4,6e4),Ts=new Nr(5e3,15e3),Ss=null;function Is(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Cs(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function Ns(t){try{return po.app(t).auth().ya()}catch(t){return[]}}function As(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function ks(t){var e=Xn();return function(t){return vs(t,ns,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=_n(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(a=0==o.indexOf("chrome-extension://")?_n(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(er.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new mo(Xn())})}function Ds(t){return t.m||(t.m=rr().then(function(){if(!t.u){var e=t.c,n=t.h,r=Ns(t.b),i=new Is(t.l,t.f,t.b);i.f=e,i.b=n,i.c=K(r||[]),t.u=i.toString()}t.i=new ws(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.bb.then(function(){t.a.register("authEvent",e,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=ho(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Yt(n)}return n.status="ERROR",Yt(n)})}(t)})),t.m}function Rs(t){return t.o||(t.v=t.c?pr(t.c,Ns(t.b)):null,t.o=new wa(t.f,mi(t.h),t.v)),t.o}function Os(t,e,n,r,i,o,a,s,u,c){return(t=new Cs(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=G(u||null),t.f=c,t.toString()}function Ps(t){if(this.a=t||po.INTERNAL.reactNative&&po.INTERNAL.reactNative.AsyncStorage,!this.a)throw new zr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ms(t){this.b=t,this.a={},this.f=E(this.c,this)}Is.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Cs.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.l),bn(t,"appName",this.c),bn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=po.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.Ya=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).vb))n[r]=n[r].toString();r=e.Ac,n=G(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.$a&&e.Ya&&!n[e.$a]&&(n[e.$a]=e.Ya),H(n)||bn(t,"customParameters",_r(n))}if("function"==typeof this.a.Db&&(e=this.a.Db()).length&&bn(t,"scopes",e.join(",")),this.i?bn(t,"redirectUrl",this.i):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.h?bn(t,"v",this.h):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Ns(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=As.prototype).Bb=function(t,e,n){var r=new zr("popup-closed-by-user"),i=new zr("web-storage-unsupported"),o=this,a=!1;return this.fa().then(function(){(function(t){var e={type:"webStorageSupport"};return Ds(t).then(function(){return function(t,e){return t.bb.then(function(){return new jt(function(n){t.a.send(e.type,e,n,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&Zn(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new jt(function(e){return function n(){un(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return un(n).then(function(){e(r)})})},t.Kb=function(){var t=dr();return!wr(t)&&!Ir(t)},t.Fb=function(){return!1},t.zb=function(t,e,n,r,i,o,a){if(!t)return Xt(new zr("popup-blocked"));if(a&&!wr())return this.fa().s(function(e){Zn(t),i(e)}),r(),Yt();this.a||(this.a=ks(Rs(this)));var s=this;return this.a.then(function(){var e=s.fa().s(function(e){throw Zn(t),i(e),e});return r(),e}).then(function(){uo(n),a||Jn(Os(s.l,s.f,s.b,e,n,null,o,s.c,void 0,s.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ab=function(t,e,n){this.a||(this.a=ks(Rs(this)));var r=this;return this.a.then(function(){uo(e),Jn(Os(r.l,r.f,r.b,t,e,Xn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.fa=function(){var t=this;return Ds(this).then(function(){return t.i.bb}).s(function(){throw t.a=null,new zr("network-request-failed")})},t.Mb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ja=function(t){j(this.g,function(e){return e==t})},(t=Ps.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Tr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,_r(e)))},t.P=function(t){return Yt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var xs,Ls=[];function Fs(t,e,n){H(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Us(t){this.a=t}function qs(t){this.c=t,this.b=!1,this.a=[]}function Vs(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Xt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Bs(t,c),e}).s(function(e){throw Bs(t,c),e})}function Bs(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),j(t.a,function(t){return t==e})}}function js(){if(!Ks())throw new zr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=a.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var t=this;ar()&&self?(this.m=function(){var t=ar()?self:null;if(F(Ls,function(n){n.b==t&&(e=n)}),!e){var e=new Ms(t);Ls.push(e)}return e}(),Fs(this.m,"keyChanged",function(e,n){return Ys(t).then(function(e){return 0<e.length&&F(t.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Fs(this.m,"ping",function(){return Yt(["keyChanged"])})):function(){var t=a.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(e){(t.h=e)&&(t.g=new qs(new Us(e)),Vs(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&V(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function Ws(t){return t.o||(t.o=function t(e){return new jt(function(n,r){var i=e.l.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(t){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){r(t)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new jt(function(e,n){var r=t.l.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(e).then(function(){return t(e)}).then(function(t){n(t)}).s(function(t){r(t)})}})}(t)),t.o}function Ks(){try{return!!a.indexedDB}catch(t){return!1}}function Qs(t){return t.objectStore("firebaseLocalStorage")}function Hs(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Gs(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function zs(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Vs(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Yt()}function Ys(t){return Ws(t).then(function(t){var e=Qs(Hs(t,!1));return e.getAll?Gs(e.getAll()):new jt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function Xs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Js(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(Ks()){var t=Sr(),r="__sak"+t;return xs=xs||new js,(n=xs).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){F(e.a,function(e){e(t)})}),t})}function $s(){this.a={},this.type="inMemory"}function Zs(){if(!function(){var t="Node"==sr();if(!(t=tu()||t&&po.INTERNAL.node&&po.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The LocalStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=tu()||po.INTERNAL.node.localStorage,this.type="localStorage"}function tu(){try{var t=a.localStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function eu(){this.type="nullStorage"}function nu(){if(!function(){var t="Node"==sr();if(!(t=ru()||t&&po.INTERNAL.node&&po.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The SessionStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=ru()||po.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function ru(){try{var t=a.sessionStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function iu(){var t={};t.Browser=su,t.Node=uu,t.ReactNative=cu,t.Worker=hu,this.a=t[sr()]}Ms.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,function(e){i.push(Yt().then(function(){return e(t.origin,t.data.data)}))}),$t(i).then(function(r){var i=[];F(r,function(t){i.push({fulfilled:t.Cb,value:t.value,reason:t.reason?t.reason.message:void 0})}),F(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Us.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},qs.prototype.close=function(){for(;0<this.a.length;)Bs(this,this.a[0]);this.b=!0},(t=js.prototype).set=function(t,e){var n,r=!1,i=this;return Ws(this).then(function(e){return Gs((e=Qs(Hs(n=e,!0))).get(t))}).then(function(o){var a=Qs(Hs(n,!0));return o?(o.value=e,Gs(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Gs(a.add(o)))}).then(function(){return i.c[t]=e,zs(i,t)}).ha(function(){r&&i.b--})},t.get=function(t){return Ws(this).then(function(e){return Gs(Qs(Hs(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return Ws(this).then(function(r){return e=!0,n.b++,Gs(Qs(Hs(r,!0)).delete(t))}).then(function(){return delete n.c[t],zs(n,t)}).ha(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){Xs(t),function e(){t.f=setTimeout(function(){t.i=Ys(t).then(function(e){0<e.length&&F(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){j(this.a,function(e){return e==t}),0==this.a.length&&Xs(this)},(t=Js.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){j(this.a,function(e){return e==t})},(t=$s.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.P=function(t){return delete this.a[t],Yt()},t.Y=function(){},t.ca=function(){},(t=Zs.prototype).get=function(t){var e=this;return Yt().then(function(){return Tr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Yt().then(function(){var r=_r(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(t){a.window&&Ke(a.window,"storage",t)},t.ca=function(t){a.window&&Ge(a.window,"storage",t)},(t=eu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.P=function(){return Yt()},t.Y=function(){},t.ca=function(){},(t=nu.prototype).get=function(t){var e=this;return Yt().then(function(){return Tr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Yt().then(function(){var r=_r(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var ou,au,su={C:Zs,Qa:nu},uu={C:Zs,Qa:nu},cu={C:Ps,Qa:eu},hu={C:Zs,Qa:eu},lu={Vc:"local",NONE:"none",Xc:"session"};function fu(){var t=!(Ir(dr())||!or()),e=wr(),n=mr();this.o=t,this.h=e,this.m=n,this.a={},t=ou=ou||new iu;try{this.g=!Yn()&&Dr()||!a.indexedDB?new t.a.C:new Js(ar()?new $s:new t.a.C)}catch(t){this.g=new $s,this.h=!0}try{this.i=new t.a.Qa}catch(t){this.i=new $s}this.l=new $s,this.f=E(this.Lb,this),this.b={}}function pu(){return au=au||new fu}function du(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function yu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function mu(t,e,n){return n=yu(e,n),"local"==e.C&&(t.b[n]=null),du(t,e.C).P(n)}function vu(t){t.c&&(clearInterval(t.c),t.c=null)}function gu(t){this.a=t,this.b=pu()}(t=fu.prototype).get=function(t,e){return du(this,t.C).get(yu(t,e))},t.set=function(t,e,n){var r=yu(t,n),i=this,o=du(this,t.C);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.C&&(i.b[r]=e)})},t.addListener=function(t,e,n){t=yu(t,e),this.m&&(this.b[t]=a.localStorage.getItem(t)),H(this.a)&&(du(this,"local").Y(this.f),this.h||(Yn()||!Dr())&&a.indexedDB||!this.m||function(t){vu(t),t.c=setInterval(function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Pe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Lb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=yu(t,e),this.a[t]&&(j(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),H(this.a)&&(du(this,"local").ca(this.f),vu(this))},t.Lb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Wa(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?du(this,"local").ca(this.f):vu(this),this.o)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.Wa(e))},me&&Ie&&10==Ie&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,E(this.Wa,this))},t.Wa=function(t){this.a[t]&&F(this.a[t],function(t){t()})};var bu,wu={name:"authEvent",C:"local"};function _u(){this.a=pu()}function Eu(t,e){this.b=Tu,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=a.Int32Array?new Int32Array(64):Array(64),void 0!==bu||(bu=a.Int32Array?new Int32Array(Du):Du),this.reset()}I(Eu,function(){this.b=-1});for(var Tu=64,Su=Tu-1,Iu=[],Cu=0;Cu<Su;Cu++)Iu[Cu]=0;var Nu=W(128,Iu);function Au(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|bu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function ku(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Au(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Au(t),i=0)}}t.c=i,t.g+=n}Eu.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):K(this.h)};var Du=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Ru(){Eu.call(this,8,Ou)}I(Ru,Eu);var Ou=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Pu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new _u,this.g=new gu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Mu(t){return new zr("invalid-cordova-configuration",t)}function xu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Lu(t){return t.f||(t.f=t.fa().then(function(){return new jt(function(e){t.wa(function n(r){return e(r),t.Ja(n),!1}),function(t){function e(e){r=!0,i&&i.cancel(),Fu(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Ri(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Tr(wn(o=_n(i),"firebaseError")||null))?Yr(o):null)?new co(r.c,r.b,null,null,o):new co(r.c,r.b,i,r.f)),i=o||n}xu(t,i)})}var n=new co("unknown",null,null,null,new zr("no-auth-event")),r=!1,i=un(500).then(function(){return Fu(t).then(function(){r||xu(t,n)})}),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(yr("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},yo=yo||new lo,function(t){var e=yo;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=yr("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)})})),t.f}function Fu(t){var e=null;return function(t){return t.b.get(wu,t.a).then(function(t){return ho(t)})}(t.g).then(function(n){return e=n,mu((n=t.g).b,wu,n.a)}).then(function(){return e})}function Uu(t){this.a=t,this.b=pu()}(t=Pu.prototype).fa=function(){return this.za?this.za:this.za=(ir(void 0)?rr().then(function(){return new jt(function(t,e){var n=a.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof yr("universalLinks.subscribe",a))throw Mu("cordova-universal-links-plugin-fix is not installed");if(void 0===yr("BuildInfo.packageName",a))throw Mu("cordova-plugin-buildinfo is not installed");if("function"!=typeof yr("cordova.plugins.browsertab.openUrl",a))throw Mu("cordova-plugin-browsertab is not installed");if("function"!=typeof yr("cordova.InAppBrowser.open",a))throw Mu("cordova-plugin-inappbrowser is not installed")},function(){throw new zr("cordova-not-ready")})},t.Bb=function(t,e){return e(new zr("operation-not-supported-in-this-environment")),Yt()},t.zb=function(){return Xt(new zr("operation-not-supported-in-this-environment"))},t.Mb=function(){return!1},t.Kb=function(){return!0},t.Fb=function(){return!0},t.Ab=function(t,e,n){if(this.c)return Xt(new zr("redirect-operation-pending"));var r=this,i=a.document,o=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return uo(e),Lu(r)}).then(function(){return function(t,e,n,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new co(e,r,null,i,new zr("no-auth-event")),s=yr("BuildInfo.packageName",a);if("string"!=typeof s)throw new zr("invalid-cordova-configuration");var u=yr("BuildInfo.displayName",a),c={};if(dr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!dr().toLowerCase().match(/android/))return Xt(new zr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),i=function(t){var e=new Ru;ku(e,t),t=[];var n=8*e.g;e.c<56?ku(e,Nu,56-e.c):ku(e,Nu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Au(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return U(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}(i),c.sessionId=i;var h=Os(t.l,t.i,t.m,e,n,null,r,t.o,c,t.u);return t.fa().then(function(){var e=t.h;return t.v.a.set(wu,o.A(),e)}).then(function(){var e=yr("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new zr("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=yr("cordova.plugins.browsertab.openUrl",a)))throw new zr("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=yr("cordova.InAppBrowser.open",a)))throw new zr("invalid-cordova-configuration");e=dr(),t.a=n(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new jt(function(t,e){s=function(){var e=yr("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(s),u=function(){o=o||un(2e3).then(function(){e(new zr("redirect-cancelled-by-user"))})},c=function(){Ar()&&u()},i.addEventListener("resume",u,!1),dr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",c,!1)}).s(function(t){return Fu(r).then(function(){throw t})})}).ha(function(){u&&i.removeEventListener("resume",u,!1),c&&i.removeEventListener("visibilitychange",c,!1),o&&o.cancel(),s&&r.Ja(s),r.c=null})},t.wa=function(t){this.b.push(t),Lu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new co("unknown",null,null,null,new zr("no-auth-event")),t(e))})},t.Ja=function(t){j(this.b,function(e){return e==t})};var qu={name:"pendingRedirect",C:"session"};function Vu(t){return mu(t.b,qu,t.a)}function Bu(t,e,n){this.i={},this.v=0,this.B=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=E(this.u,this),this.b=new ec,this.w=new ac,this.g=new Uu(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=ju(this.B,this.l,this.o,di)}function ju(t,e,n,r){var i=po.SDK_VERSION||null;return ir()?new Pu(t,e,n,i,r):new As(t,e,n,i,r)}function Wu(t){t.f||(t.f=!0,t.a.wa(t.m));var e=t.a;return t.a.fa().s(function(n){throw t.a==e&&t.reset(),n})}function Ku(t){t.a.Kb()&&Wu(t).s(function(e){var n=new co("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));Xu(e)&&t.u(n)}),t.a.Fb()||nc(t.b)}function Qu(t,e){V(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(qu,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?Vu(t.g).then(function(){Wu(t).s(function(e){var n=new co("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));Xu(e)&&t.u(n)})}):Ku(t)}).s(function(){Ku(t)})}function Hu(t,e){j(t.h,function(t){return t==e})}Bu.prototype.reset=function(){this.f=!1,this.a.Ja(this.m),this.a=ju(this.B,this.l,this.o),this.i={}},Bu.prototype.u=function(t){if(!t)throw new zr("invalid-auth-event");if(6e5<=S()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.tb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=S())),e=!0;break}}return nc(this.b),e};var Gu=new Nr(2e3,1e4),zu=new Nr(3e4,6e4);function Yu(t,e,n,r,i,o){return t.a.zb(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function Xu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function Ju(t,e,n,r){var i;return function(t){return t.b.set(qu,"pending",t.a)}(t.g).then(function(){return t.a.Ab(e,n,r).s(function(e){if(Xu(e))throw new zr("operation-not-supported-in-this-environment");return i=e,Vu(t.g).then(function(){throw i})}).then(function(){return t.a.Mb()?new jt(function(){}):Vu(t.g).then(function(){return t.la()}).then(function(){}).s(function(){})})})}function $u(t,e,n,r,i){return t.a.Bb(r,function(t){e.ga(n,null,t,i)},Gu.get())}Bu.prototype.la=function(){return this.b.la()};var Zu={};function tc(t,e,n){var r=e+":"+n;return Zu[r]||(Zu[r]=new Bu(t,e,n)),Zu[r]}function ec(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function nc(t){t.g||(t.g=!0,oc(t,!1,null,null))}function rc(t){t.g&&!t.i&&oc(t,!1,null,null)}function ic(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function oc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):ic(t,n):ic(t,{user:null}),t.f=[],t.c=[]}function ac(){}function sc(){this.qb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.qb},set:function(t){this.qb=t},enumerable:!1})}function uc(t,e){this.a=e,xr(this,"verificationId",t)}function cc(t,e,n,r){return new oo(t).Ta(e,n).then(function(t){return new uc(t,r)})}function hc(t){var e=pi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new zr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Lr(this,{token:t,expirationTime:kr(1e3*e.exp),authTime:kr(1e3*e.auth_time),issuedAtTime:kr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function lc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function fc(t){this.f=t,this.b=this.a=null,this.c=0}function pc(t,e){var n=e[Ea],r=e.refreshToken;e=dc(e.expiresIn),t.b=n,t.c=e,t.a=r}function dc(t){return S()+1e3*parseInt(t,10)}function yc(t,e){this.a=t||null,this.b=e||null,Lr(this,{lastSignInTime:kr(e||null),creationTime:kr(t||null)})}function mc(t,e,n,r,i,o){Lr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function vc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function gc(t,e,n){this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=po.SDK_VERSION?pr(po.SDK_VERSION):null,this.a=new wa(this.l,mi(di),t),this.c=new fc(this.a),Ic(this,e[Ea]),pc(this.c,e),xr(this,"refreshToken",this.c.a),Ac(this,n||{}),nn.call(this),this.I=!1,this.u&&vr()&&(this.i=tc(this.u,this.l,this.o)),this.N=[],this.h=null,this.w=function(t){return new lc(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.c.c-S()-3e5;return 0<e?e:0})}(this),this.V=E(this.Fa,this);var r=this;this.ja=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){wc(r,t.c)},this.W=null}function bc(t,e){t.X&&Ge(t.X,"languageCodeChanged",t.ta),(t.X=e)&&Ke(e,"languageCodeChanged",t.ta)}function wc(t,e){t.O=e,Aa(t.a,po.SDK_VERSION?pr(po.SDK_VERSION,t.O):null)}function _c(t,e){t.W&&Ge(t.W,"frameworkChanged",t.sa),(t.W=e)&&Ke(e,"frameworkChanged",t.sa)}function Ec(t){try{return po.app(t.o).auth()}catch(e){throw new zr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.o+"'!")}}function Tc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.V),Ke(t,"tokenChanged",t.V))}function Sc(t){Ge(t,"tokenChanged",t.V),t.w.stop()}function Ic(t,e){t.ra=e,xr(t,"_lat",e)}function Cc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return $t(e).then(function(){return t})}function Nc(t){t.i&&!t.I&&(t.I=!0,Qu(t.i,t))}function Ac(t,e){Lr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new yc(e.createdAt,e.lastLoginAt),providerData:[]})}function kc(){}function Dc(t){return Yt().then(function(){if(t.B)throw new zr("app-deleted")})}function Rc(t){return U(t.providerData,function(t){return t.providerId})}function Oc(t,e){e&&(Pc(t,e.providerId),t.providerData.push(e))}function Pc(t,e){j(t.providerData,function(t){return t.providerId==e})}function Mc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function xc(t,e){t!=e&&(Lr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?xr(t,"metadata",function(t){return new yc(t.a,t.b)}(e.metadata)):xr(t,"metadata",new yc),F(e.providerData,function(e){Oc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.c,e.c),xr(t,"refreshToken",t.c.a))}function Lc(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return vs(t.a,$a,{idToken:e}).then(E(t.uc,t))}(t,e).then(function(){return n||Mc(t,"isAnonymous",!1),e})})}function Fc(t,e){e[Ea]&&t.ra!=e[Ea]&&(pc(t.c,e),t.dispatchEvent(new vc("tokenChanged")),Ic(t,e[Ea]),Mc(t,"refreshToken",t.c.a))}function Uc(t,e){return Lc(t).then(function(){if(V(Rc(t),e))return Cc(t).then(function(){throw new zr("provider-already-linked")})})}function qc(t,e,n){return Fr({user:t,credential:so(e),additionalUserInfo:e=_i(e),operationType:n})}function Vc(t,e){return Fc(t,e),t.reload().then(function(){return t})}function Bc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=wi(n.providerId),a=Sr(t.uid+":::"),s=null;(!wr()||or())&&t.u&&n.isOAuthProvider&&(s=Os(t.u,t.l,t.o,e,n,null,a,po.SDK_VERSION||null));var u=tr(s,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(Wc(t),!i)return t.F().then(function(){})}).then(function(){return Yu(t.i,u,e,n,a,!!s)}).then(function(){return new jt(function(n,r){t.ga(e,null,new zr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.b=$u(t.i,t,e,u,a)})}).then(function(t){return u&&Zn(u),t?Fr(t):null}).s(function(t){throw u&&Zn(u),t}),Kc(t,r,i)}function jc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=null,a=Sr(t.uid+":::");return r=r().then(function(){if(Wc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=a,Cc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(Gc,t.A(),e.a)),e}).then(function(){return Ju(t.i,e,n,a)}).s(function(e){if(o=e,t.ba)return zc(t.ba);throw o}).then(function(){if(o)throw o}),Kc(t,r,i)}function Wc(t){if(!t.i||!t.I){if(t.i&&!t.I)throw new zr("internal-error");throw new zr("auth-domain-config-required")}}function Kc(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Xt(t.h)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new vc("userInvalidated")),t.h=e),e})}(t,e,n);return t.G.push(r),r.ha(function(){B(t.G,r)}),r}function Qc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ea]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-S())/1e3;var r=new gc(e,n,t);return t.providerData&&F(t.providerData,function(t){t&&Oc(r,Fr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Hc(t){this.a=t,this.b=pu()}ec.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},ec.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(oc(this,!0,null,t.a),Yt()):e.xa(n,r)?function(t,e,n){n=n.xa(e.c,e.b);var r=e.g,i=e.f,o=e.h,a=!!e.c.match(/Redirect$/);n(r,i,o).then(function(e){oc(t,a,e,null)}).s(function(e){oc(t,a,null,e)})}(this,t,e):Xt(new zr("invalid-auth-event")):(oc(this,!1,null,null),Yt())}else Xt(new zr("invalid-auth-event"))},ec.prototype.la=function(){var t=this;return new jt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new zr("timeout");t.a&&t.a.cancel(),t.a=un(zu.get()).then(function(){t.b||(t.g=!0,oc(t,!0,null,e))})}(t))})},ac.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ga(t.c,null,t.a,t.b),Yt()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ga(r,t,null,n)}).s(function(t){e.ga(r,null,t,n)})}(t,e):Xt(new zr("invalid-auth-event"))}else Xt(new zr("invalid-auth-event"))},uc.prototype.confirm=function(t){return t=ao(this.verificationId,t),this.a(t)},lc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=un(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=a.document,e=null,Ar()||!t?Yt():new jt(function(n){e=function(){Ar()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},lc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},fc.prototype.A=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},fc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new zr("user-token-expired")):t||!this.b||S()>this.c-3e4?this.a?function(t,e){return function(t,e){return new jt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?ka(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(bs(t)):t.access_token&&t.refresh_token?n(t):r(new zr("internal-error")):r(new zr("network-request-failed"))},"POST",Pn(e).toString(),t.f,t.m.get()):r(new zr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=dc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},yc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},I(vc,Oe),I(gc,nn),gc.prototype.pa=function(t){this.ja=t,Na(this.a,t)},gc.prototype.ea=function(){return this.ja},gc.prototype.ya=function(){return K(this.O)},gc.prototype.Fa=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(gc.prototype,"providerId","firebase"),(t=gc.prototype).reload=function(){var t=this;return Kc(this,Dc(this).then(function(){return Lc(t).then(function(){return Cc(t)}).then(kc)}))},t.Zb=function(t){return this.F(t).then(function(t){return new hc(t)})},t.F=function(t){var e=this;return Kc(this,Dc(this).then(function(){return e.c.getToken(t)}).then(function(t){if(!t)throw new zr("internal-error");return t.accessToken!=e.ra&&(Ic(e,t.accessToken),e.dispatchEvent(new vc("tokenChanged"))),Mc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.uc=function(t){if(!(t=t.users)||!t.length)throw new zr("internal-error");Ac(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?U(t,function(t){return new mc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Oc(this,e[n]);Mc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.vc=function(t){return Pr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.cb(t)},t.cb=function(t){var e=this,n=null;return Kc(this,t.f(this.a,this.uid).then(function(t){return Fc(e,t),n=qc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.mc=function(t){return Pr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.ab(t)},t.ab=function(t){var e=this,n=null;return Kc(this,Uc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=qc(e,t,"link"),Vc(e,t)}).then(function(){return n}))},t.nc=function(t,e){var n=this;return Kc(this,Uc(this,"phone").then(function(){return cc(Ec(n),t,e,E(n.ab,n))}))},t.wc=function(t,e){var n=this;return Kc(this,Yt().then(function(){return cc(Ec(n),t,e,E(n.cb,n))}),!0)},t.nb=function(t){var e=this;return Kc(this,this.F().then(function(n){return e.a.nb(n,t)}).then(function(t){return Fc(e,t),e.reload()}))},t.Nc=function(t){var e=this;return Kc(this,this.F().then(function(n){return t.b(e.a,n)}).then(function(t){return Fc(e,t),e.reload()}))},t.ob=function(t){var e=this;return Kc(this,this.F().then(function(n){return e.a.ob(n,t)}).then(function(t){return Fc(e,t),e.reload()}))},t.pb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Dc(this);var e=this;return Kc(this,this.F().then(function(n){return e.a.pb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Fc(e,t),Mc(e,"displayName",t.displayName||null),Mc(e,"photoURL",t.photoUrl||null),F(e.providerData,function(t){"password"===t.providerId&&(xr(t,"displayName",e.displayName),xr(t,"photoURL",e.photoURL))}),Cc(e)}).then(kc))},t.Lc=function(t){var e=this;return Kc(this,Lc(this).then(function(n){return V(Rc(e),t)?function(t,e,n){return vs(t,Ya,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return F(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),F(Rc(e),function(t){n[t]||Pc(e,t)}),n[oo.PROVIDER_ID]||xr(e,"phoneNumber",null),Cc(e)}):Cc(e).then(function(){throw new zr("no-such-provider")})}))},t.delete=function(){var t=this;return Kc(this,this.F().then(function(e){return vs(t.a,za,{idToken:e})}).then(function(){t.dispatchEvent(new vc("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");bc(t,null),_c(t,null),t.G=[],t.B=!0,Sc(t),xr(t,"refreshToken",null),t.i&&Hu(t.i,t)})},t.tb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ga=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.xb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.yb,this):"linkViaRedirect"==t&&(this.aa||null)==e?E(this.xb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?E(this.yb,this):null},t.oc=function(t){var e=this;return Bc(this,"linkViaPopup",t,function(){return Uc(e,t.providerId).then(function(){return Cc(e)})},!1)},t.xc=function(t){return Bc(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.pc=function(t){var e=this;return jc(this,"linkViaRedirect",t,function(){return Uc(e,t.providerId)},!1)},t.yc=function(t){return jc(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.xb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Kc(this,this.F().then(function(i){return Ba(r.a,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=qc(r,t,"link"),Vc(r,t)}).then(function(){return i}))},t.yb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Kc(this,Yt().then(function(){return Pi(ja(r.a,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=qc(r,t,"reauthenticate"),Fc(r,t),r.h=null,r.reload()}).then(function(){return i}),!0)},t.gb=function(t){var e=this,n=null;return Kc(this,this.F().then(function(e){return n=e,void 0===t||H(t)?{}:ui(new $r(t))}).then(function(t){return e.a.gb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.c.A(),redirectEventId:this.aa||null};return this.metadata&&Y(t,this.metadata.A()),F(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var Gc={name:"redirectUser",C:"session"};function zc(t){return mu(t.b,Gc,t.a)}function Yc(t){this.a=t,this.b=pu(),this.c=null,this.f=function(t){var e=$c("local"),n=$c("session"),r=$c("none");return function(t,e,n){var r=yu(e,n),i=du(t,e.C);return t.get(e,n).then(function(o){var s=null;try{s=Tr(a.localStorage.getItem(r))}catch(o){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(i){return i?n:t.b.get(r,t.a).then(function(n){return n?r:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(Jc,t.a).then(function(t){return t?$c(t):e})})})}).then(function(e){return t.c=e,Xc(t,e.C)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener($c("local"),this.a,E(this.g,this))}function Xc(t,e){var n,r=[];for(n in lu)lu[n]!==e&&r.push(mu(t.b,$c(lu[n]),t.a));return r.push(mu(t.b,Jc,t.a)),function(t){return new jt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Jt(t[s],T(o,s),a);else e(i)})}(r)}Yc.prototype.g=function(){var t=this,e=$c("local");nh(this,function(){return Yt().then(function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null}).then(function(n){if(n)return Xc(t,"local").then(function(){t.c=e})})})};var Jc={name:"persistence",C:"session"};function $c(t){return{name:"authUser",C:t}}function Zc(t,e){return nh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function th(t){return nh(t,function(){return mu(t.b,t.c,t.a)})}function eh(t,e){return nh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Qc(t||{})})})}function nh(t,e){return t.f=t.f.then(e,e),t.f}function rh(t){if(this.l=!1,xr(this,"settings",new sc),xr(this,"app",t),!lh(this).options||!lh(this).options.apiKey)throw new zr("invalid-api-key");t=po.SDK_VERSION?pr(po.SDK_VERSION):null,this.c=new wa(lh(this).options&&lh(this).options.apiKey,mi(di),t),this.N=[],this.o=[],this.I=[],this.Pb=po.INTERNAL.createSubscribe(E(this.ic,this)),this.O=void 0,this.Qb=po.INTERNAL.createSubscribe(E(this.jc,this)),ch(this,null),this.h=new Yc(lh(this).options.apiKey+":"+lh(this).name),this.w=new Hc(lh(this).options.apiKey+":"+lh(this).name),this.V=yh(this,function(t){var e=lh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Gc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Qc(t||{})})}(t.w,lh(t).options.authDomain).then(function(e){return(t.B=e)&&(e.ba=t.w),zc(t.w)});return yh(t,e)}(t).then(function(){return eh(t.h,e)}).then(function(e){return e?(e.ba=t.w,t.B&&(t.B.aa||null)==(e.aa||null)?e:e.reload().then(function(){return Zc(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:th(t.h)})):null}).then(function(e){ch(t,e||null)});return yh(t,n)}(this)),this.i=yh(this,function(t){return t.V.then(function(){return sh(t)}).s(function(){}).then(function(){if(!t.l)return t.ja()}).s(function(){}).then(function(){if(!t.l){t.X=!0;var e=t.h;e.b.addListener($c("local"),e.a,t.ja)}})}(this)),this.X=!1,this.ja=E(this.Ic,this),this.Fa=E(this.Z,this),this.ra=E(this.Xb,this),this.sa=E(this.gc,this),this.ta=E(this.hc,this),this.a=null,function(t){var e=lh(t).options.authDomain,n=lh(t).options.apiKey;e&&vr()&&(t.Ob=t.V.then(function(){if(!t.l){if(t.a=tc(e,n,lh(t).name),Qu(t.a,t),fh(t)&&Nc(fh(t)),t.B){Nc(t.B);var r=t.B;r.pa(t.ea()),bc(r,t),wc(r=t.B,t.G),_c(r,t),t.B=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.qc,this),this.u=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function ih(t){Oe.call(this,"languageCodeChanged"),this.g=t}function oh(t){Oe.call(this,"frameworkChanged"),this.c=t}function ah(t){return t.Ob||Xt(new zr("auth-domain-config-required"))}function sh(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=ah(t).then(function(){return t.a.la()}).then(function(t){return t?Fr(t):null});return yh(t,e)}function uh(t,e){var n={};return n.apiKey=lh(t).options.apiKey,n.authDomain=lh(t).options.authDomain,n.appName=lh(t).name,t.V.then(function(){return function(t,e,n,r){var i=new gc(t,e);return n&&(i.ba=n),r&&wc(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.ya())}).then(function(e){return fh(t)&&e.uid==fh(t).uid?xc(fh(t),e):(ch(t,e),Nc(e)),t.Z(e)}).then(function(){dh(t)})}function ch(t,e){fh(t)&&(function(t,e){j(t.N,function(t){return t==e})}(fh(t),t.Fa),Ge(fh(t),"tokenChanged",t.ra),Ge(fh(t),"userDeleted",t.sa),Ge(fh(t),"userInvalidated",t.ta),Sc(fh(t))),e&&(e.N.push(t.Fa),Ke(e,"tokenChanged",t.ra),Ke(e,"userDeleted",t.sa),Ke(e,"userInvalidated",t.ta),0<t.u&&Tc(e)),xr(t,"currentUser",e),e&&(e.pa(t.ea()),bc(e,t),wc(e,t.G),_c(e,t))}function hh(t,e){var n=null,r=null;return yh(t,e.then(function(e){return n=so(e),r=_i(e),uh(t,e)}).then(function(){return Fr({user:fh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function lh(t){return t.app}function fh(t){return t.currentUser}function ph(t){return fh(t)&&fh(t)._lat||null}function dh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](ph(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](ph(t))}}function yh(t,e){return t.N.push(e),e.ha(function(){B(t.N,e)}),e}function mh(){}function vh(){this.a={},this.b=1e12}Yc.prototype.jb=function(t){var e=null,n=this;return function(t){var e=new zr("invalid-persistence-type"),n=new zr("unsupported-persistence-type");t:{for(r in lu)if(lu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(sr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!mr()&&"none"!==t)throw n}}(t),nh(this,function(){return t!=n.c.C?n.b.get(n.c,n.a).then(function(r){return e=r,Xc(n,t)}).then(function(){if(n.c=$c(t),e)return n.b.set(n.c,e,n.a)}):Yt()})},I(rh,nn),I(ih,Oe),I(oh,Oe),(t=rh.prototype).jb=function(t){return yh(this,t=this.h.jb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,Na(this.c,this.W),this.dispatchEvent(new ih(this.ea())))},t.ea=function(){return this.W},t.Oc=function(){var t=a.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.qc=function(t){this.G.push(t),Aa(this.c,po.SDK_VERSION?pr(po.SDK_VERSION,this.G):null),this.dispatchEvent(new oh(this.G))},t.ya=function(){return K(this.G)},t.toJSON=function(){return{apiKey:lh(this).options.apiKey,authDomain:lh(this).options.authDomain,appName:lh(this).name,currentUser:fh(this)&&fh(this).A()}},t.tb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ga=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.Wb,this):null},t.Wb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=Va(r.c,t).then(function(t){return i=so(t),o=_i(t),t});return yh(this,t=r.V.then(function(){return a}).then(function(t){return uh(r,t)}).then(function(){return Fr({user:fh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Gc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this,n=wi(t.providerId),r=Sr(),i=null;(!wr()||or())&&lh(this).options.authDomain&&t.isOAuthProvider&&(i=Os(lh(this).options.authDomain,lh(this).options.apiKey,lh(this).name,"signInViaPopup",t,null,r,po.SDK_VERSION||null));var o=tr(i,n&&n.Ba,n&&n.Aa);return yh(this,n=ah(this).then(function(e){return Yu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new jt(function(t,n){e.ga("signInViaPopup",null,new zr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.b=$u(e.a,e,"signInViaPopup",o,r)})}).then(function(t){return o&&Zn(o),t?Fr(t):null}).s(function(t){throw o&&Zn(o),t}))},t.Hc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this;return yh(this,ah(this).then(function(){return function(t){return nh(t,function(){return t.b.set(Jc,t.c.C,t.a)})}(e.h)}).then(function(){return Ju(e.a,"signInViaRedirect",t)}))},t.la=function(){var t=this;return sh(this).then(function(e){return t.a&&rc(t.a.b),e}).s(function(e){throw t.a&&rc(t.a.b),e})},t.Mc=function(t){if(!t)return Xt(new zr("null-user"));var e=this,n={};n.apiKey=lh(this).options.apiKey,n.authDomain=lh(this).options.authDomain,n.appName=lh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.c,o={};return o[Ea]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-S())/1e3,e=new gc(e,o),n&&(e.ba=n),r&&wc(e,r),xc(e,t),e}(t,n,e.w,e.ya());return yh(this,this.i.then(function(){if(lh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return fh(e)&&t.uid==fh(e).uid?(xc(fh(e),t),e.Z(t)):(ch(e,r),Nc(r),e.Z(r))}).then(function(){dh(e)}))},t.lb=function(){var t=this;return yh(this,this.i.then(function(){return t.a&&rc(t.a.b),fh(t)?(ch(t,null),th(t.h).then(function(){dh(t)})):Yt()}))},t.Ic=function(){var t=this;return eh(this.h,lh(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=fh(t)&&e){n=fh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return xc(fh(t),e),fh(t).F();(fh(t)||e)&&(ch(t,e),e&&(Nc(e),e.ba=t.w),t.a&&Qu(t.a,t),dh(t))}})},t.Z=function(t){return Zc(this.h,t)},t.Xb=function(){dh(this),this.Z(fh(this))},t.gc=function(){this.lb()},t.hc=function(){this.lb()},t.ic=function(t){var e=this;this.addAuthTokenListener(function(){t.next(fh(e))})},t.jc=function(t){var e=this;!function(t,e){t.I.push(e),yh(t,t.i.then(function(){!t.l&&V(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(ph(t)))}))}(this,function(){t.next(fh(e))})},t.sc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){m(t)?t(fh(r)):m(t.next)&&t.next(fh(r))}),this.Pb(t,e,n)},t.rc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),m(t)?t(fh(r)):m(t.next)&&t.next(fh(r))}),this.Qb(t,e,n)},t.Yb=function(t){var e=this;return yh(this,this.i.then(function(){return fh(e)?fh(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Cc=function(t){var e=this;return this.i.then(function(){return hh(e,vs(e.c,fs,{token:t}))}).then(function(t){var n=t.user;return Mc(n,"isAnonymous",!1),e.Z(n),t})},t.Dc=function(t,e){var n=this;return this.i.then(function(){return hh(n,vs(n.c,ps,{email:t,password:e}))})},t.Sb=function(t,e){var n=this;return this.i.then(function(){return hh(n,vs(n.c,Ha,{email:t,password:e}))})},t.Pa=function(t){var e=this;return this.i.then(function(){return hh(e,t.ka(e.c))})},t.Bc=function(t){return Pr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Pa(t)},t.kb=function(){var t=this;return this.i.then(function(){var e=fh(t);return e&&e.isAnonymous?Fr({user:e,credential:null,additionalUserInfo:Fr({providerId:null,isNewUser:!1}),operationType:"signIn"}):hh(t,t.c.kb()).then(function(e){var n=e.user;return Mc(n,"isAnonymous",!0),t.Z(n),e})})},t.getUid=function(){return fh(this)&&fh(this).uid||null},t.Rb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&fh(this)&&Tc(fh(this))},t.zc=function(t){var e=this;F(this.o,function(n){n==t&&e.u--}),this.u<0&&(this.u=0),0==this.u&&fh(this)&&Sc(fh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),yh(this,this.i.then(function(){e.l||V(e.o,t)&&t(ph(e))}))},t.removeAuthTokenListener=function(t){j(this.o,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener($c("local"),t.a,this.ja),this.a&&(Hu(this.a,this),rc(this.a.b)),Promise.resolve()},t.Vb=function(t){return yh(this,function(t,e){return vs(t,Ga,{identifier:e,continueUri:gr()?Xn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.c,t))},t.kc=function(t){return!!eo(t)},t.ib=function(t,e){var n=this;return yh(this,Yt().then(function(){var t=new $r(e);if(!t.c)throw new zr("argument-error",ei+" must be true when sending sign in link to email");return ui(t)}).then(function(e){return n.c.ib(t,e)}).then(function(){}))},t.Pc=function(t){return this.Ia(t).then(function(t){return t.data.email})},t.Xa=function(t,e){return yh(this,this.c.Xa(t,e).then(function(){}))},t.Ia=function(t){return yh(this,this.c.Ia(t).then(function(t){return new qr(t)}))},t.Va=function(t){return yh(this,this.c.Va(t).then(function(){}))},t.hb=function(t,e){var n=this;return yh(this,Yt().then(function(){return void 0===e||H(e)?{}:ui(new $r(e))}).then(function(e){return n.c.hb(t,e)}).then(function(){}))},t.Fc=function(t,e){return yh(this,cc(this,t,e,E(this.Pa,this)))},t.Ec=function(t,e){var n=this;return yh(this,Yt().then(function(){var r=to(t,e||Xn());return n.Pa(r)}))},mh.prototype.render=function(){},mh.prototype.reset=function(){},mh.prototype.getResponse=function(){},mh.prototype.execute=function(){};var gh=null;function bh(t,e){return(e=wh(e))&&t.a[e]||null}function wh(t){return(t=void 0===t?1e12:t)?t.toString():null}function _h(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function Eh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Th(){}vh.prototype.render=function(t,e){return this.a[this.b.toString()]=new _h(t,e),this.b++},vh.prototype.reset=function(t){var e=bh(this,t);t=wh(t),e&&t&&(e.delete(),delete this.a[t])},vh.prototype.getResponse=function(t){return(t=bh(this,t))?t.getResponse():null},vh.prototype.execute=function(t){(t=bh(this,t))&&t.execute()},_h.prototype.getResponse=function(){return Eh(this),this.b},_h.prototype.execute=function(){Eh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},_h.prototype.delete=function(){Eh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Th.prototype.g=function(){return Yt(gh=gh||new vh)},Th.prototype.c=function(){};var Sh=null;function Ih(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Ch=new X(Z,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Nh=new Nr(3e4,6e4);Ih.prototype.g=function(t){var e=this;return new jt(function(n,r){var i=setTimeout(function(){r(new zr("network-request-failed"))},Nh.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new zr("internal-error"));delete a[e.a]},Yt(pa(rt(Ch,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(i),r(new zr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),n(a.grecaptcha))})},Ih.prototype.c=function(){this.b--};var Ah=null;function kh(t,e,n,r,i,o,s){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.l=e,this.g=null,s=s?Sh=Sh||new Th:Ah=Ah||new Ih,this.o=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Oh])throw new zr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ph],!a.document)throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new zr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new wa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.m=[];var c=this.a[Dh];this.a[Dh]=function(t){if(Mh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=yr(c,a);"function"==typeof e&&e(t)}};var h=this.a[Rh];this.a[Rh]=function(){if(Mh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=yr(h,a);"function"==typeof t&&t()}}}var Dh="callback",Rh="expired-callback",Oh="sitekey",Ph="size";function Mh(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function xh(t,e){return t.h.push(e),e.ha(function(){B(t.h,e)}),e}function Lh(t){if(t.B)throw new zr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Fh(t,e,n){var r=!1;try{this.b=n||po.app()}catch(t){throw new zr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new zr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=po.SDK_VERSION?pr(po.SDK_VERSION,o):null,kh.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,mi(di),r)}function Uh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new zr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=qh.length)throw new zr("internal-error","Argument validator received an unsupported number of arguments.");n=qh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new zr("argument-error",t+" failed: "+r)}(t=kh.prototype).za=function(){var t=this;return this.f?this.f:this.f=xh(this,Yt().then(function(){if(gr()&&!ar())return rr();throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.o.g(t.v())}).then(function(e){return t.g=e,vs(t.u,rs,{})}).then(function(e){t.a[Oh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){Lh(this);var t=this;return xh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Vn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Lt(a.name),'"'),a.type){o.push(' type="',Lt(a.type),'"');var u={};Y(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!y(o)||v(o)&&0<o.nodeType?r(o):F(Wn(o)?K(o):o,r)}}(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){Lh(this);var t=this;return xh(this,this.render().then(function(e){return new jt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(e,n){j(t.m,function(t){return t==n})}(0,i),n(e))};t.m.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){Lh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Lh(this),this.B=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},I(Fh,kh);var qh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Vh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:s}}function Bh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:u}}function jh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:v}}function Wh(t,e){return{name:t||"",K:"a function",optional:!!e,M:m}}function Kh(t,e){return{name:t||"",K:"null",optional:!!e,M:p}}function Qh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ka||!n)}}}function Hh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&s(t.type)&&m(t.verify))}}}function Gh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function zh(t,e){for(var n in e){var r=e[n].name;t[r]=Jh(r,t[n],e[n].j)}}function Yh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){Uh(t,[n],[r],!0),this[e]=r},r,n,e[n].rb),enumerable:!0})}}function Xh(t,e,n,r){t[e]=Jh(e,n,r)}function Jh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Uh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}zh(rh.prototype,{Va:{name:"applyActionCode",j:[Vh("code")]},Ia:{name:"checkActionCode",j:[Vh("code")]},Xa:{name:"confirmPasswordReset",j:[Vh("code"),Vh("newPassword")]},Sb:{name:"createUserWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Vb:{name:"fetchSignInMethodsForEmail",j:[Vh("email")]},la:{name:"getRedirectResult",j:[]},kc:{name:"isSignInWithEmailLink",j:[Vh("emailLink")]},rc:{name:"onAuthStateChanged",j:[Gh(jh(),Wh(),"nextOrObserver"),Wh("opt_error",!0),Wh("opt_completed",!0)]},sc:{name:"onIdTokenChanged",j:[Gh(jh(),Wh(),"nextOrObserver"),Wh("opt_error",!0),Wh("opt_completed",!0)]},hb:{name:"sendPasswordResetEmail",j:[Vh("email"),Gh(jh("opt_actionCodeSettings",!0),Kh(null,!0),"opt_actionCodeSettings",!0)]},ib:{name:"sendSignInLinkToEmail",j:[Vh("email"),jh("actionCodeSettings")]},jb:{name:"setPersistence",j:[Vh("persistence")]},Bc:{name:"signInAndRetrieveDataWithCredential",j:[Qh()]},kb:{name:"signInAnonymously",j:[]},Pa:{name:"signInWithCredential",j:[Qh()]},Cc:{name:"signInWithCustomToken",j:[Vh("token")]},Dc:{name:"signInWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Ec:{name:"signInWithEmailLink",j:[Vh("email"),Vh("emailLink",!0)]},Fc:{name:"signInWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},Gc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Hc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"updateCurrentUser",j:[Gh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof gc)}},Kh(),"user")]},lb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Oc:{name:"useDeviceLanguage",j:[]},Pc:{name:"verifyPasswordResetCode",j:[Vh("code")]}}),Yh(rh.prototype,{lc:{name:"languageCode",rb:Gh(Vh(),Kh(),"languageCode")}}),(rh.Persistence=lu).LOCAL="local",rh.Persistence.SESSION="session",rh.Persistence.NONE="none",zh(gc.prototype,{delete:{name:"delete",j:[]},Zb:{name:"getIdTokenResult",j:[Bh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Bh("opt_forceRefresh",!0)]},mc:{name:"linkAndRetrieveDataWithCredential",j:[Qh()]},ab:{name:"linkWithCredential",j:[Qh()]},nc:{name:"linkWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},oc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},pc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},vc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Qh()]},cb:{name:"reauthenticateWithCredential",j:[Qh()]},wc:{name:"reauthenticateWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},xc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},yc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},gb:{name:"sendEmailVerification",j:[Gh(jh("opt_actionCodeSettings",!0),Kh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Lc:{name:"unlink",j:[Vh("provider")]},nb:{name:"updateEmail",j:[Vh("email")]},ob:{name:"updatePassword",j:[Vh("password")]},Nc:{name:"updatePhoneNumber",j:[Qh("phone")]},pb:{name:"updateProfile",j:[jh("profile")]}}),zh(vh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zh(mh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zh(jt.prototype,{ha:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Yh(sc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",rb:Bh("appVerificationDisabledForTesting")}}),zh(uc.prototype,{confirm:{name:"confirm",j:[Vh("verificationCode")]}}),Xh(Oi,"fromJSON",function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[qi,$i,ro,Li],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Gh(Vh(),jh(),"json")]),Xh(Zi,"credential",function(t,e){return new Ji(t,e)},[Vh("email"),Vh("password")]),zh(Ji.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Wi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Wi,"credential",Ki,[Gh(Vh(),jh(),"token")]),Xh(Zi,"credentialWithLink",to,[Vh("email"),Vh("emailLink")]),zh(Qi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Qi,"credential",Hi,[Gh(Vh(),jh(),"token")]),zh(Gi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Gi,"credential",zi,[Gh(Vh(),Gh(jh(),Kh()),"idToken"),Gh(Vh(),Kh(),"accessToken",!0)]),zh(Yi.prototype,{Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Yi,"credential",Xi,[Gh(Vh(),jh(),"token"),Vh("secret",!0)]),zh(ji.prototype,{ua:{name:"addScope",j:[Vh("scope")]},credential:{name:"credential",j:[Gh(Vh(),Gh(jh(),Kh()),"optionsOrIdToken"),Gh(Vh(),Kh(),"accessToken",!0)]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),zh(Fi.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Mi.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),Xh(oo,"credential",ao,[Vh("verificationId"),Vh("verificationCode")]),zh(oo.prototype,{Ta:{name:"verifyPhoneNumber",j:[Vh("phoneNumber"),Hh()]}}),zh(no.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(zr.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(vo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(mo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Fh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===po||!po.INTERNAL||!po.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:rh,AuthCredential:Oi,Error:zr};Xh(t,"EmailAuthProvider",Zi,[]),Xh(t,"FacebookAuthProvider",Wi,[]),Xh(t,"GithubAuthProvider",Qi,[]),Xh(t,"GoogleAuthProvider",Gi,[]),Xh(t,"TwitterAuthProvider",Yi,[]),Xh(t,"OAuthProvider",ji,[Vh("providerId")]),Xh(t,"SAMLAuthProvider",Bi,[Vh("providerId")]),Xh(t,"PhoneAuthProvider",oo,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof rh)}}]),Xh(t,"RecaptchaVerifier",Fh,[Gh(Vh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),jh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof po.app.App)}}]),po.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:E((t=new rh(t)).getUid,t),getToken:E(t.Yb,t),addAuthTokenListener:E(t.Rb,t),removeAuthTokenListener:E(t.zc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),po.INTERNAL.extendNamespace({User:gc})}()}).apply(void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var yo=(mo.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Pi(e))},mo.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Oi(e)},mo.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},mo.prototype.prefixedName_=function(t){return this.prefix_+t},mo.prototype.toString=function(){return this.domStorage_.toString()},mo);function mo(t){this.domStorage_=t,this.prefix_="firebase:"}var vo=(go.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},go.prototype.get=function(t){return xi(this.cache_,t)?this.cache_[t]:null},go.prototype.remove=function(t){delete this.cache_[t]},go);function go(){this.cache_={},this.isInMemoryStorage=!0}function bo(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new yo(e)}}catch(t){}return new vo}function wo(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;yi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new qi;n.update(e);var r=n.digest();return vi.encodeByteArray(r)}function _o(t,e){yi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Mo.logLevel=ji.VERBOSE,Uo=Mo.log.bind(Mo),e&&Po.set("logging_enabled",!0)):"function"==typeof t?Uo=t:(Uo=null,Po.remove("logging_enabled"))}function Eo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===qo&&(qo=!1,null===Uo&&!0===Po.get("logging_enabled")&&_o(!0)),Uo){var n=Fo.apply(null,t);Uo(n)}}function To(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Eo.apply(void 0,li([t],e))}}function So(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Fo.apply(void 0,li(t));Mo.error(n)}function Io(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Fo.apply(void 0,li(t));throw Mo.error(n),new Error(n)}function Co(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Fo.apply(void 0,li(t));Mo.warn(n)}function No(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Ao(t,e){return t===e?0:t<e?-1:1}function ko(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Pi(e))}function Do(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Ro,Oo=bo("localStorage"),Po=bo("sessionStorage"),Mo=new eo("@firebase/database"),xo="FIREBASE_DATABASE_EMULATOR_HOST",Lo=(Ro=1,function(){return Ro++}),Fo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Fo.apply(null,t[r]):"object"==typeof t[r]?n+=Pi(t[r]):n+=t[r],n+=" ";return n},Uo=null,qo=!0,Vo="[MIN_NAME]",Bo="[MAX_NAME]",jo=function(t,e){if(t===e)return 0;if(t===Vo||e===Bo)return-1;if(e===Vo||t===Bo)return 1;var n=Yo(t),r=Yo(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Wo=function(t){if("object"!=typeof t||null===t)return Pi(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Pi(e[i]),r+=":",r+=Wo(t[e[i]]);return r+"}"};function Ko(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Qo(t){var e,n,r,i,o,a,s;for(yi(!No(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Ho(t){try{t()}catch(t){setTimeout(function(){throw Co("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}}function Go(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var zo=new RegExp("^-?\\d{1,10}$"),Yo=function(t){if(zo.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Xo=(Object.defineProperty(Jo,"Empty",{get:function(){return new Jo("")},enumerable:!0,configurable:!0}),Jo.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Jo.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Jo.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Jo(this.pieces_,t)},Jo.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Jo.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Jo.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Jo.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Jo.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Jo(t,0)},Jo.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Jo)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Jo(e,0)},Jo.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Jo.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Jo.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Jo.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=jo(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Jo.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Jo.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Jo);function Jo(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var $o=(Object.defineProperty(Zo,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Zo,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Zo.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Ji(t),this.checkValid_()},Zo.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Ji(t),0<this.parts_.length&&(this.byteLength_-=1)},Zo.prototype.checkValid_=function(){if(this.byteLength_>Zo.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Zo.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Zo.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Zo.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Zo.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Zo);function Zo(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Ji(this.parts_[n]);this.checkValid_()}var ta="firebaseio.com",ea="websocket",na="long_polling",ra=(ia.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},ia.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},ia.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},ia.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},ia.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Oo.set("host:"+this.host,this.internalHost))},ia.prototype.connectionURL=function(t,e){var n;if(yi("string"==typeof t,"typeof type must == string"),yi("object"==typeof e,"typeof params must == object"),t===ea)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==na)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Ko(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},ia.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},ia.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},ia);function ia(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Oo.get("host:"+t)||this.host}function oa(t){var e=va(t),n=e.namespace;"firebase"===e.domain&&Io(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Io("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Co("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new ra(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Xo(e.pathString)}}function aa(t){return"string"==typeof t&&0!==t.length&&!ga.test(t)}function sa(t){return"string"==typeof t&&0!==t.length&&!ba.test(t)}function ua(t){return null===t||"string"==typeof t||"number"==typeof t&&!No(t)||t&&"object"==typeof t&&xi(t,".sv")}function ca(t,e,n,r,i){i&&void 0===n||_a(zi(t,e,i),n,r)}function ha(t,e,n,r,i){if(!i||void 0!==n){var o=zi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Ko(n,function(t,e){var n=new Xo(t);if(_a(o,e,r.child(n)),".priority"===n.getBack()&&!ua(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!aa(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Xo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function la(t,e,n,r){if(!r||void 0!==n){if(No(n))throw new Error(zi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ua(n))throw new Error(zi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function fa(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(zi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function pa(t,e,n,r){if(!(r&&void 0===n||aa(n)))throw new Error(zi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function da(t,e,n,r){if(!(r&&void 0===n||sa(n)))throw new Error(zi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function ya(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function ma(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!aa(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return sa(t=t&&t.replace(/^\/*\.info(\/|$)/,"/"))}(r))throw new Error(zi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var va=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ci(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Co("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},ga=/[\[\].#$\/\u0000-\u001F\u007F]/,ba=/[\[\].#$\u0000-\u001F\u007F]/,wa=10485760,_a=function(t,e,n){var r=n instanceof Xo?new $o(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(No(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>wa/3&&Ji(e)>wa)throw new Error(t+"contains a string greater than "+wa+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(Ko(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!aa(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),_a(t,n,r),r.pop()}),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Ea=(Ta.prototype.cancel=function(t){Gi("OnDisconnect.cancel",0,1,arguments.length),Yi("OnDisconnect.cancel",1,t,!0);var e=new wi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Ta.prototype.remove=function(t){Gi("OnDisconnect.remove",0,1,arguments.length),ya("OnDisconnect.remove",this.path_),Yi("OnDisconnect.remove",1,t,!0);var e=new wi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Ta.prototype.set=function(t,e){Gi("OnDisconnect.set",1,2,arguments.length),ya("OnDisconnect.set",this.path_),ca("OnDisconnect.set",1,t,this.path_,!1),Yi("OnDisconnect.set",2,e,!0);var n=new wi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Ta.prototype.setWithPriority=function(t,e,n){Gi("OnDisconnect.setWithPriority",2,3,arguments.length),ya("OnDisconnect.setWithPriority",this.path_),ca("OnDisconnect.setWithPriority",1,t,this.path_,!1),la("OnDisconnect.setWithPriority",2,e,!1),Yi("OnDisconnect.setWithPriority",3,n,!0);var r=new wi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Ta.prototype.update=function(t,e){if(Gi("OnDisconnect.update",1,2,arguments.length),ya("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Co("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ha("OnDisconnect.update",1,t,this.path_,!1),Yi("OnDisconnect.update",2,e,!0);var i=new wi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Ta);function Ta(t,e){this.repo_=t,this.path_=e}var Sa=(Ia.prototype.toJSON=function(){return Gi("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Ia);function Ia(t,e){this.committed=t,this.snapshot=e}var Ca,Na,Aa,ka=(Ca="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Na=0,Aa=[],function(t){var e,n=t===Na;Na=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Ca.charAt(t%64),t=Math.floor(t/64);yi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Aa[e];e--)Aa[e]=0;Aa[e]++}else for(e=0;e<12;e++)Aa[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Ca.charAt(Aa[e]);return yi(20===i.length,"nextPushId: Length should be 20."),i}),Da=(Ra.Wrap=function(t,e){return new Ra(t,e)},Ra);function Ra(t,e){this.name=t,this.node=e}var Oa,Pa=(Ma.prototype.getCompare=function(){return this.compare.bind(this)},Ma.prototype.indexedValueChanged=function(t,e){var n=new Da(Vo,t),r=new Da(Vo,e);return 0!==this.compare(n,r)},Ma.prototype.minPost=function(){return Da.MIN},Ma);function Ma(){}var xa,La=(oi(Fa,xa=Pa),Object.defineProperty(Fa,"__EMPTY_NODE",{get:function(){return Oa},set:function(t){Oa=t},enumerable:!0,configurable:!0}),Fa.prototype.compare=function(t,e){return jo(t.name,e.name)},Fa.prototype.isDefinedOn=function(t){throw mi("KeyIndex.isDefinedOn not expected to be called.")},Fa.prototype.indexedValueChanged=function(t,e){return!1},Fa.prototype.minPost=function(){return Da.MIN},Fa.prototype.maxPost=function(){return new Da(Bo,Oa)},Fa.prototype.makePost=function(t,e){return yi("string"==typeof t,"KeyIndex indexValue must always be a string."),new Da(t,Oa)},Fa.prototype.toString=function(){return".key"},Fa);function Fa(){return null!==xa&&xa.apply(this,arguments)||this}var Ua,qa=new La;function Va(t){return"number"==typeof t?"number:"+Qo(t):"string:"+t}function Ba(t){if(t.isLeafNode()){var e=t.val();yi("string"==typeof e||"number"==typeof e||"object"==typeof e&&xi(e,".sv"),"Priority must be a string or number.")}else yi(t===Ua||t.isEmpty(),"priority of unexpected type.");yi(t===Ua||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var ja,Wa,Ka,Qa,Ha=(Object.defineProperty(Ga,"__childrenNodeConstructor",{get:function(){return ja},set:function(t){ja=t},enumerable:!0,configurable:!0}),Ga.prototype.isLeafNode=function(){return!0},Ga.prototype.getPriority=function(){return this.priorityNode_},Ga.prototype.updatePriority=function(t){return new Ga(this.value_,t)},Ga.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Ga.__childrenNodeConstructor.EMPTY_NODE},Ga.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Ga.__childrenNodeConstructor.EMPTY_NODE},Ga.prototype.hasChild=function(){return!1},Ga.prototype.getPredecessorChildName=function(t,e){return null},Ga.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Ga.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Ga.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(yi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Ga.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Ga.prototype.isEmpty=function(){return!1},Ga.prototype.numChildren=function(){return 0},Ga.prototype.forEachChild=function(t,e){return!1},Ga.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Ga.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Va(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Qo(this.value_):this.value_,this.lazyHash_=wo(t)}return this.lazyHash_},Ga.prototype.getValue=function(){return this.value_},Ga.prototype.compareTo=function(t){return t===Ga.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ga.__childrenNodeConstructor?-1:(yi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Ga.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Ga.VALUE_TYPE_ORDER.indexOf(e),i=Ga.VALUE_TYPE_ORDER.indexOf(n);return yi(0<=r,"Unknown leaf type: "+e),yi(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Ga.prototype.withIndex=function(){return this},Ga.prototype.isIndexed=function(){return!0},Ga.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Ga.VALUE_TYPE_ORDER=["object","boolean","number","string"],Ga);function Ga(t,e){void 0===e&&(e=Ga.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,yi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ba(this.priorityNode_)}function za(){return null!==Qa&&Qa.apply(this,arguments)||this}var Ya=new(oi(za,Qa=Pa),za.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?jo(t.name,e.name):i},za.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},za.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},za.prototype.minPost=function(){return Da.MIN},za.prototype.maxPost=function(){return new Da(Bo,new Ha("[PRIORITY-POST]",Ka))},za.prototype.makePost=function(t,e){var n=Wa(t);return new Da(e,new Ha("[PRIORITY-POST]",n))},za.prototype.toString=function(){return".priority"},za),Xa=(Ja.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Ja.prototype.hasNext=function(){return 0<this.nodeStack_.length},Ja.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Ja);function Ja(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var $a=(Za.prototype.copy=function(t,e,n,r,i){return new Za(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Za.prototype.count=function(){return this.left.count()+1+this.right.count()},Za.prototype.isEmpty=function(){return!1},Za.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Za.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Za.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},Za.prototype.minKey=function(){return this.min_().key},Za.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Za.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},Za.prototype.removeMin_=function(){if(this.left.isEmpty())return ns.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},Za.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return ns.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},Za.prototype.isRed_=function(){return this.color},Za.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},Za.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},Za.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},Za.prototype.rotateLeft_=function(){var t=this.copy(null,null,Za.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Za.prototype.rotateRight_=function(){var t=this.copy(null,null,Za.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Za.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Za.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},Za.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},Za.RED=!0,Za.BLACK=!1,Za);function Za(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Za.RED,this.left=null!=r?r:ns.EMPTY_NODE,this.right=null!=i?i:ns.EMPTY_NODE}var ts=(es.prototype.copy=function(t,e,n,r,i){return this},es.prototype.insert=function(t,e,n){return new $a(t,e,null)},es.prototype.remove=function(t,e){return this},es.prototype.count=function(){return 0},es.prototype.isEmpty=function(){return!0},es.prototype.inorderTraversal=function(t){return!1},es.prototype.reverseTraversal=function(t){return!1},es.prototype.minKey=function(){return null},es.prototype.maxKey=function(){return null},es.prototype.check_=function(){return 0},es.prototype.isRed_=function(){return!1},es);function es(){}var ns=(rs.prototype.insert=function(t,e){return new rs(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,$a.BLACK,null,null))},rs.prototype.remove=function(t){return new rs(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,$a.BLACK,null,null))},rs.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},rs.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},rs.prototype.isEmpty=function(){return this.root_.isEmpty()},rs.prototype.count=function(){return this.root_.count()},rs.prototype.minKey=function(){return this.root_.minKey()},rs.prototype.maxKey=function(){return this.root_.maxKey()},rs.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},rs.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},rs.prototype.getIterator=function(t){return new Xa(this.root_,null,this.comparator_,!1,t)},rs.prototype.getIteratorFrom=function(t,e){return new Xa(this.root_,t,this.comparator_,!1,e)},rs.prototype.getReverseIteratorFrom=function(t,e){return new Xa(this.root_,t,this.comparator_,!0,e)},rs.prototype.getReverseIterator=function(t){return new Xa(this.root_,null,this.comparator_,!0,t)},rs.EMPTY_NODE=new ts,rs);function rs(t,e){void 0===e&&(e=rs.EMPTY_NODE),this.comparator_=t,this.root_=e}var is=Math.log(2),os=(as.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},as);function as(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/is,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var ss,us,cs=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new $a(a,o.node,$a.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new $a(a,o.node,$a.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(1+o,s),h=t[o],l=n?n(h):h;u(new $a(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,$a.BLACK):(s(l,$a.BLACK),s(l,$a.RED))}return o}(new os(t.length));return new ns(r||e,o)},hs={},ls=(Object.defineProperty(fs,"Default",{get:function(){return yi(Ya,"ChildrenNode.ts has not been loaded"),ss=ss||new fs({".priority":hs},{".priority":Ya})},enumerable:!0,configurable:!0}),fs.prototype.get=function(t){var e=Li(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ns?e:null},fs.prototype.hasIndex=function(t){return xi(this.indexSet_,t.toString())},fs.prototype.addIndex=function(t,e){yi(t!==qa,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Da.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?cs(r,t.getCompare()):hs;var s=t.toString(),u=ai({},this.indexSet_);u[s]=t;var c=ai({},this.indexes_);return c[s]=n,new fs(c,u)},fs.prototype.addToIndexes=function(t,e){var n=this;return new fs(Ui(this.indexes_,function(r,i){var o=Li(n.indexSet_,i);if(yi(o,"Missing index implementation for "+i),r===hs){if(o.isDefinedOn(t.node)){for(var a=[],s=e.getIterator(Da.Wrap),u=s.getNext();u;)u.name!=t.name&&a.push(u),u=s.getNext();return a.push(t),cs(a,o.getCompare())}return hs}var c=e.get(t.name),h=r;return c&&(h=h.remove(new Da(t.name,c))),h.insert(t,t.node)}),this.indexSet_)},fs.prototype.removeFromIndexes=function(t,e){return new fs(Ui(this.indexes_,function(n){if(n===hs)return n;var r=e.get(t.name);return r?n.remove(new Da(t.name,r)):n}),this.indexSet_)},fs);function fs(t,e){this.indexes_=t,this.indexSet_=e}function ps(t,e){return jo(t.name,e.name)}function ds(t,e){return jo(t,e)}var ys,ms=(Object.defineProperty(vs,"EMPTY_NODE",{get:function(){return us=us||new vs(new ns(ds),null,ls.Default)},enumerable:!0,configurable:!0}),vs.prototype.isLeafNode=function(){return!1},vs.prototype.getPriority=function(){return this.priorityNode_||us},vs.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new vs(this.children_,t,this.indexMap_)},vs.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?us:e},vs.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},vs.prototype.hasChild=function(t){return null!==this.children_.get(t)},vs.prototype.updateImmediateChild=function(t,e){if(yi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r,i=new Da(t,e),o=void 0;return r=e.isEmpty()?(o=this.children_.remove(t),this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,e),this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?us:this.priorityNode_,new vs(o,n,r)},vs.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;yi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},vs.prototype.isEmpty=function(){return this.children_.isEmpty()},vs.prototype.numChildren=function(){return this.children_.count()},vs.prototype.val=function(t){if(this.isEmpty())return null;var e={},n=0,r=0,i=!0;if(this.forEachChild(Ya,function(o,a){e[o]=a.val(t),n++,i&&vs.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!t&&i&&r<2*n){var o=[];for(var a in e)o[a]=e[a];return o}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e},vs.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Va(this.getPriority().val())+":"),this.forEachChild(Ya,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":wo(t)}return this.lazyHash_},vs.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Da(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},vs.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},vs.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Da(e,this.children_.get(e)):null},vs.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},vs.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Da(e,this.children_.get(e)):null},vs.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},vs.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},vs.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Da.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},vs.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},vs.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Da.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},vs.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===bs?-1:0},vs.prototype.withIndex=function(t){if(t===qa||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new vs(this.children_,this.priorityNode_,e)},vs.prototype.isIndexed=function(t){return t===qa||this.indexMap_.hasIndex(t)},vs.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Ya),r=e.getIterator(Ya),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},vs.prototype.resolveIndex_=function(t){return t===qa?null:this.indexMap_.get(t.toString())},vs.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,vs);function vs(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ba(this.priorityNode_),this.children_.isEmpty()&&yi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function gs(){return ys.call(this,new ns(ds),ms.EMPTY_NODE,ls.Default)||this}var bs=new(oi(gs,ys=ms),gs.prototype.compareTo=function(t){return t===this?0:1},gs.prototype.equals=function(t){return t===this},gs.prototype.getPriority=function(){return this},gs.prototype.getImmediateChild=function(t){return ms.EMPTY_NODE},gs.prototype.isEmpty=function(){return!1},gs);Object.defineProperties(Da,{MIN:{value:new Da(Vo,ms.EMPTY_NODE)},MAX:{value:new Da(Bo,bs)}}),La.__EMPTY_NODE=ms.EMPTY_NODE,Ha.__childrenNodeConstructor=ms,Ua=bs,Ka=bs;var ws,_s=!0;function Es(t,e){if(void 0===e&&(e=null),null===t)return ms.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),yi(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Ha(t,Es(e));if(t instanceof Array||!_s){var n=ms.EMPTY_NODE;return Ko(t,function(e,r){if(xi(t,e)&&"."!==e.substring(0,1)){var i=Es(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}}),n.updatePriority(Es(e))}var r=[],i=!1;if(Ko(t,function(t,e){if("."!==t.substring(0,1)){var n=Es(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Da(t,n)))}}),0==r.length)return ms.EMPTY_NODE;var o=cs(r,ps,function(t){return t.name},ds);if(i){var a=cs(r,Ya.getCompare());return new ms(o,Es(e),new ls({".priority":a},{".priority":Ya}))}return new ms(o,Es(e),ls.Default)}function Ts(){return null!==ws&&ws.apply(this,arguments)||this}Wa=Es;var Ss,Is=new(oi(Ts,ws=Pa),Ts.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?jo(t.name,e.name):n},Ts.prototype.isDefinedOn=function(t){return!0},Ts.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Ts.prototype.minPost=function(){return Da.MIN},Ts.prototype.maxPost=function(){return Da.MAX},Ts.prototype.makePost=function(t,e){var n=Es(t);return new Da(e,n)},Ts.prototype.toString=function(){return".value"},Ts),Cs=(oi(Ns,Ss=Pa),Ns.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Ns.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Ns.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?jo(t.name,e.name):i},Ns.prototype.makePost=function(t,e){var n=Es(t),r=ms.EMPTY_NODE.updateChild(this.indexPath_,n);return new Da(e,r)},Ns.prototype.maxPost=function(){var t=ms.EMPTY_NODE.updateChild(this.indexPath_,bs);return new Da(Bo,t)},Ns.prototype.toString=function(){return this.indexPath_.slice().join("/")},Ns);function Ns(t){var e=Ss.call(this)||this;return e.indexPath_=t,yi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var As=(ks.prototype.val=function(){return Gi("DataSnapshot.val",0,0,arguments.length),this.node_.val()},ks.prototype.exportVal=function(){return Gi("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},ks.prototype.toJSON=function(){return Gi("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},ks.prototype.exists=function(){return Gi("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},ks.prototype.child=function(t){Gi("DataSnapshot.child",0,1,arguments.length),da("DataSnapshot.child",1,t=String(t),!1);var e=new Xo(t),n=this.ref_.child(e);return new ks(this.node_.getChild(e),n,Ya)},ks.prototype.hasChild=function(t){Gi("DataSnapshot.hasChild",1,1,arguments.length),da("DataSnapshot.hasChild",1,t,!1);var e=new Xo(t);return!this.node_.getChild(e).isEmpty()},ks.prototype.getPriority=function(){return Gi("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},ks.prototype.forEach=function(t){var e=this;return Gi("DataSnapshot.forEach",1,1,arguments.length),Yi("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(n,r){return t(new ks(r,e.ref_.child(n),Ya))})},ks.prototype.hasChildren=function(){return Gi("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(ks.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),ks.prototype.numChildren=function(){return Gi("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},ks.prototype.getRef=function(){return Gi("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(ks.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),ks);function ks(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var Ds=(Rs.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Rs.prototype.getEventType=function(){return this.eventType},Rs.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Rs.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Pi(this.snapshot.exportVal())},Rs);function Rs(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Os=(Ps.prototype.getPath=function(){return this.path},Ps.prototype.getEventType=function(){return"cancel"},Ps.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ps.prototype.toString=function(){return this.path.toString()+":cancel"},Ps);function Ps(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Ms=(xs.prototype.respondsTo=function(t){return"value"===t},xs.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Ds("value",this,new As(t.snapshotNode,e.getRef(),n))},xs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){yi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},xs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Os(this,t,e):null},xs.prototype.matches=function(t){return t instanceof xs&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},xs.prototype.hasAnyCallback=function(){return null!==this.callback_},xs);function xs(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Ls,Fs=(Us.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,xi(this.callbacks_,e)},Us.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Os(this,t,e):null},Us.prototype.createEvent=function(t,e){yi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Ds(t.type,this,new As(t.snapshotNode,n,r),t.prevName)},Us.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){yi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Us.prototype.matches=function(t){var e=this;if(t instanceof Us){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object.keys(t.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every(function(n){return t.callbacks_[n]===e.callbacks_[n]});var o=n[0],a=r[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}}}return!1},Us.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Us);function Us(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var qs=(Object.defineProperty(Vs,"__referenceConstructor",{get:function(){return yi(Ls,"Reference.ts has not been loaded"),Ls},set:function(t){Ls=t},enumerable:!0,configurable:!0}),Vs.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===qa){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Vo)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Bo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ya){if(null!=e&&!ua(e)||null!=n&&!ua(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(yi(t.getIndex()instanceof Cs||t.getIndex()===Is,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Vs.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Vs.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Vs.prototype.getQueryParams=function(){return this.queryParams_},Vs.prototype.getRef=function(){return Gi("Query.ref",0,0,arguments.length),new Vs.__referenceConstructor(this.repo,this.path)},Vs.prototype.on=function(t,e,n,r){Gi("Query.on",2,4,arguments.length),fa("Query.on",1,t,!1),Yi("Query.on",2,e,!1);var i=Vs.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Vs.prototype.onValueEvent=function(t,e,n){var r=new Ms(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Vs.prototype.onChildEvent=function(t,e,n){var r=new Fs(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Vs.prototype.off=function(t,e,n){Gi("Query.off",0,3,arguments.length),fa("Query.off",1,t,!0),Yi("Query.off",2,e,!0),Xi("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Ms(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Fs(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Vs.prototype.once=function(t,e,n,r){var i=this;Gi("Query.once",1,4,arguments.length),fa("Query.once",1,t,!1),Yi("Query.once",2,e,!0);var o=Vs.getCancelAndContextArgs_("Query.once",n,r),a=!0,s=new wi;s.promise.catch(function(){});var u=function(n){a&&(a=!1,i.off(t,u),e&&e.bind(o.context)(n),s.resolve(n))};return this.on(t,u,function(e){i.off(t,u),o.cancel&&o.cancel.bind(o.context)(e),s.reject(e)}),s.promise},Vs.prototype.limitToFirst=function(t){if(Gi("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Vs(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Vs.prototype.limitToLast=function(t){if(Gi("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Vs(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Vs.prototype.orderByChild=function(t){if(Gi("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');da("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Xo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Cs(e),r=this.queryParams_.orderBy(n);return Vs.validateQueryEndpoints_(r),new Vs(this.repo,this.path,r,!0)},Vs.prototype.orderByKey=function(){Gi("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(qa);return Vs.validateQueryEndpoints_(t),new Vs(this.repo,this.path,t,!0)},Vs.prototype.orderByPriority=function(){Gi("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ya);return Vs.validateQueryEndpoints_(t),new Vs(this.repo,this.path,t,!0)},Vs.prototype.orderByValue=function(){Gi("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Is);return Vs.validateQueryEndpoints_(t),new Vs(this.repo,this.path,t,!0)},Vs.prototype.startAt=function(t,e){void 0===t&&(t=null),Gi("Query.startAt",0,2,arguments.length),ca("Query.startAt",1,t,this.path,!0),pa("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Vs.validateLimit_(n),Vs.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Vs(this.repo,this.path,n,this.orderByCalled_)},Vs.prototype.endAt=function(t,e){void 0===t&&(t=null),Gi("Query.endAt",0,2,arguments.length),ca("Query.endAt",1,t,this.path,!0),pa("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Vs.validateLimit_(n),Vs.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Vs(this.repo,this.path,n,this.orderByCalled_)},Vs.prototype.equalTo=function(t,e){if(Gi("Query.equalTo",1,2,arguments.length),ca("Query.equalTo",1,t,this.path,!1),pa("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Vs.prototype.toString=function(){return Gi("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Vs.prototype.toJSON=function(){return Gi("Query.toJSON",0,1,arguments.length),this.toString()},Vs.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Vs.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Wo(t);return"{}"===e?"default":e},Vs.prototype.isEqual=function(t){if(Gi("Query.isEqual",1,1,arguments.length),!(t instanceof Vs))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Vs.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Yi(t,3,r.cancel,!0),r.context=n,Xi(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(zi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Vs.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Vs);function Vs(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var Bs=(js.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},js.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new js);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},js.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ya,function(t,e){n.remember(new Xo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},js.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild(function(n,r){var i=new Xo(t.toString()+"/"+n);r.forEachTree(i,e)})},js.prototype.forEachChild=function(t){this.children.forEach(function(e,n){t(n,e)})},js);function js(){this.value=null,this.children=new Map}function Ws(t,e){return t&&"object"==typeof t?(yi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Ks,Qs,Hs=function(t,e){var n,r=Ws(t.getPriority().val(),e);if(t.isLeafNode()){var i=t,o=Ws(i.getValue(),e);return o!==i.getValue()||r!==i.getPriority().val()?new Ha(o,Es(r)):t}var a=t;return r!==(n=a).getPriority().val()&&(n=n.updatePriority(new Ha(r))),a.forEachChild(Ya,function(t,r){var i=Hs(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};(Qs=Ks=Ks||{})[Qs.OVERWRITE=0]="OVERWRITE",Qs[Qs.MERGE=1]="MERGE",Qs[Qs.ACK_USER_WRITE=2]="ACK_USER_WRITE",Qs[Qs.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Gs=(zs.User=new zs(!0,!1,null,!1),zs.Server=new zs(!1,!0,null,!1),zs.forServerTaggedQuery=function(t){return new zs(!1,!0,t,!0)},zs);function zs(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,yi(!r||e,"Tagged queries must be from server.")}var Ys,Xs=(Js.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return yi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Xo(t));return new Js(Xo.Empty,e,this.revert)}return yi(this.path.getFront()===t,"operationForChild called for unrelated child."),new Js(this.path.popFront(),this.affectedTree,this.revert)},Js);function Js(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ks.ACK_USER_WRITE,this.source=Gs.User}var $s=(Zs.fromObject=function(t){var e=Zs.Empty;return Ko(t,function(t,n){e=e.set(new Xo(t),n)}),e},Zs.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Zs.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Xo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Xo(n).child(i.path),value:i.value}},Zs.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},Zs.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):Zs.Empty},Zs.prototype.set=function(t,e){if(t.isEmpty())return new Zs(e,this.children);var n=t.getFront(),r=(this.children.get(n)||Zs.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new Zs(this.value,i)},Zs.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?Zs.Empty:new Zs(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?Zs.Empty:new Zs(this.value,i)}return this},Zs.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},Zs.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n,r=t.getFront(),i=(this.children.get(r)||Zs.Empty).setTree(t.popFront(),e);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new Zs(this.value,n)},Zs.prototype.fold=function(t){return this.fold_(Xo.Empty,t)},Zs.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},Zs.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Xo.Empty,e)},Zs.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},Zs.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Xo.Empty,e)},Zs.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):Zs.Empty},Zs.prototype.foreach=function(t){this.foreach_(Xo.Empty,t)},Zs.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},Zs.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},Zs.Empty=new Zs(null),Zs);function Zs(t,e){void 0===e&&(e=Ys=Ys||new ns(Ao)),this.value=t,this.children=e}var tu=(eu.prototype.operationForChild=function(t){return this.path.isEmpty()?new eu(this.source,Xo.Empty):new eu(this.source,this.path.popFront())},eu);function eu(t,e){this.source=t,this.path=e,this.type=Ks.LISTEN_COMPLETE}var nu=(ru.prototype.operationForChild=function(t){return this.path.isEmpty()?new ru(this.source,Xo.Empty,this.snap.getImmediateChild(t)):new ru(this.source,this.path.popFront(),this.snap)},ru);function ru(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ks.OVERWRITE}var iu=(ou.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Xo(t));return e.isEmpty()?null:e.value?new nu(this.source,Xo.Empty,e.value):new ou(this.source,Xo.Empty,e)}return yi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new ou(this.source,this.path.popFront(),this.children)},ou.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},ou);function ou(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ks.MERGE}var au=(su.prototype.isFullyInitialized=function(){return this.fullyInitialized_},su.prototype.isFiltered=function(){return this.filtered_},su.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},su.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},su.prototype.getNode=function(){return this.node_},su);function su(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var uu=(cu.prototype.updateEventSnap=function(t,e,n){return new cu(new au(t,e,n),this.serverCache_)},cu.prototype.updateServerSnap=function(t,e,n){return new cu(this.eventCache_,new au(t,e,n))},cu.prototype.getEventCache=function(){return this.eventCache_},cu.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},cu.prototype.getServerCache=function(){return this.serverCache_},cu.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},cu.Empty=new cu(new au(ms.EMPTY_NODE,!1,!1),new au(ms.EMPTY_NODE,!1,!1)),cu);function cu(t,e){this.eventCache_=t,this.serverCache_=e}var hu=(lu.valueChange=function(t){return new lu(lu.VALUE,t)},lu.childAddedChange=function(t,e){return new lu(lu.CHILD_ADDED,e,t)},lu.childRemovedChange=function(t,e){return new lu(lu.CHILD_REMOVED,e,t)},lu.childChangedChange=function(t,e,n){return new lu(lu.CHILD_CHANGED,e,t,n)},lu.childMovedChange=function(t,e){return new lu(lu.CHILD_MOVED,e,t)},lu.CHILD_ADDED="child_added",lu.CHILD_REMOVED="child_removed",lu.CHILD_CHANGED="child_changed",lu.CHILD_MOVED="child_moved",lu.VALUE="value",lu);function lu(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var fu=(pu.prototype.updateChild=function(t,e,n,r,i,o){yi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(hu.childRemovedChange(e,a)):yi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(hu.childAddedChange(e,n)):o.trackChildChange(hu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},pu.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ya,function(t,r){e.hasChild(t)||n.trackChildChange(hu.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(Ya,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(hu.childChangedChange(e,r,i))}else n.trackChildChange(hu.childAddedChange(e,r))})),e.withIndex(this.index_)},pu.prototype.updatePriority=function(t,e){return t.isEmpty()?ms.EMPTY_NODE:t.updatePriority(e)},pu.prototype.filtersNodes=function(){return!1},pu.prototype.getIndexedFilter=function(){return this},pu.prototype.getIndex=function(){return this.index_},pu);function pu(t){this.index_=t}var du=(yu.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;yi(e==hu.CHILD_ADDED||e==hu.CHILD_CHANGED||e==hu.CHILD_REMOVED,"Only child changes supported for tracking"),yi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==hu.CHILD_ADDED&&i==hu.CHILD_REMOVED)this.changeMap.set(n,hu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==hu.CHILD_REMOVED&&i==hu.CHILD_ADDED)this.changeMap.delete(n);else if(e==hu.CHILD_REMOVED&&i==hu.CHILD_CHANGED)this.changeMap.set(n,hu.childRemovedChange(n,r.oldSnap));else if(e==hu.CHILD_CHANGED&&i==hu.CHILD_ADDED)this.changeMap.set(n,hu.childAddedChange(n,t.snapshotNode));else{if(e!=hu.CHILD_CHANGED||i!=hu.CHILD_CHANGED)throw mi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,hu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},yu.prototype.getChanges=function(){return Array.from(this.changeMap.values())},yu);function yu(){this.changeMap=new Map}function mu(){}var vu=new(mu.prototype.getCompleteChild=function(t){return null},mu.prototype.getChildAfterChild=function(t,e,n){return null},mu),gu=(bu.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new au(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},bu.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},bu);function bu(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var wu=function(t,e){this.viewCache=t,this.changes=e},_u=(Eu.prototype.assertIndexed=function(t){yi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),yi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Eu.prototype.applyOperation=function(t,e,n,r){var i,o,a=new du;if(e.type===Ks.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(yi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Ks.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(yi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Ks.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Ks.LISTEN_COMPLETE)throw mi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Eu.maybeAddValueEvent_(t,i,h),new wu(i,h)},Eu.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(hu.valueChange(e.getCompleteEventSnap()))}},Eu.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(yi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof ms?u:ms.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){yi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Eu.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,vu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new gu(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Eu.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new gu(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):ms.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Eu.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Eu.prototype.applyUserMerge_=function(t,e,n,r,i,o){var a=this,s=t;return n.foreach(function(n,u){var c=e.child(n);Eu.cacheHasChild_(t,c.getFront())&&(s=a.applyUserOverwrite_(s,c,u,r,i,o))}),n.foreach(function(n,u){var c=e.child(n);Eu.cacheHasChild_(t,c.getFront())||(s=a.applyUserOverwrite_(s,c,u,r,i,o))}),s},Eu.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},Eu.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:$s.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new Xo(e),l,r,i,o,a)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new Xo(e),f,r,i,o,a)}}),c},Eu.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=$s.Empty;return s.getNode().forEachChild(qa,function(t,e){u=u.set(new Xo(t),e)}),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=$s.Empty;return n.foreach(function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))}),this.applyServerMerge_(t,e,c,r,i,a,o)},Eu.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,vu,r)},Eu.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new gu(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();yi(h instanceof ms,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,ms.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Xo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Eu);function Eu(t){this.filter_=t}var Tu=(Su.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===hu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(hu.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,hu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,hu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,hu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,hu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,hu.VALUE,t,n,e),i},Su.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},Su.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Su.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw mi("Should only compare child_ events.");var n=new Da(t.childName,t.snapshotNode),r=new Da(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Su);function Su(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Iu,Cu=(Nu.prototype.getQuery=function(){return this.query_},Nu.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Nu.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Nu.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Nu.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Nu.prototype.removeEventRegistration=function(t,e){var n=[];if(e){yi(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},Nu.prototype.applyOperation=function(t,e,n){t.type===Ks.MERGE&&null!==t.source.queryId&&(yi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),yi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),yi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Nu.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ya,function(t,e){n.push(hu.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(hu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Nu.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Nu);function Nu(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new fu(n.getIndex()),i=n.getNodeFilter();this.processor_=new _u(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(ms.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ms.EMPTY_NODE,a.getNode(),null),c=new au(s,o.isFullyInitialized(),r.filtersNodes()),h=new au(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new uu(h,c),this.eventGenerator_=new Tu(this.query_)}var Au=(Object.defineProperty(ku,"__referenceConstructor",{get:function(){return yi(Iu,"Reference.ts has not been loaded"),Iu},set:function(t){yi(!Iu,"__referenceConstructor has already been defined"),Iu=t},enumerable:!0,configurable:!0}),ku.prototype.isEmpty=function(){return 0===this.views.size},ku.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return yi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ci(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},ku.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof ms?n.calcCompleteEventChildren(r):ms.EMPTY_NODE,!1);var c=new uu(new au(u,s,!1),new au(r,i,!1));a=new Cu(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},ku.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ci(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=hi(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new ku.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},ku.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=ci(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},ku.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ci(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},ku.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},ku.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},ku.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},ku.prototype.getCompleteView=function(){var t,e;try{for(var n=ci(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},ku);function ku(){this.views=new Map}var Du=(Ru.prototype.addWrite=function(t,e){if(t.isEmpty())return new Ru(new $s(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Xo.relativePath(r,t);return i=i.updateChild(o,e),new Ru(this.writeTree_.set(r,i))}var a=new $s(e);return new Ru(this.writeTree_.setTree(t,a))},Ru.prototype.addWrites=function(t,e){var n=this;return Ko(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},Ru.prototype.removeWrite=function(t){return t.isEmpty()?Ru.Empty:new Ru(this.writeTree_.setTree(t,$s.Empty))},Ru.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Ru.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Xo.relativePath(e.path,t)):null},Ru.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ya,function(e,n){t.push(new Da(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new Da(e,n.value))}),t},Ru.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Ru(null!=e?new $s(e):this.writeTree_.subtree(t))},Ru.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Ru.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(yi(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}(Xo.Empty,this.writeTree_,t)},Ru.Empty=new Ru(new $s(null)),Ru);function Ru(t){this.writeTree_=t}var Ou=(Pu.prototype.childWrites=function(t){return new Mu(t,this)},Pu.prototype.addOverwrite=function(t,e,n,r){yi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Pu.prototype.addMerge=function(t,e,n){yi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Pu.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Pu.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});yi(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Ko(r.children,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Pu.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Pu.prototype.calcCompleteEventCache=function(t,e,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(t);if(!r&&i.isEmpty())return e;if(r||null!=e||i.hasCompleteWrite(Xo.Empty)){var o=Pu.layerTree_(this.allWrites_,function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t);return u=e||ms.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(t);if(s.isEmpty())return e;if(null!=e||s.hasCompleteWrite(Xo.Empty)){var u=e||ms.EMPTY_NODE;return s.apply(u)}return null},Pu.prototype.calcCompleteEventChildren=function(t,e){var n=ms.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ya,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ya,function(t,e){var r=i.childCompoundWrite(new Xo(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},Pu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){yi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Pu.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Pu.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Pu.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Xo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Pu.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Pu.prototype.resetTree_=function(){this.visibleWrites_=Pu.layerTree_(this.allWrites_,Pu.DefaultFilter_,Xo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Pu.DefaultFilter_=function(t){return t.visible},Pu.layerTree_=function(t,e,n){for(var r=Du.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Xo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Xo.relativePath(a,n),r=r.addWrite(Xo.Empty,o.snap.getChild(s)));else{if(!o.children)throw mi("WriteRecord should have .snap or .children");if(n.contains(a))s=Xo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Xo.relativePath(a,n)).isEmpty())r=r.addWrites(Xo.Empty,o.children);else{var u=Li(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Xo.Empty,c)}}}}}return r},Pu);function Pu(){this.visibleWrites_=Du.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Mu=(xu.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},xu.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},xu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},xu.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},xu.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},xu.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},xu.prototype.child=function(t){return new xu(this.treePath_.child(t),this.writeTree_)},xu);function xu(t,e){this.treePath_=t,this.writeTree_=e}var Lu=(Fu.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new nu(Gs.User,t,e)):[]},Fu.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=$s.fromObject(e);return this.applyOperationToSyncPoints_(new iu(Gs.User,t,r))},Fu.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=$s.Empty;return null!=n.snap?r=r.set(Xo.Empty,!0):Ko(n.children,function(t,e){r=r.set(new Xo(t),e)}),this.applyOperationToSyncPoints_(new Xs(n.path,r,e))}return[]},Fu.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new nu(Gs.Server,t,e))},Fu.prototype.applyServerMerge=function(t,e){var n=$s.fromObject(e);return this.applyOperationToSyncPoints_(new iu(Gs.Server,t,n))},Fu.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new tu(Gs.Server,t))},Fu.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Fu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Xo.relativePath(o,t),u=new nu(Gs.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},Fu.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=Fu.parseQueryKey_(r),o=i.path,a=i.queryId,s=Xo.relativePath(o,t),u=$s.fromObject(e),c=new iu(Gs.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},Fu.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=Fu.parseQueryKey_(n),i=r.path,o=r.queryId,a=Xo.relativePath(i,t),s=new tu(Gs.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},Fu.prototype.addEventRegistration=function(t,e){var n=t.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,function(t,e){var o=Xo.relativePath(t,n);r=r||e.getCompleteServerCache(o),i=i||e.hasCompleteView()});var o,a=this.syncPointTree_.get(n);a?(i=i||a.hasCompleteView(),r=r||a.getCompleteServerCache(Xo.Empty)):(a=new Au,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r?o=!0:(o=!1,r=ms.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild(function(t,e){var n=e.getCompleteServerCache(Xo.Empty);n&&(r=r.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=Fu.makeQueryKey_(t);yi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=Fu.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(n),l=a.addEventRegistration(t,e,h,r,o);if(!s&&!i){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},Fu.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(Fu.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(Fu.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(Fu.makeQueryKey_(t));r.listenProvider_.stopListening(Fu.queryForListening_(t),e)})),this.removeTags_(u)}return a},Fu.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=Xo.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},Fu.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Ko(n,function(t,e){r=r.concat(e)}),r})},Fu.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=Fu.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Fu.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},Fu.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(Fu.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)yi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Ko(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(Fu.queryForListening_(c),this.tagForQuery_(c))}return o},Fu.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||ms.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},Fu.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},Fu.parseQueryKey_=function(t){var e=t.indexOf("$");return yi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Xo(t.substr(0,e))}},Fu.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},Fu.prototype.tagForQuery_=function(t){var e=Fu.makeQueryKey_(t);return this.queryToTagMap.get(e)},Fu.getNextQueryTag_=function(){return Fu.nextQueryTag_++},Fu.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);yi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},Fu.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Xo.Empty))},Fu.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Xo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Xo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},Fu.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(Xo.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(Xo.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))}),o&&(a=a.concat(o.applyOperation(t,r,n))),a},Fu.nextQueryTag_=1,Fu);function Fu(t){this.listenProvider_=t,this.syncPointTree_=$s.Empty,this.pendingWriteTree_=new Ou,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Uu=(qu.prototype.getNode=function(t){return this.rootNode_.getChild(t)},qu.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},qu);function qu(){this.rootNode_=ms.EMPTY_NODE}var Vu=(Bu.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Eo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Bu.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Bu.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Bu.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Co(t)},Bu);function Bu(t){this.app_=t}var ju=function(t){this.accessToken=t},Wu=(Ku.prototype.getToken=function(t){return Promise.resolve(new ju("owner"))},Ku.prototype.addTokenChangeListener=function(t){},Ku.prototype.removeTokenChangeListener=function(t){},Ku.prototype.notifyForInvalidToken=function(){Co('Database emulator unexpectedly rejected fake "owner" credentials.')},Ku);function Ku(t){this.app_=t}var Qu=(Hu.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),xi(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Hu.prototype.get=function(){return gi(this.counters_)},Hu);function Hu(){this.counters_={}}var Gu=(zu.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Qu),this.collections_[e]},zu.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},zu.collections_={},zu.reporters_={},zu);function zu(){}var Yu=(Xu.prototype.get=function(){var t=this.collection_.get(),e=ai({},t);return this.last_&&Ko(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},Xu);function Xu(t){this.collection_=t,this.last_=null}var Ju=($u.prototype.includeStat=function(t){this.statsToReport_[t]=!0},$u.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;Ko(e,function(e,i){0<i&&xi(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),Go(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},$u);function $u(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Yu(t);var n=1e4+2e4*Math.random();Go(this.reportStats_.bind(this),Math.floor(n))}var Zu=(tc.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new ec(i)),e.add(r)}e&&this.eventLists_.push(e)},tc.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},tc.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},tc.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},tc);function tc(){this.eventLists_=[],this.recursionDepth_=0}var ec=(nc.prototype.add=function(t){this.events_.push(t)},nc.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Uo&&Eo("event: "+e.toString()),Ho(n)}}},nc.prototype.getPath=function(){return this.path_},nc);function nc(t){this.path_=t,this.events_=[]}var rc=(ic.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=li(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},ic.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},ic.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},ic.prototype.validateEventType_=function(t){yi(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},ic);function ic(t){this.allowedEvents_=t,this.listeners_={},yi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var oc,ac=(oi(sc,oc=rc),sc.getInstance=function(){return new sc},sc.prototype.getInitialEvent=function(t){return yi("visible"===t,"Unknown event type: "+t),[this.visible_]},sc);function sc(){var t,e,n=oc.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),n.visible_=!0,e&&document.addEventListener(e,function(){var e=!document[t];e!==n.visible_&&(n.visible_=e,n.trigger("visible",e))},!1),n}var uc,cc=(oi(hc,uc=rc),hc.getInstance=function(){return new hc},hc.prototype.getInitialEvent=function(t){return yi("online"===t,"Unknown event type: "+t),[this.online_]},hc.prototype.currentlyOnline=function(){return this.online_},hc);function hc(){var t=uc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ti()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var lc=(fc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},fc.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Ho(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},fc);function fc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var pc=(dc.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new lc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new yc(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=hi(t,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==i)n.id=o,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=hi(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ta)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},dc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},dc.forceAllow=function(){dc.forceAllow_=!0},dc.forceDisallow=function(){dc.forceDisallow_=!0},dc.isAvailable=function(){return dc.forceAllow_||!dc.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Ii()},dc.prototype.markConnectionHealthy=function(){},dc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},dc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},dc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},dc.prototype.send=function(t){var e=Pi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Do(function(t){var e=fi(t);return vi.encodeByteArray(e,!0)}(e),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},dc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},dc.prototype.incrementIncomingBytes_=function(t){var e=Pi(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},dc);function dc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=To(t),this.stats_=Gu.getCollection(e),this.urlFn=function(t){return e.connectionURL(na,t)}}var yc=(mc.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Eo("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},mc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},mc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},mc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},mc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},mc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},mc.prototype.addTag=function(t,e){var n=this;setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){Eo("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},mc);function mc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Lo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=mc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Eo("frame writing exception"),t.stack&&Eo(t.stack),Eo(t)}}var vc="",gc=null;"undefined"!=typeof MozWebSocket?gc=MozWebSocket:"undefined"!=typeof WebSocket&&(gc=WebSocket);var bc=(wc.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ta)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(ea,r)},wc.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Oo.set("previous_websocket_failure",!0);try{if(Ii()){var i=di.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+vc+"/"+r.platform+"/"+i}},a=r.env,s=0==this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;s&&(o.proxy={origin:s}),this.mySock=new gc(this.connURL,[],o)}else this.mySock=new gc(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var u=t.message||t.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},wc.prototype.start=function(){},wc.forceDisallow=function(){wc.forceDisallow_=!0},wc.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==gc&&!wc.forceDisallow_},wc.previouslyFailed=function(){return Oo.isInMemoryStorage||!0===Oo.get("previous_websocket_failure")},wc.prototype.markConnectionHealthy=function(){Oo.remove("previous_websocket_failure")},wc.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Oi(e);this.onMessage(n)}},wc.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},wc.prototype.extractFrameCount_=function(t){if(yi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},wc.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},wc.prototype.send=function(t){this.resetKeepAlive();var e=Pi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Do(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},wc.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},wc.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},wc.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},wc.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},wc.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},wc.responsesRequiredToBeHealthy=2,wc.healthyTimeout=3e4,wc);function wc(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=To(this.connId),this.stats_=Gu.getCollection(e),this.connURL=wc.connectionURL_(e,n,r)}var _c=(Object.defineProperty(Ec,"ALL_TRANSPORTS",{get:function(){return[pc,bc]},enumerable:!0,configurable:!0}),Ec.prototype.initTransports_=function(t){var e,n,r=bc&&bc.isAvailable(),i=r&&!bc.previouslyFailed();if(t.webSocketOnly&&(r||Co("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[bc];else{var o=this.transports_=[];try{for(var a=ci(Ec.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Ec.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Ec.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Ec);function Ec(t){this.initTransports_(t)}var Tc=(Sc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Go(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Sc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Sc.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},Sc.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},Sc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Sc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Sc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Sc.prototype.onSecondaryMessageReceived_=function(t){var e=ko("t",t),n=ko("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Sc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Sc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Sc.prototype.onPrimaryMessageReceived_=function(t){var e=ko("t",t),n=ko("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Sc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Sc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Sc.prototype.onControl_=function(t){var e=ko("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?So("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):So("Unknown control packet command: "+e)}},Sc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Co("Protocol version mismatch detected"),this.tryStartUpgrade_())},Sc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Sc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Go(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Sc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Sc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Go(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Sc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Sc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Sc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Oo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Sc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Sc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Sc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Sc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Sc);function Sc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=To("c:"+this.id+":"),this.transportManager_=new _c(e),this.log_("Connection created"),this.start_()}var Ic=(Cc.prototype.put=function(t,e,n,r){},Cc.prototype.merge=function(t,e,n,r){},Cc.prototype.refreshAuthToken=function(t){},Cc.prototype.onDisconnectPut=function(t,e,n){},Cc.prototype.onDisconnectMerge=function(t,e,n){},Cc.prototype.onDisconnectCancel=function(t,e){},Cc.prototype.reportStats=function(t){},Cc);function Cc(){}var Nc,Ac=(oi(kc,Nc=Ic),kc.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Pi(i)),yi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},kc.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),yi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),yi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},kc.prototype.sendListen_=function(t){var e=this,n=t.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};t.tag&&(o.q=n.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,function(o){var a=o.d,s=o.s;kc.warnOnListenWarnings_(a,n),(e.listens.get(r)&&e.listens.get(r).get(i))===t&&(e.log_("listen response",o),"ok"!==s&&e.removeListen_(r,i),t.onComplete&&t.onComplete(s,a))})},kc.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&xi(t,"w")){var n=Li(t,"w");Array.isArray(n)&&~n.indexOf("no_index")&&Co('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+e.getQueryParams().getIndex().toString()+'" at '+e.path.toString()+" to your security rules for better performance.")}},kc.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},kc.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Mi(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},kc.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=function(t){var n=Mi(e).claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}()?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},kc.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),yi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},kc.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},kc.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},kc.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},kc.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},kc.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},kc.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},kc.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},kc.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},kc.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},kc.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},kc.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Pi(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},kc.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):So("Unrecognized action received from server: "+Pi(t)+"\nAre you using the latest client?")},kc.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},kc.prototype.scheduleConnect_=function(t){var e=this;yi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},kc.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},kc.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},kc.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},kc.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+kc.nextConnectionId_++,i=this,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){yi(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then(function(u){a?Eo("getToken() completed but was canceled"):(Eo("getToken() completed. Creating connection."),i.authToken_=u&&u.accessToken,s=new Tc(r,i.repoInfo_,t,e,n,function(t){Co(t+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")},o))}).then(null,function(t){i.log_("Failed to get token: "+t),a||u()})}},kc.prototype.interrupt=function(t){Eo("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},kc.prototype.resume=function(t){Eo("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Fi(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},kc.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},kc.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},kc.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Wo(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},kc.prototype.removeListen_=function(t,e){var n,r=new Xo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},kc.prototype.onAuthRevoked_=function(t,e){Eo("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},kc.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},kc.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=ci(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ci(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},kc.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+vc.replace(/\./g,"-")]=1,Ti()?t["framework.cordova"]=1:Si()&&(t["framework.reactnative"]=1),this.reportStats(t)},kc.prototype.shouldReconnect_=function(){var t=cc.getInstance().currentlyOnline();return Fi(this.interruptReasons_)&&t},kc.nextPersistentConnectionId_=0,kc.nextConnectionId_=0,kc);function kc(t,e,n,r,i,o){var a=Nc.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=kc.nextPersistentConnectionId_++,a.log_=To("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ii())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),ac.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&cc.getInstance().on("online",a.onOnline_,a),a}var Dc,Rc=(oi(Oc,Dc=Ic),Oc.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Oc.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(yi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Oc.prototype.listen=function(t,e,n,r){var i=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=Oc.getListenId_(t,n),s={};this.listens_[a]=s;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,function(t,e){var u=e;404===t&&(t=u=null),null===t&&i.onDataUpdate_(o,u,!1,n),Li(i.listens_,a)===s&&r(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Oc.prototype.unlisten=function(t,e){var n=Oc.getListenId_(t,e);delete this.listens_[n]},Oc.prototype.refreshAuthToken=function(t){},Oc.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}(e);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(200<=s.status&&s.status<300){try{t=Oi(s.responseText)}catch(t){Co("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&Co("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()})},Oc);function Oc(t,e,n){var r=Dc.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=To("p:rest:"),r.listens_={},r}var Pc="repo_interrupt",Mc=(xc.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},xc.prototype.name=function(){return this.repoInfo_.namespace},xc.prototype.serverTime=function(){var t=this.infoData_.getNode(new Xo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},xc.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},xc.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Xo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Ui(e,function(t){return Es(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Es(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Ui(e,function(t){return Es(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Es(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},xc.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},xc.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},xc.prototype.onServerInfoUpdate_=function(t){var e=this;Ko(t,function(t,n){e.updateInfo_(t,n)})},xc.prototype.updateInfo_=function(t,e){var n=new Xo("/.info/"+t),r=Es(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},xc.prototype.getNextWriteId_=function(){return this.nextWriteId_++},xc.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=Es(e,n),s=Hs(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),function(e,n){var o="ok"===e;o||Co("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},xc.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(Ko(e,function(t,e){i=!1;var n=Es(e);a[t]=Hs(n,o)}),i)Eo("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||Co("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)}),Ko(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},xc.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new Bs;return t.forEachTree(new Xo(""),function(t,r){n.remember(t,Hs(r,e))}),n}(this.onDisconnect_,e),r=[];n.forEachTree(Xo.Empty,function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new Bs,this.eventQueue_.raiseEventsForChangedPath(Xo.Empty,r)},xc.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},xc.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Es(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},xc.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Es(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},xc.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Fi(e))return Eo("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&Ko(e,function(e,n){var i=Es(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},xc.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xc.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xc.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Pc)},xc.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Pc)},xc.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Yu(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Ko(e,function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)})}},xc.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},xc.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Eo.apply(void 0,li([n],t))},xc.prototype.callOnCompleteCallback=function(t,e,n){t&&Ho(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(xc.prototype,"database",{get:function(){return this.__database||(this.__database=new th(this))},enumerable:!0,configurable:!0}),xc);function xc(t,e,n){var i,o=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Zu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Bs,this.persistentConnection_=null,i=void 0!==r&&r.env[xo]?new Wu(n):new Vu(n),this.stats_=Gu.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Rc(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=n.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Pi(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Ac(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){o.server_.refreshAuthToken(t)}),this.statsReporter_=Gu.getOrCreateReporter(t,function(){return new Ju(o.stats_,o.server_)}),this.transactions_init_(),this.infoData_=new Uu,this.infoSyncTree_=new Lu({startListening:function(t,e,n,r){var i=[],a=o.infoData_.getNode(t.path);return a.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Lu({startListening:function(t,e,n,r){return o.server_.listen(t,n,e,function(e,n){var i=r(e,n);o.eventQueue_.raiseEventsForChangedPath(t.path,i)}),[]},stopListening:function(t,e){o.server_.unlisten(t,e)}})}var Lc=(Fc.prototype.getStartPost=function(){return this.startPost_},Fc.prototype.getEndPost=function(){return this.endPost_},Fc.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Fc.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Da(e,n))||(n=ms.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Fc.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=ms.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(ms.EMPTY_NODE);var i=this;return e.forEachChild(Ya,function(t,e){i.matches(new Da(t,e))||(r=r.updateImmediateChild(t,ms.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Fc.prototype.updatePriority=function(t,e){return t},Fc.prototype.filtersNodes=function(){return!0},Fc.prototype.getIndexedFilter=function(){return this.indexedFilter_},Fc.prototype.getIndex=function(){return this.index_},Fc.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Fc.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Fc);function Fc(t){this.indexedFilter_=new fu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Fc.getStartPost_(t),this.endPost_=Fc.getEndPost_(t)}var Uc=(qc.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Da(e,n))||(n=ms.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},qc.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=ms.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=ms.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(ms.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,ms.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},qc.prototype.updatePriority=function(t,e){return t},qc.prototype.filtersNodes=function(){return!0},qc.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},qc.prototype.getIndex=function(){return this.index_},qc.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;yi(s.numChildren()==this.limit_,"");var u=new Da(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(hu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(hu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,ms.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(hu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(hu.childRemovedChange(c.name,c.node)),i.trackChildChange(hu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,ms.EMPTY_NODE)):t},qc);function qc(t){this.rangedFilter_=new Lc(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Vc=(Bc.prototype.hasStart=function(){return this.startSet_},Bc.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Bc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Bc.prototype.getIndexStartValue=function(){return yi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Bc.prototype.getIndexStartName=function(){return yi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vo},Bc.prototype.hasEnd=function(){return this.endSet_},Bc.prototype.getIndexEndValue=function(){return yi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Bc.prototype.getIndexEndName=function(){return yi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Bo},Bc.prototype.hasLimit=function(){return this.limitSet_},Bc.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Bc.prototype.getLimit=function(){return yi(this.limitSet_,"Only valid if limit has been set"),this.limit_},Bc.prototype.getIndex=function(){return this.index_},Bc.prototype.copy_=function(){var t=new Bc;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Bc.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Bc.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Bc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Bc.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Bc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Bc.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Bc.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Bc.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Bc.prototype.getQueryObject=function(){var t=Bc.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Ya&&(e[t.INDEX]=this.index_.toString()),e},Bc.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Bc.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ya},Bc.prototype.getNodeFilter=function(){return this.loadsAllData()?new fu(this.getIndex()):this.hasLimit()?new Uc(this):new Lc(this)},Bc.prototype.toRestQueryStringParameters=function(){var t,e=Bc.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Ya?e.PRIORITY_INDEX:this.index_===Is?e.VALUE_INDEX:this.index_===qa?e.KEY_INDEX:(yi(this.index_ instanceof Cs,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Pi(t),this.startSet_&&(n[e.START_AT]=Pi(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Pi(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Pi(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Pi(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Bc.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Bc.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Bc.DEFAULT=new Bc,Bc);function Bc(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ya}var jc,Wc=(oi(Kc,jc=qs),Kc.prototype.getKey=function(){return Gi("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Kc.prototype.child=function(t){return Gi("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Xo||(null===this.path.getFront()?function(t,e,n,r){da("Reference.child",1,n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),!1)}(0,0,t):da("Reference.child",1,t,!1)),new Kc(this.repo,this.path.child(t))},Kc.prototype.getParent=function(){Gi("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Kc(this.repo,t)},Kc.prototype.getRoot=function(){Gi("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Kc.prototype.databaseProp=function(){return this.repo.database},Kc.prototype.set=function(t,e){Gi("Reference.set",1,2,arguments.length),ya("Reference.set",this.path),ca("Reference.set",1,t,this.path,!1),Yi("Reference.set",2,e,!0);var n=new wi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Kc.prototype.update=function(t,e){if(Gi("Reference.update",1,2,arguments.length),ya("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Co("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ha("Reference.update",1,t,this.path,!1),Yi("Reference.update",2,e,!0);var i=new wi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Kc.prototype.setWithPriority=function(t,e,n){if(Gi("Reference.setWithPriority",2,3,arguments.length),ya("Reference.setWithPriority",this.path),ca("Reference.setWithPriority",1,t,this.path,!1),la("Reference.setWithPriority",2,e,!1),Yi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new wi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Kc.prototype.remove=function(t){return Gi("Reference.remove",0,1,arguments.length),ya("Reference.remove",this.path),Yi("Reference.remove",1,t,!0),this.set(null,t)},Kc.prototype.transaction=function(t,e,n){if(Gi("Reference.transaction",1,3,arguments.length),ya("Reference.transaction",this.path),Yi("Reference.transaction",1,t,!1),Yi("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(zi("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new wi;return"function"==typeof e&&r.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new Sa(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},Kc.prototype.setPriority=function(t,e){Gi("Reference.setPriority",1,2,arguments.length),ya("Reference.setPriority",this.path),la("Reference.setPriority",1,t,!1),Yi("Reference.setPriority",2,e,!0);var n=new wi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Kc.prototype.push=function(t,e){Gi("Reference.push",0,2,arguments.length),ya("Reference.push",this.path),ca("Reference.push",1,t,this.path,!0),Yi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=ka(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Kc.prototype.onDisconnect=function(){return ya("Reference.onDisconnect",this.path),new Ea(this.repo,this.path)},Object.defineProperty(Kc.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Kc.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Kc.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Kc.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Kc);function Kc(t,e){if(!(t instanceof Mc))throw new Error("new Reference() no longer supported - use app.database().");return jc.call(this,t,e,Vc.DEFAULT,!1)||this}qs.__referenceConstructor=Wc,Au.__referenceConstructor=Wc;var Qc,Hc,Gc=function(){this.children={},this.childCount=0,this.value=null},zc=(Yc.prototype.subTree=function(t){for(var e,n=t instanceof Xo?t:new Xo(t),r=this;null!==(e=n.getFront());)r=new Yc(e,r,Li(r.node_.children,e)||new Gc),n=n.popFront();return r},Yc.prototype.getValue=function(){return this.node_.value},Yc.prototype.setValue=function(t){yi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Yc.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Yc.prototype.hasChildren=function(){return 0<this.node_.childCount},Yc.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Yc.prototype.forEachChild=function(t){var e=this;Ko(this.node_.children,function(n,r){t(new Yc(n,e,r))})},Yc.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},Yc.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Yc.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},Yc.prototype.path=function(){return new Xo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Yc.prototype.name=function(){return this.name_},Yc.prototype.parent=function(){return this.parent_},Yc.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Yc.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=xi(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Yc);function Yc(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Gc),this.name_=t,this.parent_=e,this.node_=n}(Hc=Qc=Qc||{})[Hc.RUN=0]="RUN",Hc[Hc.SENT=1]="SENT",Hc[Hc.COMPLETED=2]="COMPLETED",Hc[Hc.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Hc[Hc.NEEDS_ABORT=4]="NEEDS_ABORT",Mc.MAX_TRANSACTION_RETRIES_=25,Mc.prototype.transactions_init_=function(){this.transactionQueueTree_=new zc},Mc.prototype.startTransaction=function(t,e,n,r){function i(){}this.log_("transaction on "+t);var o=new Wc(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Lo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new As(a.currentInputSnapshot,new Wc(this,a.path),Ya);a.onComplete(null,!1,c)}}else{_a("transaction failed: Data returned ",u,a.path),a.status=Qc.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;"object"==typeof u&&null!==u&&xi(u,".priority")?(f=Li(u,".priority"),yi(ua(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||ms.EMPTY_NODE).getPriority().val(),f=f;var p=this.generateServerValues(),d=Es(u,f),y=Hs(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Mc.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||ms.EMPTY_NODE},Mc.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);yi(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Qc.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Mc.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];yi(u.status===Qc.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Qc.SENT,u.retryCount++;var c=Xo.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=Qc.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new Wc(n,e[a].path),c=new As(s,u,Ya);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)Ho(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===Qc.SENT_NEEDS_ABORT?e[a].status=Qc.NEEDS_ABORT:e[a].status=Qc.RUN;else for(Co("transaction at "+l.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=Qc.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}},a)},Mc.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Mc.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Qc.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Xo.relativePath(e,s.path),c=!1,h=void 0;if(yi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Qc.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Qc.RUN)if(s.retryCount>=Mc.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){_a("transaction failed: Data returned ",f,s.path);var p=Es(f);"object"==typeof f&&null!=f&&xi(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Hs(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Qc.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new Wc(this,t[a].path),g=t[a].currentInputSnapshot,b=new As(g,v,Ya);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<r.length;a++)Ho(r[a]);this.sendReadyTransactions_()}},Mc.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Mc.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Mc.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Mc.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Qc.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Mc.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Mc.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===Qc.SENT_NEEDS_ABORT||(e[o].status===Qc.SENT?(yi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Qc.SENT_NEEDS_ABORT,e[o].abortReason="set"):(yi(e[o].status===Qc.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)Ho(n[o])}};var Xc,Jc="databaseURL",$c=(Zc.getInstance=function(){return Xc=Xc||new Zc},Zc.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},Zc.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},Zc.prototype.databaseFromApp=function(t,e){var n=e||t.options[Jc];void 0===n&&Io("Can't determine Firebase Database URL.  Be sure to include "+Jc+" option when calling firebase.initializeApp().");var i=oa(n),o=i.repoInfo,a=void 0;return void 0!==r&&(a=r.env[xo]),a&&(o=(i=oa(n="http://"+a+"?ns="+o.namespace)).repoInfo),ma("Invalid Firebase Database URL",1,i),i.path.isEmpty()||Io("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t).database},Zc.prototype.deleteRepo=function(t){var e=Li(this.repos_,t.app.name);e&&Li(e,t.repoInfo_.toURLString())===t||Io("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},Zc.prototype.createRepo=function(t,e){var n=Li(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Li(n,t.toURLString());return r&&Io("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Mc(t,this.useRestClient_,e),n[t.toURLString()]=r},Zc.prototype.forceRestClient=function(t){this.useRestClient_=t},Zc);function Zc(){this.repos_={},this.useRestClient_=!1}var th=(Object.defineProperty(eh.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),eh.prototype.ref=function(t){return this.checkDeleted_("ref"),Gi("database.ref",0,1,arguments.length),t instanceof Wc?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},eh.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Gi(e,1,1,arguments.length);var n=oa(t);ma(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Io(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},eh.prototype.checkDeleted_=function(t){null===this.repo_&&Io("Cannot call "+t+" on a deleted database.")},eh.prototype.goOffline=function(){Gi("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},eh.prototype.goOnline=function(){Gi("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},eh.ServerValue={TIMESTAMP:{".sv":"timestamp"}},eh);function eh(t){(this.repo_=t)instanceof Mc||Io("Don't call new Database() directly - please use firebase.database()."),this.root_=new Wc(t,Xo.Empty),this.INTERNAL=new nh(this)}var nh=(rh.prototype.delete=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return this.database.checkDeleted_("delete"),$c.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},rh);function rh(t){this.database=t}var ih=Object.freeze({forceLongPolling:function(){bc.forceDisallow(),pc.forceAllow()},forceWebSockets:function(){pc.forceDisallow()},isWebSocketsAvailable:function(){return bc.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),oh=Ac;Ac.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Ac.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var ah,sh,uh=Tc,ch=ra,hh=Object.freeze({DataConnection:oh,RealTimeConnection:uh,hijackHash:function(t){var e=Ac.prototype.put;return Ac.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Ac.prototype.put=e}},ConnectionTarget:ch,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){$c.getInstance().forceRestClient(t)}}),lh=th.ServerValue;ah=(sh=po).SDK_VERSION,vc=ah,sh.INTERNAL.registerService("database",function(t,e,n){return $c.getInstance().databaseFromApp(t,n)},{Reference:Wc,Query:qs,Database:th,DataSnapshot:As,enableLogging:_o,INTERNAL:ih,ServerValue:lh,TEST_ACCESS:hh},null,!0);var fh,ph="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},dh=dh||{},yh=ph;function mh(t){return"string"==typeof t}function vh(t){return"number"==typeof t}function gh(t,e){t=t.split("."),e=e||yh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function bh(){}function wh(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function _h(t){return"array"==wh(t)}function Eh(t){var e=wh(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Th(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Sh="closure_uid_"+(1e9*Math.random()>>>0),Ih=0;function Ch(t,e,n){return t.call.apply(t.bind,arguments)}function Nh(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ah(t,e,n){return(Ah=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ch:Nh).apply(null,arguments)}function kh(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var Dh=Date.now||function(){return+new Date};function Rh(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Oh(){this.j=this.j,this.i=this.i}Oh.prototype.j=!1,Oh.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[Sh]||(this[Sh]=++Ih))},Oh.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Ph=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(mh(t))return mh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Mh=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=mh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function xh(){return Array.prototype.concat.apply([],arguments)}function Lh(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Fh(t){return/^[\s\xa0]*$/.test(t)}var Uh,qh=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Vh(t,e){return-1!=t.indexOf(e)}function Bh(t,e){return t<e?-1:e<t?1:0}t:{var jh=yh.navigator;if(jh){var Wh=jh.userAgent;if(Wh){Uh=Wh;break t}}Uh=""}function Kh(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Qh(t){var e,n={};for(e in t)n[e]=t[e];return n}var Hh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Gh(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Hh.length;i++)e=Hh[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function zh(t){return zh[" "](t),t}zh[" "]=bh;var Yh,Xh,Jh=Vh(Uh,"Opera"),$h=Vh(Uh,"Trident")||Vh(Uh,"MSIE"),Zh=Vh(Uh,"Edge"),tl=Zh||$h,el=Vh(Uh,"Gecko")&&!(Vh(Uh.toLowerCase(),"webkit")&&!Vh(Uh,"Edge"))&&!(Vh(Uh,"Trident")||Vh(Uh,"MSIE"))&&!Vh(Uh,"Edge"),nl=Vh(Uh.toLowerCase(),"webkit")&&!Vh(Uh,"Edge");function rl(){var t=yh.document;return t?t.documentMode:void 0}t:{var il="",ol=(Xh=Uh,el?/rv:([^\);]+)(\)|;)/.exec(Xh):Zh?/Edge\/([\d\.]+)/.exec(Xh):$h?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Xh):nl?/WebKit\/(\S+)/.exec(Xh):Jh?/(?:Version)[ \/]?(\S+)/.exec(Xh):void 0);if(ol&&(il=ol?ol[1]:""),$h){var al=rl();if(null!=al&&al>parseFloat(il)){Yh=String(al);break t}}Yh=il}var sl,ul={};function cl(t){return function(e,n){var r=ul;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=qh(String(Yh)).split("."),r=qh(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Bh(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Bh(0==a[2].length,0==s[2].length)||Bh(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}var hl=yh.document;sl=hl&&$h?rl()||("CSS1Compat"==hl.compatMode?parseInt(Yh,10):5):void 0;var ll=!$h||9<=Number(sl),fl=$h&&!cl("9"),pl=function(){if(!yh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{yh.addEventListener("test",bh,e),yh.removeEventListener("test",bh,e)}catch(t){}return t}();function dl(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function yl(t,e){if(dl.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(el){t:{try{zh(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=mh(t.pointerType)?t.pointerType:ml[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}dl.prototype.b=function(){this.Ja=!1},Rh(yl,dl);var ml={2:"touch",3:"pen",4:"mouse"};yl.prototype.b=function(){yl.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,fl)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var vl="closure_listenable_"+(1e6*Math.random()|0),gl=0;function bl(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++gl,this.X=this.Z=!1}function wl(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function _l(t){this.src=t,this.a={},this.b=0}function El(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Ph(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(wl(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Tl(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}_l.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Tl(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new bl(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Sl="closure_lm_"+(1e6*Math.random()|0),Il={};function Cl(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(_h(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Ml(r),e&&e[vl]?e.Ba(n,r,Th(i)?!!i.capture:!!i,o):Nl(e,n,r,!0,i,o)}(t,e,n,r,i);if(_h(e)){for(var o=0;o<e.length;o++)Cl(t,e[o],n,r,i);return null}return n=Ml(n),t&&t[vl]?t.Aa(e,n,Th(r)?!!r.capture:!!r,i):Nl(t,e,n,!1,r,i)}function Nl(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Th(i)?!!i.capture:!!i;if(a&&!ll)return null;var s=Ol(t);if(s||(t[Sl]=s=new _l(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Rl,e=ll?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)pl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(kl(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Al(t){if(!vh(t)&&t&&!t.X){var e=t.src;if(e&&e[vl])El(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(kl(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ol(e))?(El(n,t),0==n.b&&(n.src=null,e[Sl]=null)):wl(t)}}}function kl(t){return t in Il?Il[t]:Il[t]="on"+t}function Dl(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Al(t),n.call(r,e)}function Rl(t,e){return!!t.X||Dl(t,ll?new yl(e,this):e=new yl(e||gh("window.event"),this))}function Ol(t){return(t=t[Sl])instanceof _l?t:null}var Pl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ml(t){return"function"==wh(t)?t:(t[Pl]||(t[Pl]=function(e){return t.handleEvent(e)}),t[Pl])}function xl(){Oh.call(this),this.c=new _l(this),(this.J=this).B=null}function Ll(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&El(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Rh(xl,Oh),xl.prototype[vl]=!0,(fh=xl.prototype).addEventListener=function(t,e,n,r){Cl(this,t,e,n,r)},fh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(_h(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Th(i)?!!i.capture:!!i,r=Ml(r),e&&e[vl]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Tl(a=e.a[n],r,i,o))&&(wl(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Ol(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Tl(n,r,i,o)),(r=-1<e?n[e]:null)&&Al(r))}(this,t,e,n,r)},fh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(mh(t))t=new dl(t,n);else if(t instanceof dl)t.target=t.target||n;else{var i=t;Gh(t=new dl(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Ll(a,r,!0,t)&&i}if(i=Ll(a=t.a=n,r,!0,t)&&i,i=Ll(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ll(a=t.a=e[o],r,!1,t)&&i;return i},fh.G=function(){if(xl.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)wl(n[r]);delete e.a[t],e.b--}}this.B=null},fh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},fh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Fl=yh.JSON.stringify;function Ul(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function ql(){this.b=this.a=null}Ul.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Vl,Bl=new Ul(function(){return new jl},function(t){t.reset()});function jl(){this.next=this.b=this.a=null}function Wl(t){yh.setTimeout(function(){throw t},0)}function Kl(t,e){Vl||function(){var t=yh.Promise.resolve(void 0);Vl=function(){t.then(Gl)}}(),Ql||(Vl(),Ql=!0),Hl.add(t,e)}ql.prototype.add=function(t,e){var n=Bl.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},jl.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ql=!(jl.prototype.reset=function(){this.next=this.b=this.a=null}),Hl=new ql;function Gl(){for(var t;r=n=void 0,r=null,(n=Hl).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Wl(t)}var e=Bl;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Ql=!1}function zl(t,e){xl.call(this),this.b=t||1,this.a=e||yh,this.f=Ah(this.gb,this),this.g=Dh()}function Yl(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Xl(t,e,n){if("function"==wh(t))n&&(t=Ah(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ah(t.handleEvent,t)}return 2147483647<Number(e)?-1:yh.setTimeout(t,e||0)}function Jl(t,e,n){Oh.call(this),this.f=null!=n?Ah(t,n):t,this.c=e,this.b=Ah(this.ab,this),this.a=[]}function $l(t){t.U=Xl(t.b,t.c),t.f.apply(null,t.a)}function Zl(t){Oh.call(this),this.b=t,this.a={}}Rh(zl,xl),(fh=zl.prototype).ba=!1,fh.L=null,fh.gb=function(){if(this.ba){var t=Dh()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Yl(this),this.start()))}},fh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Dh())},fh.G=function(){zl.N.G.call(this),Yl(this),delete this.a},Rh(Jl,Oh),(fh=Jl.prototype).ea=!1,fh.U=null,fh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:$l(this)},fh.G=function(){Jl.N.G.call(this),this.U&&(yh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},fh.ab=function(){this.U=null,this.ea&&(this.ea=!1,$l(this))},Rh(Zl,Oh);var tf=[];function ef(t,e,n,r){_h(n)||(n&&(tf[0]=n.toString()),n=tf);for(var i=0;i<n.length;i++){var o=Cl(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function nf(t){Kh(t.a,function(t,e){this.a.hasOwnProperty(e)&&Al(t)},t),t.a={}}function rf(){}Zl.prototype.G=function(){Zl.N.G.call(this),nf(this)},Zl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var of=new xl;function af(t){dl.call(this,"serverreachability",t)}function sf(t){of.dispatchEvent(new af(of,t))}function uf(t){dl.call(this,"statevent",t)}function cf(t){of.dispatchEvent(new uf(of,t))}function hf(t){dl.call(this,"timingevent",t)}function lf(t,e){if("function"!=wh(t))throw Error("Fn must not be null and must be a function");return yh.setTimeout(function(){t()},e)}Rh(af,dl),Rh(uf,dl),Rh(hf,dl);var ff={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},pf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function df(){}function yf(t){var e;return(e=t.a)||(e=t.a={}),e}function mf(){}df.prototype.a=null;var vf,gf={OPEN:"a",ib:"b",Na:"c",rb:"d"};function bf(){dl.call(this,"d")}function wf(){dl.call(this,"c")}function _f(){}function Ef(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Zl(this),this.O=Tf,t=tl?125:void 0,this.P=new zl(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Rh(bf,dl),Rh(wf,dl),Rh(_f,df),vf=new _f;var Tf=45e3,Sf={},If={};function Cf(t,e,n){t.F=1,t.f=Jf(Kf(e)),t.l=n,t.H=!0,Af(t,null)}function Nf(t,e,n,r){t.F=1,t.f=Jf(Kf(e)),t.l=null,t.H=n,Af(t,r)}function Af(t,e){t.v=Dh(),Rf(t),t.D=Kf(t.f),Xf(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Jl(Ah(t.Ka,t,t.a),t.J)),ef(t.I,t.a,"readystatechange",t.eb),e=t.h?Qh(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),sf(1)}function kf(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Df(t,n);if(i==If){4==e&&(t.c=4,cf(14),r=!1);break}if(i==Sf){t.c=4,cf(15),r=!1;break}Lf(t,i)}4==e&&0==n.length&&(t.c=1,cf(16),r=!1),t.b=t.b&&r,r||(xf(t),Mf(t))}function Df(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?If:(n=Number(e.substring(n,r)),isNaN(n)?Sf:(r+=1)+n>e.length?If:(e=e.substr(r,n),t.A=r+n,e))}function Rf(t){t.R=Dh()+t.O,Of(t,t.O)}function Of(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=lf(Ah(t.bb,t),e)}function Pf(t){t.i&&(yh.clearTimeout(t.i),t.i=null)}function Mf(t){t.g.Da()||t.m||t.g.na(t)}function xf(t){Pf(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Yl(t.P),nf(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Lf(t,e){try{t.g.Ga(t,e),sf(4)}catch(t){}}function Ff(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Eh(t)||mh(t))Mh(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Eh(t)||mh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(mh(t))return t.split("");if(Eh(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Uf(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Uf)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qf(t,e){Bf(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Vf(t))}function Vf(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Bf(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Bf(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Bf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(fh=Ef.prototype).setTimeout=function(t){this.O=t},fh.eb=function(t){t=t.target;var e=this.B;e&&3==Wp(t)?e.Ua():this.Ka(t)},fh.Ka=function(t){try{if(t==this.a)t:{var e=Wp(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!tl&&!this.a.aa())){this.m||4!=e||7==n||sf(8==n||r<=0?3:2),Pf(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Kp(this.a,"X-HTTP-Initial-Response");if(a&&!Fh(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,cf(12),xf(this),Mf(this);break t}this.s=!0,Lf(this,s)}this.H?(kf(this,e,o),tl&&this.b&&3==e&&(ef(this.I,this.P,"tick",this.cb),this.P.start())):Lf(this,o),4==e&&xf(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Rf(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,cf(12)):(this.c=0,cf(13)),xf(this),Mf(this)}}}catch(t){}},fh.cb=function(){if(this.a){var t=Wp(this.a),e=this.a.aa();this.A<e.length&&(Pf(this),kf(this,t,e),this.b&&4!=t&&Rf(this))}},fh.cancel=function(){this.m=!0,xf(this)},fh.bb=function(){this.i=null;var t=Dh();0<=t-this.R?(2!=this.F&&(sf(3),cf(17)),xf(this),this.c=2,Mf(this)):Of(this,this.R-t)},(fh=Uf.prototype).C=function(){Vf(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},fh.K=function(){return Vf(this),this.a.concat()},fh.get=function(t,e){return Bf(this.b,t)?this.b[t]:e},fh.set=function(t,e){Bf(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},fh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var jf=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Wf(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Wf?(this.h=void 0!==e?e:t.h,Qf(this,t.f),this.j=t.j,Hf(this,t.b),Gf(this,t.i),this.a=t.a,zf(this,lp(t.c)),this.g=t.g):t&&(n=String(t).match(jf))?(this.h=!!e,Qf(this,n[1]||"",!0),this.j=$f(n[2]||""),Hf(this,n[3]||"",!0),Gf(this,n[4]),this.a=$f(n[5]||"",!0),zf(this,n[6]||"",!0),this.g=$f(n[7]||"")):(this.h=!!e,this.c=new ap(null,this.h))}function Kf(t){return new Wf(t)}function Qf(t,e,n){t.f=n?$f(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Hf(t,e,n){t.b=n?$f(e,!0):e}function Gf(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function zf(t,e,n){e instanceof ap?(t.c=e,function(t,e){e&&!t.f&&(sp(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(up(this,e),hp(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Zf(e,ip)),t.c=new ap(e,t.h))}function Yf(t,e,n){t.c.set(e,n)}function Xf(t,e,n){_h(n)||(n=[String(n)]),hp(t.c,e,n)}function Jf(t){return Yf(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Dh()).toString(36)),t}function $f(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Zf(t,e,n){return mh(t)?(t=encodeURI(t).replace(e,tp),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tp(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Wf.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Zf(e,ep,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Zf(e,ep,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Zf(n,"/"==n.charAt(0)?rp:np,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Zf(n,op)),t.join("")},Wf.prototype.resolve=function(t){var e=Kf(this),n=!!t.f;n?Qf(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Hf(e,t.b):n=null!=t.i;var r=t.a;if(n)Gf(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Vh(i,"./")||Vh(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?zf(e,lp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ep=/[#\/\?@]/g,np=/[#\?:]/g,rp=/[#\?]/g,ip=/[#\?@]/g,op=/#/g;function ap(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function sp(t){t.a||(t.a=new Uf,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function up(t,e){sp(t),e=fp(t,e),Bf(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qf(t.a,e))}function cp(t,e){return sp(t),e=fp(t,e),Bf(t.a.b,e)}function hp(t,e,n){up(t,e),0<n.length&&(t.c=null,t.a.set(fp(t,e),Lh(n)),t.b+=n.length)}function lp(t){var e=new ap;return e.c=t.c,t.a&&(e.a=new Uf(t.a),e.b=t.b),e}function fp(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function pp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function dp(t){var e=t.a.F.a;if(null!=e)cf(4),e?(cf(10),nd(t.a,t,!1)):(cf(11),nd(t.a,t,!0));else{t.b=new Ef(t,void 0,void 0),t.b.h=t.h,e=sd(e=t.a,e.Y()?t.f:null,t.i),cf(4),Xf(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Yf(e,n,r),Nf(t.b,e,!1,t.f)}}function yp(){this.a=this.b=null}function mp(){this.a=new Uf}function vp(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Sh]||(t[Sh]=++Ih)):e.charAt(0)+t}function gp(t,e){this.b=t,this.a=e}function bp(t){this.g=t||wp,t=yh.PerformanceNavigationTiming?0<(t=yh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(yh.ka&&yh.ka.Ea&&yh.ka.Ea()&&yh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new mp),this.b=null,this.c=[]}(fh=ap.prototype).add=function(t,e){sp(this),this.c=null,t=fp(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},fh.forEach=function(t,e){sp(this),this.a.forEach(function(n,r){Mh(n,function(n){t.call(e,n,r,this)},this)},this)},fh.K=function(){sp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},fh.C=function(t){sp(this);var e=[];if(mh(t))cp(this,t)&&(e=xh(e,this.a.get(fp(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=xh(e,t[n])}return e},fh.set=function(t,e){return sp(this),this.c=null,cp(this,t=fp(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},fh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},fh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Rh(function(){},function(){}),(fh=pp.prototype).M=null,fh.$=function(t){return this.a.$(t)},fh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},fh.Da=function(){return!1},fh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Kp(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Kp(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void od(e,2)}this.f=r[0]}else(e=this.a).m=this.c,od(e,2)}else 1==this.M&&(this.g?cf(6):"11111"==e?(cf(5),this.g=!0,(!$h||10<=Number(sl))&&(this.c=200,this.b.cancel(),cf(11),nd(this.a,this,!0))):(cf(7),this.g=!1))},fh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,dp(this)):1==this.M&&(this.g?(cf(11),nd(this.a,this,!0)):(cf(10),nd(this.a,this,!1)));else{0==this.M?cf(8):1==this.M&&cf(9);var t=this.a;t.m=this.c,od(t,2)}},fh.Y=function(){return this.a.Y()},fh.ma=function(){return this.a.ma()},mp.prototype.add=function(t){this.a.set(vp(t),t)},mp.prototype.C=function(){return this.a.C()};var wp=10;function _p(t,e){!t.a&&(Vh(e,"spdy")||Vh(e,"quic")||Vh(e,"h2"))&&(t.f=t.g,t.a=new mp,t.b&&(Ip(t,t.b),t.b=null))}function Ep(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Tp(t){return t.b?1:t.a?t.a.a.c:0}function Sp(t,e){return t.b?t.b==e:!!t.a&&(e=vp(e),Bf(t.a.a.b,e))}function Ip(t,e){t.a?t.a.add(e):t.b=e}function Cp(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=vp(e),n=Bf(t.a.a.b,n)),n&&qf(t.a.a,vp(e)))}function Np(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Lh(t.c);var e=t.c;return Mh(t.a.C(),function(t){e=e.concat(t.j)}),e}function Ap(){}function kp(){this.a=new Ap}function Dp(t,e,n){var r=n||"";try{Ff(t,function(t,n){var i=t;Th(t)&&(i=Fl(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Rp(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bp.prototype.cancel=function(){this.c=Np(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Mh(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Ap.prototype.stringify=function(t){return yh.JSON.stringify(t,void 0)},Ap.prototype.parse=function(t){return yh.JSON.parse(t,void 0)};var Op=yh.JSON.parse;function Pp(t){xl.call(this),this.headers=new Uf,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Mp,this.D=this.F=!1}Rh(Pp,xl);var Mp="",xp=/^https?$/i,Lp=["POST","PUT"];function Fp(t){return"content-type"==t.toLowerCase()}function Up(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qp(t),Bp(t)}function qp(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Vp(t){if(t.b&&void 0!==dh&&(!t.s[1]||4!=Wp(t)||2!=t.T()))if(t.l&&4==Wp(t))Xl(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Wp(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(jf)[1]||null;if(!o&&yh.self&&yh.self.location){var a=yh.self.location.protocol;o=a.substr(0,a.length-1)}i=!xp.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",qp(t))}finally{Bp(t)}}}function Bp(t,e){if(t.a){jp(t);var n=t.a,r=t.s[0]?bh:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function jp(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(yh.clearTimeout(t.m),t.m=null)}function Wp(t){return t.a?t.a.readyState:0}function Kp(t,e){return t.a?t.a.getResponseHeader(e):null}function Qp(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Kh(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),mh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Yf(t,e,n),t}function Hp(t){this.f=[],this.F=new yp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!gh("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=gh("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=gh("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=gh("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=gh("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new bp(t&&t.concurrentRequestLimit),this.ja=new kp,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Gp(t){if(zp(t),3==t.u){var e=t.P++,n=Kf(t.B);Yf(n,"SID",t.H),Yf(n,"RID",e),Yf(n,"TYPE","terminate"),$p(t,n),(e=new Ef(t,e,void 0)).F=2,e.f=Jf(Kf(n)),n=!1,yh.navigator&&yh.navigator.sendBeacon&&(n=yh.navigator.sendBeacon(e.f.toString(),"")),!n&&yh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Dh(),Rf(e)}ad(t)}function zp(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(yh.clearTimeout(t.l),t.l=null),rd(t),t.b.cancel(),t.h&&(vh(t.h)&&yh.clearTimeout(t.h),t.h=null)}function Yp(t,e){t.f.push(new gp(t.Ra++,e)),3==t.u&&Xp(t)}function Xp(t){Ep(t.b)||t.h||(t.h=!0,Kl(t.Ia,t),t.A=0)}function Jp(t,e){var n;n=e?e.W:t.P++;var r=Kf(t.B);Yf(r,"SID",t.H),Yf(r,"RID",n),Yf(r,"AID",t.O),$p(t,r),t.g&&t.i&&Qp(r,t.g,t.i),n=new Ef(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Zp(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ip(t.b,n),Cf(n,r,e)}function $p(t,e){t.c&&Ff({},function(t,n){Yf(e,n,t)})}function Zp(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Ah(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Dp(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function td(t){t.a||t.l||(t.S=1,Kl(t.Ha,t),t.v=0)}function ed(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=lf(Ah(t.Ha,t),id(t,t.v)),t.v++,0))}function nd(t,e,n){var r=e.l;r&&_p(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=sd(t,null,t.ha),Xp(t)}function rd(t){null!=t.s&&(yh.clearTimeout(t.s),t.s=null)}function id(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function od(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Ah(t.fb,t);n||(n=new Wf("//www.google.com/images/cleardot.gif"),yh.location&&"http"==yh.location.protocol||Qf(n,"https"),Jf(n)),function(t,e){var n=new rf;if(yh.Image){var r=new Image;r.onload=kh(Rp,n,r,"TestLoadImage: loaded",!0,e),r.onerror=kh(Rp,n,r,"TestLoadImage: error",!1,e),r.onabort=kh(Rp,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=kh(Rp,n,r,"TestLoadImage: timeout",!1,e),yh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else cf(2);t.u=0,t.c&&t.c.ta(e),ad(t),zp(t)}function ad(t){t.u=0,t.m=-1,t.c&&(0==Np(t.b).length&&0==t.f.length||(t.b.c.length=0,Lh(t.f),t.f.length=0),t.c.sa())}function sd(t,e,n){var r=function(t){return t instanceof Wf?Kf(t):new Wf(t,void 0)}(n);if(""!=r.b)e&&Hf(r,e+"."+r.b),Gf(r,r.i);else{var i,o=yh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Wf(null,void 0);return t&&Qf(i,t),e&&Hf(i,e),n&&Gf(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Kh(t.V,function(t,e){Yf(r,e,t)}),e=t.j,n=t.I,e&&n&&Yf(r,e,n),Yf(r,"VER",t.wa),$p(t,r),r}function ud(){}function cd(){if($h&&!(10<=Number(sl)))throw Error("Environmental error: no available transport.")}function hd(t,e){xl.call(this),this.a=new Hp(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Fh(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Fh(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new pd(this)}function ld(t){bf.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function fd(){wf.call(this),this.status=1}function pd(t){this.a=t}(fh=Pp.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?yf(this.H):yf(vf),this.a.onreadystatechange=Ah(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Up(this,t)}t=n||"";var i=new Uf(this.headers);r&&Ff(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Fp,n=t.length,r=mh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:mh(t)?t.charAt(e):t[e]}(i.K()),n=yh.FormData&&t instanceof yh.FormData,0<=Ph(Lp,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jp(this),0<this.o&&((this.D=function(t){return $h&&cl(9)&&vh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Ah(this.Ca,this)):this.m=Xl(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Up(this,t)}},fh.Ca=function(){void 0!==dh&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},fh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Bp(this))},fh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Bp(this,!0)),Pp.N.G.call(this)},fh.Fa=function(){this.j||(this.w||this.l||this.g?Vp(this):this.$a())},fh.$a=function(){Vp(this)},fh.T=function(){try{return 2<Wp(this)?this.a.status:-1}catch(t){return-1}},fh.za=function(){try{return 2<Wp(this)?this.a.statusText:""}catch(t){return""}},fh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},fh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Op(e)}},fh.ya=function(){return this.h},fh.Ya=function(){return mh(this.f)?this.f:String(this.f)},(fh=Hp.prototype).wa=8,fh.u=1,fh.Da=function(){return 0==this.u},fh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Ef(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?Gh(r=Qh(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&mh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zp(this,n,e),Yf(i=Kf(this.B),"RID",t),Yf(i,"CVER",22),this.o&&this.j&&Yf(i,"X-HTTP-Session-Id",this.j),$p(this,i),this.g&&r&&Qp(i,this.g,r),Ip(this.b,n),this.W?(Yf(i,"$req",e),Yf(i,"SID","null"),n.S=!0,Cf(n,i,null)):Cf(n,i,e),this.u=2}}else 3==this.u&&(t?Jp(this,t):0==this.f.length||Ep(this.b)||Jp(this))},fh.Ha=function(){this.l=null,this.a=new Ef(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Kf(this.pa);Yf(t,"RID","rpc"),Yf(t,"SID",this.H),Yf(t,"CI",this.ia?"0":"1"),Yf(t,"AID",this.O),$p(this,t),Yf(t,"TYPE","xmlhttp"),this.g&&this.i&&Qp(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Nf(this.a,t,!0,this.ga)},fh.Ga=function(t,e){if(0!=this.u&&(this.a==t||Sp(this.b,t)))if(this.m=t.o,!t.s&&Sp(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(_h(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;rd(this),this.a.cancel(),this.a=null}ed(this),cf(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=lf(Ah(this.Za,this),6e3));if(Tp(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else od(this,11)}else if(!t.s&&this.a!=t||rd(this),!Fh(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&vh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Kp(r,"X-Client-Wire-Protocol"))&&_p(this.b,i),this.j&&(r=Kp(r,"X-HTTP-Session-Id")))&&(this.I=r,Yf(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=sd(this,this.Y()?this.ga:null,this.ha),r.s?(Cp(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Pf(r),Rf(r)),this.a=r):td(this),0<this.f.length&&Xp(this)}else"stop"!=r[0]&&"close"!=r[0]||od(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?od(this,7):Gp(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},fh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,ed(this),cf(19))},fh.na=function(t){var e=null;if(this.a==t){rd(this),this.a=null;var n=2}else{if(!Sp(this.b,t))return;e=t.j,Cp(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Dh()-t.v,of.dispatchEvent(new hf(of,t.l?t.l.length:0,e,this.A)),Xp(this)):td(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Tp(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=lf(Ah(t.Ia,t,e),id(t,t.A)),t.A++,0)))}(this,t)||2==n&&ed(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:od(this,5);break;case 4:od(this,10);break;case 3:od(this,6);break;default:od(this,2)}}},fh.fb=function(t){cf(t?2:1)},fh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Pp(this.La)).F=this.R,t},fh.ma=function(){return!!this.c&&!0},fh.Y=function(){return this.R},(fh=ud.prototype).va=function(){},fh.ua=function(){},fh.ta=function(){},fh.sa=function(){},fh.Ta=function(){},cd.prototype.a=function(t,e){return new hd(t,e)},Rh(hd,xl),(fh=hd.prototype).addEventListener=function(t,e,n,r){hd.N.addEventListener.call(this,t,e,n,r)},fh.removeEventListener=function(t,e,n,r){hd.N.removeEventListener.call(this,t,e,n,r)},fh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;cf(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new pp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Qp(e,t.g,t.i)),(t=t.w).i=n,e=sd(t.a,null,t.i),cf(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,dp(t)):(Xf(e,"MODE","init"),!t.a.o&&t.a.j&&Xf(e,"X-HTTP-Session-Id",t.a.j),t.b=new Ef(t,void 0,void 0),t.b.h=t.h,Nf(t.b,e,!1,null),t.M=0)},fh.close=function(){Gp(this.a)},fh.Xa=function(t){if(mh(t)){var e={};e.__data__=t,Yp(this.a,e)}else this.h?((e={}).__data__=Fl(t),Yp(this.a,e)):Yp(this.a,t)},fh.G=function(){this.a.c=null,delete this.f,Gp(this.a),delete this.a,hd.N.G.call(this)},Rh(ld,bf),Rh(fd,wf),Rh(pd,ud),pd.prototype.va=function(){this.a.dispatchEvent("a")},pd.prototype.ua=function(t){this.a.dispatchEvent(new ld(t))},pd.prototype.ta=function(t){this.a.dispatchEvent(new fd(t))},pd.prototype.sa=function(){this.a.dispatchEvent("b")};var dd=kh(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},cd);cd.prototype.createWebChannel=cd.prototype.a,hd.prototype.send=hd.prototype.Xa,hd.prototype.open=hd.prototype.Wa,hd.prototype.close=hd.prototype.close,ff.NO_ERROR=0,ff.TIMEOUT=8,ff.HTTP_ERROR=6,pf.COMPLETE="complete",(mf.EventType=gf).OPEN="a",gf.CLOSE="b",gf.ERROR="c",gf.MESSAGE="d",xl.prototype.listen=xl.prototype.Aa,Pp.prototype.listenOnce=Pp.prototype.Ba,Pp.prototype.getLastError=Pp.prototype.Ya,Pp.prototype.getLastErrorCode=Pp.prototype.ya,Pp.prototype.getStatus=Pp.prototype.T,Pp.prototype.getStatusText=Pp.prototype.za,Pp.prototype.getResponseJson=Pp.prototype.Va,Pp.prototype.getResponseText=Pp.prototype.aa,Pp.prototype.send=Pp.prototype.ca;var yd,md,vd={createWebChannelTransport:dd,ErrorCode:ff,EventType:pf,WebChannel:mf,XhrIo:Pp},gd=vd.createWebChannelTransport,bd=vd.ErrorCode,wd=vd.EventType,_d=vd.WebChannel,Ed=vd.XhrIo,Td=po.SDK_VERSION,Sd=new eo("@firebase/firestore");function Id(){return Sd.logLevel===ji.DEBUG?yd.DEBUG:Sd.logLevel===ji.SILENT?yd.SILENT:yd.ERROR}function Cd(t){switch(t){case yd.DEBUG:Sd.logLevel=ji.DEBUG;break;case yd.ERROR:Sd.logLevel=ji.ERROR;break;case yd.SILENT:Sd.logLevel=ji.SILENT;break;default:Sd.error("Firestore ("+Td+"): Invalid value passed to `setLogLevel`")}}function Nd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Sd.logLevel<=ji.DEBUG){var i=n.map(kd);Sd.debug.apply(Sd,["Firestore ("+Td+") ["+t+"]: "+e].concat(i))}}function Ad(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Sd.logLevel<=ji.ERROR){var r=e.map(kd);Sd.error.apply(Sd,["Firestore ("+Td+"): "+t].concat(r))}}function kd(t){if("string"==typeof t)return t;var e=Od.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Dd(t){var e="FIRESTORE ("+Td+") INTERNAL ASSERTION FAILED: "+t;throw Ad(e),new Error(e)}function Rd(t,e){t||Dd(e)}(md=yd=yd||{})[md.DEBUG=0]="DEBUG",md[md.ERROR=1]="ERROR",md[md.SILENT=2]="SILENT";var Od=(Pd.setPlatform=function(t){Pd.platform&&Dd("Platform already defined"),Pd.platform=t},Pd.getPlatform=function(){return Pd.platform||Dd("Platform not set"),Pd.platform},Pd);function Pd(){}function Md(){return Od.getPlatform().emptyByteString}var xd,Ld={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Fd=(oi(Ud,xd=Error),Ud);function Ud(t,e){var n=xd.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function qd(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Fd(Ld.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Vd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Bd(t,e){return void 0!==t?t:e}function jd(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Wd(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Kd(t){for(var e in Rd(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qd(t,e){if(0!==e.length)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+sy(e.length,"argument")+".")}function Hd(t,e,n){if(e.length!==n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires "+sy(n,"argument")+", but was called with "+sy(e.length,"argument")+".")}function Gd(t,e,n){if(e.length<n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires at least "+sy(n,"argument")+", but was called with "+sy(e.length,"argument")+".")}function zd(t,e,n,r){if(e.length<n||e.length>r)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+sy(e.length,"argument")+".")}function Yd(t,e,n,r){ty(t,e,ay(n)+" argument",r)}function Xd(t,e,n,r){void 0!==r&&Yd(t,e,n,r)}function Jd(t,e,n,r){ty(t,e,n+" option",r)}function $d(t,e,n,r){void 0!==r&&Jd(t,e,n,r)}function Zd(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(ny(u))}var c=ny(r);throw new Fd(Ld.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ty(t,e,n,r){if(!("object"===e?ey(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=ny(r);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ey(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ny(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Dd("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function ry(t,e,n){if(void 0===n)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ay(e)+" argument, but it was undefined.")}function iy(t,e,n){Wd(e,function(e,r){if(n.indexOf(e)<0)throw new Fd(Ld.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function oy(t,e,n,r){var i=ny(r);return new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+ay(n)+" argument to be a "+e+", but it was: "+i)}function ay(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function sy(t,e){return t+" "+e+(1===t?"":"s")}var uy=(cy.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Rd(20===e.length,"Invalid auto ID: "+e),e},cy);function cy(){}function hy(t,e){return t<e?-1:e<t?1:0}function ly(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function fy(t){return t+"\0"}function py(){if("undefined"==typeof Uint8Array)throw new Fd(Ld.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function dy(){if(!Od.getPlatform().base64Available)throw new Fd(Ld.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var yy=(my.fromBase64String=function(t){Hd("Blob.fromBase64String",arguments,1),Yd("Blob.fromBase64String","string",1,t),dy();try{return new my(Od.getPlatform().atob(t))}catch(t){throw new Fd(Ld.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},my.fromUint8Array=function(t){if(Hd("Blob.fromUint8Array",arguments,1),py(),!(t instanceof Uint8Array))throw oy("Blob.fromUint8Array","Uint8Array",1,t);return new my(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},my.prototype.toBase64=function(){return Hd("Blob.toBase64",arguments,0),dy(),Od.getPlatform().btoa(this._binaryString)},my.prototype.toUint8Array=function(){Hd("Blob.toUint8Array",arguments,0),py();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},my.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},my.prototype.isEqual=function(t){return this._binaryString===t._binaryString},my.prototype._compareTo=function(t){return hy(this._binaryString,t._binaryString)},my);function my(t){dy(),this._binaryString=t}var vy=qd(yy,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),gy=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},by="(default)",wy=(Object.defineProperty(_y.prototype,"isDefaultDatabase",{get:function(){return this.database===by},enumerable:!0,configurable:!0}),_y.prototype.isEqual=function(t){return t instanceof _y&&t.projectId===this.projectId&&t.database===this.database},_y.prototype.compareTo=function(t){return hy(this.projectId,t.projectId)||hy(this.database,t.database)},_y);function _y(t,e){this.projectId=t,this.database=e||by}var Ey=(Ty.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ty.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Ty.INVALID=-1,Ty);function Ty(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Sy="__name__",Iy=(Object.defineProperty(Cy.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Cy.prototype.isEqual=function(t){return 0===Cy.comparator(this,t)},Cy.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Cy?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Cy.prototype.limit=function(){return this.offset+this.length},Cy.prototype.popFirst=function(t){return t=void 0===t?1:t,Rd(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Cy.prototype.popLast=function(){return Rd(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Cy.prototype.firstSegment=function(){return Rd(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Cy.prototype.lastSegment=function(){return this.get(this.length-1)},Cy.prototype.get=function(t){return Rd(t<this.length,"Index out of range"),this.segments[this.offset+t]},Cy.prototype.isEmpty=function(){return 0===this.length},Cy.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Cy.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Cy.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Cy.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Cy.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Cy);function Cy(t,e,n){void 0===e?e=0:e>t.length&&Dd("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Dd("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Ny,Ay=(oi(ky,Ny=Iy),ky.prototype.construct=function(t,e,n){return new ky(t,e,n)},ky.prototype.canonicalString=function(){return this.toArray().join("/")},ky.prototype.toString=function(){return this.canonicalString()},ky.fromString=function(t){if(0<=t.indexOf("//"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ky(t.split("/").filter(function(t){return 0<t.length}))},ky.EMPTY_PATH=new ky([]),ky);function ky(){return null!==Ny&&Ny.apply(this,arguments)||this}var Dy,Ry=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Oy=(oi(Py,Dy=Iy),Py.prototype.construct=function(t,e,n){return new Py(t,e,n)},Py.isValidIdentifier=function(t){return Ry.test(t)},Py.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Py.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Py.prototype.toString=function(){return this.canonicalString()},Py.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Sy},Py.keyField=function(){return new Py([Sy])},Py.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Fd(Ld.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Fd(Ld.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Py(e)},Py.EMPTY_PATH=new Py([]),Py);function Py(){return null!==Dy&&Dy.apply(this,arguments)||this}var My=(xy.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},xy.prototype.isEqual=function(t){return null!==t&&0===Ay.comparator(this.path,t.path)},xy.prototype.toString=function(){return this.path.toString()},xy.comparator=function(t,e){return Ay.comparator(t.path,e.path)},xy.isDocumentKey=function(t){return t.length%2==0},xy.fromSegments=function(t){return new xy(new Ay(t.slice()))},xy.fromPathString=function(t){return new xy(Ay.fromString(t))},xy.EMPTY=new xy(new Ay([])),xy);function xy(t){this.path=t,Rd(xy.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Ly,Fy,Uy=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})};(Fy=Ly=Ly||{}).All="all",Fy.ListenStreamIdle="listen_stream_idle",Fy.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Fy.WriteStreamIdle="write_stream_idle",Fy.WriteStreamConnectionBackoff="write_stream_connection_backoff",Fy.OnlineStateTimeout="online_state_timeout",Fy.ClientMetadataRefresh="client_metadata_refresh",Fy.LruGarbageCollection="lru_garbage_collection";var qy=(Vy.createAndSchedule=function(t,e,n,r,i){var o=new Vy(t,e,Date.now()+n,r,i);return o.start(n),o},Vy.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Vy.prototype.skipDelay=function(){return this.handleDelayElapsed()},Vy.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Fd(Ld.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Vy.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},Vy.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Vy);function Vy(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Uy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var By=(Object.defineProperty(jy.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),jy.prototype.enqueueAndForget=function(t){this.enqueue(t)},jy.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},jy.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},jy.prototype.enqueueAndInitiateShutdown=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},jy.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},jy.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Ad("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n},jy.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Rd(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Rd(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=qy.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},jy.prototype.verifyNotFailed=function(){this.failure&&Dd("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},jy.prototype.verifyOperationInProgress=function(){Rd(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},jy.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},jy.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},jy.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Rd(t===Ly.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Ly.All&&i.timerId===t)break}return e.drain()})},jy.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Rd(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},jy);function jy(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1}var Wy="",Ky="",Qy="",Hy="";function Gy(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Yy(e)),e=zy(t.get(n),e);return Yy(e)}function zy(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Wy+Qy;break;case Wy:n+=Wy+Hy;break;default:n+=o}}return n}function Yy(t){return t+Wy+Ky}function Xy(t){var e=t.length;if(Rd(2<=e,"Invalid path "+t),2===e)return Rd(t.charAt(0)===Wy&&t.charAt(1)===Ky,"Non-empty path "+t+" had length 2"),Ay.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Wy,o);switch((a<0||n<a)&&Dd('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Ky:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Qy:i+=t.substring(o,a),i+="\0";break;case Hy:i+=t.substring(o,a+1);break;default:Dd('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Ay(r)}var Jy=($y.now=function(){return $y.fromMillis(Date.now())},$y.fromDate=function(t){return $y.fromMillis(t.getTime())},$y.fromMillis=function(t){var e=Math.floor(t/1e3);return new $y(e,1e6*(t-1e3*e))},$y.prototype.toDate=function(){return new Date(this.toMillis())},$y.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},$y.prototype._compareTo=function(t){return this.seconds===t.seconds?hy(this.nanoseconds,t.nanoseconds):hy(this.seconds,t.seconds)},$y.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},$y.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},$y);function $y(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Fd(Ld.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var Zy=(tm.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new tm(new Jy(e,t%1e6*1e3))},tm.fromTimestamp=function(t){return new tm(t)},tm.forDeletedDoc=function(){return tm.MIN},tm.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},tm.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},tm.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},tm.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},tm.prototype.toTimestamp=function(){return this.timestamp},tm.MIN=new tm(new Jy(0,0)),tm);function tm(t){this.timestamp=t}var em=(nm.prototype.insert=function(t,e){return new nm(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,om.BLACK,null,null))},nm.prototype.remove=function(t){return new nm(this.comparator,this.root.remove(t,this.comparator).copy(null,null,om.BLACK,null,null))},nm.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},nm.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},nm.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(nm.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),nm.prototype.minKey=function(){return this.root.minKey()},nm.prototype.maxKey=function(){return this.root.maxKey()},nm.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},nm.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},nm.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},nm.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},nm.prototype.getIterator=function(){return new rm(this.root,null,this.comparator,!1)},nm.prototype.getIteratorFrom=function(t){return new rm(this.root,t,this.comparator,!1)},nm.prototype.getReverseIterator=function(){return new rm(this.root,null,this.comparator,!0)},nm.prototype.getReverseIteratorFrom=function(t){return new rm(this.root,t,this.comparator,!0)},nm);function nm(t,e){this.comparator=t,this.root=e||om.EMPTY}var rm=(im.prototype.getNext=function(){Rd(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},im.prototype.hasNext=function(){return 0<this.nodeStack.length},im.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},im);function im(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var om=(am.prototype.copy=function(t,e,n,r,i){return new am(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},am.prototype.isEmpty=function(){return!1},am.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},am.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},am.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},am.prototype.minKey=function(){return this.min().key},am.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},am.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},am.prototype.removeMin=function(){if(this.left.isEmpty())return am.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},am.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return am.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},am.prototype.isRed=function(){return this.color},am.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},am.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},am.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},am.prototype.rotateLeft=function(){var t=this.copy(null,null,am.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},am.prototype.rotateRight=function(){var t=this.copy(null,null,am.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},am.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},am.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},am.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Dd("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Dd("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Dd("Black depths differ");return t+(this.isRed()?0:1)},am.EMPTY=null,am.RED=!0,am.BLACK=!1,am);function am(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:am.RED,this.left=null!=r?r:am.EMPTY,this.right=null!=i?i:am.EMPTY,this.size=this.left.size+1+this.right.size}var sm=(Object.defineProperty(um.prototype,"key",{get:function(){throw Dd("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(um.prototype,"value",{get:function(){throw Dd("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(um.prototype,"color",{get:function(){throw Dd("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(um.prototype,"left",{get:function(){throw Dd("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(um.prototype,"right",{get:function(){throw Dd("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),um.prototype.copy=function(t,e,n,r,i){return this},um.prototype.insert=function(t,e,n){return new om(t,e)},um.prototype.remove=function(t,e){return this},um.prototype.isEmpty=function(){return!0},um.prototype.inorderTraversal=function(t){return!1},um.prototype.reverseTraversal=function(t){return!1},um.prototype.minKey=function(){return null},um.prototype.maxKey=function(){return null},um.prototype.isRed=function(){return!1},um.prototype.checkMaxDepth=function(){return!0},um.prototype.check=function(){return 0},um);function um(){this.size=0}om.EMPTY=new sm;var cm=(hm.fromMapKeys=function(t){var e=new hm(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},hm.prototype.has=function(t){return null!==this.data.get(t)},hm.prototype.first=function(){return this.data.minKey()},hm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(hm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),hm.prototype.indexOf=function(t){return this.data.indexOf(t)},hm.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},hm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},hm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},hm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},hm.prototype.getIterator=function(){return new lm(this.data.getIterator())},hm.prototype.getIteratorFrom=function(t){return new lm(this.data.getIteratorFrom(t))},hm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},hm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},hm.prototype.isEmpty=function(){return this.data.isEmpty()},hm.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},hm.prototype.isEqual=function(t){if(!(t instanceof hm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},hm.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},hm.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},hm.prototype.copy=function(t){var e=new hm(this.comparator);return e.data=t,e},hm);function hm(t){this.comparator=t,this.data=new em(this.comparator)}var lm=(fm.prototype.getNext=function(){return this.iter.getNext().key},fm.prototype.hasNext=function(){return this.iter.hasNext()},fm);function fm(t){this.iter=t}var pm=new em(My.comparator);function dm(){return pm}function ym(){return dm()}var mm=new em(My.comparator);function vm(){return mm}var gm=new em(My.comparator);function bm(){return gm}var wm=new cm(My.comparator);function _m(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=wm,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Em=new cm(hy);function Tm(){return Em}var Sm=(Im.prototype.applyToRemoteDocument=function(t,e,n){e&&Rd(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Rd(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Im.prototype.applyToLocalView=function(t,e){e&&Rd(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Im.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},Im.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},_m())},Im.prototype.isEqual=function(t){return this.batchId===t.batchId&&ly(this.mutations,t.mutations)&&ly(this.baseMutations,t.baseMutations)},Im);function Im(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Rd(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Cm=(Nm.from=function(t,e,n,r){Rd(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=bm(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Nm(t,e,n,r,i)},Nm);function Nm(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Am=(km.prototype.catch=function(t){return this.next(void 0,t)},km.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Dd("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new km(function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}})},km.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},km.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof km?e:km.resolve(e)}catch(t){return km.reject(t)}},km.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):km.resolve(e)},km.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):km.reject(e)},km.resolve=function(t){return new km(function(e,n){e(t)})},km.reject=function(t){return new km(function(e,n){n(t)})},km.waitFor=function(t){return new km(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},km.or=function(t){for(var e=km.resolve(!1),n=function(t){e=e.next(function(e){return e?km.resolve(e):t()})},r=0,i=t;r<i.length;r++)n(i[r]);return e},km.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},km);function km(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Dm,Rm,Om=(Pm.forUser=function(t,e,n,r){return Rd(""!==t.uid,"UserID must not be an empty string."),new Pm(t.isAuthenticated()?t.uid:"",e,n,r)},Pm.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Fm(t).iterate({index:Kv.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},Pm.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=Lm(n),qm(t).put(e)})},Pm.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Pm.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Lm(e),qm(t).put(n)})},Pm.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Um(t),a=Fm(t);return a.add({}).next(function(s){Rd("number"==typeof s,"Auto-generated key is not a number");var u=new Sm(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=Hv.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,Hv.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return Am.waitFor(h).next(function(){return u})})},Pm.prototype.lookupMutationBatch=function(t,e){var n=this;return Fm(t).get(e).next(function(t){return t?(Rd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Pm.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Am.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null})},Pm.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Fm(t).iterate({index:Kv.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Rd(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},Pm.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Fm(t).loadAll(Kv.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Pm.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Hv.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Um(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=Xy(u);if(s===n.userId&&e.path.isEqual(h))return Fm(t).get(c).next(function(t){if(!t)throw Dd("Dangling document-mutation reference found: "+r+" which points to "+c);Rd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},Pm.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new cm(hy),i=[];return e.forEach(function(e){var o=Hv.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=Um(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=Xy(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),Am.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},Pm.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Rd(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Hv.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new cm(hy);return Um(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=Xy(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},Pm.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Fm(t).get(e).next(function(t){if(null===t)throw Dd("Dangling document-mutation reference found, which points to "+e);Rd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Am.waitFor(i).next(function(){return r})},Pm.prototype.removeMutationBatch=function(t,e){var n=this;return xm(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),Am.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},Pm.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Pm.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Am.resolve();var r=IDBKeyRange.lowerBound(Hv.prefixForUser(e.userId)),i=[];return Um(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=Xy(t[1]);i.push(o)}else r.done()}).next(function(){Rd(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Pm.prototype.containsKey=function(t,e){return Mm(t,this.userId,e)},Pm.prototype.getMutationQueueMetadata=function(t){var e=this;return qm(t).get(this.userId).next(function(t){return t||new jv(e.userId,-1,"")})},Pm);function Pm(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Mm(t,e,n){var r=Hv.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return Um(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function xm(t,e,n){var r=t.store(Kv.store),i=t.store(Hv.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Rd(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Hv.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Am.waitFor(o).next(function(){return c})}function Lm(t){return t instanceof Uint8Array?(Rd("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Fm(t){return qg.getStore(t,Kv.store)}function Um(t){return qg.getStore(t,Hv.store)}function qm(t){return qg.getStore(t,jv.store)}(Rm=Dm=Dm||{})[Rm.QueryCache=0]="QueryCache",Rm[Rm.SyncEngine=1]="SyncEngine";var Vm=(Bm.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Bm.prototype.after=function(t){return this.seek(t+2),this.next()},Bm.prototype.seek=function(t){Rd((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Bm.forQueryCache=function(){return new Bm(Dm.QueryCache,2)},Bm.forSyncEngine=function(){return new Bm(Dm.SyncEngine)},Bm);function Bm(t,e){Rd((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var jm="SimpleDb",Wm=(Km.openOrCreate=function(t,e,n){return Rd(Km.isAvailable(),"IndexedDB not supported in current environment."),Nd(jm,"Opening database:",t),new Am(function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new Km(e))},o.onblocked=function(){i(new Fd(Ld.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new Fd(Ld.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){Nd(jm,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result,i=new Gm(o.transaction);n.createOrUpgrade(r,i,e.oldVersion,Lv).next(function(){Nd(jm,"Database upgrade to version "+Lv+" complete")})}}).toPromise()},Km.delete=function(t){return Nd(jm,"Removing database:",t),Jm(window.indexedDB.deleteDatabase(t)).toPromise()},Km.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===r.env.USE_MOCK_PERSISTENCE;var t=Ei(),e=Km.getIOSVersion(t),n=0<e&&e<10,i=Km.getAndroidVersion(t),o=0<i&&i<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||o)},Km.getStore=function(t,e){return t.store(e)},Km.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Km.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Km.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},Km.prototype.runTransaction=function(t,e,n){var r=Gm.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Am.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Km.prototype.close=function(){this.db.close()},Km);function Km(t){this.db=t,12.2===Km.getIOSVersion(Ei())&&Ad("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Qm=(Object.defineProperty(Hm.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Hm.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Hm.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Hm.prototype.done=function(){this.shouldStop=!0},Hm.prototype.skip=function(t){this.nextKey=t},Hm.prototype.delete=function(){return Jm(this.dbCursor.delete())},Hm);function Hm(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Gm=(zm.open=function(t,e,n){return new zm(t.transaction(n,e))},Object.defineProperty(zm.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),zm.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Nd(jm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},zm.prototype.store=function(t){var e=this.transaction.objectStore(t);return Rd(!!e,"Object store not part of transaction: "+t),new Ym(e)},zm);function zm(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Uy,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=Zm(t.target.error);e.completionDeferred.reject(n)}}var Ym=(Xm.prototype.put=function(t,e){return Jm(void 0!==e?(Nd(jm,"PUT",this.store.name,t,e),this.store.put(e,t)):(Nd(jm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Xm.prototype.add=function(t){return Nd(jm,"ADD",this.store.name,t,t),Jm(this.store.add(t))},Xm.prototype.get=function(t){var e=this;return Jm(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Nd(jm,"GET",e.store.name,t,n),n})},Xm.prototype.delete=function(t){return Nd(jm,"DELETE",this.store.name,t),Jm(this.store.delete(t))},Xm.prototype.count=function(){return Nd(jm,"COUNT",this.store.name),Jm(this.store.count())},Xm.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Xm.prototype.deleteAll=function(t,e){Nd(jm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Xm.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Xm.prototype.iterateSerial=function(t){var e=this.cursor({});return new Am(function(n,r){e.onerror=function(t){var e=Zm(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},Xm.prototype.iterateCursor=function(t,e){var n=[];return new Am(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Qm(i),a=e(i.primaryKey,i.value,o);if(a instanceof Am){var s=a.catch(function(t){return o.done(),Am.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return Am.waitFor(n)})},Xm.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Rd(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Xm.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Xm);function Xm(t){this.store=t}function Jm(t){return new Am(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Zm(t.target.error);n(e)}})}var $m=!1;function Zm(t){var e=Wm.getIOSVersion(Ei());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Fd("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return $m||($m=!0,setTimeout(function(){throw r},0)),r}}return t}var tv=(ev.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},ev.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Zy.fromTimestamp(new Jy(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},ev.prototype.getHighestSequenceNumber=function(t){return iv(t.simpleDbTransaction)},ev.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},ev.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},ev.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},ev.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return nv(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Rd(0<e.targetCount,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},ev.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return nv(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return Am.waitFor(o)}).next(function(){return i})},ev.prototype.forEachTarget=function(t,e){var n=this;return nv(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},ev.prototype.retrieveMetadata=function(t){return rv(t.simpleDbTransaction)},ev.prototype.saveMetadata=function(t,e){return function(t){return qg.getStore(t,ig.store)}(t).put(ig.key,e)},ev.prototype.saveQueryData=function(t,e){return nv(t).put(this.serializer.toDbTarget(e))},ev.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},ev.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},ev.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return nv(t).iterate({range:i,index:tg.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},ev.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ov(t);return e.forEach(function(e){var a=Gy(e.path);i.push(o.put(new ng(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),Am.waitFor(i)},ev.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ov(t);return Am.forEach(e,function(e){var o=Gy(e.path);return Am.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},ev.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ov(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},ev.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ov(t),i=_m();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Xy(t[1]),o=new My(r);i=i.add(o)}).next(function(){return i})},ev.prototype.containsKey=function(t,e){var n=Gy(e.path),r=IDBKeyRange.bound([n],[fy(n)],!1,!0),i=0;return ov(t).iterate({index:ng.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},ev.prototype.getQueryDataForTarget=function(t,e){var n=this;return nv(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},ev);function ev(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Vm.forQueryCache()}function nv(t){return qg.getStore(t,tg.store)}function rv(t){return Wm.getStore(t,ig.store).get(ig.key).next(function(t){return Rd(null!==t,"Missing metadata row."),t})}function iv(t){return rv(t).next(function(t){return t.highestListenSequenceNumber})}function ov(t){return qg.getStore(t,ng.store)}var av=(sv.compareByKey=function(t,e){return My.comparator(t.key,e.key)},sv);function sv(t,e){this.key=t,this.version=e}var uv,cv=(oi(hv,uv=av),hv.prototype.field=function(t){return this.data.field(t)},hv.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},hv.prototype.value=function(){return this.data.value()},hv.prototype.isEqual=function(t){return t instanceof hv&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},hv.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(hv.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),hv.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Dd("Trying to compare documents on fields that don't exist")},hv);function hv(t,e,n,r,i){var o=uv.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}var lv,fv=(oi(pv,lv=av),pv.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(pv.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),pv.prototype.isEqual=function(t){return t instanceof pv&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},pv);function pv(t,e,n){var r=lv.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var dv,yv=(oi(mv,dv=av),mv.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(mv.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),mv.prototype.isEqual=function(t){return t instanceof mv&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},mv);function mv(){return null!==dv&&dv.apply(this,arguments)||this}var vv=(gv.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},gv.prototype.has=function(t){return void 0!==this.get(t)},gv.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},gv.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},gv.prototype.forEach=function(t){Wd(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},gv.prototype.isEmpty=function(){return Kd(this.inner)},gv);function gv(t){this.mapKeyFn=t,this.inner={}}var bv=(wv.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},wv.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?Am.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},wv.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},wv.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},wv.prototype.assertChanges=function(){return Rd(null!==this.changes,"Changes have already been applied."),this.changes},wv);function wv(){this.changes=dm(),this.documentSizes=new vv(function(t){return t.toString()})}var _v="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Ev=(Object.defineProperty(Tv.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),Tv.prototype.start=function(t){var e=Wm.getStore(t,cg.store);return this.synchronizeLastDocumentChangeId(e)},Tv.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=Av(t),o=_m(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Dv(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(kv(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return Am.waitFor(r)},Tv.prototype.removeEntry=function(t,e){var n=Av(t),r=Dv(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Rv(t)}):Am.resolve(0)})},Tv.prototype.getEntry=function(t,e){var n=this;return Av(t).get(Dv(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},Tv.prototype.getSizedEntry=function(t,e){var n=this;return Av(t).get(Dv(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Rv(t)}:null})},Tv.prototype.getEntries=function(t,e){var n=this,r=ym();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},Tv.prototype.getSizedEntries=function(t,e){var n=this,r=ym(),i=new em(My.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Rv(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},Tv.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Am.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Av(t).iterate({range:r},function(t,e,r){for(var a=My.fromSegments(t);o&&My.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},Tv.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=vm(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return Av(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof cv&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},Tv.prototype.getNewDocumentChanges=function(t){var e=this;Rd(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=_m(),r=dm(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=kv(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return Am.reject(new Fd(Ld.DATA_LOSS,_v))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new fv(n,Zy.forDeletedDoc());r=r.insert(n,e)}))}),Am.waitFor(i)}).next(function(){return r})},Tv.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return kv(t).delete(n)},Tv.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},Tv.prototype.newChangeBuffer=function(){return new Cv(this)},Tv.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Tv.prototype.getMetadata=function(t){return Sv(t).get($v.key).next(function(t){return Rd(!!t,"Missing document cache metadata"),t})},Tv.prototype.setMetadata=function(t,e){return Sv(t).put($v.key,e)},Tv.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},Tv);function Tv(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function Sv(t){return qg.getStore(t,$v.store)}var Iv,Cv=(oi(Nv,Iv=bv),Nv.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),a=e.documentSizes.get(t);Rd(void 0!==a,"Attempting to change document "+t.toString()+" without having read it first");var s=Rv(o);r+=s-a,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},Nv.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Nv.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Nv);function Nv(t){var e=Iv.call(this)||this;return e.documentCache=t,e}function Av(t){return qg.getStore(t,Xv.store)}function kv(t){return qg.getStore(t,cg.store)}function Dv(t){return t.path.toArray()}function Rv(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Dd("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Ov=(Pv.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Am.resolve()},Pv.prototype.getCollectionParents=function(t,e){return Am.resolve(this.collectionParentIndex.getEntries(e))},Pv);function Pv(){this.collectionParentIndex=new Mv}var Mv=(xv.prototype.add=function(t){Rd(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new cm(Ay.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},xv.prototype.getEntries=function(t){return(this.index[t]||new cm(Ay.comparator)).toArray()},xv);function xv(){this.index={}}var Lv=8,Fv=(Uv.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Rd(n<r&&0<=n&&r<=Lv,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(Vv.store)}(t),function(t){t.createObjectStore(jv.store,{keyPath:jv.keyPath}),t.createObjectStore(Kv.store,{keyPath:Kv.keyPath,autoIncrement:!0}).createIndex(Kv.userMutationsIndex,Kv.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Hv.store)}(t),ug(t),function(t){t.createObjectStore(Xv.store)}(t));var o=Am.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(ng.store),t.deleteObjectStore(tg.store),t.deleteObjectStore(ig.store)}(t),ug(t)),o=o.next(function(){return function(t){var e=t.store(ig.store),n=new ig(0,0,Zy.MIN.toTimestamp(),0);return e.put(ig.key,n)}(e)})),n<4&&4<=r&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(Kv.store).loadAll().next(function(n){t.deleteObjectStore(Kv.store),t.createObjectStore(Kv.store,{keyPath:Kv.keyPath,autoIncrement:!0}).createIndex(Kv.userMutationsIndex,Kv.userMutationsKeyPath,{unique:!0});var r=e.store(Kv.store),i=n.map(function(t){return r.put(t)});return Am.waitFor(i)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(lg.store,{keyPath:lg.keyPath})}(t),function(t){t.createObjectStore(cg.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&5<=r&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(o=o.next(function(){return function(t){t.createObjectStore($v.store)}(t),i.addDocumentGlobal(e)})),n<7&&7<=r&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&8<=r&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},Uv.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Xv.store).iterate(function(t,n){e+=Rv(n)}).next(function(){var n=new $v(e);return t.store($v.store).put($v.key,n)})},Uv.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(jv.store),r=t.store(Kv.store);return n.loadAll().next(function(n){return Am.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Kv.userMutationsIndex,i).next(function(r){return Am.forEach(r,function(r){Rd(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return xm(t,n.userId,i).next(function(){})})})})})},Uv.prototype.ensureSequenceNumbers=function(t){var e=t.store(ng.store),n=t.store(Xv.store);return iv(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new Ay(n),a=[0,Gy(o)];r.push(e.get(a).next(function(n){return n?Am.resolve():function(n){return e.put(new ng(0,Gy(n),t))}(o)}))}).next(function(){return Am.waitFor(r)})})},Uv.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Gy(n)})}}t.createObjectStore(ag.store,{keyPath:ag.keyPath});var r=e.store(ag.store),i=new Mv;return e.store(Xv.store).iterate({keysOnly:!0},function(t,e){return n(new Ay(t).popLast())}).next(function(){return e.store(Hv.store).iterate({keysOnly:!0},function(t,e){t[0];var r=t[1];return n((t[2],Xy(r)).popLast())})})},Uv);function Uv(t){this.serializer=t}var qv=function(t,e){this.seconds=t,this.nanoseconds=e},Vv=(Bv.store="owner",Bv.key="owner",Bv);function Bv(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var jv=(Wv.store="mutationQueues",Wv.keyPath="userId",Wv);function Wv(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Kv=(Qv.store="mutations",Qv.keyPath="batchId",Qv.userMutationsIndex="userMutationsIndex",Qv.userMutationsKeyPath=["userId","batchId"],Qv);function Qv(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Hv=(Gv.prefixForUser=function(t){return[t]},Gv.prefixForPath=function(t,e){return[t,Gy(e)]},Gv.key=function(t,e,n){return[t,Gy(e),n]},Gv.store="documentMutations",Gv.PLACEHOLDER=new Gv,Gv);function Gv(){}var zv=function(t,e){this.path=t,this.readTime=e},Yv=function(t,e){this.path=t,this.version=e},Xv=(Jv.store="remoteDocuments",Jv);function Jv(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var $v=(Zv.store="remoteDocumentGlobal",Zv.key="remoteDocumentGlobalKey",Zv);function Zv(t){this.byteSize=t}var tg=(eg.store="targets",eg.keyPath="targetId",eg.queryTargetsIndexName="queryTargetsIndex",eg.queryTargetsKeyPath=["canonicalId","targetId"],eg);function eg(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var ng=(rg.store="targetDocuments",rg.keyPath=["targetId","path"],rg.documentTargetsIndex="documentTargetsIndex",rg.documentTargetsKeyPath=["path","targetId"],rg);function rg(t,e,n){this.targetId=t,this.path=e,Rd(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var ig=(og.key="targetGlobalKey",og.store="targetGlobal",og);function og(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var ag=(sg.store="collectionParents",sg.keyPath=["collectionId","parent"],sg);function sg(t,e){this.collectionId=t,this.parent=e}function ug(t){t.createObjectStore(ng.store,{keyPath:ng.keyPath}).createIndex(ng.documentTargetsIndex,ng.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(tg.store,{keyPath:tg.keyPath}).createIndex(tg.queryTargetsIndexName,tg.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ig.store)}var cg=(hg.store="remoteDocumentChanges",hg.keyPath="id",hg);function hg(t){this.changes=t}var lg=(fg.store="clientMetadata",fg.keyPath="clientId",fg);function fg(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var pg,dg,yg=[jv.store,Kv.store,Hv.store,Xv.store,tg.store,Vv.store,ig.store,ng.store].concat([lg.store,cg.store]).concat([$v.store]).concat([ag.store]),mg=(vg.prototype.addToCollectionParentIndex=function(t,e){if(Rd(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Rd(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return gg(t).put({collectionId:n,parent:Gy(r)})}return Am.resolve()},vg.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[fy(e),""],!1,!0);return gg(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Xy(o.parent))}return n})},vg);function vg(){this.collectionParentsCache=new Mv}function gg(t){return qg.getStore(t,ag.store)}(dg=pg=pg||{})[dg.Listen=0]="Listen",dg[dg.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",dg[dg.LimboResolution=2]="LimboResolution";var bg=(wg.prototype.copy=function(t){return new wg(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},wg.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},wg);function wg(t,e,n,r,i,o){void 0===i&&(i=Zy.MIN),void 0===o&&(o=Md()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var _g=(Eg.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=My.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new fv(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=My.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new yv(e,n)):Dd("Unexpected DbRemoteDocument")},Eg.prototype.toDbRemoteDocument=function(t){if(t instanceof cv){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Xv(null,null,e,n)}if(t instanceof fv){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Xv(null,new zv(r,i),null,n)}return t instanceof yv?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Xv(new Yv(r,i),null,null,!0)):Dd("Unexpected MaybeDocumment")},Eg.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new qv(e.seconds,e.nanoseconds)},Eg.prototype.fromDbTimestamp=function(t){var e=new Jy(t.seconds,t.nanoseconds);return Zy.fromTimestamp(e)},Eg.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Kv(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Eg.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Jy.fromMillis(t.localWriteTimeMs);return new Sm(t.batchId,i,n,r)},Eg.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Gy(t.path))}),e},Eg.prototype.fromDbResourcePaths=function(t){for(var e=_m(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new My(Xy(i)))}return e},Eg.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new bg(e,t.targetId,pg.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},Eg.prototype.toDbTarget=function(t){Rd(pg.Listen===t.purpose,"Only queries with purpose "+pg.Listen+" may be stored, got "+t.purpose);var e,n,i=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Rd("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new tg(t.targetId,t.query.canonicalId(),i,n,t.sequenceNumber,e)},Eg);function Eg(t){this.remoteSerializer=t}function Tg(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=hy(n,i);return 0===a?hy(r,o):a}var Sg=(Ig.prototype.nextIndex=function(){return++this.previousIndex},Ig.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Tg(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Ig.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Ig);function Ig(t){this.maxElements=t,this.buffer=new cm(Tg),this.previousIndex=0}var Cg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ng=(Ag.withCacheSize=function(t){return new Ag(t,Ag.DEFAULT_COLLECTION_PERCENTILE,Ag.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Ag.COLLECTION_DISABLED=-1,Ag.MINIMUM_CACHE_SIZE_BYTES=1048576,Ag.DEFAULT=new Ag(Ag.DEFAULT_CACHE_SIZE_BYTES=41943040,Ag.DEFAULT_COLLECTION_PERCENTILE=10,Ag.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),Ag.DISABLED=new Ag(Ag.COLLECTION_DISABLED,0,0),Ag);function Ag(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var kg=(Dg.prototype.start=function(){Rd(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ng.COLLECTION_DISABLED&&this.scheduleGC()},Dg.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Dg.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Dg.prototype.scheduleGC=function(){var t=this;Rd(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Nd("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Ly.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Bg)})},Dg);function Dg(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var Rg=(Og.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},Og.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Am.resolve(Ey.INVALID);var r=new Sg(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},Og.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},Og.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},Og.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Ng.COLLECTION_DISABLED?(Nd("LruGarbageCollector","Garbage collection skipped; disabled"),Am.resolve(Cg)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Nd("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Cg):n.runGarbageCollection(t,e)})},Og.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},Og.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(Nd("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Id()<=yd.DEBUG&&Nd("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),Am.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},Og);function Og(t,e){this.delegate=t,this.params=e}var Pg,Mg="IndexedDbPersistence",xg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lg="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Fg=(oi(Ug,Pg=function(){}),Ug);function Ug(t,e){var n=Pg.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var qg=(Vg.getStore=function(t,e){if(t instanceof Fg)return Wm.getStore(t.simpleDbTransaction,e);throw Dd("IndexedDbPersistence must use instances of IndexedDbTransaction")},Vg.createIndexedDbPersistence=function(t,e,n,r,i,o){return si(this,void 0,void 0,function(){var a;return ui(this,function(s){switch(s.label){case 0:return[4,(a=new Vg(t,e,n,r,i,o)).start()];case 1:return s.sent(),[2,a]}})})},Vg.createMultiClientIndexedDbPersistence=function(t,e,n,r,i,o,a){return si(this,void 0,void 0,function(){var s;return ui(this,function(u){switch(u.label){case 0:return[4,(s=new Vg(t,e,n,r,i,o,a)).start()];case 1:return u.sent(),[2,s]}})})},Vg.prototype.start=function(){var t=this;return Rd(!this.started,"IndexedDbPersistence double-started!"),Rd(null!==this.window,"Expected 'window' to be defined"),Wm.openOrCreate(this.dbName,Lv,new Fv(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[ig.store],function(e){return iv(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new Ey(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},Vg.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",yg,function(e){return t.remoteDocumentCache.start(e)})},Vg.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return si(e,void 0,void 0,function(){return ui(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},Vg.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return si(e,void 0,void 0,function(){return ui(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},Vg.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return si(e,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Vg.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",yg,function(e){return Wg(e).put(new lg(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},Vg.prototype.verifyPrimaryLease=function(t){var e=this;return jg(t).get(Vv.key).next(function(t){return Am.resolve(e.isLocalClient(t))})},Vg.prototype.removeClientMetadata=function(t){return Wg(t).delete(this.clientId)},Vg.prototype.maybeGarbageCollectMultiClientState=function(){return si(this,void 0,void 0,function(){var t,e,n=this;return ui(this,function(r){switch(r.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),e=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(r){var i=Vg.getStore(r,lg.store);return i.loadAll().next(function(r){t=n.filterActiveClients(r,18e5),e=r.filter(function(e){return-1===t.indexOf(e)})}).next(function(){return Am.forEach(e,function(t){return i.delete(t.clientId)})}).next(function(){if(0<(t=t.filter(function(t){return t.clientId!==n.clientId})).length){var e=t.map(function(t){return t.lastProcessedDocumentChangeId||0}),i=Math.min.apply(Math,e);return n.remoteDocumentCache.removeDocumentChangesThroughChangeId(r,i)}})})]);case 1:r.sent(),e.forEach(function(t){n.window.localStorage.removeItem(n.zombiedClientLocalStorageKey(t.clientId))}),r.label=2;case 2:return[2]}})})},Vg.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Ly.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Vg.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Vg.prototype.canActAsPrimary=function(t){var e=this;return jg(t).get(Vv.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new Fd(Ld.FAILED_PRECONDITION,Lg);return!1}}return!(!e.networkEnabled||!e.inForeground)||Wg(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Nd(Mg,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Vg.prototype.shutdown=function(){return si(this,void 0,void 0,function(){var t=this;return ui(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Vv.store,lg.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Vg.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Vg.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[lg.store],function(e){return Wg(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},Vg.clearPersistence=function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return Vg.isAvailable()?(e=t+Vg.MAIN_DATABASE,[4,Wm.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})},Object.defineProperty(Vg.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Vg.prototype.getMutationQueue=function(t){return Rd(this.started,"Cannot initialize MutationQueue before persistence is started."),Om.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Vg.prototype.getQueryCache=function(){return Rd(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},Vg.prototype.getRemoteDocumentCache=function(){return Rd(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Vg.prototype.getIndexManager=function(){return Rd(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Vg.prototype.runTransaction=function(t,e,n){var r=this;return Nd(Mg,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",yg,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Ad("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new Fd(Ld.FAILED_PRECONDITION,xg);return n(new Fg(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Fg(i,r.listenSequence.next()))})})},Vg.prototype.verifyAllowTabSynchronization=function(t){var e=this;return jg(t).get(Vv.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Fd(Ld.FAILED_PRECONDITION,Lg)})},Vg.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Vv(this.clientId,this.allowTabSynchronization,Date.now());return jg(t).put(Vv.key,e)},Vg.isAvailable=function(){return Wm.isAvailable()},Vg.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Vg.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=jg(t);return n.get(Vv.key).next(function(t){return e.isLocalClient(t)?(Nd(Mg,"Releasing primary lease."),n.delete(Vv.key)):Am.resolve()})},Vg.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Ad("Detected an update time that is in the future: "+t+" > "+n),1))},Vg.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Vg.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Rd(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Vg.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Vg.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Rd("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Vg.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Nd(Mg,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Ad(Mg,"Failed to get zombied client id.",t),!1}},Vg.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Ad("Failed to set zombie client id.",t)}},Vg.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Vg.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Vg.MAIN_DATABASE="main",Vg);function Vg(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!Vg.isAvailable())throw new Fd(Ld.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new zg(this,o),this.dbName=t+Vg.MAIN_DATABASE,this.serializer=new _g(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new tv(this.referenceDelegate,this.serializer),this.indexManager=new mg,this.remoteDocumentCache=new Ev(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new Fd(Ld.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}function Bg(t){return si(this,void 0,void 0,function(){return ui(this,function(e){if(!function(t){return t.code===Ld.FAILED_PRECONDITION&&t.message===xg}(t))throw t;return Nd(Mg,"Unexpectedly lost primary lease"),[2]})})}function jg(t){return t.store(Vv.store)}function Wg(t){return t.store(lg.store)}var Kg,Qg,Hg,Gg,zg=(Yg.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},Yg.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Yg.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Yg.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},Yg.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Yg.prototype.addReference=function(t,e){return Xg(t,e)},Yg.prototype.removeReference=function(t,e){return Xg(t,e)},Yg.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Yg.prototype.removeMutationReference=function(t,e){return Xg(t,e)},Yg.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Am.resolve(!0):function(t,e){var n=!1;return qm(t).iterateSerial(function(r){return Mm(t,r,e).next(function(t){return t&&(n=!0),Am.resolve(!t)})}).next(function(){return n})}(t,e)},Yg.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,a).next(function(t){i+=t})});o.push(u)}}).next(function(){return Am.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},Yg.prototype.removeOrphanedDocument=function(t,e){var n=0,r=this.db.getRemoteDocumentCache();return Am.waitFor([ov(t).delete([0,Gy(e.path)]),r.removeEntry(t,e).next(function(t){n+=t})]).next(function(){return n})},Yg.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},Yg.prototype.updateLimboDocument=function(t,e){return Xg(t,e)},Yg.prototype.forEachOrphanedDocument=function(t,e){var n,r=ov(t),i=Ey.INVALID;return r.iterate({index:ng.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==Ey.INVALID&&e(new My(Xy(n)),i),i=s,n=a):i=Ey.INVALID}).next(function(){i!==Ey.INVALID&&e(new My(Xy(n)),i)})},Yg.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Yg);function Yg(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Rg(this,e)}function Xg(t,e){return ov(t).put(function(t,e){return new ng(0,Gy(t.path),e)}(e,t.currentSequenceNumber))}(Qg=Kg=Kg||{})[Qg.NullValue=0]="NullValue",Qg[Qg.BooleanValue=1]="BooleanValue",Qg[Qg.NumberValue=2]="NumberValue",Qg[Qg.TimestampValue=3]="TimestampValue",Qg[Qg.StringValue=4]="StringValue",Qg[Qg.BlobValue=5]="BlobValue",Qg[Qg.RefValue=6]="RefValue",Qg[Qg.GeoPointValue=7]="GeoPointValue",Qg[Qg.ArrayValue=8]="ArrayValue",Qg[Qg.ObjectValue=9]="ObjectValue",(Gg=Hg=Hg||{})[Gg.Default=0]="Default",Gg[Gg.Estimate=1]="Estimate",Gg[Gg.Previous=2]="Previous";var Jg=($g.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new $g(Hg.Estimate,e);case"previous":return new $g(Hg.Previous,e);case"none":case void 0:return new $g(Hg.Default,e);default:return Dd("fromSnapshotOptions() called with invalid options.")}},$g);function $g(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Zg=(tb.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},tb.prototype.defaultCompareTo=function(t){return Rd(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),hy(this.typeOrder,t.typeOrder)},tb);function tb(){}var eb,nb=(oi(rb,eb=Zg),rb.prototype.value=function(t){return null},rb.prototype.isEqual=function(t){return t instanceof rb},rb.prototype.compareTo=function(t){return t instanceof rb?0:this.defaultCompareTo(t)},rb.INSTANCE=new rb,rb);function rb(){var t=eb.call(this)||this;return t.typeOrder=Kg.NullValue,t.internalValue=null,t}var ib,ob=(oi(ab,ib=Zg),ab.prototype.value=function(t){return this.internalValue},ab.prototype.isEqual=function(t){return t instanceof ab&&this.internalValue===t.internalValue},ab.prototype.compareTo=function(t){return t instanceof ab?hy(this,t):this.defaultCompareTo(t)},ab.of=function(t){return t?ab.TRUE:ab.FALSE},ab.TRUE=new ab(!0),ab.FALSE=new ab(!1),ab);function ab(t){var e=ib.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.BooleanValue,e}var sb,ub=(oi(cb,sb=Zg),cb.prototype.value=function(t){return this.internalValue},cb.prototype.compareTo=function(t){return t instanceof cb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},cb);function cb(t){var e=sb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.NumberValue,e}function hb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var lb,fb=(oi(pb,lb=ub),pb.prototype.isEqual=function(t){return t instanceof pb&&hb(this.internalValue,t.internalValue)},pb);function pb(){return null!==lb&&lb.apply(this,arguments)||this}var db,yb=(oi(mb,db=ub),mb.prototype.isEqual=function(t){return t instanceof mb&&hb(this.internalValue,t.internalValue)},mb.NAN=new mb(NaN),mb.POSITIVE_INFINITY=new mb(1/0),mb.NEGATIVE_INFINITY=new mb(-1/0),mb);function mb(){return null!==db&&db.apply(this,arguments)||this}var vb,gb=(oi(bb,vb=Zg),bb.prototype.value=function(t){return this.internalValue},bb.prototype.isEqual=function(t){return t instanceof bb&&this.internalValue===t.internalValue},bb.prototype.compareTo=function(t){return t instanceof bb?hy(this.internalValue,t.internalValue):this.defaultCompareTo(t)},bb);function bb(t){var e=vb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.StringValue,e}var wb,_b=(oi(Eb,wb=Zg),Eb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Eb.prototype.isEqual=function(t){return t instanceof Eb&&this.internalValue.isEqual(t.internalValue)},Eb.prototype.compareTo=function(t){return t instanceof Eb?this.internalValue._compareTo(t.internalValue):t instanceof Sb?-1:this.defaultCompareTo(t)},Eb);function Eb(t){var e=wb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.TimestampValue,e}var Tb,Sb=(oi(Ib,Tb=Zg),Ib.prototype.value=function(t){return t&&t.serverTimestampBehavior===Hg.Estimate?new _b(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Hg.Previous&&this.previousValue?this.previousValue.value(t):null},Ib.prototype.isEqual=function(t){return t instanceof Ib&&this.localWriteTime.isEqual(t.localWriteTime)},Ib.prototype.compareTo=function(t){return t instanceof Ib?this.localWriteTime._compareTo(t.localWriteTime):t instanceof _b?1:this.defaultCompareTo(t)},Ib.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Ib);function Ib(t,e){var n=Tb.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Kg.TimestampValue,n}var Cb,Nb=(oi(Ab,Cb=Zg),Ab.prototype.value=function(t){return this.internalValue},Ab.prototype.isEqual=function(t){return t instanceof Ab&&this.internalValue.isEqual(t.internalValue)},Ab.prototype.compareTo=function(t){return t instanceof Ab?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Ab);function Ab(t){var e=Cb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.BlobValue,e}var kb,Db=(oi(Rb,kb=Zg),Rb.prototype.value=function(t){return this.key},Rb.prototype.isEqual=function(t){return t instanceof Rb&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Rb.prototype.compareTo=function(t){if(t instanceof Rb){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:My.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Rb);function Rb(t,e){var n=kb.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Kg.RefValue,n}var Ob,Pb=(oi(Mb,Ob=Zg),Mb.prototype.value=function(t){return this.internalValue},Mb.prototype.isEqual=function(t){return t instanceof Mb&&this.internalValue.isEqual(t.internalValue)},Mb.prototype.compareTo=function(t){return t instanceof Mb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Mb);function Mb(t){var e=Ob.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.GeoPointValue,e}var xb,Lb=(oi(Fb,xb=Zg),Fb.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},Fb.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Fb.prototype.isEqual=function(t){if(t instanceof Fb){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Fb.prototype.compareTo=function(t){if(t instanceof Fb){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=hy(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return hy(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Fb.prototype.set=function(t,e){if(Rd(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Fb||(n=Fb.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Fb.prototype.delete=function(t){if(Rd(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Fb(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Fb){var n=e.delete(t.popFirst());return new Fb(this.internalValue.insert(t.firstSegment(),n))}return this},Fb.prototype.contains=function(t){return null!==this.field(t)},Fb.prototype.field=function(t){Rd(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Fb?e.internalValue.get(t):null}),e},Fb.prototype.fieldMask=function(){var t=new cm(Oy.comparator);return this.internalValue.forEach(function(e,n){var r=new Oy([e]);if(n instanceof Fb){var i=n.fieldMask().fields;i.isEmpty()?t=t.add(r):i.forEach(function(e){t=t.add(r.child(e))})}else t=t.add(r)}),Bb.fromSet(t)},Fb.prototype.toString=function(){return this.internalValue.toString()},Fb.prototype.child=function(t){return this.internalValue.get(t)||void 0},Fb.prototype.setChild=function(t,e){return new Fb(this.internalValue.insert(t,e))},Fb.EMPTY=new Fb(new em(hy)),Fb);function Fb(t){var e=xb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.ObjectValue,e}var Ub,qb=(oi(Vb,Ub=Zg),Vb.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},Vb.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Vb.prototype.forEach=function(t){this.internalValue.forEach(t)},Vb.prototype.isEqual=function(t){if(t instanceof Vb){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Vb.prototype.compareTo=function(t){if(t instanceof Vb){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return hy(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Vb.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Vb);function Vb(t){var e=Ub.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.ArrayValue,e}var Bb=(jb.fromSet=function(t){return new jb(t)},jb.fromArray=function(t){var e=new cm(Oy.comparator);return t.forEach(function(t){return e=e.add(t)}),new jb(e)},jb.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},jb.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},jb);function jb(t){this.fields=t}var Wb=(Kb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Kb);function Kb(t,e){this.field=t,this.transform=e}var Qb,Hb,Gb=function(t,e){this.version=t,this.transformResults=e};(Hb=Qb=Qb||{})[Hb.Set=0]="Set",Hb[Hb.Patch=1]="Patch",Hb[Hb.Transform=2]="Transform",Hb[Hb.Delete=3]="Delete";var zb=(Yb.exists=function(t){return new Yb(void 0,t)},Yb.updateTime=function(t){return new Yb(t)},Object.defineProperty(Yb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Yb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof cv&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof cv:(Rd(this.isNone,"Precondition should be empty"),!0)},Yb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Yb.NONE=new Yb,Yb);function Yb(t,e){this.updateTime=t,this.exists=e,Rd(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Xb=(Jb.prototype.verifyKeyMatches=function(t){null!=t&&Rd(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Jb.getPostMutationVersion=function(t){return t instanceof cv?t.version:Zy.MIN},Jb);function Jb(){}var $b,Zb=(oi(tw,$b=Xb),tw.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new cv(this.key,n,this.value,{hasCommittedMutations:!0})},tw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Xb.getPostMutationVersion(t);return new cv(this.key,r,this.value,{hasLocalMutations:!0})},tw.prototype.extractBaseValue=function(t){return null},tw.prototype.isEqual=function(t){return t instanceof tw&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},tw);function tw(t,e,n){var r=$b.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Qb.Set,r}var ew,nw=(oi(rw,ew=Xb),rw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new yv(this.key,e.version);var n=this.patchDocument(t);return new cv(this.key,e.version,n,{hasCommittedMutations:!0})},rw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Xb.getPostMutationVersion(t),i=this.patchDocument(t);return new cv(this.key,r,i,{hasLocalMutations:!0})},rw.prototype.extractBaseValue=function(t){return null},rw.prototype.isEqual=function(t){return t instanceof rw&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},rw.prototype.patchDocument=function(t){var e;return e=t instanceof cv?t.data:Lb.EMPTY,this.patchObject(e)},rw.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},rw);function rw(t,e,n,r){var i=ew.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Qb.Patch,i}var iw,ow=(oi(aw,iw=Xb),aw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Rd(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new yv(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new cv(this.key,i,o,{hasCommittedMutations:!0})},aw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new cv(this.key,r.version,o,{hasLocalMutations:!0})},aw.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof cv?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Lb.EMPTY.set(i.field,a):e.set(i.field,a))}return e},aw.prototype.isEqual=function(t){return t instanceof aw&&this.key.isEqual(t.key)&&ly(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},aw.prototype.requireDocument=function(t){Rd(t instanceof cv,"Unknown MaybeDocument type "+t);var e=t;return Rd(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},aw.prototype.serverTransformResults=function(t,e){var n=[];Rd(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof cv&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},aw.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof cv&&(u=e.field(a.field)),null===u&&n instanceof cv&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},aw.prototype.transformObject=function(t,e){Rd(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},aw);function aw(t,e){var n=iw.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Qb.Transform,n.precondition=zb.exists(!0),n}var sw,uw=(oi(cw,sw=Xb),cw.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Rd(null==e.transformResults,"Transform results received by DeleteMutation."),new fv(this.key,e.version,{hasCommittedMutations:!0})},cw.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Rd(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new fv(this.key,Zy.forDeletedDoc())):t},cw.prototype.extractBaseValue=function(t){return null},cw.prototype.isEqual=function(t){return t instanceof cw&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},cw);function cw(t,e){var n=sw.call(this)||this;return n.key=t,n.precondition=e,n.type=Qb.Delete,n}var hw=(lw.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},lw.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t})},lw.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=ym();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)}),r},lw.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},lw.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=dm();return i.forEach(function(t,e){e=e||new fv(t,Zy.forDeletedDoc()),o=o.insert(t,e)}),o})},lw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},lw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new My(e)).next(function(t){var e=vm();return t instanceof cv&&(e=e.insert(t.key,t)),e})},lw.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;Rd(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=vm();return this.indexManager.getCollectionParents(t,r).next(function(o){return Am.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},lw.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next(function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof cv?n.insert(c,l):n.remove(c)}})}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},lw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=_m(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof nw&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof cv&&(c=c.insert(t,e))}),c})},lw);function lw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var fw=(pw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},pw.prototype.addReference=function(t,e){var n=new dw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},pw.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},pw.prototype.removeReference=function(t,e){this.removeRef(new dw(t,e))},pw.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},pw.prototype.removeReferencesForId=function(t){var e=this,n=My.EMPTY,r=new dw(n,t),i=new dw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},pw.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},pw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},pw.prototype.referencesForId=function(t){var e=My.EMPTY,n=new dw(e,t),r=new dw(e,t+1),i=_m();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},pw.prototype.containsKey=function(t){var e=new dw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},pw);function pw(){this.refsByKey=new cm(dw.compareByKey),this.refsByTarget=new cm(dw.compareByTargetId)}var dw=(yw.compareByKey=function(t,e){return My.comparator(t.key,e.key)||hy(t.targetOrBatchId,e.targetOrBatchId)},yw.compareByTargetId=function(t,e){return hy(t.targetOrBatchId,e.targetOrBatchId)||My.comparator(t.key,e.key)},yw);function yw(t,e){this.key=t,this.targetOrBatchId=e}var mw=(vw.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new hw(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=_m(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++)f=m[y],a=a.add(f.key)}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},vw.prototype.localWrite=function(t){var e=this,n=Jy.now(),r=t.reduce(function(t,e){return t.add(e.key)},_m());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new nw(u.key,c,c.fieldMask(),zb.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},vw.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):Am.resolve(null)})})},vw.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},vw.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Rd(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},vw.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},vw.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},vw.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},vw.prototype.applyRemoteEvent=function(t){var e=this,n=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(r){var i=[],o=_m();jd(t.targetChanges,function(n,a){var s=e.queryDataByTarget[n];if(s){a.addedDocuments.forEach(function(t){o=o.add(t)}),a.modifiedDocuments.forEach(function(t){o=o.add(t)}),i.push(e.queryCache.removeMatchingKeys(r,a.removedDocuments,n).next(function(){return e.queryCache.addMatchingKeys(r,a.addedDocuments,n)}));var u=a.resumeToken;if(0<u.length){var c=s;s=s.copy({resumeToken:u,snapshotVersion:t.snapshotVersion}),e.queryDataByTarget[n]=s,vw.shouldPersistQueryData(c,s,a)&&i.push(e.queryCache.updateQueryData(r,s))}}});var a=dm(),s=_m();t.documentUpdates.forEach(function(t,e){s=s.add(t)}),i.push(n.getEntries(r,s).next(function(s){t.documentUpdates.forEach(function(u,c){var h=s.get(u);null==h||c.version.isEqual(Zy.MIN)||o.has(c.key)&&!h.hasPendingWrites||0<=c.version.compareTo(h.version)?(n.addEntry(c),a=a.insert(u,c)):Nd("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),t.resolvedLimboDocuments.has(u)&&i.push(e.persistence.referenceDelegate.updateLimboDocument(r,u))})}));var u=t.snapshotVersion;if(!u.isEqual(Zy.MIN)){var c=e.queryCache.getLastRemoteSnapshotVersion(r).next(function(t){return Rd(0<=u.compareTo(t),"Watch stream reverted to previous snapshot?? "+u+" < "+t),e.queryCache.setTargetsMetadata(r,r.currentSequenceNumber,u)});i.push(c)}return Am.waitFor(i).next(function(){return n.apply(r)}).next(function(){return e.localDocuments.getLocalViewOfDocuments(r,a)})})},vw.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size)},vw.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Am.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),Am.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},vw.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},vw.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},vw.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,Am.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new bg(t,i,pg.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return Rd(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r})})},vw.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){Rd(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?Am.resolve():Am.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},vw.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},vw.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},vw.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},vw.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},vw.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},vw.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Am.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);Rd(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):Rd(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},vw.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},vw.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},vw.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},vw.RESUME_TOKEN_MAX_AGE_MICROS=3e8,vw);function vw(t,e){this.persistence=t,this.localViewReferences=new fw,this.queryDataByTarget={},Rd(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new hw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var gw=(bw.prototype.checkEmpty=function(t){return Am.resolve(0===this.mutationQueue.length)},bw.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Rd(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Rd(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Am.resolve()},bw.prototype.getLastStreamToken=function(t){return Am.resolve(this.lastStreamToken)},bw.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Am.resolve()},bw.prototype.addMutationBatch=function(t,e,n,r){Rd(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Rd(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Sm(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Am.resolve(o)},bw.prototype.lookupMutationBatch=function(t,e){return Am.resolve(this.findMutationBatch(e))},bw.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Rd(null!=n,"Failed to find local mutation batch."),Am.resolve(n.keys())},bw.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Am.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},bw.prototype.getAllMutationBatches=function(t){return Am.resolve(this.mutationQueue.slice())},bw.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new dw(e,0),i=new dw(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Rd(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Rd(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),Am.resolve(o)},bw.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new cm(hy);return e.forEach(function(t){var e=new dw(t,0),i=new dw(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Rd(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),Am.resolve(this.findMutationBatches(r))},bw.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;My.isDocumentKey(i)||(i=i.child(""));var o=new dw(new My(i),0),a=new cm(hy);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Am.resolve(this.findMutationBatches(a))},bw.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},bw.prototype.removeMutationBatch=function(t,e){var n=this;Rd(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Am.forEach(e.mutations,function(i){var o=new dw(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},bw.prototype.removeCachedMutationKeys=function(t){},bw.prototype.containsKey=function(t,e){var n=new dw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Am.resolve(e.isEqual(r&&r.key))},bw.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Rd(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Am.resolve()},bw.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Rd(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},bw.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},bw.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Rd(n.batchId===t,"If found batch must match"),n},bw);function bw(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Md(),this.batchesByDocumentKey=new cm(dw.compareByKey)}var ww=(_w.prototype.getTargetCount=function(t){return Am.resolve(this.targetCount)},_w.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),Am.resolve()},_w.prototype.getLastRemoteSnapshotVersion=function(t){return Am.resolve(this.lastRemoteSnapshotVersion)},_w.prototype.getHighestSequenceNumber=function(t){return Am.resolve(this.highestSequenceNumber)},_w.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Am.resolve(e)},_w.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Am.resolve()},_w.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},_w.prototype.addQueryData=function(t,e){return Rd(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Am.resolve()},_w.prototype.updateQueryData=function(t,e){return Rd(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Am.resolve()},_w.prototype.removeQueryData=function(t,e){return Rd(0<this.targetCount,"Removing a target from an empty cache"),Rd(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Am.resolve()},_w.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),Am.waitFor(o).next(function(){return i})},_w.prototype.getQueryCount=function(t){return Am.resolve(this.targetCount)},_w.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Am.resolve(n)},_w.prototype.getQueryDataForTarget=function(t,e){return Dd("Not yet implemented.")},_w.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),Am.waitFor(i)},_w.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),Am.waitFor(i)},_w.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Am.resolve()},_w.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Am.resolve(n)},_w.prototype.containsKey=function(t,e){return Am.resolve(this.references.containsKey(e))},_w);function _w(t){this.persistence=t,this.queries=new vv(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Zy.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new fw,this.targetCount=0,this.targetIdGenerator=Vm.forQueryCache()}var Ew=(Tw.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,Am.waitFor(r)},Tw.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,Am.resolve(n.size)):Am.resolve(0)},Tw.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Am.resolve(n?n.maybeDocument:null)},Tw.prototype.getSizedEntry=function(t,e){return Am.resolve(this.docs.get(e))},Tw.prototype.getEntries=function(t,e){var n=this,r=ym();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Am.resolve(r)},Tw.prototype.getSizedEntries=function(t,e){var n=this,r=ym(),i=new em(My.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),Am.resolve({maybeDocuments:r,sizeMap:i})},Tw.prototype.getDocumentsMatchingQuery=function(t,e){Rd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=vm(),r=new My(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof cv&&e.matches(s)&&(n=n.insert(s.key,s))}return Am.resolve(n)},Tw.prototype.forEachDocumentKey=function(t,e){return Am.forEach(this.docs,function(t){return e(t)})},Tw.prototype.getNewDocumentChanges=function(t){var e=this,n=dm();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new fv(t,Zy.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=_m(),Am.resolve(n)},Tw.prototype.newChangeBuffer=function(){return new Iw(this.sizer,this)},Tw.prototype.getSize=function(t){return Am.resolve(this.size)},Tw);function Tw(t,e){this.indexManager=t,this.sizer=e,this.docs=new em(My.comparator),this.newDocumentChanges=_m(),this.size=0}var Sw,Iw=(oi(Cw,Sw=bv),Cw.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);Rd(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var a=e.sizer(n);r+=a-o,i.push({maybeDocument:n,size:a})}),this.documentCache.addEntries(t,i,r)},Cw.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Cw.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Cw);function Cw(t,e){var n=Sw.call(this)||this;return n.sizer=t,n.documentCache=e,n}var Nw=(Aw.createLruPersistence=function(t,e,n){return new Aw(t,function(t){return new Ow(t,new _g(e),n)})},Aw.createEagerPersistence=function(t){return new Aw(t,function(t){return new Dw(t)})},Aw.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Aw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Aw.prototype.getActiveClients=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return[2,[this.clientId]]})})},Aw.prototype.setPrimaryStateListener=function(t){return t(!0)},Aw.prototype.setDatabaseDeletedListener=function(){},Aw.prototype.setNetworkEnabled=function(t){},Aw.prototype.getIndexManager=function(){return this.indexManager},Aw.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new gw(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Aw.prototype.getQueryCache=function(){return this.queryCache},Aw.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Aw.prototype.runTransaction=function(t,e,n){var r=this;Nd("MemoryPersistence","Starting transaction:",t);var i=new kw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},Aw.prototype.mutationQueuesContainKey=function(t,e){return Am.or(function(t){var e=[];return Wd(t,function(t,n){return e.push(n)}),e}(this.mutationQueues).map(function(n){return function(){return n.containsKey(t,e)}}))},Aw);function Aw(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Ey(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new ww(this),this.indexManager=new Ov,this.remoteDocumentCache=new Ew(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var kw=function(t){this.currentSequenceNumber=t},Dw=(Object.defineProperty(Rw.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Dd("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Rw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Rw.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Am.resolve()},Rw.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Am.resolve()},Rw.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Am.resolve()},Rw.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},Rw.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Rw.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return Am.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?Am.resolve():n.removeEntry(t,r).next(function(){})})}).next(function(){e._orphanedDocuments=null})},Rw.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Rw.prototype.documentSize=function(t){return 0},Rw.prototype.isReferenced=function(t,e){var n=this;return Am.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Am.resolve(n.inMemoryPins.containsKey(e))}])},Rw);function Rw(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var Ow=(Pw.prototype.onTransactionStarted=function(){},Pw.prototype.onTransactionCommitted=function(t){return Am.resolve()},Pw.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},Pw.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},Pw.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Pw.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Am.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?Am.resolve():e(i)})})},Pw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Pw.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},Pw.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?Am.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},Pw.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Am.resolve()},Pw.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},Pw.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Am.resolve()},Pw.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Am.resolve()},Pw.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Am.resolve()},Pw.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Dd("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},Pw.prototype.isPinned=function(t,e,n){var r=this;return Am.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Am.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Am.resolve(void 0!==t&&n<t)}])},Pw.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Pw);function Pw(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new vv(function(t){return Gy(t.path)}),this.garbageCollector=new Rg(this,n)}var Mw=Number,xw=Mw.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Lw=Mw.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Fw=Mw.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Uw(t){return null==t}function qw(t){return Fw(t)&&t<=Lw&&xw<=t}var Vw=(Bw.prototype.reset=function(){this.currentBaseMs=0},Bw.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Bw.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Nd("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Bw.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Bw.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Bw);function Bw(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var jw,Ww,Kw="PersistentStream";(Ww=jw=jw||{})[Ww.Initial=0]="Initial",Ww[Ww.Starting=1]="Starting",Ww[Ww.Open=2]="Open",Ww[Ww.Error=3]="Error",Ww[Ww.Backoff=4]="Backoff";var Qw=(Hw.prototype.isStarted=function(){return this.state===jw.Starting||this.state===jw.Open||this.state===jw.Backoff},Hw.prototype.isOpen=function(){return this.state===jw.Open},Hw.prototype.start=function(){this.state!==jw.Error?(Rd(this.state===jw.Initial,"Already started"),this.auth()):this.performBackoff()},Hw.prototype.stop=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(jw.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hw.prototype.inhibitBackoff=function(){Rd(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=jw.Initial,this.backoff.reset()},Hw.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},Hw.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Hw.prototype.handleIdleCloseTimer=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return this.isOpen()?[2,this.close(jw.Initial)]:[2]})})},Hw.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Hw.prototype.close=function(t,e){return si(this,void 0,void 0,function(){return ui(this,function(n){switch(n.label){case 0:return Rd(this.isStarted(),"Only started streams should be closed."),Rd(t===jw.Error||Uw(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==jw.Error?this.backoff.reset():e&&e.code===Ld.RESOURCE_EXHAUSTED?(Ad(e.toString()),Ad("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Ld.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},Hw.prototype.tearDown=function(){},Hw.prototype.auth=function(){var t=this;Rd(this.state===jw.Initial,"Must be in initial state to auth"),this.state=jw.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new Fd(Ld.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},Hw.prototype.startStream=function(t){var e=this;Rd(this.state===jw.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Rd(e.state===jw.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=jw.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Hw.prototype.performBackoff=function(){var t=this;Rd(this.state===jw.Error,"Should only perform backoff when in Error state"),this.state=jw.Backoff,this.backoff.backoffAndRun(function(){return si(t,void 0,void 0,function(){return ui(this,function(t){return Rd(this.state===jw.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=jw.Initial,this.start(),Rd(this.isStarted(),"PersistentStream should have started"),[2]})})})},Hw.prototype.handleStreamClose=function(t){return Rd(this.isStarted(),"Can't handle server close on non-started stream"),Nd(Kw,"close with error: "+t),this.stream=null,this.close(jw.Error,t)},Hw.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Nd(Kw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Hw);function Hw(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=jw.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Vw(t,e,1e3,1.5,6e4)}var Gw,zw=(oi(Yw,Gw=Qw),Yw.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},Yw.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},Yw.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},Yw.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},Yw);function Yw(t,e,n,r,i){var o=Gw.call(this,t,Ly.ListenStreamConnectionBackoff,Ly.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Xw,Jw=(oi($w,Xw=Qw),Object.defineProperty($w.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),$w.prototype.start=function(){this.handshakeComplete_=!1,Xw.prototype.start.call(this)},$w.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},$w.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},$w.prototype.onMessage=function(t){if(Rd(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Rd(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},$w.prototype.writeHandshake=function(){Rd(this.isOpen(),"Writing handshake requires an opened stream"),Rd(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},$w.prototype.writeMutations=function(t){var e=this;Rd(this.isOpen(),"Writing mutations requires an opened stream"),Rd(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Rd(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},$w);function $w(t,e,n,r,i){var o=Xw.call(this,t,Ly.WriteStreamConnectionBackoff,Ly.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Md(),o}var Zw=(t_.prototype.newPersistentWriteStream=function(t){return new Jw(this.queue,this.connection,this.credentials,this.serializer,t)},t_.prototype.newPersistentWatchStream=function(t){return new zw(this.queue,this.connection,this.credentials,this.serializer,t)},t_.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t_.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=dm();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Rd(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t_.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Ld.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t_.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Ld.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t_);function t_(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var e_,n_,r_,i_,o_=(a_.prototype.lookup=function(t){return si(this,void 0,void 0,function(){var e,n=this;return ui(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Fd(Ld.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof fv||t instanceof cv?n.recordVersion(t):Dd("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},a_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},a_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},a_.prototype.delete=function(t){this.write([new uw(t,this.precondition(t))]),this.writtenDocs.add(t)},a_.prototype.commit=function(){return si(this,void 0,void 0,function(){var t;return ui(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new Fd(Ld.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},a_.prototype.recordVersion=function(t){var e;if(t instanceof cv)e=t.version;else{if(!(t instanceof fv))throw Dd("Document in a transaction was a "+t.constructor.name);e=Zy.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Fd(Ld.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},a_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?zb.updateTime(e):zb.NONE},a_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return zb.exists(!0);if(e.isEqual(Zy.forDeletedDoc()))throw new Fd(Ld.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return zb.updateTime(e)},a_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},a_.prototype.ensureCommitNotCalled=function(){Rd(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},a_);function a_(t){this.datastore=t,this.readVersions=bm(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(n_=e_=e_||{})[n_.Unknown=0]="Unknown",n_[n_.Online=1]="Online",n_[n_.Offline=2]="Offline",(i_=r_=r_||{})[i_.RemoteStore=0]="RemoteStore",i_[i_.SharedClientState=1]="SharedClientState";var s_,u_,c_=(h_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(e_.Unknown),Rd(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Ly.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Rd(t.state===e_.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(e_.Offline),Promise.resolve()}))},h_.prototype.handleWatchStreamFailure=function(t){this.state===e_.Online?(this.setAndBroadcast(e_.Unknown),Rd(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Rd(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(e_.Offline)))},h_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===e_.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},h_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},h_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Ad(e),this.shouldWarnClientIsOffline=!1):Nd("OnlineStateTracker",e)},h_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},h_);function h_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=e_.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function l_(t){switch(t){case Ld.OK:return Dd("Treated status OK as error");case Ld.CANCELLED:case Ld.UNKNOWN:case Ld.DEADLINE_EXCEEDED:case Ld.RESOURCE_EXHAUSTED:case Ld.INTERNAL:case Ld.UNAVAILABLE:case Ld.UNAUTHENTICATED:return!1;case Ld.INVALID_ARGUMENT:case Ld.NOT_FOUND:case Ld.ALREADY_EXISTS:case Ld.PERMISSION_DENIED:case Ld.FAILED_PRECONDITION:case Ld.ABORTED:case Ld.OUT_OF_RANGE:case Ld.UNIMPLEMENTED:case Ld.DATA_LOSS:return!0;default:return Dd("Unknown status code: "+t)}}function f_(t){if(void 0===t)return Ad("GRPC error has no .code"),Ld.UNKNOWN;switch(t){case s_.OK:return Ld.OK;case s_.CANCELLED:return Ld.CANCELLED;case s_.UNKNOWN:return Ld.UNKNOWN;case s_.DEADLINE_EXCEEDED:return Ld.DEADLINE_EXCEEDED;case s_.RESOURCE_EXHAUSTED:return Ld.RESOURCE_EXHAUSTED;case s_.INTERNAL:return Ld.INTERNAL;case s_.UNAVAILABLE:return Ld.UNAVAILABLE;case s_.UNAUTHENTICATED:return Ld.UNAUTHENTICATED;case s_.INVALID_ARGUMENT:return Ld.INVALID_ARGUMENT;case s_.NOT_FOUND:return Ld.NOT_FOUND;case s_.ALREADY_EXISTS:return Ld.ALREADY_EXISTS;case s_.PERMISSION_DENIED:return Ld.PERMISSION_DENIED;case s_.FAILED_PRECONDITION:return Ld.FAILED_PRECONDITION;case s_.ABORTED:return Ld.ABORTED;case s_.OUT_OF_RANGE:return Ld.OUT_OF_RANGE;case s_.UNIMPLEMENTED:return Ld.UNIMPLEMENTED;case s_.DATA_LOSS:return Ld.DATA_LOSS;default:return Dd("Unknown status code: "+t)}}(u_=s_=s_||{})[u_.OK=0]="OK",u_[u_.CANCELLED=1]="CANCELLED",u_[u_.UNKNOWN=2]="UNKNOWN",u_[u_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",u_[u_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",u_[u_.NOT_FOUND=5]="NOT_FOUND",u_[u_.ALREADY_EXISTS=6]="ALREADY_EXISTS",u_[u_.PERMISSION_DENIED=7]="PERMISSION_DENIED",u_[u_.UNAUTHENTICATED=16]="UNAUTHENTICATED",u_[u_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",u_[u_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",u_[u_.ABORTED=10]="ABORTED",u_[u_.OUT_OF_RANGE=11]="OUT_OF_RANGE",u_[u_.UNIMPLEMENTED=12]="UNIMPLEMENTED",u_[u_.INTERNAL=13]="INTERNAL",u_[u_.UNAVAILABLE=14]="UNAVAILABLE",u_[u_.DATA_LOSS=15]="DATA_LOSS";var p_,d_,y_,m_,v_=(g_.emptySet=function(t){return new g_(t.comparator)},g_.prototype.has=function(t){return null!=this.keyedMap.get(t)},g_.prototype.get=function(t){return this.keyedMap.get(t)},g_.prototype.first=function(){return this.sortedSet.minKey()},g_.prototype.last=function(){return this.sortedSet.maxKey()},g_.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},g_.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(g_.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),g_.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},g_.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},g_.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},g_.prototype.isEqual=function(t){if(!(t instanceof g_))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},g_.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},g_.prototype.copy=function(t,e){var n=new g_;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},g_);function g_(t){this.comparator=t?function(e,n){return t(e,n)||My.comparator(e.key,n.key)}:function(t,e){return My.comparator(t.key,e.key)},this.keyedMap=vm(),this.sortedSet=new em(this.comparator)}(d_=p_=p_||{})[d_.Added=0]="Added",d_[d_.Removed=1]="Removed",d_[d_.Modified=2]="Modified",d_[d_.Metadata=3]="Metadata",(m_=y_=y_||{})[m_.Local=0]="Local",m_[m_.Synced=1]="Synced";var b_=(w_.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==p_.Added&&n.type===p_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===p_.Metadata&&n.type!==p_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===p_.Modified&&n.type===p_.Modified?this.changeMap=this.changeMap.insert(e,{type:p_.Modified,doc:t.doc}):t.type===p_.Modified&&n.type===p_.Added?this.changeMap=this.changeMap.insert(e,{type:p_.Added,doc:t.doc}):t.type===p_.Removed&&n.type===p_.Added?this.changeMap=this.changeMap.remove(e):t.type===p_.Removed&&n.type===p_.Modified?this.changeMap=this.changeMap.insert(e,{type:p_.Removed,doc:n.doc}):t.type===p_.Added&&n.type===p_.Removed?this.changeMap=this.changeMap.insert(e,{type:p_.Modified,doc:t.doc}):Dd("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},w_.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},w_);function w_(){this.changeMap=new em(My.comparator)}var __=(E_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:p_.Added,doc:t})}),new E_(t,e,v_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(E_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),E_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},E_);function E_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var T_=(S_.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=I_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new S_(Zy.MIN,r,Tm(),dm(),_m())},S_);function S_(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var I_=(C_.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new C_(Md(),e,_m(),_m(),_m())},C_);function C_(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var N_,A_,k_=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},D_=function(t,e){this.targetId=t,this.existenceFilter=e};(A_=N_=N_||{})[A_.NoChange=0]="NoChange",A_[A_.Added=1]="Added",A_[A_.Removed=2]="Removed",A_[A_.Current=3]="Current",A_[A_.Reset=4]="Reset";var R_=function(t,e,n,r){void 0===n&&(n=Md()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},O_=(Object.defineProperty(P_.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),P_.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},P_.prototype.toTargetChange=function(){var t=_m(),e=_m(),n=_m();return this.documentChanges.forEach(function(r,i){switch(i){case p_.Added:t=t.add(r);break;case p_.Modified:e=e.add(r);break;case p_.Removed:n=n.add(r);break;default:Dd("Encountered invalid change type: "+i)}}),new I_(this._resumeToken,this._current,t,e,n)},P_.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=F_()},P_.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},P_.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},P_.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},P_.prototype.recordTargetResponse=function(){this.pendingResponses-=1},P_.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},P_);function P_(){this.pendingResponses=0,this.documentChanges=F_(),this._resumeToken=Md(),this._current=!1,this._hasPendingChanges=!0}var M_=(x_.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof cv?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof fv&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},x_.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case N_.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case N_.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case N_.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Rd(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case N_.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case N_.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Dd("Unknown target watch change state: "+t.state)}})},x_.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):jd(this.targetStates,e)},x_.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new My(i.path);this.removeDocumentFromTarget(e,o,new fv(o,Zy.forDeletedDoc()))}else Rd(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},x_.prototype.createRemoteEvent=function(t){var e=this,n={};jd(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new My(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new fv(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=_m();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===pg.LimboResolution||(i=!1)}),i&&(r=r.add(t))});var i=new T_(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=dm(),this.pendingDocumentTargetMapping=L_(),this.pendingTargetResets=new cm(hy),i},x_.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?p_.Modified:p_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},x_.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,p_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},x_.prototype.removeTarget=function(t){delete this.targetStates[t]},x_.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},x_.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},x_.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new O_),this.targetStates[t]},x_.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new cm(hy),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},x_.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Nd("WatchChangeAggregator","Detected inactive target",t),e},x_.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},x_.prototype.resetTarget=function(t){var e=this;Rd(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new O_,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},x_.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},x_);function x_(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=dm(),this.pendingDocumentTargetMapping=L_(),this.pendingTargetResets=new cm(hy)}function L_(){return new em(My.comparator)}function F_(){return new em(My.comparator)}var U_="RemoteStore",q_=(V_.prototype.start=function(){return this.enableNetwork()},V_.prototype.enableNetwork=function(){return si(this,void 0,void 0,function(){var t;return ui(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(e_.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},V_.prototype.disableNetwork=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(e_.Offline),[2]}})})},V_.prototype.disableNetworkInternal=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Nd(U_,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},V_.prototype.shutdown=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return Nd(U_,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(e_.Unknown),[2]}})})},V_.prototype.listen=function(t){Rd(!Vd(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},V_.prototype.unlisten=function(t){Rd(Vd(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Kd(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(e_.Unknown))},V_.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},V_.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},V_.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},V_.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},V_.prototype.startWatchStream=function(){Rd(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new M_(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},V_.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Kd(this.listenTargets)},V_.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},V_.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},V_.prototype.onWatchStreamOpen=function(){return si(this,void 0,void 0,function(){var t=this;return ui(this,function(e){return jd(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},V_.prototype.onWatchStreamClose=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){return void 0===t&&Rd(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(e_.Unknown),[2]})})},V_.prototype.onWatchStreamChange=function(t,e){return si(this,void 0,void 0,function(){var n;return ui(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(e_.Online),t instanceof R_&&t.state===N_.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof k_?this.watchChangeAggregator.handleDocumentChange(t):t instanceof D_?this.watchChangeAggregator.handleExistenceFilter(t):(Rd(t instanceof R_,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Zy.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},V_.prototype.raiseWatchSnapshot=function(t){var e=this;Rd(!t.isEqual(Zy.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return jd(n.targetChanges,function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:Md()}),e.sendUnwatchRequest(t);var r=new bg(n.query,t,pg.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},V_.prototype.handleTargetError=function(t){var e=this;Rd(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return si(e,void 0,void 0,function(){return ui(this,function(e){return Vd(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},V_.prototype.fillWritePipeline=function(){return si(this,void 0,void 0,function(){var t,e;return ui(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},V_.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},V_.prototype.outstandingWrites=function(){return this.writePipeline.length},V_.prototype.addToWritePipeline=function(t){Rd(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},V_.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},V_.prototype.startWriteStream=function(){Rd(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},V_.prototype.onWriteStreamOpen=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return this.writeStream.writeHandshake(),[2]})})},V_.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Bg)},V_.prototype.onMutationResult=function(t,e){var n=this;Rd(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Cm.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},V_.prototype.onWriteStreamClose=function(t){return si(this,void 0,void 0,function(){var e=this;return ui(this,function(n){return void 0===t&&Rd(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},V_.prototype.handleHandshakeError=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){return l_(t.code)?(Nd(U_,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Md(),[2,this.localStore.setLastStreamToken(Md()).catch(Bg)]):[2]})})},V_.prototype.handleWriteError=function(t){return si(this,void 0,void 0,function(){var e,n=this;return ui(this,function(r){return function(t){return l_(t)&&t!==Ld.ABORTED}(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2]})})},V_.prototype.createTransaction=function(){return new o_(this.datastore)},V_.prototype.restartNetwork=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(e_.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},V_.prototype.handleCredentialChange=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Nd(U_,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},V_.prototype.applyPrimaryState=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(e_.Unknown),e.label=4;case 4:return[2]}})})},V_);function V_(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return si(o,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Nd(U_,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new c_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var B_=(Object.defineProperty(j_.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(j_.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),j_.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},j_.prototype._compareTo=function(t){return hy(this._lat,t._lat)||hy(this._long,t._long)},j_);function j_(t,e){if(Hd("GeoPoint",arguments,2),Yd("GeoPoint","number",1,t),Yd("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Fd(Ld.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Fd(Ld.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var W_=(K_.atPath=function(t){return new K_(t)},Object.defineProperty(K_.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[vE]:this.memoizedOrderBy=[new yE(t),vE];else{Rd(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:lE.ASCENDING;this.memoizedOrderBy.push(a===lE.ASCENDING?vE:gE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),K_.prototype.addFilter=function(t){Rd(null==this.getInequalityFilterField()||!(t instanceof z_)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Rd(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new K_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},K_.prototype.addOrderBy=function(t){Rd(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new K_(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},K_.prototype.withLimit=function(t){return new K_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},K_.prototype.withStartAt=function(t){return new K_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},K_.prototype.withEndAt=function(t){return new K_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},K_.prototype.asCollectionQueryAtPath=function(t){return new K_(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},K_.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Uw(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},K_.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Uw(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},K_.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},K_.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Rd(n,"orderBy used that doesn't compare on key field"),0},K_.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},K_.prototype.hasLimit=function(){return!Uw(this.limit)},K_.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},K_.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof z_&&n.isInequality())return n.field}return null},K_.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof z_&&0<=t.indexOf(r.op))return r.op}return null},K_.prototype.isDocumentQuery=function(){return My.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},K_.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},K_.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):My.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},K_.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},K_.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},K_.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},K_.prototype.assertValidBound=function(t){Rd(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},K_);function K_(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}var Q_=(H_.fromString=function(t){switch(t){case"<":return H_.LESS_THAN;case"<=":return H_.LESS_THAN_OR_EQUAL;case"==":return H_.EQUAL;case">=":return H_.GREATER_THAN_OR_EQUAL;case">":return H_.GREATER_THAN;case"array-contains":return H_.ARRAY_CONTAINS;case"in":return H_.IN;case"array-contains-any":return H_.ARRAY_CONTAINS_ANY;default:return Dd("Unknown FieldFilter operator: "+t)}},H_.prototype.toString=function(){return this.name},H_.prototype.isEqual=function(t){return this.name===t.name},H_.LESS_THAN=new H_("<"),H_.LESS_THAN_OR_EQUAL=new H_("<="),H_.EQUAL=new H_("=="),H_.GREATER_THAN=new H_(">"),H_.GREATER_THAN_OR_EQUAL=new H_(">="),H_.ARRAY_CONTAINS=new H_("array-contains"),H_.IN=new H_("in"),H_.ARRAY_CONTAINS_ANY=new H_("array-contains-any"),H_);function H_(t){this.name=t}var G_,z_=(oi(Y_,G_=function(){}),Y_.create=function(t,e,n){if(t.isKeyField())return e===Q_.IN?(Rd(n instanceof qb,"Comparing on key with IN, but filter value not an ArrayValue"),Rd(n.internalValue.every(function(t){return t instanceof Db}),"Comparing on key with IN, but an array value was not a RefValue"),new tE(t,n)):(Rd(n instanceof Db,"Comparing on key, but filter value not a RefValue"),Rd(e!==Q_.ARRAY_CONTAINS&&e!==Q_.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new J_(t,e,n));if(n.isEqual(nb.INSTANCE)){if(e!==Q_.EQUAL)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Y_(t,e,n)}if(n.isEqual(yb.NAN)){if(e!==Q_.EQUAL)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Y_(t,e,n)}return e===Q_.ARRAY_CONTAINS?new rE(t,n):e===Q_.IN?(Rd(n instanceof qb,"IN filter has invalid value: "+n.toString()),new aE(t,n)):e===Q_.ARRAY_CONTAINS_ANY?(Rd(n instanceof qb,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new cE(t,n)):new Y_(t,e,n)},Y_.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},Y_.prototype.matchesComparison=function(t){switch(this.op){case Q_.LESS_THAN:return t<0;case Q_.LESS_THAN_OR_EQUAL:return t<=0;case Q_.EQUAL:return 0===t;case Q_.GREATER_THAN:return 0<t;case Q_.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Dd("Unknown FieldFilter operator: "+this.op)}},Y_.prototype.isInequality=function(){return 0<=[Q_.LESS_THAN,Q_.LESS_THAN_OR_EQUAL,Q_.GREATER_THAN,Q_.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Y_.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},Y_.prototype.isEqual=function(t){return t instanceof Y_&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Y_.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},Y_);function Y_(t,e,n){var r=G_.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var X_,J_=(oi($_,X_=z_),$_.prototype.matches=function(t){var e=this.value,n=My.comparator(t.key,e.key);return this.matchesComparison(n)},$_);function $_(){return null!==X_&&X_.apply(this,arguments)||this}var Z_,tE=(oi(eE,Z_=z_),eE.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},eE);function eE(t,e){var n=Z_.call(this,t,Q_.IN,e)||this;return n.value=e,n}var nE,rE=(oi(iE,nE=z_),iE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof qb&&e.contains(this.value)},iE);function iE(t,e){return nE.call(this,t,Q_.ARRAY_CONTAINS,e)||this}var oE,aE=(oi(sE,oE=z_),sE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},sE);function sE(t,e){var n=oE.call(this,t,Q_.IN,e)||this;return n.value=e,n}var uE,cE=(oi(hE,uE=z_),hE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof qb&&n.internalValue.some(function(t){return e.value.contains(t)})},hE);function hE(t,e){var n=uE.call(this,t,Q_.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var lE=(fE.prototype.toString=function(){return this.name},fE.ASCENDING=new fE("asc"),fE.DESCENDING=new fE("desc"),fE);function fE(t){this.name=t}var pE=(dE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},dE.prototype.sortsBeforeDocument=function(t,e){Rd(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Rd(o instanceof Db,"Bound has a non-key value where the key path is being used."),n=My.comparator(o.key,e.key);else{var a=e.field(i.field);Rd(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===lE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},dE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},dE);function dE(t,e){this.position=t,this.before=e}var yE=(mE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?cv.compareByKey(t,e):cv.compareByField(this.field,t,e);switch(this.dir){case lE.ASCENDING:return n;case lE.DESCENDING:return-1*n;default:return Dd("Unknown direction: "+this.dir)}},mE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},mE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},mE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},mE);function mE(t,e){this.field=t,void 0===e&&(e=lE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var vE=new yE(Oy.keyField(),lE.ASCENDING),gE=new yE(Oy.keyField(),lE.DESCENDING),bE=(wE.prototype.applyToLocalView=function(t,e){return new Sb(e,t)},wE.prototype.applyToRemoteDocument=function(t,e){return e},wE.prototype.computeBaseValue=function(t){return null},wE.prototype.isEqual=function(t){return t instanceof wE},wE.instance=new wE,wE);function wE(){}var _E=(EE.prototype.applyToLocalView=function(t,e){return this.apply(t)},EE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},EE.prototype.apply=function(t){for(var e=NE(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new qb(e)},EE.prototype.computeBaseValue=function(t){return null},EE.prototype.isEqual=function(t){return t instanceof EE&&ly(t.elements,this.elements)},EE);function EE(t){this.elements=t}var TE=(SE.prototype.applyToLocalView=function(t,e){return this.apply(t)},SE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},SE.prototype.apply=function(t){for(var e=NE(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new qb(e)},SE.prototype.computeBaseValue=function(t){return null},SE.prototype.isEqual=function(t){return t instanceof SE&&ly(t.elements,this.elements)},SE);function SE(t){this.elements=t}var IE=(CE.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof fb&&this.operand instanceof fb){var r=n.internalValue+this.operand.internalValue;return new fb(r)}return r=n.internalValue+this.operand.internalValue,new yb(r)},CE.prototype.applyToRemoteDocument=function(t,e){return Rd(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},CE.prototype.computeBaseValue=function(t){return t instanceof ub?t:new fb(0)},CE.prototype.isEqual=function(t){return t instanceof CE&&this.operand.isEqual(t.operand)},CE);function CE(t){this.operand=t}function NE(t){return t instanceof qb?t.internalValue.slice():[]}var AE=(kE.prototype.isEqual=function(t){return t&&t.count===this.count},kE);function kE(t){this.count=t}var DE,RE,OE=((DE={})[lE.ASCENDING.name]="ASCENDING",DE[lE.DESCENDING.name]="DESCENDING",DE),PE=((RE={})[Q_.LESS_THAN.name]="LESS_THAN",RE[Q_.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",RE[Q_.GREATER_THAN.name]="GREATER_THAN",RE[Q_.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",RE[Q_.EQUAL.name]="EQUAL",RE[Q_.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",RE[Q_.IN.name]="IN",RE[Q_.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",RE),ME=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xE(t,e){Rd(!Uw(t),e+" is missing")}function LE(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Dd("can't parse "+t)}var FE=(UE.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},UE.prototype.unsafeCastProtoByteString=function(t){return t},UE.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Ld.UNKNOWN:f_(t.code);return new Fd(e,t.message||"")},UE.prototype.toInt32Value=function(t){return Uw(t)?void 0:{value:t}},UE.prototype.fromInt32Value=function(t){var e;return Uw(e="object"==typeof t?t.value:t)?null:e},UE.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},UE.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Rd(!!t,"Cannot deserialize null or undefined timestamp.");var e=LE(t.seconds||"0"),n=t.nanos||0;return new Jy(e,n)},UE.prototype.fromIso8601String=function(t){var e=0,n=ME.exec(t);if(Rd(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Jy(o,e)},UE.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},UE.prototype.fromBlob=function(t){return"string"==typeof t?(Rd(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),yy.fromBase64String(t)):(Rd(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),yy.fromUint8Array(t))},UE.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},UE.prototype.fromVersion=function(t){return Rd(!!t,"Trying to deserialize version that isn't set"),Zy.fromTimestamp(this.fromTimestamp(t))},UE.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},UE.prototype.fromResourceName=function(t){var e=Ay.fromString(t);return Rd(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},UE.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},UE.prototype.fromName=function(t){var e=this.fromResourceName(t);return Rd(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Rd(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new My(this.extractLocalPathFromResourceName(e))},UE.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},UE.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Ay.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(UE.prototype,"encodedDatabaseId",{get:function(){return new Ay(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),UE.prototype.fullyQualifiedPrefixPath=function(t){return new Ay(["projects",t.projectId,"databases",t.database])},UE.prototype.extractLocalPathFromResourceName=function(t){return Rd(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},UE.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},UE.prototype.toValue=function(t){if(t instanceof nb)return{nullValue:"NULL_VALUE"};if(t instanceof ob)return{booleanValue:t.value()};if(t instanceof fb)return{integerValue:""+t.value()};if(t instanceof yb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof gb?{stringValue:t.value()}:t instanceof Lb?{mapValue:this.toMapValue(t)}:t instanceof qb?{arrayValue:this.toArrayValue(t)}:t instanceof _b?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Pb?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Nb?{bytesValue:this.toBytes(t.value())}:t instanceof Db?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Dd("Unknown FieldValue "+JSON.stringify(t))},UE.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return nb.INSTANCE;if("booleanValue"in t)return ob.of(t.booleanValue);if("integerValue"in t)return new fb(LE(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return yb.NAN;if("Infinity"===t.doubleValue)return yb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return yb.NEGATIVE_INFINITY}return new yb(t.doubleValue)}if("stringValue"in t)return new gb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){xE(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new qb(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return xE(t.timestampValue,"timestampValue"),new _b(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){xE(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Pb(new B_(r,i))}if("bytesValue"in t){xE(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Nb(o)}if("referenceValue"in t){xE(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new wy(a.get(1),a.get(3)),u=new My(this.extractLocalPathFromResourceName(a));return new Db(s,u)}return Dd("Unknown Value proto "+JSON.stringify(t))},UE.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},UE.prototype.toDocument=function(t){return Rd(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},UE.prototype.fromDocument=function(t,e){return new cv(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},UE.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},UE.prototype.fromFields=function(t){var e=this,n=t,r=Lb.EMPTY;return Wd(n,function(t,n){r=r.set(new Oy([t]),e.fromValue(n))}),r},UE.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},UE.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},UE.prototype.fromFound=function(t){Rd(!!t.found,"Tried to deserialize a found document from a missing document."),xE(t.found.name,"doc.found.name"),xE(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new cv(e,n,r,{},t.found)},UE.prototype.fromMissing=function(t){Rd(!!t.missing,"Tried to deserialize a missing document from a found document."),Rd(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new fv(e,n)},UE.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Dd("invalid batch get response: "+JSON.stringify(t))},UE.prototype.toWatchTargetChangeState=function(t){switch(t){case N_.Added:return"ADD";case N_.Current:return"CURRENT";case N_.NoChange:return"NO_CHANGE";case N_.Removed:return"REMOVE";case N_.Reset:return"RESET";default:return Dd("Unknown WatchTargetChangeState: "+t)}},UE.prototype.toTestWatchChange=function(t){if(t instanceof D_)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof k_){if(t.newDoc instanceof cv){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof fv)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof R_){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return s_.OK;switch(t){case Ld.OK:return s_.OK;case Ld.CANCELLED:return s_.CANCELLED;case Ld.UNKNOWN:return s_.UNKNOWN;case Ld.DEADLINE_EXCEEDED:return s_.DEADLINE_EXCEEDED;case Ld.RESOURCE_EXHAUSTED:return s_.RESOURCE_EXHAUSTED;case Ld.INTERNAL:return s_.INTERNAL;case Ld.UNAVAILABLE:return s_.UNAVAILABLE;case Ld.UNAUTHENTICATED:return s_.UNAUTHENTICATED;case Ld.INVALID_ARGUMENT:return s_.INVALID_ARGUMENT;case Ld.NOT_FOUND:return s_.NOT_FOUND;case Ld.ALREADY_EXISTS:return s_.ALREADY_EXISTS;case Ld.PERMISSION_DENIED:return s_.PERMISSION_DENIED;case Ld.FAILED_PRECONDITION:return s_.FAILED_PRECONDITION;case Ld.ABORTED:return s_.ABORTED;case Ld.OUT_OF_RANGE:return s_.OUT_OF_RANGE;case Ld.UNIMPLEMENTED:return s_.UNIMPLEMENTED;case Ld.DATA_LOSS:return s_.DATA_LOSS;default:return Dd("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Dd("Unrecognized watch change: "+JSON.stringify(t))},UE.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){xE(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new R_(n,r,i,a||null)}else if("documentChange"in t){xE(t.documentChange,"documentChange"),xE(t.documentChange.document,"documentChange.name"),xE(t.documentChange.document.name,"documentChange.document.name"),xE(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new cv(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new k_(f,p,l.key,l)}else if("documentDelete"in t){xE(t.documentDelete,"documentDelete"),xE(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):Zy.forDeletedDoc(),l=new fv(u,c),p=d.removedTargetIds||[],e=new k_([],p,l.key,l)}else if("documentRemove"in t){xE(t.documentRemove,"documentRemove"),xE(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[],e=new k_([],p,u,null)}else{if(!("filter"in t))return Dd("Unknown change type "+JSON.stringify(t));xE(t.filter,"filter"),xE(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new AE(v),b=m.targetId;e=new D_(b,g)}return e},UE.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?N_.NoChange:"ADD"===t?N_.Added:"REMOVE"===t?N_.Removed:"CURRENT"===t?N_.Current:"RESET"===t?N_.Reset:Dd("Got unexpected TargetChange.state: "+t)},UE.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Zy.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Zy.MIN:e.readTime?this.fromVersion(e.readTime):Zy.MIN},UE.prototype.toMutation=function(t){var e,n=this;if(t instanceof Zb)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof uw)e={delete:this.toName(t.key)};else if(t instanceof nw)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof ow))return Dd("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},UE.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):zb.NONE;if(t.update){xE(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new nw(r,i,o,n)}return new Zb(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new uw(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Rd(!0===n.exists,'Transforms only support precondition "exists == true"'),new ow(r,a)}return Dd("unknown mutation proto: "+JSON.stringify(t))},UE.prototype.toPrecondition=function(t){return Rd(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Dd("Unknown precondition")},UE.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?zb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?zb.exists(t.exists):zb.NONE},UE.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Gb(r,i)},UE.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Rd(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},UE.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof bE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof _E)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof TE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof IE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Dd("Unknown transform: "+t.transform)},UE.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Rd("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=bE.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new _E(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new TE(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Rd(i instanceof ub,"NUMERIC_ADD transform requires a NumberValue"),n=new IE(i)}else Dd("Unknown transform proto: "+JSON.stringify(t));var o=Oy.fromServerFormat(t.fieldPath);return new Wb(o,n)},UE.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},UE.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Rd(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return W_.atPath(this.fromQueryPath(n))},UE.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Rd(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Rd(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},UE.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Rd(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new W_(e,i,s,a,u,c,h)},UE.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},UE.prototype.toLabel=function(t){switch(t){case pg.Listen:return null;case pg.ExistenceFilterMismatch:return"existence-filter-mismatch";case pg.LimboResolution:return"limbo-document";default:return Dd("Unrecognized query purpose: "+t)}},UE.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},UE.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof z_?e.toUnaryOrFieldFilter(t):Dd("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},UE.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Dd("Unknown filter: "+JSON.stringify(t)):[]},UE.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},UE.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},UE.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},UE.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new pE(r,n)},UE.prototype.toDirection=function(t){return OE[t.name]},UE.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return lE.ASCENDING;case"DESCENDING":return lE.DESCENDING;default:return}},UE.prototype.toOperatorName=function(t){return PE[t.name]},UE.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Q_.EQUAL;case"GREATER_THAN":return Q_.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Q_.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Q_.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Q_.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Q_.ARRAY_CONTAINS;case"IN":return Q_.IN;case"ARRAY_CONTAINS_ANY":return Q_.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Dd("Unspecified operator");default:return Dd("Unknown operator")}},UE.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},UE.prototype.fromFieldPathReference=function(t){return Oy.fromServerFormat(t.fieldPath)},UE.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},UE.prototype.fromPropertyOrder=function(t){return new yE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},UE.prototype.fromFieldFilter=function(t){return z_.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},UE.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Q_.EQUAL){if(t.value.isEqual(yb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(nb.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},UE.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return z_.create(e,Q_.EQUAL,yb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return z_.create(n,Q_.EQUAL,nb.INSTANCE);case"OPERATOR_UNSPECIFIED":return Dd("Unspecified filter");default:return Dd("Unknown filter")}},UE.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},UE.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Oy.fromServerFormat(t)});return Bb.fromArray(e)},UE);function UE(t,e){this.databaseId=t,this.options=e}var qE=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},VE=(BE.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new qE,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},BE.prototype.unlisten=function(t){return si(this,void 0,void 0,function(){var e,n,r,i;return ui(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},BE.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(r);o.viewSnap=r}}},BE.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},BE.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].applyOnlineStateChange(t)})},BE);function BE(t){this.syncEngine=t,this.queries=new vv(function(t){return t.canonicalId()}),this.onlineState=e_.Unknown,this.syncEngine.subscribe(this)}var jE=(WE.prototype.onViewSnapshot=function(t){if(Rd(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==p_.Metadata&&e.push(i)}t=new __(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},WE.prototype.onError=function(t){this.queryObserver.error(t)},WE.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},WE.prototype.shouldRaiseInitialEvent=function(t,e){if(Rd(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==e_.Offline;return this.options.waitForSyncWhenOnline&&n?(Rd(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===e_.Offline},WE.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},WE.prototype.raiseInitialEvent=function(t){Rd(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=__.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},WE);function WE(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=e_.Unknown,this.options=n||{}}var KE=(QE.fromSnapshot=function(t,e){for(var n=_m(),r=_m(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case p_.Added:n=n.add(a.doc.key);break;case p_.Removed:r=r.add(a.doc.key)}}return new QE(t,n,r)},QE);function QE(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var HE=function(t){this.key=t},GE=function(t){this.key=t},zE=(Object.defineProperty(YE.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),YE.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new b_,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof cv?e:null;h&&(Rd(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:p_.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:p_.Modified,doc:h}),p=!0,u&&0<n.query.docComparator(h,u)&&(s=!0)):!c&&h?(r.track({type:p_.Added,doc:h}),p=!0):c&&!h&&(r.track({type:p_.Removed,doc:c}),p=!0,u&&(s=!0)),p&&(o=h?(a=a.add(h),f?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:p_.Removed,doc:c})}return Rd(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},YE.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},YE.prototype.applyChanges=function(t,e,n){var r=this;Rd(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case p_.Added:return 1;case p_.Modified:case p_.Metadata:return 2;case p_.Removed:return 0;default:return Dd("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?y_.Synced:y_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new __(this.query,t.documentSet,i,o,t.mutatedKeys,s===y_.Local,u,!1),limboChanges:a}:{limboChanges:a}},YE.prototype.applyOnlineStateChange=function(t){return this.current&&t===e_.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new b_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},YE.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},YE.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Rd(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},YE.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=_m(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new GE(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new HE(t))}),n},YE.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=_m();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},YE.prototype.computeInitialSnapshot=function(){return __.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===y_.Local)},YE);function YE(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=_m(),this.mutatedKeys=_m(),this.documentSet=new v_(t.docComparator.bind(t))}var XE="SyncEngine",JE=function(t,e,n){this.query=t,this.targetId=e,this.view=n},$E=function(t){this.key=t,this.receivedDocument=!1},ZE=(Object.defineProperty(tT.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),tT.prototype.subscribe=function(t){Rd(null!==t,"SyncEngine listener cannot be null"),Rd(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},tT.prototype.listen=function(t){return si(this,void 0,void 0,function(){var e,n,r,i,o;return ui(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},tT.prototype.initializeViewAndComputeSnapshot=function(t,e){return si(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return ui(this,function(h){switch(h.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=h.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return i=h.sent(),o=new zE(n,i),a=o.computeDocChanges(r),s=I_.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==e_.Offline),Rd(0===(u=o.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),Rd(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new JE(n,t.targetId,o),this.queryViewsByQuery.set(n,c),this.queryViewsByTarget[t.targetId]=c,[2,u.snapshot]}})})},tT.prototype.synchronizeViewAndComputeSnapshot=function(t){return si(this,void 0,void 0,function(){var e,n,r;return ui(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}})})},tT.prototype.unlisten=function(t){return si(this,void 0,void 0,function(){var e,n=this;return ui(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),Rd(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Bg)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},tT.prototype.write=function(t,e){return si(this,void 0,void 0,function(){var n;return ui(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},tT.prototype.runTransaction=function(t,e){return void 0===e&&(e=5),si(this,void 0,void 0,function(){var n,r,i,o;return ui(this,function(a){switch(a.label){case 0:if(Rd(0<=e,"Got negative number of retries for transaction."),n=this.remoteStore.createTransaction(),Uw(r=t(n))||!r.catch||!r.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,r];case 2:return i=a.sent(),[4,n.commit()];case 3:return a.sent(),[2,i];case 4:return o=a.sent(),0<e&&this.isRetryableTransactionError(o)?[2,this.runTransaction(t,e-1)]:[2,Promise.reject(o)];case 5:return[2]}})})},tT.prototype.applyRemoteEvent=function(t){return si(this,void 0,void 0,function(){var e,n=this;return ui(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),Wd(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Rd(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?r.receivedDocument=!0:0<e.modifiedDocuments.size?Rd(r.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Rd(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Bg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},tT.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===r_.RemoteStore||!this.isPrimary&&e===r_.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Rd(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},tT.prototype.rejectListen=function(t,e){return si(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return ui(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new em(My.comparator)).insert(r,new fv(r,Zy.forDeletedDoc())),o=_m().add(r),a=new T_(Zy.MIN,{},new cm(hy),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return Rd(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then(function(){return u.removeAndCleanupQuery(s)}).catch(Bg)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}})})},tT.prototype.applyBatchState=function(t,e,n){return si(this,void 0,void 0,function(){var r;return ui(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Nd(XE,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Dd("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},tT.prototype.applySuccessfulWrite=function(t){return si(this,void 0,void 0,function(){var e,n;return ui(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Bg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},tT.prototype.rejectFailedWrite=function(t,e){return si(this,void 0,void 0,function(){var n;return ui(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Bg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},tT.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new em(hy)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},tT.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Rd(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},tT.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},tT.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},tT.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof HE?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof GE?(Nd(XE,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Dd("Unknown limbo change: "+JSON.stringify(i))}},tT.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Nd(XE,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=W_.atPath(e.path);this.limboResolutionsByTarget[n]=new $E(e),this.remoteStore.listen(new bg(r,n,pg.LimboResolution,Ey.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},tT.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},tT.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return si(this,void 0,void 0,function(){var n,r,i,o=this;return ui(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=KE.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},tT.prototype.assertSubscribed=function(t){Rd(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},tT.prototype.handleCredentialChange=function(t){return si(this,void 0,void 0,function(){var e,n;return ui(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},tT.prototype.applyPrimaryState=function(t){return si(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return ui(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),jd(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},tT.prototype.resetLimboDocuments=function(){var t=this;jd(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new em(My.comparator)},tT.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return si(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return ui(this,function(h){switch(h.label){case 0:e=[],n=[],r=0,i=t,h.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return h.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=h.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=h.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Rd(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Rd(!!(c=h.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=h.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:h.sent(),h.label=9;case 9:e.push(a),h.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},tT.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!l_(e)},tT.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},tT.prototype.applyTargetState=function(t,e,n){return si(this,void 0,void 0,function(){var r,i,o,a,s;return ui(this,function(u){switch(u.label){case 0:if(this.isPrimary)return Nd(XE,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return u.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=u.sent(),i=T_.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return u.sent(),[3,11];case 4:return function(t){return t.code===Ld.DATA_LOSS&&t.message===_v}(o=u.sent())?(a=[],jd(this.queryViewsByTarget,function(t){return a.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)]):[3,6];case 5:return u.sent(),[3,7];case 6:throw o;case 7:return[3,8];case 8:return s=this.queryViewsByTarget[t],this.removeAndCleanupQuery(s),[4,this.localStore.releaseQuery(s.query,!0)];case 9:return u.sent(),this.syncEngineListener.onWatchError(s.query,n),[3,11];case 10:Dd("Unexpected target state: "+e),u.label=11;case 11:return[2]}})})},tT.prototype.applyActiveTargetsChange=function(t,e){return si(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l=this;return ui(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],Rd(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return Rd(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return ui(this,function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(Bg)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},tT.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},tT.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},tT.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?_m().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:_m()},tT);function tT(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new vv(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new em(My.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new fw,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Vm.forSyncEngine(),this.isPrimary=void 0,this.onlineState=e_.Unknown}var eT=(nT.prototype.isAuthenticated=function(){return null!=this.uid},nT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},nT.prototype.isEqual=function(t){return t.uid===this.uid},nT.UNAUTHENTICATED=new nT(null),nT.GOOGLE_CREDENTIALS=new nT("google-credentials-uid"),nT.FIRST_PARTY=new nT("first-party-uid"),nT);function nT(t){this.uid=t}var rT="SharedClientState",iT="firestore_clients",oT="firestore_mutations",aT="firestore_targets",sT=(uT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Fd(r.error.code,r.error.message)),i?new uT(t,e,r.state,o):(Ad(rT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},uT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},uT);function uT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Rd(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var cT=(hT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Fd(n.error.code,n.error.message)),r?new hT(t,n.state,i):(Ad(rT,"Failed to parse target state for ID '"+t+"': "+e),null)},hT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},hT);function hT(t,e,n){this.targetId=t,this.state=e,Rd(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var lT=(fT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Tm(),o=0;r&&o<n.activeTargetIds.length;++o)r=qw(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new fT(t,i):(Ad(rT,"Failed to parse client data for instance '"+t+"': "+e),null)},fT);function fT(t,e){this.clientId=t,this.activeTargetIds=e}var pT=(dT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in e_&&"string"==typeof e.clientId?new dT(e.clientId,e_[e.onlineState]):(Ad(rT,"Failed to parse online state: "+t),null)},dT);function dT(t,e){this.clientId=t,this.onlineState=e}var yT=(mT.prototype.addQueryTarget=function(t){Rd(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},mT.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},mT.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},mT);function mT(){this.activeTargetIds=Tm()}var vT=(gT.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},gT.prototype.start=function(){return si(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return ui(this,function(f){switch(f.label){case 0:return Rd(!this.started,"WebStorageSharedClientState already started"),Rd(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Rd(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=lT.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},gT.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},gT.prototype.getAllActiveQueryTargets=function(){var t=Tm();return Wd(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},gT.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},gT.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},gT.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},gT.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=cT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},gT.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},gT.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},gT.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},gT.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},gT.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},gT.prototype.setOnlineState=function(t){this.persistOnlineState(t)},gT.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},gT.prototype.getItem=function(t){var e=this.storage.getItem(t);return Nd(rT,"READ",t,e),e},gT.prototype.setItem=function(t,e){Nd(rT,"SET",t,e),this.storage.setItem(t,e)},gT.prototype.removeItem=function(t){Nd(rT,"REMOVE",t),this.storage.removeItem(t)},gT.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Nd(rT,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Ad("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return si(e,void 0,void 0,function(){var e,n,r,i,o,a;return ui(this,function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Rd(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Ey.INVALID;if(null!=t)try{var n=JSON.parse(t);Rd("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Ad(rT,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Ey.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(gT.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),gT.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},gT.prototype.persistMutationState=function(t,e,n){var r=new sT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},gT.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},gT.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:e_[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},gT.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new cT(t,e,n);this.setItem(r,i.toWebStorageJSON())},gT.prototype.toWebStorageClientStateKey=function(t){return Rd(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),iT+"_"+this.persistenceKey+"_"+t},gT.prototype.toWebStorageQueryTargetMetadataKey=function(t){return aT+"_"+this.persistenceKey+"_"+t},gT.prototype.toWebStorageMutationBatchKey=function(t){var e=oT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},gT.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},gT.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Rd(null!==n,"Cannot parse client state key '"+t+"'"),lT.fromWebStorageEntry(n,e)},gT.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Rd(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return sT.fromWebStorageEntry(new eT(i),r,e)},gT.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Rd(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return cT.fromWebStorageEntry(r,e)},gT.prototype.fromWebStorageOnlineState=function(t){return pT.fromWebStorageEntry(t)},gT.prototype.handleMutationBatchEvent=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){return t.user.uid!==this.currentUser.uid?(Nd(rT,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},gT.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},gT.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return si(n,void 0,void 0,function(){return ui(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return si(n,void 0,void 0,function(){return ui(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},gT.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},gT);function gT(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!gT.isAvailable(this.platform))throw new Fd(Ld.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new yT,this.clientStateKeyRe=new RegExp("^"+iT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+oT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+aT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var bT=(wT.prototype.addPendingMutation=function(t){},wT.prototype.updateMutationState=function(t,e,n){},wT.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},wT.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},wT.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},wT.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},wT.prototype.clearQueryState=function(t){delete this.queryState[t]},wT.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},wT.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},wT.prototype.start=function(){return this.localState=new yT,Promise.resolve()},wT.prototype.handleUserChange=function(t,e,n){},wT.prototype.setOnlineState=function(t){},wT.prototype.shutdown=function(){},wT.prototype.writeSequenceNumber=function(t){},wT);function wT(){this.localState=new yT,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var _T="FirestoreClient",ET=(TT.prototype.lruParams=function(){return Ng.withCacheSize(this.cacheSizeBytes)},TT);function TT(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var ST=function(){},IT=(CT.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new Uy,r=new Uy,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},CT.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},CT.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ET?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},CT.prototype.canFallback=function(t){return t instanceof Fd?t.code===Ld.FAILED_PRECONDITION||t.code===Ld.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},CT.prototype.verifyNotShutdown=function(){if(this.asyncQueue.isShuttingDown)throw new Fd(Ld.FAILED_PRECONDITION,"The client has already been shutdown.")},CT.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=qg.buildStoragePrefix(this.databaseInfo),i=new FE(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return si(n,void 0,void 0,function(){var n,o;return ui(this,function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!vT.isAvailable(this.platform))throw new Fd(Ld.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.synchronizeTabs?(this.sharedClientState=new vT(this.asyncQueue,this.platform,r,this.clientId,t),[4,qg.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=a.sent(),[3,4];case 2:return this.sharedClientState=new bT,[4,qg.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent(),a.label=4;case 4:return[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},CT.prototype.startMemoryPersistence=function(){return this.persistence=Nw.createEagerPersistence(this.clientId),this.sharedClientState=new bT,Promise.resolve(null)},CT.prototype.initializeRest=function(t,e){var n=this;return Nd(_T,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return si(n,void 0,void 0,function(){var n,i,o,a,s,u=this;return ui(this,function(c){switch(c.label){case 0:return this.localStore=new mw(this.persistence,t),e&&(this.lruScheduler=new kg(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),i=this.platform.newSerializer(this.databaseInfo.databaseId),o=new Zw(this.asyncQueue,r,this.credentials,i),a=function(t){return u.syncEngine.applyOnlineStateChange(t,r_.RemoteStore)},s=function(t){return u.syncEngine.applyOnlineStateChange(t,r_.SharedClientState)},this.remoteStore=new q_(this.localStore,o,this.asyncQueue,a,n),this.syncEngine=new ZE(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new VE(this.syncEngine),[4,this.sharedClientState.start()];case 1:return c.sent(),[4,this.remoteStore.start()];case 2:return c.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return si(u,void 0,void 0,function(){return ui(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return c.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return si(u,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return c.sent(),[2]}})})})},CT.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Nd(_T,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},CT.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},CT.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return si(t,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},CT.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new jE(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},CT.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},CT.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof cv)return t;if(t instanceof fv)return null;throw new Fd(Ld.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},CT.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=_m(),r=new zE(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},CT.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new Uy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},CT.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(CT.prototype,"clientShutdown",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),CT.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return si(e,void 0,void 0,function(){return ui(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},CT);function CT(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=uy.newId()}var NT=(AT.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},AT.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},AT.prototype.mute=function(){this.muted=!0},AT.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},AT);function AT(t){this.observer=t,this.muted=!1}var kT=(DT.documentId=function(){return DT._DOCUMENT_ID},DT.prototype.isEqual=function(t){if(!(t instanceof DT))throw oy("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},DT._DOCUMENT_ID=new DT(Oy.keyField().canonicalString()),DT);function DT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Fd(Ld.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+sy(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(Yd("FieldPath","string",n,t[n]),0===t[n].length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oy(t)}var RT=new RegExp("[~\\*/\\[\\]]"),OT=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},PT=(MT.prototype.getToken=function(){return Promise.resolve(null)},MT.prototype.invalidateToken=function(){},MT.prototype.setChangeListener=function(t){Rd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(eT.UNAUTHENTICATED)},MT.prototype.removeChangeListener=function(){Rd(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},MT);function MT(){this.changeListener=null}var xT=(LT.prototype.getToken=function(){var t=this;Rd(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new Fd(Ld.ABORTED,"getToken aborted due to token change.");return n?(Rd("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new OT(n.accessToken,t.currentUser)):null})},LT.prototype.invalidateToken=function(){this.forceRefresh=!0},LT.prototype.setChangeListener=function(t){Rd(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},LT.prototype.removeChangeListener=function(){Rd(null!=this.tokenListener,"removeChangeListener() called twice"),Rd(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},LT.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Rd(null===t||"string"==typeof t,"Received invalid UID: "+t),new eT(t)},LT);function LT(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=eT.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var FT=(Object.defineProperty(UT.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),UT);function UT(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=eT.FIRST_PARTY}var qT=(VT.prototype.getToken=function(){return Promise.resolve(new FT(this.gapi,this.sessionIndex))},VT.prototype.setChangeListener=function(t){t(eT.FIRST_PARTY)},VT.prototype.removeChangeListener=function(){},VT.prototype.invalidateToken=function(){},VT);function VT(t,e){this.gapi=t,this.sessionIndex=e}function BT(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var jT=(WT.delete=function(){return Qd("FieldValue.delete",arguments),QT.instance},WT.serverTimestamp=function(){return Qd("FieldValue.serverTimestamp",arguments),zT.instance},WT.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Gd("FieldValue.arrayUnion",arguments,1),new JT(t)},WT.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Gd("FieldValue.arrayRemove",arguments,1),new tS(t)},WT.increment=function(t){return Yd("FieldValue.increment","number",1,t),Hd("FieldValue.increment",arguments,1),new rS(t)},WT.prototype.isEqual=function(t){return this===t},WT);function WT(t){this._methodName=t}var KT,QT=(oi(HT,KT=jT),HT.instance=new HT,HT);function HT(){return KT.call(this,"FieldValue.delete")||this}var GT,zT=(oi(YT,GT=jT),YT.instance=new YT,YT);function YT(){return GT.call(this,"FieldValue.serverTimestamp")||this}var XT,JT=(oi($T,XT=jT),$T);function $T(t){var e=XT.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var ZT,tS=(oi(eS,ZT=jT),eS);function eS(t){var e=ZT.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var nS,rS=(oi(iS,nS=jT),iS);function iS(t){var e=nS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var oS=qd(jT,"Use FieldValue.<field>() instead."),aS=/^__.*__$/,sS=(uS.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new nw(t,this.data,this.fieldMask,e)):n.push(new Zb(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new ow(t,this.fieldTransforms)),n},uS);function uS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var cS,hS,lS=(fS.prototype.toMutations=function(t,e){var n=[new nw(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new ow(t,this.fieldTransforms)),n},fS);function fS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function pS(t){switch(t){case cS.Set:case cS.MergeSet:case cS.Update:return!0;case cS.Argument:return!1;default:throw Dd("Unexpected case for UserDataSource: "+t)}}(hS=cS=cS||{})[hS.Set=0]="Set",hS[hS.Update=1]="Update",hS[hS.MergeSet=2]="MergeSet",hS[hS.Argument=3]="Argument";var dS=(yS.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new yS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},yS.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new yS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},yS.prototype.childContextForArray=function(t){return new yS(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},yS.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Fd(Ld.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},yS.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},yS.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},yS.prototype.validatePathSegment=function(t){if(pS(this.dataSource)&&aS.test(t))throw this.createError("Document fields cannot begin and end with __")},yS);function yS(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var mS=function(t,e){this.databaseId=t,this.key=e},vS=(gS.prototype.parseSetData=function(t,e){var n=new dS(cS.Set,t,Oy.EMPTY_PATH);wS("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new sS(r,null,n.fieldTransforms)},gS.prototype.parseMergeData=function(t,e,n){var r=new dS(cS.MergeSet,t,Oy.EMPTY_PATH);wS("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new cm(Oy.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof kT)l=h._internalPath;else{if("string"!=typeof h)throw Dd("Expected stringOrFieldPath to be a string or a FieldPath");l=ES(t,h)}if(!r.contains(l))throw new Fd(Ld.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Bb.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Bb.fromArray(r.fieldMask),o=r.fieldTransforms;return new sS(a,i,o)},gS.prototype.parseUpdateData=function(t,e){var n=this,r=new dS(cS.Update,t,Oy.EMPTY_PATH);wS("Data must be an object, but it was:",r,e);var i=new cm(Oy.comparator),o=Lb.EMPTY;Wd(e,function(e,a){var s=ES(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof QT)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=Bb.fromSet(i);return new lS(o,a,r.fieldTransforms)},gS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new dS(cS.Update,t,Oy.EMPTY_PATH),o=[_S(t,e)],a=[n];if(r.length%2!=0)throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(_S(t,r[s])),a.push(r[s+1]);var u=new cm(Oy.comparator),c=Lb.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof QT)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Bb.fromSet(u);return new lS(c,d,i.fieldTransforms)},gS.prototype.parseQueryValue=function(t,e){var n=new dS(cS.Argument,t,Oy.EMPTY_PATH),r=this.parseData(e,n);return Rd(null!=r,"Parsed data should not be null."),Rd(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},gS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=TS(t);throw e.createError(n)}},gS.prototype.parseData=function(t,e){if(bS(t=this.runPreConverter(t,e)))return wS("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof jT)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},gS.prototype.parseObject=function(t,e){var n=this,r=new em(hy);return Kd(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):Wd(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Lb(r)},gS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=nb.INSTANCE),n.push(s),r++}return new qb(n)},gS.prototype.parseSentinelFieldValue=function(t,e){if(!pS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof QT){if(e.dataSource!==cS.MergeSet)throw e.dataSource===cS.Update?(Rd(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof zT)e.fieldTransforms.push(new Wb(e.path,bE.instance));else if(t instanceof JT){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new _E(n);e.fieldTransforms.push(new Wb(e.path,r))}else if(t instanceof tS){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new TE(n);e.fieldTransforms.push(new Wb(e.path,i))}else if(t instanceof rS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new IE(o);e.fieldTransforms.push(new Wb(e.path,a))}else Dd("Unknown FieldValue type: "+t)},gS.prototype.parseScalarValue=function(t,e){if(null===t)return nb.INSTANCE;if("number"==typeof t)return qw(t)?new fb(t):new yb(t);if("boolean"==typeof t)return ob.of(t);if("string"==typeof t)return new gb(t);if(t instanceof Date)return new _b(Jy.fromDate(t));if(t instanceof Jy)return new _b(new Jy(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof B_)return new Pb(t);if(t instanceof yy)return new Nb(t);if(t instanceof mS)return new Db(t.databaseId,t.key);throw e.createError("Unsupported field value: "+ny(t))},gS.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new dS(cS.Argument,t,Oy.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},gS);function gS(t){this.preConverter=t}function bS(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Jy||t instanceof B_||t instanceof yy||t instanceof mS||t instanceof jT)}function wS(t,e,n){if(!bS(n)||!ey(n)){var r=ny(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function _S(t,e){if(e instanceof kT)return e._internalPath;if("string"==typeof e)return ES(t,e);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function ES(t,e){try{return function(t){if(0<=t.search(RT))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(kT.bind.apply(kT,[void 0].concat(t.split("."))))}catch(e){throw new Fd(Ld.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=TS(e);throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function TS(t){return t instanceof Error?t.message:t.toString()}var SS=Ng.COLLECTION_DISABLED,IS=(CS.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},CS);function CS(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Fd(Ld.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Jd("settings","non-empty string","host",t.host),this.host=t.host,$d("settings","boolean","ssl",t.ssl),this.ssl=Bd(t.ssl,!0);if(iy("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),$d("settings","object","credentials",t.credentials),this.credentials=t.credentials,$d("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Ad("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Ad("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Bd(t.timestampsInSnapshots,!0),$d("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ng.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==SS&&t.cacheSizeBytes<Ng.MINIMUM_CACHE_SIZE_BYTES)throw new Fd(Ld.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ng.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}$d("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var NS=(AS.prototype.settings=function(t){if(Hd("Firestore.settings",arguments,1),Yd("Firestore.settings","object",1,t),Vd(t,"persistence"))throw new Fd(Ld.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new IS(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Fd(Ld.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new PT;switch(t.type){case"gapi":var e=t.client;return Rd(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new qT(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Fd(Ld.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},AS.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},AS.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},AS.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Fd(Ld.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Ad("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Bd(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new ET(this._settings.cacheSizeBytes,e))},AS.prototype.clearPersistence=function(){var t=this,e=qg.buildStoragePrefix(this.makeDatabaseInfo()),n=new Uy;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return si(t,void 0,void 0,function(){var t;return ui(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new Fd(Ld.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,qg.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},AS.prototype._shutdown=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(AS.prototype,"_isShutdown",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientShutdown},enumerable:!0,configurable:!0}),AS.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new ST),this._firestoreClient},AS.prototype.makeDatabaseInfo=function(){return new gy(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},AS.prototype.configureClient=function(t){Rd(!!this._settings.host,"FirestoreSettings.host is not set"),Rd(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new IT(Od.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},AS.prototype.createDataConverter=function(t){return new vS(function(e){if(e instanceof PS){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new Fd(Ld.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new mS(t,e._key)}return e})},AS.databaseIdFromApp=function(t){var e=t.options;if(!Vd(e,"projectId"))throw new Fd(Ld.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Fd(Ld.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new wy(n)},Object.defineProperty(AS.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Fd(Ld.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),AS.prototype.collection=function(t){return Hd("Firestore.collection",arguments,1),Yd("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new GS(Ay.fromString(t),this)},AS.prototype.doc=function(t){return Hd("Firestore.doc",arguments,1),Yd("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),PS.forPath(Ay.fromString(t),this)},AS.prototype.collectionGroup=function(t){if(Hd("Firestore.collectionGroup",arguments,1),Yd("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new jS(new W_(Ay.EMPTY_PATH,t),this)},AS.prototype.runTransaction=function(t){var e=this;return Hd("Firestore.runTransaction",arguments,1),Yd("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new kS(e,n))})},AS.prototype.batch=function(){return this.ensureClientConfigured(),new RS(this)},Object.defineProperty(AS,"logLevel",{get:function(){switch(Id()){case yd.DEBUG:return"debug";case yd.ERROR:return"error";case yd.SILENT:return"silent";default:return Dd("Unknown log level: "+Id())}},enumerable:!0,configurable:!0}),AS.setLogLevel=function(t){switch(Hd("Firestore.setLogLevel",arguments,1),Yd("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Cd(yd.DEBUG);break;case"error":Cd(yd.ERROR);break;case"silent":Cd(yd.SILENT);break;default:throw new Fd(Ld.INVALID_ARGUMENT,"Invalid log level: "+t)}},AS.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},AS);function AS(t){var e=this;if(this._firebaseApp=null,this._queue=new By,this.INTERNAL={delete:function(){return si(e,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=AS.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new xT(n)}else{var r=t;if(!r.projectId)throw new Fd(Ld.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new wy(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new PT}this._settings=new IS({}),this._dataConverter=this.createDataConverter(this._databaseId)}var kS=(DS.prototype.get=function(t){var e=this;Hd("Transaction.get",arguments,1);var n=$S("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Dd("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof fv)return new FS(e._firestore,n._key,null,!1,!1);if(r instanceof cv)return new FS(e._firestore,n._key,r,!1,!1);throw Dd("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},DS.prototype.set=function(t,e,n){zd("Transaction.set",arguments,2,3);var r=$S("Transaction.set",t,this._firestore),i=(n=YS("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},DS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof kT?(Gd("Transaction.update",arguments,3),r=$S("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Hd("Transaction.update",arguments,2),r=$S("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},DS.prototype.delete=function(t){Hd("Transaction.delete",arguments,1);var e=$S("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},DS);function DS(t,e){this._firestore=t,this._transaction=e}var RS=(OS.prototype.set=function(t,e,n){zd("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=$S("WriteBatch.set",t,this._firestore),i=(n=YS("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,zb.NONE)),this},OS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof kT?(Gd("WriteBatch.update",arguments,3),r=$S("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Hd("WriteBatch.update",arguments,2),r=$S("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,zb.exists(!0))),this},OS.prototype.delete=function(t){Hd("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=$S("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new uw(e._key,zb.NONE)),this},OS.prototype.commit=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},OS.prototype.verifyNotCommitted=function(){if(this._committed)throw new Fd(Ld.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},OS);function OS(t){this._firestore=t,this._mutations=[],this._committed=!1}var PS=(MS.forPath=function(t,e){if(t.length%2!=0)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new MS(new My(t),e)},Object.defineProperty(MS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(MS.prototype,"parent",{get:function(){return new GS(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(MS.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),MS.prototype.collection=function(t){if(Hd("DocumentReference.collection",arguments,1),Yd("DocumentReference.collection","non-empty string",1,t),!t)throw new Fd(Ld.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Ay.fromString(t);return new GS(this._key.path.child(e),this.firestore)},MS.prototype.isEqual=function(t){if(!(t instanceof MS))throw oy("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},MS.prototype.set=function(t,e){zd("DocumentReference.set",arguments,1,2);var n=(e=YS("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,zb.NONE))},MS.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof kT?(Gd("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Hd("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,zb.exists(!0)))},MS.prototype.delete=function(){return Hd("DocumentReference.delete",arguments,0),this._firestoreClient.write([new uw(this._key,zb.NONE)])},MS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zd("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||BT(t[i])||(iy("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),$d("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=BT(t[i])?t[i]:(Yd("DocumentReference.onSnapshot","function",i,t[i]),Xd("DocumentReference.onSnapshot","function",i+1,t[i+1]),Xd("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},MS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new NT({next:function(t){if(e.next){Rd(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new FS(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(W_.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},MS.prototype.get=function(t){var e=this;return zd("DocumentReference.get",arguments,0,1),JS("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new FS(e.firestore,e._key,t,!0,t instanceof cv&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},MS.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Fd(Ld.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Fd(Ld.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},MS);function MS(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var xS=(LS.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},LS);function LS(t,e){this.hasPendingWrites=t,this.fromCache=e}var FS=(US.prototype.data=function(t){return zd("DocumentSnapshot.data",arguments,0,1),t=XS("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,Jg.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},US.prototype.get=function(t,e){if(zd("DocumentSnapshot.get",arguments,1,2),e=XS("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(_S("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Jg.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(US.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(US.prototype,"ref",{get:function(){return new PS(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(US.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(US.prototype,"metadata",{get:function(){return new xS(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),US.prototype.isEqual=function(t){if(!(t instanceof US))throw oy("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},US.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},US.prototype.convertValue=function(t,e){if(t instanceof Lb)return this.convertObject(t,e);if(t instanceof qb)return this.convertArray(t,e);if(t instanceof Db){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Ad("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new PS(n,this._firestore)}return t.value(e)},US.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},US);function US(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var qS,VS=(oi(BS,qS=FS),BS.prototype.data=function(t){var e=qS.prototype.data.call(this,t);return Rd("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},BS);function BS(){return null!==qS&&qS.apply(this,arguments)||this}var jS=(WS.prototype.where=function(t,e,n){Hd("Query.where",arguments,3),ry("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid value "+ny(r)+" provided to function Query.where() for its "+ay(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains"],0,e);var r,i=_S("Query.where",t),o=Q_.fromString(e);if(i.isKeyField()){if(o===Q_.ARRAY_CONTAINS||o===Q_.ARRAY_CONTAINS_ANY)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===Q_.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new qb(a)}else r=this.parseDocumentIdValue(n)}else o!==Q_.IN&&o!==Q_.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=z_.create(i,o,r);return this.validateNewFilter(h),new WS(this._query.addFilter(h),this.firestore)},WS.prototype.orderBy=function(t,e){var n;if(zd("Query.orderBy",arguments,1,2),Xd("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=lE.ASCENDING;else{if("desc"!==e)throw new Fd(Ld.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=lE.DESCENDING}if(null!==this._query.startAt)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=_S("Query.orderBy",t),i=new yE(r,n);return this.validateNewOrderBy(i),new WS(this._query.addOrderBy(i),this.firestore)},WS.prototype.limit=function(t){if(Hd("Query.limit",arguments,1),Yd("Query.limit","number",1,t),t<=0)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new WS(this._query.withLimit(t),this.firestore)},WS.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new WS(this._query.withStartAt(r),this.firestore)},WS.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new WS(this._query.withStartAt(r),this.firestore)},WS.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new WS(this._query.withEndAt(r),this.firestore)},WS.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Gd("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new WS(this._query.withEndAt(r),this.firestore)},WS.prototype.isEqual=function(t){if(!(t instanceof WS))throw oy("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},WS.prototype.boundFromDocOrFields=function(t,e,n,r){if(ry(t,1,e),e instanceof FS){if(0<n.length)throw new Fd(Ld.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Fd(Ld.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},WS.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Db(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Sb)throw new Fd(Ld.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new pE(r,n)},WS.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Fd(Ld.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Ay.fromString(a));if(!My.isDocumentKey(s))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new My(s);i.push(new Db(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new pE(i,n)},WS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zd("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||BT(t[i])||(iy("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),$d("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=BT(t[i])?t[i]:(Yd("Query.onSnapshot","function",i,t[i]),Xd("Query.onSnapshot","function",i+1,t[i+1]),Xd("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},WS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new NT({next:function(t){e.next&&e.next(new KS(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},WS.prototype.get=function(t){var e=this;return zd("Query.get",arguments,0,1),JS("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new KS(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},WS.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Fd(Ld.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},WS.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Ay.fromString(t));if(!My.isDocumentKey(e))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Db(this.firestore._databaseId,new My(e))}if(t instanceof PS){var n=t;return new Db(this.firestore._databaseId,n._key)}throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ny(t)+".")},WS.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},WS.prototype.validateNewFilter=function(t){if(t instanceof z_){var e=[Q_.ARRAY_CONTAINS,Q_.ARRAY_CONTAINS_ANY],n=[Q_.IN,Q_.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},WS.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},WS.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Fd(Ld.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},WS);function WS(t,e){this._query=t,this.firestore=e}var KS=(Object.defineProperty(QS.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(QS.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(QS.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),QS.prototype.forEach=function(t,e){var n=this;zd("QuerySnapshot.forEach",arguments,1,2),Yd("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(QS.prototype,"query",{get:function(){return new jS(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),QS.prototype.docChanges=function(t){t&&(iy("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),$d("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Fd(Ld.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new VS(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return Rd(e.type===p_.Added,"Invalid event type for first snapshot"),Rd(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==p_.Metadata}).map(function(e){var r=new VS(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==p_.Added&&(Rd(0<=(i=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),e.type!==p_.Removed&&(a=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case p_.Added:return"added";case p_.Modified:case p_.Metadata:return"modified";case p_.Removed:return"removed";default:return Dd("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},QS.prototype.isEqual=function(t){if(!(t instanceof QS))throw oy("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},QS.prototype.convertToDocumentImpl=function(t){return new VS(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},QS);function QS(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new xS(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(KS.prototype.docChanges,t,{get:function(){return function(){throw new Fd(Ld.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var HS,GS=(oi(zS,HS=jS),Object.defineProperty(zS.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(zS.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new PS(new My(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(zS.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),zS.prototype.doc=function(t){if(zd("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=uy.newId()),Yd("CollectionReference.doc","non-empty string",1,t),""===t)throw new Fd(Ld.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Ay.fromString(t);return PS.forPath(this._query.path.child(e),this.firestore)},zS.prototype.add=function(t){Hd("CollectionReference.add",arguments,1),Yd("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},zS);function zS(t,e){var n=HS.call(this,W_.atPath(t),e)||this;if(t.length%2!=1)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function YS(t,e){if(void 0===e)return{merge:!1};if(iy(t,e,["merge","mergeFields"]),$d(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+ny(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Fd(Ld.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+ny(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof kT}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Fd(Ld.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function XS(t,e){return void 0===e?{}:(iy(t,e,["serverTimestamps"]),Zd(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function JS(t,e){Xd(t,"object",1,e),e&&(iy(t,e,["source"]),Zd(t,0,"source",e.source,["default","server","cache"]))}function $S(t,e,n){if(e instanceof PS){if(e.firestore!==n)throw new Fd(Ld.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw oy(t,"DocumentReference",1,e)}var ZS=qd(NS,"Use firebase.firestore() instead."),tI=qd(kS,"Use firebase.firestore().runTransaction() instead."),eI=qd(RS,"Use firebase.firestore().batch() instead."),nI=qd(PS,"Use firebase.firestore().doc() instead."),rI=qd(FS),iI=qd(VS),oI=qd(jS),aI=qd(KS),sI=qd(GS,"Use firebase.firestore().collection() instead."),uI={Firestore:ZS,GeoPoint:B_,Timestamp:Jy,Blob:vy,Transaction:tI,WriteBatch:eI,DocumentReference:nI,DocumentSnapshot:rI,Query:oI,QueryDocumentSnapshot:iI,QuerySnapshot:aI,CollectionReference:sI,FieldPath:kT,FieldValue:oS,setLogLevel:NS.setLogLevel,CACHE_SIZE_UNLIMITED:SS},cI=(hI.prototype.addCallback=function(t){},hI.prototype.shutdown=function(){},hI);function hI(){}var lI="ConnectivityMonitor",fI=(pI.prototype.addCallback=function(t){this.callbacks.push(t)},pI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},pI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},pI.prototype.onNetworkAvailable=function(){Nd(lI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},pI.prototype.onNetworkUnavailable=function(){Nd(lI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},pI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},pI);function pI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var dI=(yI.prototype.onOpen=function(t){Rd(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},yI.prototype.onClose=function(t){Rd(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},yI.prototype.onMessage=function(t){Rd(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},yI.prototype.close=function(){this.closeFn()},yI.prototype.send=function(t){this.sendFn(t)},yI.prototype.callOnOpen=function(){Rd(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},yI.prototype.callOnClose=function(t){Rd(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},yI.prototype.callOnMessage=function(t){Rd(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},yI);function yI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var mI="Connection",vI={BatchGetDocuments:"batchGet",Commit:"commit"},gI="gl-js/ fire/"+Td,bI=(wI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=gI},wI.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new Ed;s.listenOnce(wd.COMPLETE,function(){try{switch(s.getLastErrorCode()){case bd.NO_ERROR:var e=s.getResponseJson();Nd(mI,"XHR received:",JSON.stringify(e)),o(e);break;case bd.TIMEOUT:Nd(mI,'RPC "'+t+'" timed out'),a(new Fd(Ld.DEADLINE_EXCEEDED,"Request time out"));break;case bd.HTTP_ERROR:var n=s.getStatus();if(Nd(mI,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=r.status.toLowerCase().replace("_","-");return 0<=Object.values(Ld).indexOf(e)?e:Ld.UNKNOWN}();a(new Fd(i,r.message))}else a(new Fd(Ld.UNKNOWN,"Server responded with status "+s.getStatus()))}else Nd(mI,'RPC "'+t+'" failed'),a(new Fd(Ld.UNAVAILABLE,"Connection failed."));break;default:Dd('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{Nd(mI,'RPC "'+t+'" completed.')}});var u=JSON.stringify(e);Nd(mI,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},wI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},wI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=gd(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Si()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Nd(mI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new dI({sendFn:function(t){c?Nd(mI,"Not sending because WebChannel is closed:",t):(u||(Nd(mI,"Opening WebChannel transport."),s.open(),u=!0),Nd(mI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(_d.EventType.OPEN,function(){c||Nd(mI,"WebChannel transport opened.")}),a(_d.EventType.CLOSE,function(){c||(c=!0,Nd(mI,"WebChannel transport closed"),h.callOnClose())}),a(_d.EventType.ERROR,function(t){c||(c=!0,Nd(mI,"WebChannel transport errored:",t),h.callOnClose(new Fd(Ld.UNAVAILABLE,"The operation could not be completed")))}),a(_d.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Rd(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Nd(mI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=s_[i];if(void 0!==e)return f_(e)}(),a=r.message;void 0===o&&(o=Ld.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Fd(o,a)),s.close()}else Nd(mI,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},wI.prototype.makeUrl=function(t){var e=vI[t];Rd(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},wI);function wI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var _I=(Object.defineProperty(EI.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(EI.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),EI.prototype.loadConnection=function(t){return Promise.resolve(new bI(t))},EI.prototype.newConnectivityMonitor=function(){return fI.isAvailable()?new fI:new cI},EI.prototype.newSerializer=function(t){return new FE(t,{useProto3Json:!0})},EI.prototype.formatJSON=function(t){return JSON.stringify(t)},EI.prototype.atob=function(t){return atob(t)},EI.prototype.btoa=function(t){return btoa(t)},EI);function EI(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Od.setPlatform(new _I),function(t){t.INTERNAL.registerService("firestore",function(t){return new NS(t)},function(t){Rd(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(uI))}(po);var TI,SI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},II=(oi(CI,TI=Error),CI);function CI(t,e,n){var r=TI.call(this,e)||this;return Object.setPrototypeOf(r,CI.prototype),r.code=t,r.details=n,r}var NI=(AI.prototype.getAuthToken=function(){return si(this,void 0,void 0,function(){var t;return ui(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},AI.prototype.getInstanceIdToken=function(){return si(this,void 0,void 0,function(){var t;return ui(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},AI.prototype.getContext=function(){return si(this,void 0,void 0,function(){var t,e;return ui(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},AI);function AI(t){this.app=t}function kI(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var DI=(RI.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return kI(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},RI.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?kI(t,function(t){return e.decode(t)}):t},RI);function RI(){}var OI,PI,MI=(Object.defineProperty(xI.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),xI.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},xI.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},xI.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},xI.prototype.postJSON=function(t,e,n){return si(this,void 0,void 0,function(){var r,i;return ui(this,function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}})})},xI.prototype.call=function(t,e,n){return si(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h;return ui(this,function(l){switch(l.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=l.sent()).authToken&&o.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&o.append("Firebase-Instance-ID-Token",a.instanceIdToken),s=n.timeout||7e4,[4,Promise.race([this.postJSON(r,i,o),function(t){return new Promise(function(e,n){setTimeout(function(){n(new II("deadline-exceeded","deadline-exceeded"))},t)})}(s),this.cancelAllRequests])];case 2:if(!(u=l.sent()))throw new II("cancelled","Firebase Functions instance was deleted.");if(c=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!SI[s])return new II("internal","internal");r=SI[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new II(r,i,o)}(u.status,u.json,this.serializer))throw c;if(!u.json)throw new II("internal","Response is not valid JSON object.");if(void 0===(h=u.json.data)&&(h=u.json.result),void 0===h)throw new II("internal","Response is missing data field.");return[2,{data:this.serializer.decode(h)}]}})})},xI);function xI(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new DI,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new NI(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}OI={Functions:MI},po.INTERNAL.registerService("functions",function(t,e,n){return new MI(t,n)},OI,void 0,!0);var LI,FI,UI,qI,VI=((PI={})["only-available-in-window"]="This method is available in a Window context.",PI["only-available-in-sw"]="This method is available in a service worker context.",PI["should-be-overriden"]="This method should be overriden by extended classes.",PI["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",PI["permission-default"]="The required permissions were not granted and dismissed instead.",PI["permission-blocked"]="The required permissions were not granted and blocked instead.",PI["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",PI["notifications-blocked"]="Notifications have been blocked.",PI["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",PI["sw-registration-expected"]="A service worker registration was the expected input.",PI["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",PI["invalid-saved-token"]="Unable to access details of the saved token.",PI["sw-reg-redundant"]="The service worker being used for push was made redundant.",PI["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",PI["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",PI["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",PI["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",PI["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",PI["token-update-no-token"]="FCM returned no token when updating the user to push.",PI["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",PI["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",PI["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",PI["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",PI["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",PI["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",PI["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",PI["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",PI["failed-to-delete-token"]="Unable to delete the currently saved token.",PI["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",PI["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",PI["bad-scope"]="The service worker scope must be a string with at least one character.",PI["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",PI["bad-subscription"]="The subscription must be a valid PushSubscription.",PI["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",PI["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",PI["failed-delete-vapid-key"]="The VAPID key could not be deleted.",PI["invalid-public-vapid-key"]="The public VAPID key must be a string.",PI["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",PI["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",PI),BI=new ki("messaging","Messaging",VI),jI=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),WI="https://fcm.googleapis.com";function KI(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function QI(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,li(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(FI=LI=LI||{}).TYPE_OF_MSG="firebase-messaging-msg-type",FI.DATA="firebase-messaging-msg-data",(qI=UI=UI||{}).PUSH_MSG_RECEIVED="push-msg-received",qI.NOTIFICATION_CLICKED="notification-clicked";var HI=(GI.prototype.getToken=function(t,e,n){return si(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h,l;return ui(this,function(f){switch(f.label){case 0:r=QI(e.getKey("p256dh")),i=QI(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,KI(n.buffer,jI.buffer)||(a=QI(n),o+="&application_pub_key="+a),(s=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:s,body:o},f.label=1;case 1:return f.trys.push([1,4,,5]),[4,fetch(WI+"/fcm/connect/subscribe",u)];case 2:return[4,f.sent().json()];case 3:return c=f.sent(),[3,5];case 4:throw h=f.sent(),BI.create("token-subscribe-failed",{errorInfo:h});case 5:if(c.error)throw l=c.error.message,BI.create("token-subscribe-failed",{errorInfo:l});if(!c.token)throw BI.create("token-subscribe-no-token");if(!c.pushSet)throw BI.create("token-subscribe-no-push-set");return[2,{token:c.token,pushSet:c.pushSet}]}})})},GI.prototype.updateToken=function(t,e,n,r,i){return si(this,void 0,void 0,function(){var o,a,s,u,c,h,l,f,p;return ui(this,function(d){switch(d.label){case 0:o=QI(r.getKey("p256dh")),a=QI(r.getKey("auth")),s="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+a,KI(i.buffer,jI.buffer)||(u=QI(i),s+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:s},d.label=1;case 1:return d.trys.push([1,4,,5]),[4,fetch(WI+"/fcm/connect/subscribe",h)];case 2:return[4,d.sent().json()];case 3:return l=d.sent(),[3,5];case 4:throw f=d.sent(),BI.create("token-update-failed",{errorInfo:f});case 5:if(l.error)throw p=l.error.message,BI.create("token-update-failed",{errorInfo:p});if(!l.token)throw BI.create("token-update-no-token");return[2,l.token]}})})},GI.prototype.deleteToken=function(t,e,n){return si(this,void 0,void 0,function(){var r,i,o,a,s,u;return ui(this,function(c){switch(c.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,fetch(WI+"/fcm/connect/unsubscribe",o)];case 2:return[4,c.sent().json()];case 3:if((a=c.sent()).error)throw s=a.error.message,BI.create("token-unsubscribe-failed",{errorInfo:s});return[3,5];case 4:throw u=c.sent(),BI.create("token-unsubscribe-failed",{errorInfo:u});case 5:return[2]}})})},GI);function GI(){}function zI(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var YI="undefined",XI="fcm_token_object_Store",JI=($I.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},$I.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},$I.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},$I.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},$I.prototype.closeDatabase=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},$I.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),si(this,void 0,void 0,function(){var n,r,i,o;return ui(this,function(a){switch(a.label){case 0:return[4,this.getDb()];case 1:return n=a.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}(t(i))];case 2:return o=a.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}})})},$I.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},$I);function $I(){this.dbPromise=null}var ZI,tC=(oi(eC,ZI=JI),eC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:!function(){var t=indexedDB.open(YI);t.onerror=function(t){},t.onsuccess=function(e){!function(t){if(t.objectStoreNames.contains(XI)){var e=t.transaction(XI).objectStore(XI),n=new HI,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(YI)}}}(t.result)}}();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=ai({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=zI(e.vapidKey)),"string"==typeof e.auth&&(n.auth=zI(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=zI(e.p256dh).buffer),t.update(n),t.continue()}}}},eC.prototype.getTokenDetailsFromToken=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){if(!t)throw BI.create("bad-token");return nC({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},eC.prototype.getTokenDetailsFromSWScope=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){if(!t)throw BI.create("bad-scope");return nC({swScope:t}),[2,this.get(t)]})})},eC.prototype.saveTokenDetails=function(t){return si(this,void 0,void 0,function(){return ui(this,function(e){if(!t.swScope)throw BI.create("bad-scope");if(!t.vapidKey)throw BI.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw BI.create("bad-subscription");if(!t.fcmSenderId)throw BI.create("bad-sender-id");if(!t.fcmToken)throw BI.create("bad-token");if(!t.fcmPushSet)throw BI.create("bad-push-set");return nC(t),[2,this.put(t)]})})},eC.prototype.deleteToken=function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(BI.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw BI.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},eC);function eC(){var t=null!==ZI&&ZI.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function nC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw BI.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw BI.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw BI.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw BI.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw BI.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw BI.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw BI.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw BI.create("bad-push-set")}var rC,iC=(oi(oC,rC=JI),oC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},oC.prototype.getVapidFromSWScope=function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw BI.create("bad-scope");return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},oC.prototype.saveVapidDetails=function(t,e){return si(this,void 0,void 0,function(){var n;return ui(this,function(r){if("string"!=typeof t||0===t.length)throw BI.create("bad-scope");if(null===e||65!==e.length)throw BI.create("bad-vapid-key");return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},oC.prototype.deleteVapidDetails=function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw BI.create("delete-scope-not-found");return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},oC);function oC(){var t=null!==rC&&rC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var aC="messagingSenderId",sC=(uC.prototype.getToken=function(){return si(this,void 0,void 0,function(){var t,e,n,r,i;return ui(this,function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw BI.create("notifications-blocked");return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}})})},uC.prototype.manageExistingToken=function(t,e,n,r){return si(this,void 0,void 0,function(){return ui(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!KI(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=KI(t.getKey("auth"),n.auth),o=KI(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}})})},uC.prototype.updateToken=function(t,e,n,r){return si(this,void 0,void 0,function(){var i,o,a;return ui(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=s.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return s.sent(),[2,i];case 4:return a=s.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw s.sent(),a;case 6:return[2]}})})},uC.prototype.getNewToken=function(t,e,n){return si(this,void 0,void 0,function(){var r,i;return ui(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}})})},uC.prototype.deleteToken=function(t){return si(this,void 0,void 0,function(){var e,n;return ui(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},uC.prototype.deleteTokenFromDB=function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}})})},uC.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then(function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})})},uC.prototype.requestPermission=function(){throw BI.create("only-available-in-window")},uC.prototype.useServiceWorker=function(t){throw BI.create("only-available-in-window")},uC.prototype.usePublicVapidKey=function(t){throw BI.create("only-available-in-window")},uC.prototype.onMessage=function(t,e,n){throw BI.create("only-available-in-window")},uC.prototype.onTokenRefresh=function(t,e,n){throw BI.create("only-available-in-window")},uC.prototype.setBackgroundMessageHandler=function(t){throw BI.create("only-available-in-sw")},uC.prototype.delete=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},uC.prototype.getNotificationPermission_=function(){return Notification.permission},uC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},uC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},uC.prototype.getIidModel=function(){return this.iidModel},uC);function uC(t){var e=this;if(!t.options[aC]||"string"!=typeof t.options[aC])throw BI.create("bad-sender-id");this.messagingSenderId=t.options[aC],this.tokenDetailsModel=new tC,this.vapidDetailsModel=new iC,this.iidModel=new HI,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var cC,hC="FCM_MSG",lC=(oi(fC,cC=sC),fC.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},fC.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},fC.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},fC.prototype.onPush_=function(t){return si(this,void 0,void 0,function(){var e,n,r,i,o,a;return ui(this,function(s){switch(s.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(s){return[2]}return[4,this.hasVisibleClients_()];case 1:return s.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=s.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return s.sent(),[2];case 5:return[2]}})})},fC.prototype.onSubChange_=function(t){return si(this,void 0,void 0,function(){var t,e,n,r;return ui(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),BI.create("unable-to-resubscribe",{errorInfo:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},fC.prototype.onNotificationClick_=function(t){return si(this,void 0,void 0,function(){var e,n,r,i;return ui(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data[hC]?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data[hC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=dC(UI.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},fC.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=ai({},t.notification);return n.data=ai({},t.notification.data,((e={})[hC]=t,e)),n}},fC.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw BI.create("bg-handler-function-expected");this.bgMessageHandler=t},fC.prototype.getWindowClient_=function(t){return si(this,void 0,void 0,function(){var e,n,r,i;return ui(this,function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,pC()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},fC.prototype.attemptToMessageClient_=function(t,e){return si(this,void 0,void 0,function(){return ui(this,function(n){if(!t)throw BI.create("no-window-client-to-msg");return t.postMessage(e),[2]})})},fC.prototype.hasVisibleClients_=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return[4,pC()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},fC.prototype.sendMessageToWindowClients_=function(t){return si(this,void 0,void 0,function(){var e,n,r=this;return ui(this,function(i){switch(i.label){case 0:return[4,pC()];case 1:return e=i.sent(),n=dC(UI.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},fC.prototype.getSWRegistration_=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return[2,self.registration]})})},fC.prototype.getPublicVapidKey_=function(){return si(this,void 0,void 0,function(){var t,e;return ui(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw BI.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,jI]:[2,e]}})})},fC);function fC(t){var e=cC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function pC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function dC(t,e){var n;return(n={})[LI.TYPE_OF_MSG]=t,n[LI.DATA]=e,n}var yC,mC,vC=(oi(gC,yC=sC),gC.prototype.getToken=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return si(this,void 0,void 0,function(){var t,e;return ui(this,function(n){switch(n.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,n.sent().json()];case 3:return e=n.sent(),[3,5];case 4:return n.sent(),[2];case 5:if(!e||!e.gcm_sender_id)return[2];if("103953800507"!==e.gcm_sender_id)throw BI.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,yC.prototype.getToken.call(this)]}})})},gC.prototype.requestPermission=function(){return si(this,void 0,void 0,function(){var t;return ui(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?BI.create("permission-blocked"):BI.create("permission-default")}})})},gC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw BI.create("sw-registration-expected");if(null!=this.registrationToUse)throw BI.create("use-sw-before-get-token");this.registrationToUse=t},gC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw BI.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw BI.create("use-public-key-before-get-token");var e=zI(t);if(65!==e.length)throw BI.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},gC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},gC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},gC.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(BI.create("sw-reg-redundant"))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(BI.create("sw-reg-redundant"));else n(t);else r(BI.create("no-sw-in-reg"))})},gC.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw BI.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},gC.prototype.getPublicVapidKey_=function(){return si(this,void 0,void 0,function(){return ui(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,jI]})})},gC.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[LI.TYPE_OF_MSG]){var n=e.data;switch(n[LI.TYPE_OF_MSG]){case UI.PUSH_MSG_RECEIVED:case UI.NOTIFICATION_CLICKED:var r=n[LI.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},gC);function gC(t){var e=yC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Bi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Bi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function bC(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}mC={isSupported:bC},po.INTERNAL.registerService("messaging",function(t){if(!bC())throw BI.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new lC(t):new vC(t)},mC);var wC="firebasestorage.googleapis.com",_C="storageBucket",EC=(TC.prototype.codeProp=function(){return this.code},TC.prototype.codeEquals=function(t){return IC(t)===this.codeProp()},TC.prototype.serverResponseProp=function(){return this.serverResponse_},TC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(TC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(TC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(TC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(TC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),TC);function TC(t,e){this.code_=IC(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var SC={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function IC(t){return"storage/"+t}function CC(){return new EC(SC.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function NC(){return new EC(SC.CANCELED,"User canceled the upload/download.")}function AC(){return new EC(SC.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function kC(t,e,n){return new EC(SC.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function DC(){return new EC(SC.APP_DELETED,"The Firebase app was deleted.")}function RC(t,e){return new EC(SC.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function OC(t){throw new EC(SC.INTERNAL_ERROR,"Internal error: "+t)}var PC={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function MC(t){switch(t){case PC.RAW:case PC.BASE64:case PC.BASE64URL:case PC.DATA_URL:return;default:throw"Expected one of the event types: ["+PC.RAW+", "+PC.BASE64+", "+PC.BASE64URL+", "+PC.DATA_URL+"]."}}var xC=function(t,e){this.data=t,this.contentType=e||null};function LC(t,e){switch(t){case PC.RAW:return new xC(FC(e));case PC.BASE64:case PC.BASE64URL:return new xC(UC(t,e));case PC.DATA_URL:return new xC(function(t){var e=new BC(t);return e.base64?UC(PC.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw RC(PC.DATA_URL,"Malformed data URL.")}return FC(e)}(e.rest)}(e),new BC(e).contentType)}throw CC()}function FC(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function UC(t,e){switch(t){case PC.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw RC(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case PC.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw RC(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw RC(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var qC,VC,BC=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw RC(PC.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)},jC={STATE_CHANGED:"state_changed"},WC="running",KC="pausing",QC="paused",HC="success",GC="canceling",zC="canceled",YC="error",XC={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function JC(t){switch(t){case WC:case KC:case GC:return XC.RUNNING;case QC:return XC.PAUSED;case HC:return XC.SUCCESS;case zC:return XC.CANCELED;case YC:default:return XC.ERROR}}function $C(t){return null!=t}function ZC(t){return void 0!==t}function tN(t){return"function"==typeof t}function eN(t){return"object"==typeof t}function nN(t){return"string"==typeof t||t instanceof String}function rN(t){return"number"==typeof t||t instanceof Number}function iN(t){return oN()&&t instanceof Blob}function oN(){return"undefined"!=typeof Blob}(VC=qC=qC||{})[VC.NO_ERROR=0]="NO_ERROR",VC[VC.NETWORK_ERROR=1]="NETWORK_ERROR",VC[VC.ABORT=2]="ABORT";var aN=(sN.prototype.send=function(t,e,n,r){if(this.sent_)throw OC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),$C(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return $C(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},sN.prototype.getErrorCode=function(){if(!this.sent_)throw OC("cannot .getErrorCode() before sending");return this.errorCode_},sN.prototype.getStatus=function(){if(!this.sent_)throw OC("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},sN.prototype.getResponseText=function(){if(!this.sent_)throw OC("cannot .getResponseText() before sending");return this.xhr_.responseText},sN.prototype.abort=function(){this.xhr_.abort()},sN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},sN.prototype.addUploadProgressListener=function(t){$C(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},sN.prototype.removeUploadProgressListener=function(t){$C(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},sN);function sN(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=qC.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=qC.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=qC.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}var uN=(cN.prototype.createXhrIo=function(){return new aN},cN);function cN(){}function hN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(oN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var lN=(fN.prototype.size=function(){return this.size_},fN.prototype.type=function(){return this.type_},fN.prototype.slice=function(t,e){if(iN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new fN(n)}return new fN(new Uint8Array(this.data_.buffer,t,e-t),!0)},fN.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(oN()){var n=t.map(function(t){return t instanceof fN?t.data_:t});return new fN(hN.apply(null,n))}var r=t.map(function(t){return nN(t)?LC(PC.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new fN(o,!0)},fN.prototype.uploadData=function(){return this.data_},fN);function fN(t,e){var n=0,r="";iN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var pN=(Object.defineProperty(dN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(dN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),dN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},dN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},dN.makeFromBucketSpec=function(t){var e;try{e=dN.makeFromUrl(t)}catch(e){return new dN(t,"")}if(""===e.path)return e;throw function(t){return new EC(SC.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(t)},dN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=wC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new dN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new EC(SC.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},dN);function dN(t,e){this.bucket=t,this.path_=e}function yN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return eN(t)&&!Array.isArray(t)}(e)?e:null}function mN(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function vN(t){return"https://"+wC+"/v0"+t}function gN(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}function bN(t,e){return e}var wN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||bN},_N=null;function EN(t,e,n){var r=yN(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new pN(n,r);return e.makeStorageReference(i)}})}(r,t),r}(t,r,n)}function TN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function SN(t){if(!eN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!eN(n))throw"Expected object for 'customMetadata' mapping."}else if(eN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var IN="maxResults",CN=1e3,NN="pageToken",AN="prefixes",kN="items";function DN(t){if(!eN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===IN){if(!rN(n=t[IN])||!Number.isInteger(n)||t[IN]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[IN])throw"Expected maxResults to be less than or equal to "+CN+"."}else{if(e!==NN)throw"Unknown option: "+e;if(t[NN]&&!nN(t[NN]))throw"Expected pageToken to be string."}var n}var RN=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function ON(t){if(!t)throw CC()}function PN(t,e){return function(n,r){var i=EN(t,r,e);return ON(null!==i),i}}function MN(t){return function(e,n){var r=function(t,e){var n=yN(e);return null===n?null:function(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new EC(SC.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_C+"' property when initializing the app?");if(e[AN])for(var i=0,o=e[AN];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new pN(r,a));n.prefixes.push(s)}if(e[kN])for(var u=0,c=e[kN];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new pN(r,h.name)),n.items.push(s)}return n}(t,n)}(t,n);return ON(null!==r),r}}function xN(t,e){return function(n,r){var i=EN(t,r,e);return ON(null!==i),function(t,e){var n=yN(e);if(null===n)return null;if(!nN(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return vN("/b/"+i(n)+"/o/"+i(r))+gN({alt:"media",token:e})})[0]}(i,r)}}function LN(t){return function(e,n){var r;return(r=401===e.getStatus()?new EC(SC.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(t){return new EC(SC.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(t.bucket):403===e.getStatus()?function(t){return new EC(SC.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(t.path):n).setServerResponseProp(n.serverResponseProp()),r}}function FN(t){var e=LN(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=function(t){return new EC(SC.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(t.path)),i.setServerResponseProp(r.serverResponseProp()),i}}function UN(t,e,n){var r=vN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new RN(r,"GET",PN(t,n),i);return o.errorHandler=FN(e),o}function qN(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var VN=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function BN(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){ON(!1)}return ON(!!n&&-1!==(e||["active"]).indexOf(n)),n}var jN=function(t,e,n){if(tN(t)||$C(e)||$C(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},WN=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function KN(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new EC(SC.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,t,n.length);for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?kC(o,t,e.message):kC(o,t,e)}}var QN=function(t,e){var n=this;this.validator=function(e){n.optional&&!ZC(e)||t(e)},this.optional=!!e};function HN(t,e){function n(t){if(!nN(t))throw"Expected string."}var r;return r=t?function(t,e){return function(n){t(n),e(n)}}(n,t):n,new QN(r,e)}function GN(t){return new QN(SN,t)}function zN(){return new QN(function(t){if(!(rN(t)&&0<=t))throw"Expected a number 0 or greater."})}function YN(t,e){return new QN(function(e){if(!(null===e||$C(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function XN(t){return new QN(function(t){if(null!==t&&!tN(t))throw"Expected a Function."},t)}function JN(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var $N=(ZN.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},ZN.prototype.shouldDoResumable_=function(t){return 262144<t.size()},ZN.prototype.start_=function(){this.state_===WC&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},ZN.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case WC:t(n);break;case GC:e.transition_(zC);break;case KC:e.transition_(QC)}})},ZN.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=qN(e,r,i),s={name:a.fullPath},u=vN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=TN(a,n),l=t.maxUploadRetryTime(),f=new RN(u,"POST",function(t){var e;BN(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){ON(!1)}return ON(nN(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=LN(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},ZN.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new RN(n,"POST",function(t){var e=BN(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){ON(!1)}n||ON(!1);var i=Number(n);return ON(!isNaN(i)),new VN(i,r.size(),"final"===e)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=LN(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);(t.request_=i).getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},ZN.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new VN(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=function(t,e,n,r,i,o,a,s){var u=new VN(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new EC(SC.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;0<i&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw AC();var y=e.maxUploadRetryTime(),m=new RN(n,"POST",function(t,n){var i,a=BN(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?PN(e,o)(t,n):null,new VN(s,c,"final"===a,i)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=s||null,m.errorHandler=LN(t),m}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(i){return t.error_=i,void t.transition_(YC)}var a=t.authWrapper_.makeRequest(o,i);(t.request_=a).getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(HC)):t.completeTransitions_()},t.errorHandler_)})},ZN.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},ZN.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=UN(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(HC)},t.metadataErrorHandler_)})},ZN.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=qN(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+TN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=lN.getBlob(c,r,h);if(null===l)throw AC();var f={name:u.fullPath},p=vN(o),d=t.maxUploadRetryTime(),y=new RN(p,"POST",PN(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=LN(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(HC)},t.errorHandler_)})},ZN.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},ZN.prototype.transition_=function(t){if(this.state_!==t)switch(t){case GC:case KC:this.state_=t,null!==this.request_&&this.request_.cancel();break;case WC:var e=this.state_===QC;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case QC:this.state_=t,this.notifyObservers_();break;case zC:this.error_=NC(),this.state_=t,this.notifyObservers_();break;case YC:case HC:this.state_=t,this.notifyObservers_()}},ZN.prototype.completeTransitions_=function(){switch(this.state_){case KC:this.transition_(QC);break;case GC:this.transition_(zC);break;case WC:this.start_()}},Object.defineProperty(ZN.prototype,"snapshot",{get:function(){var t=JC(this.state_);return new WN(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),ZN.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=XN(!0).validator,a=YN(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(ZC(t.next)||ZC(t.error)||ZC(t.complete)))throw"";return}catch(t){throw i}}KN("on",[HN(function(){if(t!==jC.STATE_CHANGED)throw"Expected one of the event types: ["+jC.STATE_CHANGED+"]."}),YN(s,!0),XN(!0),XN(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&KN("on",t,arguments);var o=new jN(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[YN(function(t){if(null===t)throw i;s(t)}),XN(!0),XN(!0)];return ZC(e)||ZC(n)||ZC(r)?c(null)(e,n,r):c(h)},ZN.prototype.then=function(t,e){return this.promise_.then(t,e)},ZN.prototype.catch=function(t){return this.then(null,t)},ZN.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},ZN.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},ZN.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach(function(e){t.notifyObserver_(e)})},ZN.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(JC(this.state_)){case XC.SUCCESS:JN(this.resolve_.bind(null,this.snapshot))();break;case XC.CANCELED:case XC.ERROR:JN(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},ZN.prototype.notifyObserver_=function(t){switch(JC(this.state_)){case XC.RUNNING:case XC.PAUSED:t.next&&JN(t.next.bind(t,this.snapshot))();break;case XC.SUCCESS:t.complete&&JN(t.complete.bind(t))();break;case XC.CANCELED:case XC.ERROR:t.error&&JN(t.error.bind(t,this.error_))();break;default:t.error&&JN(t.error.bind(t,this.error_))()}},ZN.prototype.resume=function(){KN("resume",[],arguments);var t=this.state_===QC||this.state_===KC;return t&&this.transition_(WC),t},ZN.prototype.pause=function(){KN("pause",[],arguments);var t=this.state_===WC;return t&&this.transition_(KC),t},ZN.prototype.cancel=function(){KN("cancel",[],arguments);var t=this.state_===WC||this.state_===KC;return t&&this.transition_(GC),t},ZN);function ZN(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=WC,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(SC.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(YC))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(SC.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(YC))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var tA=(eA.prototype.toString=function(){return KN("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},eA.prototype.newRef=function(t,e){return new eA(t,e)},eA.prototype.mappings=function(){return function(){if(_N)return _N;var t=[];t.push(new wN("bucket")),t.push(new wN("generation")),t.push(new wN("metageneration")),t.push(new wN("name","fullPath",!0));var e=new wN("name");e.xform=function(t,e){return function(t){return!nN(t)||t.length<2?t:mN(t)}(e)},t.push(e);var n=new wN("size");return n.xform=function(t,e){return $C(e)?Number(e):e},t.push(n),t.push(new wN("timeCreated")),t.push(new wN("updated")),t.push(new wN("md5Hash",null,!0)),t.push(new wN("cacheControl",null,!0)),t.push(new wN("contentDisposition",null,!0)),t.push(new wN("contentEncoding",null,!0)),t.push(new wN("contentLanguage",null,!0)),t.push(new wN("contentType",null,!0)),t.push(new wN("metadata","customMetadata",!0)),_N=t}()},eA.prototype.child=function(t){KN("child",[HN()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new pN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(eA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new pN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(eA.prototype,"root",{get:function(){var t=new pN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(eA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(eA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(eA.prototype,"name",{get:function(){return mN(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(eA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),eA.prototype.put=function(t,e){return void 0===e&&(e=null),KN("put",[new QN(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||oN()&&t instanceof Blob))throw"Expected Blob or File."}),GN(!0)],arguments),this.throwIfRoot_("put"),new $N(this,this.authWrapper,this.location,this.mappings(),new lN(t),e)},eA.prototype.putString=function(t,e,n){void 0===e&&(e=PC.RAW),KN("putString",[HN(),HN(MC,!0),GN(!0)],arguments),this.throwIfRoot_("putString");var r=LC(e,t),i=Object.assign({},n);return!$C(i.contentType)&&$C(r.contentType)&&(i.contentType=r.contentType),new $N(this,this.authWrapper,this.location,this.mappings(),new lN(r.data,!0),i)},eA.prototype.delete=function(){var t=this;return KN("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=vN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new RN(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=FN(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},eA.prototype.listAll=function(){KN("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},eA.prototype.listAllHelper=function(t,e){return si(this,void 0,void 0,function(){var n,r,i,o;return ui(this,function(a){switch(a.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=a.sent(),(i=t.prefixes).push.apply(i,r.prefixes),(o=t.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},eA.prototype.list=function(t){KN("list",[new QN(DN,!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=t||{},i=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",0<"/".length&&(o.delimiter="/"),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=vN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new RN(a,"GET",MN(t),s);return u.urlParams=o,u.errorHandler=LN(e),u}(e.authWrapper,e.location,0,r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()})},eA.prototype.getMetadata=function(){var t=this;return KN("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(e){var n=UN(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},eA.prototype.updateMetadata=function(t){var e=this;return KN("updateMetadata",[GN()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=vN(e.fullServerUrl()),o=TN(n,r),a=t.maxOperationRetryTime(),s=new RN(i,"PATCH",PN(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=FN(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},eA.prototype.getDownloadURL=function(){var t=this;return KN("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e,n){var r=vN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new RN(r,"GET",xN(t,n),i);return o.errorHandler=FN(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new EC(SC.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},eA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new EC(SC.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},eA);function eA(t,e){this.authWrapper=t,this.location=e instanceof pN?e:pN.makeFromUrl(e)}var nA=(rA.prototype.getPromise=function(){return this.promise_},rA.prototype.cancel=function(t){},rA);function rA(t){this.promise_=Promise.reject(t)}var iA=(oA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},oA.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},oA);function oA(){this.map=new Map,this.id=-9007199254740991}var aA=(sA.extractBucket_=function(t){var e=t[_C]||null;return null==e?null:pN.makeFromBucketSpec(e).bucket},sA.prototype.getAuthToken=function(){return null!==this.app_&&$C(this.app_.INTERNAL)&&$C(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},sA.prototype.bucket=function(){if(this.deleted_)throw DC();return this.bucket_},sA.prototype.service=function(){return this.service_},sA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},sA.prototype.makeRequest=function(t,e){if(this.deleted_)return new nA(DC());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},sA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},sA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},sA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},sA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},sA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},sA);function sA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;$C(o)&&(this.bucket_=sA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new iA}var uA=(cA.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());ZC(s)?i(s):i()}catch(e){o(e)}else null!==a?((r=CC()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?DC():NC()):o(r=new EC(SC.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new hA(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout(function(){i=null,t(l,s())},e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},n),p}(function(e,n){if(n)e(!1,new hA(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===qC.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new hA(a,n))}else{var s=n.getErrorCode()===qC.ABORT;e(!1,new hA(!1,null,s))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},cA.prototype.getPromise=function(){return this.promise_},cA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},cA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},cA);function cA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var hA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function lA(t,e,n){var r=gN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==po?po.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new uA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var fA=(pA.prototype.ref=function(t){if(KN("ref",[HN(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new tA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},pA.prototype.refFromURL=function(t){return KN("refFromURL",[HN(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{pN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new tA(this.authWrapper_,t)},Object.defineProperty(pA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),pA.prototype.setMaxUploadRetryTime=function(t){KN("setMaxUploadRetryTime",[zN()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},pA.prototype.setMaxOperationRetryTime=function(t){KN("setMaxOperationRetryTime",[zN()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(pA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(pA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),pA);function pA(t,e,n){if(this.bucket_=null,this.authWrapper_=new aA(t,function(t,e){return new tA(t,e)},lA,this,e),this.app_=t,null!=n)this.bucket_=pN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new pN(r,""))}this.internals_=new yA(this)}var dA,yA=(mA.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},mA);function mA(t){this.service_=t}function vA(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function gA(t,e,n){var r,i=new Promise(function(i,o){vA(r=t[e].apply(t,n)).then(i,o)});return i.request=r,i}function bA(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function wA(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return gA(this[e],r,arguments)})})}function _A(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function EA(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return function(t,e,n){var r=gA(t,e,n);return r.then(function(t){if(t)return new SA(t,r.request)})}(this[e],r,arguments)})})}function TA(t){this._index=t}function SA(t,e){this._cursor=t,this._request=e}function IA(t){this._store=t}function CA(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function NA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new CA(n)}function AA(t){this._db=t}dA={TaskState:XC,TaskEvent:jC,StringFormat:PC,Storage:fA,Reference:tA},po.INTERNAL.registerService("storage",function(t,e,n){return new fA(t,new uN,n)},dA,void 0,!0),bA(TA,"_index",["name","keyPath","multiEntry","unique"]),wA(TA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),EA(TA,"_index",IDBIndex,["openCursor","openKeyCursor"]),bA(SA,"_cursor",["direction","key","primaryKey","value"]),wA(SA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(SA.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,n),vA(e._request).then(function(t){if(t)return new SA(t,e._request)})})})}),IA.prototype.createIndex=function(){return new TA(this._store.createIndex.apply(this._store,arguments))},IA.prototype.index=function(){return new TA(this._store.index.apply(this._store,arguments))},bA(IA,"_store",["name","keyPath","indexNames","autoIncrement"]),wA(IA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),EA(IA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),_A(IA,"_store",IDBObjectStore,["deleteIndex"]),CA.prototype.objectStore=function(){return new IA(this._tx.objectStore.apply(this._tx,arguments))},bA(CA,"_tx",["objectStoreNames","mode"]),_A(CA,"_tx",IDBTransaction,["abort"]),NA.prototype.createObjectStore=function(){return new IA(this._db.createObjectStore.apply(this._db,arguments))},bA(NA,"_db",["name","version","objectStoreNames"]),_A(NA,"_db",IDBDatabase,["deleteObjectStore","close"]),AA.prototype.transaction=function(){return new CA(this._db.transaction.apply(this._db,arguments))},bA(AA,"_db",["name","version","objectStoreNames"]),_A(AA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[IA,TA].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[TA,IA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})});var kA,DA=1e4,RA="w:0.2.4",OA="FIS_v2",PA="https://firebaseinstallations.googleapis.com/v1",MA=36e5,xA=((kA={})["missing-app-config-values"]="Missing App configuration values.",kA["create-installation-failed"]="Could not register Firebase Installation.",kA["generate-token-failed"]="Could not generate Auth Token.",kA["not-registered"]="Firebase Installation is not registered.",kA["installation-not-found"]="Firebase Installation not found.",kA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',kA["app-offline"]="Could not process request. Application offline.",kA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",kA),LA=new ki("installations","Installations",xA);function FA(t){return t instanceof Ni&&t.code.includes("request-failed")}function UA(t){if(!t||!t.options)throw LA.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw LA.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function qA(t){var e=t.projectId;return PA+"/projects/"+e+"/installations"}function VA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function BA(t,e){return si(this,void 0,void 0,function(){var n,r;return ui(this,function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,LA.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}})})}function jA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function WA(t,e){var n=e.refreshToken,r=jA(t);return r.append("Authorization",OA+" "+n),r}function KA(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return 500<=(e=n.sent()).status&&e.status<600?[2,t()]:[2,e]}})})}function QA(t){return new Promise(function(e){setTimeout(e,t)})}var HA=/^[cdef][\w-]{21}$/,GA="";function zA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,li(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return HA.test(e)?e:GA}catch(t){return GA}}var YA="firebase-installations-database",XA=1,JA="firebase-installations-store",$A=null;function ZA(){return $A=$A||function(t,e,n){var r=gA(indexedDB,"open",[YA,XA]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new NA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new AA(t)})}(0,0,function(t){switch(t.oldVersion){case 0:t.createObjectStore(JA)}})}function tk(t,e){return si(this,void 0,void 0,function(){var n,r,i;return ui(this,function(o){switch(o.label){case 0:return n=rk(t),[4,ZA()];case 1:return r=o.sent(),[4,(i=r.transaction(JA,"readwrite")).objectStore(JA).put(e,n)];case 2:return o.sent(),[4,i.complete];case 3:return o.sent(),[2,e]}})})}function ek(t){return si(this,void 0,void 0,function(){var e,n,r;return ui(this,function(i){switch(i.label){case 0:return e=rk(t),[4,ZA()];case 1:return n=i.sent(),[4,(r=n.transaction(JA,"readwrite")).objectStore(JA).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function nk(t,e){return si(this,void 0,void 0,function(){var n,r,i,o,a,s;return ui(this,function(u){switch(u.label){case 0:return n=rk(t),[4,ZA()];case 1:return r=u.sent(),i=r.transaction(JA,"readwrite"),[4,(o=i.objectStore(JA)).get(n)];case 2:return a=u.sent(),(s=e(a))===a?[2,s]:void 0!==s?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),[2,s]}})})}function rk(t){return t.appName+"!"+t.appId}function ik(t){return si(this,void 0,void 0,function(){var e,n,r;return ui(this,function(i){switch(i.label){case 0:return[4,nk(t,function(n){var r=function(t){var e=t||{fid:zA(),registrationStatus:0};return ak(e)?{fid:e.fid,registrationStatus:0}:e}(n),i=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return[4,ok(t)];case 1:e=n.sent(),n.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,QA(100)];case 3:return n.sent(),[4,ok(t)];case 4:return e=n.sent(),[3,2];case 5:if(0===e.registrationStatus)throw LA.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(LA.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=function(t,e){return si(this,void 0,void 0,function(){var n,r;return ui(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,function(t,n){var r=e.fid;return si(this,void 0,void 0,function(){var e,n,i,o,a,s;return ui(this,function(u){switch(u.label){case 0:return e=qA(t),n=jA(t),i={fid:r,authVersion:OA,appId:t.appId,sdkVersion:RA},o={method:"POST",headers:n,body:JSON.stringify(i)},[4,KA(function(){return fetch(e,o)})];case 1:return(a=u.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,{fid:(s=u.sent()).fid||r,registrationStatus:2,refreshToken:s.refreshToken,authToken:VA(s.authToken)}];case 3:return[4,BA("Create Installation",a)];case 4:throw u.sent()}})})}(t)];case 1:return n=i.sent(),[2,tk(t,n)];case 2:return FA(r=i.sent())&&409===r.serverCode?[4,ek(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,tk(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}})})}(t,n);return{installationEntry:n,registrationPromise:r}}(t,r);return e=i.registrationPromise,i.installationEntry})];case 1:return(n=i.sent()).fid!==GA?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}})})}function ok(t){return nk(t,function(t){if(!t)throw LA.create("installation-not-found");return ak(t)?{fid:t.fid,registrationStatus:0}:t})}function ak(t){return 1===t.registrationStatus&&t.registrationTime+DA<Date.now()}function sk(t,e){return si(this,void 0,void 0,function(){var n,r,i,o,a;return ui(this,function(s){switch(s.label){case 0:return n=function(t,n){var r=e.fid;return qA(t)+"/"+r+"/authTokens:generate"}(t),r=WA(t,e),i={installation:{sdkVersion:RA}},o={method:"POST",headers:r,body:JSON.stringify(i)},[4,KA(function(){return fetch(n,o)})];case 1:return(a=s.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,VA(s.sent())];case 3:return[4,BA("Generate Auth Token",a)];case 4:throw s.sent()}})})}function uk(t){return si(this,void 0,void 0,function(){var e,n,r;return ui(this,function(i){switch(i.label){case 0:return[4,nk(t,function(n){if(!hk(n))throw LA.create("not-registered");var r=n.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+MA}(t)}(r))return n;if(1===r.requestStatus)return e=function(t){return si(this,void 0,void 0,function(){var e,n;return ui(this,function(r){switch(r.label){case 0:return[4,ck(t)];case 1:e=r.sent(),r.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,QA(100)];case 3:return r.sent(),[4,ck(t)];case 4:return e=r.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw LA.create("generate-token-failed");return[2,n]}})})}(t),n;if(!navigator.onLine)throw LA.create("app-offline");var i=function(t){var e={requestStatus:1,requestTime:Date.now()};return ai({},t,{authToken:e})}(n);return e=function(t,e){return si(this,void 0,void 0,function(){var n,r,i;return ui(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,sk(t,e)];case 1:return n=o.sent(),i=ai({},e,{authToken:n}),[4,tk(t,i)];case 2:return o.sent(),[2,n];case 3:return!FA(r=o.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,ek(t)];case 4:return o.sent(),[3,7];case 5:return i=ai({},e,{authToken:{requestStatus:0}}),[4,tk(t,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}})})}(t,i),i})];case 1:return n=i.sent(),e?[4,e]:[3,3];case 2:return r=i.sent(),[3,4];case 3:r=n.authToken,i.label=4;case 4:return[2,r.token]}})})}function ck(t){return nk(t,function(t){if(!hk(t))throw LA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+DA<Date.now()}(t.authToken)?ai({},t,{authToken:{requestStatus:0}}):t})}function hk(t){return void 0!==t&&2===t.registrationStatus}function lk(t,e){return si(this,void 0,void 0,function(){var n,r,i,o;return ui(this,function(a){switch(a.label){case 0:return n=function(t,n){var r=e.fid;return qA(t)+"/"+r}(t),r=WA(t,e),i={method:"DELETE",headers:r},[4,KA(function(){return fetch(n,i)})];case 1:return(o=a.sent()).ok?[3,3]:[4,BA("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}})})}po.INTERNAL.registerService("installations",function(t){return UA(t),{app:t,getId:function(){return function(t){return si(this,void 0,void 0,function(){var e,n,r,i;return ui(this,function(o){switch(o.label){case 0:return[4,ik(e=UA(t))];case 1:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&uk(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return function(t){return si(this,void 0,void 0,function(){var e;return ui(this,function(n){switch(n.label){case 0:return[4,function(t){return si(this,void 0,void 0,function(){var e,n,r;return ui(this,function(i){switch(i.label){case 0:return[4,ik(t)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return i.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw LA.create("create-installation-failed");i.label=4;case 4:return[2]}})})}(e=UA(t))];case 1:return n.sent(),[2,uk(e)]}})})}(t)},delete:function(){return function(t){return si(this,void 0,void 0,function(){var e,n;return ui(this,function(r){switch(r.label){case 0:return[4,nk(e=UA(t),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw LA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw LA.create("app-offline");case 3:return[4,lk(e,n)];case 4:return r.sent(),[4,ek(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}(t)}}});var fk,pk,dk,yk,mk="0.2.15",vk="FB-PERF-TRACE-MEASURE",gk="@firebase/performance/config",bk="@firebase/performance/configexpire",wk="Performance",_k=((fk={})["trace started"]="Trace {$traceName} was started before.",fk["trace stopped"]="Trace {$traceName} is not running.",fk["no window"]="Window is not available.",fk["no app id"]="App id is not available.",fk["no project id"]="Project id is not available.",fk["no api key"]="Api key is not available.",fk["invalid cc log"]="Attempted to queue invalid cc event",fk["FB not default"]="Performance can only start when Firebase app instance is the default one.",fk["RC response not ok"]="RC response is not ok",fk),Ek=new ki("performance",wk,_k),Tk=(Sk.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},Sk.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},Sk.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},Sk.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},Sk.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},Sk.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},Sk.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},Sk.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}}).observe({entryTypes:[t]})},Sk.getInstance=function(){return void 0===pk&&(pk=new Sk(dk)),pk},Sk);function Sk(t){if(!t)throw Ek.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var Ik,Ck,Nk,Ak=(kk.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Ek.create("no app id");return t},kk.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Ek.create("no project id");return t},kk.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Ek.create("no api key");return t},kk.getInstance=function(){return void 0===yk&&(yk=new kk),yk},kk);function kk(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function Dk(){return Ik}function Rk(){switch(Tk.getInstance().document.visibilityState){case"visible":return Ck.VISIBLE;case"hidden":return Ck.HIDDEN;case"prerender":return Ck.PRERENDER;default:return Ck.UNKNOWN}}(Nk=Ck=Ck||{})[Nk.UNKNOWN=0]="UNKNOWN",Nk[Nk.VISIBLE=1]="VISIBLE",Nk[Nk.HIDDEN=2]="HIDDEN",Nk[Nk.PRERENDER=3]="PRERENDER",Nk[Nk.UNLOADED=4]="UNLOADED";var Ok=new eo(wk);Ok.logLevel=ji.INFO;var Pk="0.0.1",Mk={loggingEnabled:!0},xk="FIREBASE_INSTALLATIONS_AUTH",Lk="Could not fetch config, will use default configs";function Fk(t){if(!t)return t;var e=Ak.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=Mk.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Uk(e.tracesSamplingRate),e.logNetworkAfterSampling=Uk(e.networkRequestsSamplingRate),t}function Uk(t){return Math.random()<=t}var qk,Vk=1;function Bk(){return Vk=2,qk=qk||function(){var t=Tk.getInstance().document;return new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})}().then(function(){return function(){var t=Ak.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){Ik=t}),t}()}).then(function(t){return function(t){var e=function(){var t=Tk.getInstance().localStorage,e=t.getItem(bk);if(e&&Number(e)>Date.now()){var n=t.getItem(gk);if(n)try{return JSON.parse(n)}catch(t){return}}}();return e?(Fk(e),Promise.resolve()):function(t){return function(){var t=Ak.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Ak.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Ak.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:xk+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:Ak.getInstance().getAppId(),app_version:mk,sdk_version:Pk})});return fetch(r).then(function(t){if(t.ok)return t.json();throw Ek.create("RC response not ok")})}).catch(function(){Ok.info(Lk)})}(t).then(function(t){return Fk(t)}).then(function(t){return function(t){if(t){var e=Tk.getInstance().localStorage;e.setItem(gk,JSON.stringify(t)),e.setItem(bk,String(Date.now()+60*Ak.getInstance().configTimeToLive*60*1e3))}}(t)},function(){})}(t)}).then(function(){return jk()},function(){return jk()})}function jk(){Vk=3}var Wk,Kk=3,Qk=[];function Hk(){if(Wk)return Wk;var t=function(t){return function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];!function(t){if(!t.eventTime||!t.message)throw Ek.create("invalid cc log");Qk=Qk.concat([t])}({message:t.apply(void 0,r),eventTime:Date.now()})}}(Yk);return(Wk=new eo("@firebase/performance/cc")).logHandler=t,Wk}function Gk(t){var e=Ak.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Tk.getInstance().requiredApisAvailable()&&(t.isAuto&&Rk()!==Ck.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===Vk?zk(t):Bk().then(function(){return zk(t)},function(){return zk(t)})))}function zk(t){Dk()&&setTimeout(function(){return Hk().log(t,1)},0)}function Yk(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:Xk(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=Jk(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=Jk(n));var r={application_info:Xk(),trace_metric:e};return JSON.stringify(r)}(t)}function Xk(){return{google_app_id:Ak.getInstance().getAppId(),app_instance_id:Dk(),web_app_info:{sdk_version:mk,page_url:Tk.getInstance().getUrl(),service_worker_status:function(){var t=Tk.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:Rk(),effective_connection_type:function(){var t=Tk.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function Jk(t){return Object.keys(t).map(function(e){return{key:e,value:t[e]}})}!function t(e){setTimeout(function(){if(0!==Kk){if(!Qk.length)return t(1e4);var e=Qk.slice();Qk=[];var n=e.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Ak.getInstance().logSource,log_event:n};fetch(Ak.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then(function(t){return t.ok||Ok.info("Call to Firebase backend failed."),t.json()}).then(function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?1e4:Math.max(1e4,n);Kk=3,t(r)}).catch(function(){Qk=e.concat(Qk),Kk--,Ok.info("Tries left: "+Kk+"."),t(1e4)})}},e)}(5500);var $k=(Zk.prototype.start=function(){if(1!==this.state)throw Ek.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},Zk.prototype.stop=function(){if(2!==this.state)throw Ek.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Gk(this)},Zk.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=ai({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}Gk(this)},Zk.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&(this.counters[t]=0),this.counters[t]+=e},Zk.prototype.putMetric=function(t,e){this.counters[t]=e},Zk.prototype.getMetric=function(t){return this.counters[t]||0},Zk.prototype.putAttribute=function(t,e){this.customAttributes[t]=e},Zk.prototype.getAttribute=function(t){return this.customAttributes[t]},Zk.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},Zk.prototype.getAttributes=function(){return ai({},this.customAttributes)},Zk.prototype.setStartTime=function(t){this.startTimeUs=t},Zk.prototype.setDuration=function(t){this.durationUs=t},Zk.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},Zk.createOobTrace=function(t,e,n){var r=Tk.getInstance().getUrl();if(r){var i=new Zk("_wt_"+r,!0),o=Math.floor(1e3*Tk.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.incrementMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.incrementMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.incrementMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.incrementMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.incrementMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.incrementMetric("_fid",Math.floor(1e3*n))}Gk(i)}},Zk.createUserTimingTrace=function(t){Gk(new Zk(t,!1,t))},Zk);function Zk(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Tk.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||vk+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function tD(t){var e=t;if(e&&void 0!==e.responseStart){var n=Tk.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=Ak.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return Hk().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var eD=5e3;function nD(){Dk()&&(setTimeout(function(){return function(){var t=Tk.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){$k.createOobTrace(e,n),r=void 0},eD);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),$k.createOobTrace(e,n,t))})}else $k.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Tk.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)tD(n[e]);t.setupObserver("resource",tD)}()},0),setTimeout(function(){return function(){for(var t=Tk.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)rD(n[e]);t.setupObserver("measure",rD)}()},0))}function rD(t){var e=t.name;e.substring(0,vk.length)!==vk&&$k.createUserTimingTrace(e)}var iD=(oD.prototype.trace=function(t){return new $k(t)},Object.defineProperty(oD.prototype,"instrumentationEnabled",{get:function(){return Ak.getInstance().instrumentationEnabled},set:function(t){Ak.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(oD.prototype,"dataCollectionEnabled",{get:function(){return Ak.getInstance().dataCollectionEnabled},set:function(t){Ak.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),oD);function oD(t){this.app=t,Tk.getInstance().requiredApisAvailable()?Bk().then(nD,nD):Ok.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return po.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw Ek.create("FB not default");if("undefined"==typeof window)throw Ek.create("no window");return function(t){dk=t}(window),Ak.getInstance().firebaseAppInstance=t,new iD(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),po}()}).call(this,n(27),n(128).setImmediate,n(61))},128:function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(129),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(27))},129:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},h=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},f.clearImmediate=p}function p(t){delete c[t]}function d(t){if(h)setTimeout(d,0,t);else{var e=c[t];if(e){h=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{p(t),h=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(27),n(61))}}]);