(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{123:function(t,e,n){(function(e,n,r){t.exports=function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),p(t)},d.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),p(t)},d.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),p(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(t,e){return new Promise((function(n,i){var o=new w(t,e),a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:function(t){var e=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e}(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new E(e,t))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),a.send(void 0===o._bodyInit?null:o._bodyInit)}))},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}function o(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){return e.reject(n)}))}))}var a=setTimeout;function s(t){return Boolean(t&&void 0!==t.length)}function u(){}function c(t){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],y(t,this)}function h(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,c._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(n){return void f(e.promise,n)}l(e.promise,r)}else(1===t._state?l:f)(e.promise,t._value)}))):t._deferreds.push(e)}function l(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof c)return t._state=3,t._value=e,void p(t);if("function"==typeof n)return void y(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,p(t)}catch(e){f(t,e)}}function f(t,e){t._state=2,t._value=e,p(t)}function p(t){2===t._state&&0===t._deferreds.length&&c._immediateFn((function(){t._handled||c._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)h(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function y(t,e){var n=!1;try{t((function(t){n||(n=!0,l(e,t))}),(function(t){n||(n=!0,f(e,t))}))}catch(t){if(n)return;n=!0,f(e,t)}}c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var n=new this.constructor(u);return h(this,new d(t,e,n)),n},c.prototype.finally=o,c.all=function(t){return new c((function(e,n){if(!s(t))return n(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(e){o(t,e)}),n)}r[t]=a,0==--i&&e(r)}catch(a){n(a)}}for(var a=0;a<r.length;a++)o(a,r[a])}))},c.resolve=function(t){return t&&"object"==typeof t&&t.constructor===c?t:new c((function(e){e(t)}))},c.reject=function(t){return new c((function(e,n){n(t)}))},c.race=function(t){return new c((function(e,n){if(!s(t))return n(new TypeError("Promise.race accepts an array"));for(var r=0,i=t.length;r<i;r++)c.resolve(t[r]).then(e,n)}))},c._immediateFn="function"==typeof n&&function(t){n(t)}||function(t){a(t,0)},c._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var m=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();function v(t){return t&&t.Math==Math&&t}function g(t){try{return!!t()}catch(t){return!0}}function b(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function w(t){return V.call(t).slice(8,-1)}function _(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function E(t){return j(_(t))}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function S(t,e){if(!T(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!T(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function I(t,e){return W.call(t,e)}function C(t){return K?Q.createElement(t):{}}function N(t){if(!T(t))throw TypeError(String(t)+" is not an object");return t}function A(t,e){try{J(x,t,e)}catch(n){x[t]=e}return e}function k(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++rt+it).toString(36)}function D(t){return ot[t]||(ot[t]=k(t))}"Promise"in m?m.Promise.prototype.finally||(m.Promise.prototype.finally=o):m.Promise=c;var R,O,P,M="object",x=v(typeof globalThis==M&&globalThis)||v(typeof window==M&&window)||v(typeof self==M&&self)||v(typeof t==M&&t)||Function("return this")(),L=!g((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),F={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,q={f:U&&!F.call({1:2},1)?function(t){var e=U(this,t);return!!e&&e.enumerable}:F},V={}.toString,B="".split,j=g((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==w(t)?B.call(t,""):Object(t)}:Object,W={}.hasOwnProperty,Q=x.document,K=T(Q)&&T(Q.createElement),H=!L&&!g((function(){return 7!=Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a})),G=Object.getOwnPropertyDescriptor,z={f:L?G:function(t,e){if(t=E(t),e=S(e,!0),H)try{return G(t,e)}catch(t){}if(I(t,e))return b(!q.f.call(t,e),t[e])}},Y=Object.defineProperty,X={f:L?Y:function(t,e,n){if(N(t),e=S(e,!0),N(n),H)try{return Y(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},J=L?function(t,e,n){return X.f(t,e,b(1,n))}:function(t,e,n){return t[e]=n,t},$=!1,Z=i((function(t){var e="__core-js_shared__",n=x[e]||A(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.2.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),tt=Z("native-function-to-string",Function.toString),et=x.WeakMap,nt="function"==typeof et&&/native code/.test(tt.call(et)),rt=0,it=Math.random(),ot=Z("keys"),at={},st=x.WeakMap;if(nt){var ut=new st,ct=ut.get,ht=ut.has,lt=ut.set;R=function(t,e){return lt.call(ut,t,e),e},O=function(t){return ct.call(ut,t)||{}},P=function(t){return ht.call(ut,t)}}else{var ft=D("state");at[ft]=!0,R=function(t,e){return J(t,ft,e),e},O=function(t){return I(t,ft)?t[ft]:{}},P=function(t){return I(t,ft)}}function pt(t){return"function"==typeof t?t:void 0}function dt(t,e){return arguments.length<2?pt(Rt[t])||pt(x[t]):Rt[t]&&Rt[t][e]||x[t]&&x[t][e]}function yt(t){return isNaN(t=+t)?0:(0<t?Pt:Ot)(t)}function mt(t){return 0<t?Mt(yt(t),9007199254740991):0}function vt(t){return function(e,n,r){var i,o=E(e),a=mt(o.length),s=function(t,e){var n=yt(t);return n<0?xt(n+e,0):Lt(n,e)}(r,a);if(t&&n!=n){for(;s<a;)if((i=o[s++])!=i)return!0}else for(;s<a;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}function gt(t,e){var n,r=E(t),i=0,o=[];for(n in r)!I(at,n)&&I(r,n)&&o.push(n);for(;e.length>i;)I(r,n=e[i++])&&(~Ft(o,n)||o.push(n));return o}function bt(t,e){for(var n=jt(e),r=X.f,i=z.f,o=0;o<n.length;o++){var a=n[o];I(t,a)||r(t,a,i(e,a))}}function wt(t,e){var n=Kt[Qt(t)];return n==Gt||n!=Ht&&("function"==typeof e?g(e):!!e)}function _t(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?x:c?x[s]||A(s,{}):(x[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Yt(n,r))&&a.value:n[r],!zt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;bt(o,i)}(t.sham||i&&i.sham)&&J(o,"sham",!0),Dt(n,r,o,t)}}function Et(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Tt(t,e,n){if(Et(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}function St(t){return Object(_(t))}function It(t){return Zt[t]||(Zt[t]=Jt&&$t[t]||(Jt?$t:k)("Symbol."+t))}function Ct(t,e){var n;return Xt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Xt(n.prototype)?T(n)&&null===(n=n[te])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Nt(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=5==t||o;return function(s,u,c,h){for(var l,f,p=St(s),d=j(p),y=Tt(u,c,3),m=mt(d.length),v=0,g=h||Ct,b=e?g(s,m):n?g(s,0):void 0;v<m;v++)if((a||v in d)&&(f=y(l=d[v],v,p),t))if(e)b[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:ee.call(b,l)}else if(i)return!1;return o?-1:r||i?i:b}}function At(){}var kt={set:R,get:O,has:P,enforce:function(t){return P(t)?O(t):R(t,{})},getterFor:function(t){return function(e){var n;if(!T(e)||(n=O(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Dt=i((function(t){var e=kt.get,n=kt.enforce,r=String(tt).split("toString");Z("inspectSource",(function(t){return tt.call(t)})),(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||I(i,"name")||J(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==x?(a?!u&&t[e]&&(s=!0):delete t[e],s?t[e]=i:J(t,e,i)):s?t[e]=i:A(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||tt.call(this)}))})),Rt=x,Ot=Math.ceil,Pt=Math.floor,Mt=Math.min,xt=Math.max,Lt=Math.min,Ft=(vt(!0),vt(!1)),Ut=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qt=Ut.concat("length","prototype"),Vt={f:Object.getOwnPropertyNames||function(t){return gt(t,qt)}},Bt={f:Object.getOwnPropertySymbols},jt=dt("Reflect","ownKeys")||function(t){var e=Vt.f(N(t)),n=Bt.f;return n?e.concat(n(t)):e},Wt=/#|\.prototype\./,Qt=wt.normalize=function(t){return String(t).replace(Wt,".").toLowerCase()},Kt=wt.data={},Ht=wt.NATIVE="N",Gt=wt.POLYFILL="P",zt=wt,Yt=z.f,Xt=Array.isArray||function(t){return"Array"==w(t)},Jt=!!Object.getOwnPropertySymbols&&!g((function(){return!String(Symbol())})),$t=x.Symbol,Zt=Z("wks"),te=It("species"),ee=[].push,ne={forEach:Nt(0),map:Nt(1),filter:Nt(2),some:Nt(3),every:Nt(4),find:Nt(5),findIndex:Nt(6)},re=Object.keys||function(t){return gt(t,Ut)},ie=L?Object.defineProperties:function(t,e){N(t);for(var n,r=re(e),i=r.length,o=0;o<i;)X.f(t,n=r[o++],e[n]);return t},oe=dt("document","documentElement"),ae=D("IE_PROTO"),se="prototype",ue=function(){var t,e=C("iframe"),n=Ut.length;for(e.style.display="none",oe.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ue=t.F;n--;)delete ue[se][Ut[n]];return ue()},ce=Object.create||function(t,e){var n;return null!==t?(At[se]=N(t),n=new At,At[se]=null,n[ae]=t):n=ue(),void 0===e?n:ie(n,e)};at[ae]=!0;var he=It("unscopables"),le=Array.prototype;function fe(t){le[he][t]=!0}null==le[he]&&J(le,he,ce(null));var pe=ne.find,de="find",ye=!0;function me(t,e,n){return Tt(ve,x[t].prototype[e],n)}de in[]&&Array(1)[de]((function(){ye=!1})),_t({target:"Array",proto:!0,forced:ye},{find:function(t,e){return pe(this,t,1<arguments.length?e:void 0)}}),fe(de);var ve=Function.call,ge=(me("Array","find"),ne.findIndex),be="findIndex",we=!0;function _e(t){return function(e,n){var r,i,o=String(_(e)),a=yt(n),s=o.length;return a<0||s<=a?t?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(i=o.charCodeAt(a+1))<56320||57343<i?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}be in[]&&Array(1)[be]((function(){we=!1})),_t({target:"Array",proto:!0,forced:we},{findIndex:function(t,e){return ge(this,t,1<arguments.length?e:void 0)}}),fe(be),me("Array","findIndex");var Ee,Te,Se,Ie={codeAt:_e(!1),charAt:_e(!0)},Ce=!g((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Ne=D("IE_PROTO"),Ae=Object.prototype,ke=Ce?Object.getPrototypeOf:function(t){return I(t=St(t),Ne)?t[Ne]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ae:null},De=It("iterator"),Re=!1;function Oe(t,e,n){t&&!I(t=n?t:t.prototype,Ue)&&Fe(t,Ue,{configurable:!0,value:e})}function Pe(){return this}function Me(){return this}function xe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!We&&t in p)return p[t];switch(t){case"keys":case Ke:case He:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ce(Ve,{next:b(1,n)}),Oe(t,r,!1),qe[r]=Pe}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Qe]||p["@@iterator"]||i&&p[i],y=!We&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=ke(m.call(new t)),je!==Object.prototype&&u.next&&(ke(u)!==je&&(Be?Be(u,je):"function"!=typeof u[Qe]&&J(u,Qe,Me)),Oe(u,l,!0))),i==Ke&&d&&d.name!==Ke&&(f=!0,y=function(){return d.call(this)}),p[Qe]!==y&&J(p,Qe,y),qe[e]=y,i)if(c={values:s(Ke),keys:o?y:s("keys"),entries:s(He)},a)for(h in c)!We&&!f&&h in p||Dt(p,h,c[h]);else _t({target:e,proto:!0,forced:We||f},c);return c}[].keys&&("next"in(Se=[].keys())?(Te=ke(ke(Se)))!==Object.prototype&&(Ee=Te):Re=!0),null==Ee&&(Ee={}),I(Ee,De)||J(Ee,De,(function(){return this}));var Le={IteratorPrototype:Ee,BUGGY_SAFARI_ITERATORS:Re},Fe=X.f,Ue=It("toStringTag"),qe={},Ve=Le.IteratorPrototype,Be=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(n){}return function(n,r){return N(n),function(t){if(!T(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),je=Le.IteratorPrototype,We=Le.BUGGY_SAFARI_ITERATORS,Qe=It("iterator"),Ke="values",He="entries",Ge=Ie.charAt,ze="String Iterator",Ye=kt.set,Xe=kt.getterFor(ze);function Je(t,e,n,r){try{return r?e(N(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&N(i.call(t)),e}}function $e(t){return void 0!==t&&(qe.Array===t||rn[nn]===t)}function Ze(t,e,n){var r=S(e);r in t?X.f(t,r,b(0,n)):t[r]=n}function tn(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),on))?n:an?w(e):"Object"==(r=w(e))&&"function"==typeof e.callee?"Arguments":r}function en(t){if(null!=t)return t[sn]||t["@@iterator"]||qe[tn(t)]}xe(String,"String",(function(t){Ye(this,{type:ze,string:String(t),index:0})}),(function(){var t,e=Xe(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ge(n,r),e.index+=t.length,{value:t,done:!1})}));var nn=It("iterator"),rn=Array.prototype,on=It("toStringTag"),an="Arguments"==w(function(){return arguments}()),sn=It("iterator"),un=It("iterator"),cn=!1;try{var hn=0,ln={next:function(){return{done:!!hn++}},return:function(){cn=!0}};ln[un]=function(){return this},Array.from(ln,(function(){throw 2}))}catch(Zo){}function fn(t,e){if(!e&&!cn)return!1;var n=!1;try{var r={};r[un]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}_t({target:"Array",stat:!0,forced:!fn((function(t){Array.from(t)}))},{from:function(t,e,n){var r,i,o,a,s=St(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=en(s);if(l&&(h=Tt(h,2<c?n:void 0,2)),null==p||u==Array&&$e(p))for(i=new u(r=mt(s.length));f<r;f++)Ze(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Ze(i,f,l?Je(a,h,[o.value,f],!0):o.value);return i.length=f,i}}),Rt.Array.from;var pn,dn=ne.some;_t({target:"Array",proto:!0,forced:(pn=[].some,!pn||!g((function(){pn.call(null,(function(){throw 1}),1)})))},{some:function(t,e){return dn(this,t,1<arguments.length?e:void 0)}}),me("Array","some");var yn,mn=X.f,vn=x.DataView,gn=vn&&vn.prototype,bn=x.Int8Array,wn=bn&&bn.prototype,_n=x.Uint8ClampedArray,En=_n&&_n.prototype,Tn=bn&&ke(bn),Sn=wn&&ke(wn),In=Object.prototype,Cn=(In.isPrototypeOf,It("toStringTag")),Nn=k("TYPED_ARRAY_TAG"),An=!(!x.ArrayBuffer||!vn),kn=An&&!!Be&&"Opera"!==tn(x.opera),Dn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(yn in Dn)x[yn]||(kn=!1);if((!kn||"function"!=typeof Tn||Tn===Function.prototype)&&(Tn=function(){throw TypeError("Incorrect invocation")},kn))for(yn in Dn)x[yn]&&Be(x[yn],Tn);if((!kn||!Sn||Sn===In)&&(Sn=Tn.prototype,kn))for(yn in Dn)x[yn]&&Be(x[yn].prototype,Sn);if(kn&&ke(En)!==Sn&&Be(En,Sn),L&&!I(Sn,Cn))for(yn in mn(Sn,Cn,{get:function(){return T(this)?this[Nn]:void 0}}),Dn)x[yn]&&J(x[yn],Nn,yn);An&&Be&&ke(gn)!==In&&Be(gn,In);var Rn="Array Iterator",On=kt.set,Pn=kt.getterFor(Rn),Mn=xe(Array,"Array",(function(t,e){On(this,{type:Rn,target:E(t),index:0,kind:e})}),(function(){var t=Pn(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");function xn(){return Un.call(Bn(this))}qe.Arguments=qe.Array,fe("keys"),fe("values"),fe("entries");var Ln=It("iterator"),Fn=x.Uint8Array,Un=Mn.values,qn=Mn.keys,Vn=Mn.entries,Bn=function(t){if(function(t){return T(t)&&I(Dn,tn(t))}(t))return t;throw TypeError("Target is not a typed array")},jn=function(t,e,n){if(L){if(n)for(var r in Dn){var i=x[r];i&&I(i.prototype,t)&&delete i.prototype[t]}Sn[t]&&!n||Dt(Sn,t,n?e:kn&&wn[t]||e)}},Wn=Fn&&Fn.prototype[Ln],Qn=!!Wn&&("values"==Wn.name||null==Wn.name);jn("entries",(function(){return Vn.call(Bn(this))})),jn("keys",(function(){return qn.call(Bn(this))})),jn("values",xn,!Qn),jn(Ln,xn,!Qn);var Kn=Object.assign,Hn=!Kn||g((function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Kn({},t)[n]||re(Kn({},e)).join("")!=r}))?function(t,e){for(var n=St(t),r=arguments.length,i=1,o=Bt.f,a=q.f;i<r;)for(var s,u=j(arguments[i++]),c=o?re(u).concat(o(u)):re(u),h=c.length,l=0;l<h;)s=c[l++],L&&!a.call(u,s)||(n[s]=u[s]);return n}:Kn;function Gn(t){return function(e){for(var n,r=E(e),i=re(r),o=i.length,a=0,s=[];a<o;)n=i[a++],L&&!zn.call(r,n)||s.push(t?[n,r[n]]:r[n]);return s}}_t({target:"Object",stat:!0,forced:Object.assign!==Hn},{assign:Hn}),Rt.Object.assign;var zn=q.f,Yn={entries:Gn(!0),values:Gn(!1)},Xn=Yn.entries;_t({target:"Object",stat:!0},{entries:function(t){return Xn(t)}}),Rt.Object.entries;var Jn=Yn.values;function $n(t){if(function(t){var e;return T(t)&&(void 0!==(e=t[Zn])?!!e:"RegExp"==w(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}_t({target:"Object",stat:!0},{values:function(t){return Jn(t)}}),Rt.Object.values;var Zn=It("match"),tr=It("match"),er="".startsWith,nr=Math.min;function rr(t){if(!T(t))return!1;var e=t[or];return void 0!==e?!!e:Xt(t)}_t({target:"String",proto:!0,forced:!function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[tr]=!1,"/./"[t](e)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(_(this));$n(t);var r=mt(nr(1<arguments.length?e:void 0,n.length)),i=String(t);return er?er.call(n,i,r):n.slice(r,r+i.length)===i}}),me("String","startsWith"),_t({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(_(this)),n="",r=yt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),me("String","repeat");var ir=It("species"),or=It("isConcatSpreadable"),ar=9007199254740991,sr="Maximum allowed index exceeded",ur=!g((function(){var t=[];return t[or]=!1,t.concat()[0]!==t})),cr=!g((function(){var t=[];return(t.constructor={})[ir]=function(){return{foo:1}},1!==t.concat(Boolean).foo}));_t({target:"Array",proto:!0,forced:!ur||!cr},{concat:function(t){var e,n,r,i,o,a=St(this),s=Ct(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(rr(o=-1===e?a:arguments[e])){if(i=mt(o.length),ar<u+i)throw TypeError(sr);for(n=0;n<i;n++,u++)n in o&&Ze(s,u,o[n])}else{if(ar<=u)throw TypeError(sr);Ze(s,u++,o)}return s.length=u,s}});var hr={};hr[It("toStringTag")]="z";var lr="[object z]"!==String(hr)?function(){return"[object "+tn(this)+"]"}:hr.toString,fr=Object.prototype;function pr(t){var e=Rt.Symbol||(Rt.Symbol={});I(e,t)||Tr(e,t,{value:Er.f(t)})}function dr(t,e){var n=qr[t]=ce(Or[Nr]);return kr(n,{type:Cr,tag:t,description:e}),L||(n.description=e),n}function yr(t,e){N(t);var n=E(e),r=re(n).concat(Xr(n));return Sr(r,(function(e){L&&!Yr.call(n,e)||zr(t,e,n[e])})),t}function mr(t,e){var n=E(t),r=S(e,!0);if(n!==Rr||!I(qr,r)||I(Vr,r)){var i=xr(n,r);return!i||!I(qr,r)||I(n,Ir)&&n[Ir][r]||(i.enumerable=!0),i}}function vr(t){var e=Fr(E(t)),n=[];return Sr(e,(function(t){I(qr,t)||I(at,t)||n.push(t)})),n}lr!==fr.toString&&Dt(fr,"toString",lr,{unsafe:!0});var gr=Vt.f,br={}.toString,wr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],_r={f:function(t){return wr&&"[object Window]"==br.call(t)?function(t){try{return gr(t)}catch(t){return wr.slice()}}(t):gr(E(t))}},Er={f:It},Tr=X.f,Sr=ne.forEach,Ir=D("hidden"),Cr="Symbol",Nr="prototype",Ar=It("toPrimitive"),kr=kt.set,Dr=kt.getterFor(Cr),Rr=Object[Nr],Or=x.Symbol,Pr=x.JSON,Mr=Pr&&Pr.stringify,xr=z.f,Lr=X.f,Fr=_r.f,Ur=q.f,qr=Z("symbols"),Vr=Z("op-symbols"),Br=Z("string-to-symbol-registry"),jr=Z("symbol-to-string-registry"),Wr=Z("wks"),Qr=x.QObject,Kr=!Qr||!Qr[Nr]||!Qr[Nr].findChild,Hr=L&&g((function(){return 7!=ce(Lr({},"a",{get:function(){return Lr(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=xr(Rr,e);r&&delete Rr[e],Lr(t,e,n),r&&t!==Rr&&Lr(Rr,e,r)}:Lr,Gr=Jt&&"symbol"==typeof Or.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Or},zr=function(t,e,n){t===Rr&&zr(Vr,e,n),N(t);var r=S(e,!0);return N(n),I(qr,r)?(n.enumerable?(I(t,Ir)&&t[Ir][r]&&(t[Ir][r]=!1),n=ce(n,{enumerable:b(0,!1)})):(I(t,Ir)||Lr(t,Ir,b(1,{})),t[Ir][r]=!0),Hr(t,r,n)):Lr(t,r,n)},Yr=function(t){var e=S(t,!0),n=Ur.call(this,e);return!(this===Rr&&I(qr,e)&&!I(Vr,e))&&(!(n||!I(this,e)||!I(qr,e)||I(this,Ir)&&this[Ir][e])||n)},Xr=function(t){var e=t===Rr,n=Fr(e?Vr:E(t)),r=[];return Sr(n,(function(t){!I(qr,t)||e&&!I(Rr,t)||r.push(qr[t])})),r};Jt||(Dt((Or=function(t){if(this instanceof Or)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=k(e),r=function(t){this===Rr&&r.call(Vr,t),I(this,Ir)&&I(this[Ir],n)&&(this[Ir][n]=!1),Hr(this,n,b(1,t))};return L&&Kr&&Hr(Rr,n,{configurable:!0,set:r}),dr(n,e)})[Nr],"toString",(function(){return Dr(this).tag})),q.f=Yr,X.f=zr,z.f=mr,Vt.f=_r.f=vr,Bt.f=Xr,L&&(Lr(Or[Nr],"description",{configurable:!0,get:function(){return Dr(this).description}}),Dt(Rr,"propertyIsEnumerable",Yr,{unsafe:!0})),Er.f=function(t){return dr(It(t),t)}),_t({global:!0,wrap:!0,forced:!Jt,sham:!Jt},{Symbol:Or}),Sr(re(Wr),(function(t){pr(t)})),_t({target:Cr,stat:!0,forced:!Jt},{for:function(t){var e=String(t);if(I(Br,e))return Br[e];var n=Or(e);return Br[e]=n,jr[n]=e,n},keyFor:function(t){if(!Gr(t))throw TypeError(t+" is not a symbol");if(I(jr,t))return jr[t]},useSetter:function(){Kr=!0},useSimple:function(){Kr=!1}}),_t({target:"Object",stat:!0,forced:!Jt,sham:!L},{create:function(t,e){return void 0===e?ce(t):yr(ce(t),e)},defineProperty:zr,defineProperties:yr,getOwnPropertyDescriptor:mr}),_t({target:"Object",stat:!0,forced:!Jt},{getOwnPropertyNames:vr,getOwnPropertySymbols:Xr}),_t({target:"Object",stat:!0,forced:g((function(){Bt.f(1)}))},{getOwnPropertySymbols:function(t){return Bt.f(St(t))}}),Pr&&_t({target:"JSON",stat:!0,forced:!Jt||g((function(){var t=Or();return"[null]"!=Mr([t])||"{}"!=Mr({a:t})||"{}"!=Mr(Object(t))}))},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(T(e)||void 0!==t)&&!Gr(t))return Xt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Gr(e))return e}),r[1]=e,Mr.apply(Pr,r)}}),Or[Nr][Ar]||J(Or[Nr],Ar,Or[Nr].valueOf),Oe(Or,Cr),at[Ir]=!0,pr("asyncIterator");var Jr=X.f,$r=x.Symbol;if(L&&"function"==typeof $r&&!("description"in $r.prototype&&void 0===$r().description)){var Zr={},ti=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof ti?new $r(e):void 0===e?$r():$r(e);return""===e&&(Zr[n]=!0),n};bt(ti,$r);var ei=ti.prototype=$r.prototype;ei.constructor=ti;var ni=ei.toString,ri="Symbol(test)"==String($r("test")),ii=/^Symbol\((.*)\)[^)]+$/;Jr(ei,"description",{configurable:!0,get:function(){var t=T(this)?this.valueOf():this,e=ni.call(t);if(I(Zr,t))return"";var n=ri?e.slice(7,-1):e.replace(ii,"$1");return""===n?void 0:n}}),_t({global:!0,forced:!0},{Symbol:ti})}pr("hasInstance"),pr("isConcatSpreadable"),pr("iterator"),pr("match"),pr("matchAll"),pr("replace"),pr("search"),pr("species"),pr("split"),pr("toPrimitive"),pr("toStringTag"),pr("unscopables"),Oe(Math,"Math",!0),Oe(x.JSON,"JSON",!0),Rt.Symbol,pr("asyncDispose"),pr("dispose"),pr("observable"),pr("patternMatch"),pr("replaceAll");var oi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ai=It("iterator"),si=It("toStringTag"),ui=Mn.values;for(var ci in oi){var hi=x[ci],li=hi&&hi.prototype;if(li){if(li[ai]!==ui)try{J(li,ai,ui)}catch(Zo){li[ai]=ui}if(li[si]||J(li,si,ci),oi[ci])for(var fi in Mn)if(li[fi]!==Mn[fi])try{J(li,fi,Mn[fi])}catch(Zo){li[fi]=Mn[fi]}}}function pi(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function di(t,e,n,r,i){function o(t){var e=s[t];Dt(s,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return i&&!T(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})}var a=x[t],s=a&&a.prototype,u=a,c=r?"set":"add",h={};if(zt(t,"function"!=typeof a||!(i||s.forEach&&!g((function(){(new a).entries().next()})))))u=n.getConstructor(e,t,r,c),gi.REQUIRED=!0;else if(zt(t,!0)){var l=new u,f=l[c](i?{}:-0,1)!=l,p=g((function(){l.has(1)})),d=fn((function(t){new a(t)})),y=!i&&g((function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)}));d||(((u=e((function(e,n){pi(e,u,t);var i=function(t,e,n){var r,i;return Be&&"function"==typeof(r=e.constructor)&&r!==n&&T(i=r.prototype)&&i!==n.prototype&&Be(t,i),t}(new a,e,u);return null!=n&&bi(n,i[c],i,r),i}))).prototype=s).constructor=u),(p||y)&&(o("delete"),o("has"),r&&o("get")),(y||f)&&o(c),i&&s.clear&&delete s.clear}return h[t]=u,_t({global:!0,forced:u!=a},h),Oe(u,t),i||n.setStrong(u,t,r),u}function yi(t,e,n){for(var r in e)Dt(t,r,e[r],n);return t}function mi(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Et(this),(r=void 0!==u)&&Et(u),null==t?new this:(i=[],r?(o=0,a=Tt(u,2<s?n:void 0,2),bi(t,(function(t){i.push(a(t,o++))}))):bi(t,i.push,i),new this(i))}Er.f("iterator");var vi=!g((function(){return Object.isExtensible(Object.preventExtensions({}))})),gi=i((function(t){function e(t){n(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var n=X.f,r=k("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,n){if(!T(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!I(t,r)){if(!o(t))return"F";if(!n)return"E";e(t)}return t[r].objectID},getWeakData:function(t,n){if(!I(t,r)){if(!o(t))return!0;if(!n)return!1;e(t)}return t[r].weakData},onFreeze:function(t){return vi&&a.REQUIRED&&o(t)&&!I(t,r)&&e(t),t}};at[r]=!0})),bi=(gi.REQUIRED,gi.fastKey,gi.getWeakData,gi.onFreeze,i((function(t){function e(t,e){this.stopped=t,this.result=e}(t.exports=function(t,n,r,i,o){var a,s,u,c,h,l,f=Tt(n,r,i?2:1);if(o)a=t;else{if("function"!=typeof(s=en(t)))throw TypeError("Target is not iterable");if($e(s)){for(u=0,c=mt(t.length);u<c;u++)if((h=i?f(N(l=t[u])[0],l[1]):f(t[u]))&&h instanceof e)return h;return new e(!1)}a=s.call(t)}for(;!(l=a.next()).done;)if((h=Je(a,f,l.value,i))&&h instanceof e)return h;return new e(!1)}).stop=function(t){return new e(!0,t)}}))),wi=It("species"),_i=X.f,Ei=gi.fastKey,Ti=kt.set,Si=kt.getterFor,Ii={getConstructor:function(t,e,n,r){function i(t,e,n){var r,i,o=a(t),u=s(t,e);return u?u.value=n:(o.last=u={index:i=Ei(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=u),r&&(r.next=u),L?o.size++:t.size++,"F"!==i&&(o.index[i]=u)),t}var o=t((function(t,i){pi(t,o,e),Ti(t,{type:e,index:ce(null),first:void 0,last:void 0,size:0}),L||(t.size=0),null!=i&&bi(i,t[r],t,n)})),a=Si(e),s=function(t,e){var n,r=a(t),i=Ei(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return yi(o.prototype,{clear:function(){for(var t=a(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,L?t.size=0:this.size=0},delete:function(t){var e=a(this),n=s(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),L?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=a(this),i=Tt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!s(this,t)}}),yi(o.prototype,n?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return i(this,0===t?0:t,e)}}:{add:function(t){return i(this,t=0===t?0:t,t)}}),L&&_i(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,n){var r=e+" Iterator",i=Si(e),o=Si(r);xe(t,e,(function(t,e){Ti(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}}),n?"entries":"values",!n,!0),function(t){var e=dt(t),n=X.f;L&&e&&!e[wi]&&n(e,wi,{configurable:!0,get:function(){return this}})}(e)}};function Ci(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}function Ni(){for(var t,e=N(this),n=Et(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}function Ai(t){return Map.prototype.entries.call(t)}function ki(t,e){var n,r=N(t).constructor;return void 0===r||null==(n=N(r)[Di])?e:Et(n)}di("Map",(function(t){return function(e){return t(this,arguments.length?e:void 0)}}),Ii,!0),Rt.Map,_t({target:"Map",stat:!0},{from:mi}),_t({target:"Map",stat:!0},{of:Ci}),_t({target:"Map",proto:!0,real:!0,forced:$},{deleteAll:function(){return Ni.apply(this,arguments)}}),_t({target:"Map",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3);return!bi(r,(function(t,e){if(!i(e,t,n))return bi.stop()}),void 0,!0,!0).stopped}});var Di=It("species");function Ri(t){return Set.prototype.values.call(t)}_t({target:"Map",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ki(n,dt("Map"))),a=Et(o.set);return bi(r,(function(t,e){i(e,t,n)&&a.call(o,t,e)}),void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3);return bi(r,(function(t,e){if(i(e,t,n))return bi.stop(e)}),void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{findKey:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3);return bi(r,(function(t,e){if(i(e,t,n))return bi.stop(t)}),void 0,!0,!0).result}}),_t({target:"Map",stat:!0},{groupBy:function(t,e){var n=new this;Et(e);var r=Et(n.has),i=Et(n.get),o=Et(n.set);return bi(t,(function(t){var a=e(t);r.call(n,a)?i.call(n,a).push(t):o.call(n,a,[t])})),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{includes:function(t){return bi(Ai(N(this)),(function(e,n){if(function(t,e){return t===e||t!=t&&e!=e}(n,t))return bi.stop()}),void 0,!0,!0).stopped}}),_t({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Et(e);var r=Et(n.set);return bi(t,(function(t){r.call(n,e(t),t)})),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{keyOf:function(t){return bi(Ai(N(this)),(function(e,n){if(n===t)return bi.stop(e)}),void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapKeys:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ki(n,dt("Map"))),a=Et(o.set);return bi(r,(function(t,e){a.call(o,i(e,t,n),e)}),void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapValues:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ki(n,dt("Map"))),a=Et(o.set);return bi(r,(function(t,e){a.call(o,t,i(e,t,n))}),void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{merge:function(t){for(var e=N(this),n=Et(e.set),r=0;r<arguments.length;)bi(arguments[r++],n,e,!0);return e}}),_t({target:"Map",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=Ai(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty map with no initial value");n=r.value[1]}return bi(o,(function(e,r){n=t(n,r,e,i)}),void 0,!0,!0),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=Ai(n),i=Tt(t,1<arguments.length?e:void 0,3);return bi(r,(function(t,e){if(i(e,t,n))return bi.stop()}),void 0,!0,!0).stopped}}),_t({target:"Map",proto:!0,real:!0,forced:$},{update:function(t,e,n){var r=N(this),i=arguments.length;Et(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Et(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}}),_t({target:"Map",proto:!0,real:!0,forced:$},{updateOrInsert:function(t,e,n){var r=N(this);Et(e),Et(n);var i=r.has(t)?e(r.get(t)):n();return r.set(t,i),i}}),di("Set",(function(t){return function(e){return t(this,arguments.length?e:void 0)}}),Ii),Rt.Set,_t({target:"Set",stat:!0},{from:mi}),_t({target:"Set",stat:!0},{of:Ci}),_t({target:"Set",proto:!0,real:!0,forced:$},{addAll:function(){return function(){for(var t=N(this),e=Et(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{deleteAll:function(){return Ni.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=Ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return!bi(r,(function(t){if(!i(t,t,n))return bi.stop()}),void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{difference:function(t){var e=N(this),n=new(ki(e,dt("Set")))(e),r=Et(n.delete);return bi(t,(function(t){r.call(n,t)})),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=Ri(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ki(n,dt("Set"))),a=Et(o.add);return bi(r,(function(t){i(t,t,n)&&a.call(o,t)}),void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=Ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return bi(r,(function(t){if(i(t,t,n))return bi.stop(t)}),void 0,!1,!0).result}}),_t({target:"Set",proto:!0,real:!0,forced:$},{intersection:function(t){var e=N(this),n=new(ki(e,dt("Set"))),r=Et(e.has),i=Et(n.add);return bi(t,(function(t){r.call(e,t)&&i.call(n,t)})),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isDisjointFrom:function(t){var e=N(this),n=Et(e.has);return!bi(t,(function(t){if(!0===n.call(e,t))return bi.stop()})).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSubsetOf:function(t){var e=function(t){var e=en(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return N(e.call(t))}(this),n=N(t),r=n.has;return"function"!=typeof r&&(n=new(dt("Set"))(t),r=Et(n.has)),!bi(e,(function(t){if(!1===r.call(n,t))return bi.stop()}),void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSupersetOf:function(t){var e=N(this),n=Et(e.has);return!bi(t,(function(t){if(!1===n.call(e,t))return bi.stop()})).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{join:function(t){var e=Ri(N(this)),n=void 0===t?",":String(t),r=[];return bi(e,r.push,r,!1,!0),r.join(n)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{map:function(t,e){var n=N(this),r=Ri(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ki(n,dt("Set"))),a=Et(o.add);return bi(r,(function(t){a.call(o,i(t,t,n))}),void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=Ri(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return bi(o,(function(e){n=t(n,e,e,i)}),void 0,!1,!0),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=Ri(n),i=Tt(t,1<arguments.length?e:void 0,3);return bi(r,(function(t){if(i(t,t,n))return bi.stop()}),void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{symmetricDifference:function(t){var e=N(this),n=new(ki(e,dt("Set")))(e),r=Et(n.delete),i=Et(n.add);return bi(t,(function(t){r.call(n,t)||i.call(n,t)})),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{union:function(t){var e=N(this),n=new(ki(e,dt("Set")))(e);return bi(t,Et(n.add),n),n}});var Oi=Math.floor;_t({target:"Number",stat:!0},{isInteger:function(t){return!T(t)&&isFinite(t)&&Oi(t)===t}}),Rt.Number.isInteger;var Pi=function(t,e){return(Pi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Mi(t,e){function n(){this.constructor=t}Pi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var xi=function(){return(xi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Li(t,e,n,r){return new(n=n||Promise)((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function Fi(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Ui(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function qi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Vi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(qi(arguments[e]));return t}function Bi(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function ji(t){try{return Hi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var Wi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Qi=function(t,e){if(!t)throw Ki(e)},Ki=function(t){return new Error("Firebase Database ("+Wi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Hi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Bi(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function Gi(t){return zi(void 0,t)}function zi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=zi(t[n],e[n]));return t}var Yi=(Xi.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},Xi);function Xi(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}function Ji(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function $i(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ji())}function Zi(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function to(){return!0===Wi.NODE_ADMIN}var eo,no=(Mi(ro,eo=Error),ro);function ro(t,e){var n=eo.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,ro.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,io.prototype.create),n}var io=(oo.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(ao,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new no(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},oo);function oo(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var ao=/\{\$([^}]+)}/g;function so(t){return JSON.parse(t)}function uo(t){return JSON.stringify(t)}function co(t){var e={},n={},r={},i="";try{var o=t.split(".");e=so(ji(o[0])||""),n=so(ji(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function ho(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lo(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function fo(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function po(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var yo=(mo.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},mo.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},mo.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},mo.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},mo);function mo(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function vo(t,e){var n=new wo(t,e);return n.subscribe.bind(n)}var go,bo,wo=(_o.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},_o.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},_o.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},_o.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=Eo),void 0===r.error&&(r.error=Eo),void 0===r.complete&&(r.complete=Eo);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},_o.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},_o.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},_o.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},_o.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},_o);function _o(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}function Eo(){}function To(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function So(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function Io(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(So(t,e,r)+"must be a valid function.")}function Co(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(So(t,e,r)+"must be a valid context object.")}function No(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}function Ao(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case go.DEBUG:case go.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case go.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case go.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case go.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(bo=go=go||{})[bo.DEBUG=0]="DEBUG",bo[bo.VERBOSE=1]="VERBOSE",bo[bo.INFO=2]="INFO",bo[bo.WARN=3]="WARN",bo[bo.ERROR=4]="ERROR",bo[bo.SILENT=5]="SILENT";var ko,Do=go.INFO,Ro=(Object.defineProperty(Oo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in go))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(Oo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Oo.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,go.DEBUG].concat(t))},Oo.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,go.VERBOSE].concat(t))},Oo.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,go.INFO].concat(t))},Oo.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,go.WARN].concat(t))},Oo.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,go.ERROR].concat(t))},Oo);function Oo(t){this.name=t,this._logLevel=Do,this._logHandler=Ao}var Po=((ko={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",ko["bad-app-name"]="Illegal App name: '{$appName}",ko["duplicate-app"]="Firebase App named '{$appName}' already exists",ko["app-deleted"]="Firebase App named '{$appName}' already deleted",ko["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",ko),Mo=new io("app","Firebase",Po),xo="[DEFAULT]",Lo=[],Fo=(Object.defineProperty(Uo.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(Uo.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Uo.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),Uo.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))})).then((function(){t.isDeleted_=!0,t.services_={}}))},Uo.prototype._getService=function(t,e){if(void 0===e&&(e=xo),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==xo?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},Uo.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=xo),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},Uo.prototype.extendApp=function(t){var e=this;zi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(Lo.forEach((function(t){e.INTERNAL.addAuthTokenListener(t)})),Lo=[])},Uo.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Mo.create("app-deleted",{appName:this.name_})},Uo);function Uo(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Gi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){Lo.push(t),setTimeout((function(){return t(null)}),0)},removeAuthTokenListener:function(t){Lo=Lo.filter((function(e){return e!==t}))}}}Fo.prototype.name&&Fo.prototype.options||Fo.prototype.delete||console.log("dc");var qo=new Ro("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){qo.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Vo=self.firebase.SDK_VERSION;Vo&&0<=Vo.indexOf("LITE")&&qo.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Bo=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var o=r;void 0===o.name&&(o.name=xo);var a=o.name;if("string"!=typeof a||!a)throw Mo.create("bad-app-name",{appName:String(a)});if(ho(e,a))throw Mo.create("duplicate-app",{appName:a});var u=new t(n,o,i);return s(e[a]=u,"create"),u},app:o,apps:null,SDK_VERSION:"6.6.2",INTERNAL:{registerService:function(e,s,u,c,h){if(void 0===h&&(h=!1),n[e])return qo.debug("There were multiple attempts to register service "+e+"."),i[e];function l(t){if(void 0===t&&(t=o()),"function"!=typeof t[e])throw Mo.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=s,c&&(r[e]=c,a().forEach((function(t){c("create",t)}))),void 0!==u&&zi(l,u),i[e]=l,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,h?t:[])},l},removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u}};function o(t){if(!ho(e,t=t||xo))throw Mo.create("no-app",{appName:t});return e[t]}function a(){return Object.keys(e).map((function(t){return e[t]}))}function s(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=u(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function u(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:a}),o.App=t,i}(Fo);return e.INTERNAL=xi({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){zi(e,t)},createSubscribe:vo,ErrorFactory:io,deepExtend:zi}),e}(),jo=Bo.initializeApp;Bo.initializeApp=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}()&&qo.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),jo.apply(void 0,t)};var Wo=Bo;(function(){var t,n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},r="undefined"!=typeof window&&window===this?this:void 0!==e&&null!=e?e:this;function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var i=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(e=e(o=i[t=t[t.length-1]]))!=o&&null!=e&&n(i,t,{configurable:!0,writable:!0,value:e})}}("Promise",(function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.a=null}function o(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c((function(){e.g()}))}this.a.push(t)};var a=r.setTimeout;n.prototype.c=function(t){a(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},n.prototype.f=function(t){this.c((function(){throw t}))},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.o=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(e){o(e)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.Ja(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).Ja(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e((function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}for(var a=[],s=0;a.push(void 0),s++,o(r.value).Ja(i(a.length-1),e),!(r=n.next()).done;);}))},e}));var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+\/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function d(t){return"array"==f(t)}function y(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==f(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),b=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function _(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:_).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function I(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).fd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function C(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function N(t){if(Error.captureStackTrace)Error.captureStackTrace(this,N);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function A(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");N.call(this,n+t[r])}function k(t,e){throw new A("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function D(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function R(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function O(){this.b=this.a=null}I(N,Error),N.prototype.name="CustomError",I(A,N),A.prototype.name="AssertionError",D.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var P=new D((function(){return new M}),(function(t){t.reset()}));function M(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;k("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}O.prototype.add=function(t,e){var n=P.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},M.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},M.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},q=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=L(t,e)}function B(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function j(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,(function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length}))}function W(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function H(t){for(var e in t)return!1;return!0}function G(t){var e,n={};for(e in t)n[e]=t[e];return n}var z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<z.length;o++)n=z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t,e){this.a=t===Z&&e||"",this.b=$}function J(t){return t instanceof X&&t.constructor===X&&t.b===$?t.a:(k("expected object of type Const, got '"+t+"'"),"type_error:Const")}X.prototype.qa=!0,X.prototype.pa=function(){return this.a},X.prototype.toString=function(){return"Const{"+this.a+"}"};var $={},Z={},tt=new X(Z,"");function et(){this.a="",this.b=at}function nt(t){return t instanceof et&&t.constructor===et&&t.b===at?t.a:(k("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function rt(t,e){var n=J(t);if(!ot.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return st(t=n.replace(it,(function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof X?J(t):encodeURIComponent(String(t))})))}et.prototype.qa=!0,et.prototype.pa=function(){return this.a.toString()},et.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var it=/%{(\w+)}/g,ot=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,at={};function st(t){var e=new et;return e.a=t,e}var ut=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ct=/&/g,ht=/</g,lt=/>/g,ft=/"/g,pt=/'/g,dt=/\x00/g,yt=/[\x00&<>"']/;function mt(t,e){return-1!=t.indexOf(e)}function vt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function bt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(k("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var wt=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function _t(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),wt.test(t)||(t="about:invalid#zClosurez"),St(t))}var Et,Tt={};function St(t){var e=new gt;return e.a=t,e}St("about:blank");t:{var It=a.navigator;if(It){var Ct=It.userAgent;if(Ct){Et=Ct;break t}}Et=""}function Nt(t){return mt(Et,t)}function At(){this.a="",this.b=Dt}function kt(t){return t instanceof At&&t.constructor===At&&t.b===Dt?t.a:(k("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}At.prototype.qa=!0,At.prototype.pa=function(){return this.a.toString()},At.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Dt={};function Rt(t){var e=new At;return e.a=t,e}Rt("<!DOCTYPE html>");var Ot,Pt,Mt=Rt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return yt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ct,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ht,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(lt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(ft,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(pt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(dt,"&#0;"))),t}function Ft(t){a.setTimeout((function(){throw t}),0)}function Ut(t,e){Pt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Pt=function(){t.then(Bt)}}else Pt=function(){var t=Bt;!m(a.setImmediate)||a.Window&&a.Window.prototype&&!Nt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Ot=Ot||function(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Nt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=st(J(tt));x(t,"HTMLIFrameElement"),t.src=nt(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(kt(Mt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=E((function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Nt("Trident")||Nt("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}())(t):a.setImmediate(t)}}(),qt||(Pt(),qt=!0),Vt.add(t,e)}Rt("<br>");var qt=!1,Vt=new O;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Ft(t)}R(P,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,(function(t){ee(n,Qt,t)}),(function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Kt,t)}))}catch(t){ee(this,Kt,t)}}var Wt=0,Qt=2,Kt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new D((function(){return new Ht}),(function(t){t.reset()}));function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(l);return ee(e,Qt,t),e}function Xt(t){return new jt((function(e,n){n(t)}))}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(t){return new jt((function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Jt(t[o],T(i,o,!0),T(i,o,!1));else e(r)}))}function Zt(t,e){t.b||t.a!=Qt&&t.a!=Kt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,e,n,r){var i=zt(null,null,null);return i.a=new jt((function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof ue?o(e):t(i)}catch(e){o(e)}}:o})),Zt(i.a.c=t,i),i.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Kt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Kt||n instanceof ue||function(t,e){t.g=!0,Ut((function(){t.g&&se.call(null,e)}))}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||l,n||null,r)),!0;if(C(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,(function(t){a||(a=!0,n.call(i,t))}),o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Kt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}R(Gt,e)}function ae(t,e,n){e==Qt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut((function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Kt,n)))}e.c=null}else ee(e,Kt,n)}(this,new ue(t))}),this)},t.Oc=function(t){this.a=Wt,ee(this,Qt,t)},t.Pc=function(t){this.a=Wt,ee(this,Kt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Ft;function ue(t){N.call(this,t)}function ce(){this.ta=this.ta,this.la=this.la}I(ue,N);var he=0;function le(t){t.ta||(t.ta=!0,t.xa(),0==he)||t[g]||(t[g]=++b)}function fe(t){return fe[" "](t),t}ce.prototype.ta=!(ue.prototype.name="cancel"),ce.prototype.xa=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=l;var pe,de,ye=Nt("Opera"),me=Nt("Trident")||Nt("MSIE"),ve=Nt("Edge"),ge=ve||me,be=Nt("Gecko")&&!(mt(Et.toLowerCase(),"webkit")&&!Nt("Edge"))&&!(Nt("Trident")||Nt("MSIE"))&&!Nt("Edge"),we=mt(Et.toLowerCase(),"webkit")&&!Nt("Edge");function _e(){var t=a.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=Et,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(t){return function(e,n){var r=Ce;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=ut(String(pe)).split("."),r=ut(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=vt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||vt(0==a[2].length,0==s[2].length)||vt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}Ie=a.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},I(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Le,this.ra=this.Ia=!1}function Ue(t){t.ra=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&B(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ra&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Qe(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Qe(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!1,r,i)}function Ke(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=$e,e=ke?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ra){var e=t.src;if(e&&e[xe])Ve(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ra&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&ze(t),n.call(r,e)}function $e(t,e){if(t.ra)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(t){return m(t)?t:(t[tn]||(t[tn]=function(e){return t.handleEvent(e)}),t[tn])}function nn(){ce.call(this),this.u=new qe(this),(this.Sb=this).Wa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ra&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ve(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(m(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function un(t){var e=null;return new jt((function(n,r){-1==(e=sn((function(){n(void 0)}),t))&&r(Error("Failed to schedule timer."))})).s((function(t){throw a.clearTimeout(e),t}))}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(s(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(y(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}I(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Qe(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Sb;var r=t.type||t;if(s(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;Y(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.xa=function(){if(nn.qb.xa.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.l),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))}),t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return s(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)vn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(mt(i,"./")||mt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(t){t.a||(t.a=new ln,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),Q(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){On(this),this.a.forEach((function(n,r){F(n,(function(n){t.call(e,n,r,this)}),this)}),this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(s(t))xn(this,t)&&(e=W(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return s(t)?e.getElementById(t):t}function Bn(t,e){K(e,(function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:jn.hasOwnProperty(n)?t.setAttribute(jn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e}))}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),zn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":zn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Kn,t,e),e.join("")}function Kn(){}var Hn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Gn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function zn(t,e){e.push('"',t.replace(Gn,(function(t){var e=Hn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Hn[t]=e),e})),'"')}function Yn(){var t=dr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Xn(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function Jn(t,e){e=e||a.window;var n="about:blank";t&&(n=bt(_t(t)).toString()),e.location.href=n}function $n(t){return!!((t=(t||dr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Zn(t){t=t||a.window;try{t.close()}catch(t){}}function tr(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=dr().toLowerCase(),r&&(e.target=r,mt(n,"crios/")&&(e.target="_blank")),lr(dr())==cr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:_t(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Nt("iPhone")&&!Nt("iPod")&&!Nt("iPad")||Nt("iPad")||Nt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),wt.test(e)||(e="about:invalid#zClosurez"),e=St(e)),a.href=bt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=bt(e).toString(),a&&(ge&&mt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Rt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(kt(t)),a.document.close())):(a=r.open(bt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var er=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nr=/^[^@]+@[^@]+$/;function rr(){var t=null;return new jt((function(e){"complete"==a.document.readyState?e():(t=function(){e()},He(window,"load",t))})).s((function(e){throw Ge(window,"load",t),e}))}function ir(t){return t=t||dr(),!("file:"!==br()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function or(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function ar(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function sr(){return Wo.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Wo.INTERNAL.hasOwnProperty("node")?"Node":ar()?"Worker":"Browser"}function ur(){var t=sr();return"ReactNative"===t||"Node"===t}var cr="Firefox",hr="Chrome";function lr(t){var e=t.toLowerCase();return mt(e,"opera/")||mt(e,"opr/")||mt(e,"opios/")?"Opera":mt(e,"iemobile")?"IEMobile":mt(e,"msie")||mt(e,"trident/")?"IE":mt(e,"edge/")?"Edge":mt(e,"firefox/")?cr:mt(e,"silk/")?"Silk":mt(e,"blackberry")?"Blackberry":mt(e,"webos")?"Webos":!mt(e,"safari/")||mt(e,"chrome/")||mt(e,"crios/")||mt(e,"android")?!mt(e,"chrome/")&&!mt(e,"crios/")||mt(e,"edge/")?mt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":hr:"Safari"}var fr={Vc:"FirebaseCore-web",Xc:"FirebaseUI-web"};function pr(t,e){e=e||[];var n,r=[],i={};for(n in fr)i[fr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=sr())?r=lr(i=dr()):"Worker"===r&&(r=lr(i=dr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function dr(){return a.navigator&&a.navigator.userAgent||""}function yr(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function mr(){try{var t=a.localStorage,e=Sr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Yn()||!!a.indexedDB}catch(t){return ar()&&!!a.indexedDB}return!1}function vr(){return(gr()||"chrome-extension:"===br()||ir())&&!ur()&&mr()&&!ar()}function gr(){return"http:"===br()||"https:"===br()}function br(){return a.location&&a.location.protocol||null}function wr(t){return!$n(t=t||dr())&&lr(t)!=cr}function _r(t){return void 0===t?null:Qn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Tr(t){if(null!==t)return JSON.parse(t)}function Sr(t){return t||Math.floor(1e9*Math.random()).toString()}function Ir(t){return"Safari"!=lr(t=t||dr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Cr(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Nr(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=dr(),e=sr(),this.b=$n(t)||"ReactNative"===e}function Ar(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function kr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Dr(){return!(!yr("fireauth.oauthhelper",a)&&!yr("fireauth.iframe",a))}Nr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!gr()&&"chrome-extension:"!==br()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Rr,Or={};function Pr(t){Or[t]||(Or[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Rr=2==Mr.abcd}catch(t){Rr=!1}function xr(t,e,n){Rr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Lr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Fr(t){var e={};return Lr(e,t),e}function Ur(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Ur(t[n]));return e}function qr(t){var e={},n=t[Br],r=t[jr];if(!(t=t[Wr])||t!=Vr&&!n)throw Error("Invalid provider user info!");e[Kr]=r||null,e[Qr]=n||null,xr(this,Gr,t),xr(this,Hr,Ur(e))}var Vr="EMAIL_SIGNIN",Br="email",jr="newEmail",Wr="requestType",Qr="email",Kr="fromEmail",Hr="data",Gr="operation";function zr(t,e){this.code=Xr+t,this.message=e||Jr[t]||""}function Yr(t){var e=t&&t.code;return e?new zr(e.substring(Xr.length),t.message):null}I(zr,Error),zr.prototype.A=function(){return{code:this.code,message:this.message}},zr.prototype.toJSON=function(){return this.A()};var Xr="auth/",Jr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function $r(t){var e=wn(t=_n(t),Zr)||null,n=wn(t,ti)||null,r=wn(t,ri)||null;if(r=r&&oi[r]||null,!e||!n||!r)throw new zr("argument-error",Zr+", "+ti+"and "+ri+" are required in a valid action code URL.");Lr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ei)||null,languageCode:wn(t,ni)||null,tenantId:wn(t,ii)||null})}var Zr="apiKey",ti="oobCode",ei="continueUrl",ni="languageCode",ri="mode",ii="tenantId",oi={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Vr,verifyEmail:"VERIFY_EMAIL"};function ai(t){try{return new $r(t)}catch(t){return null}}function si(t){var e=t[fi];if(void 0===e)throw new zr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new zr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ui];if(n&&"object"==typeof n){e=n[yi];var r=n[pi];if(n=n[di],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new zr("argument-error",pi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new zr("argument-error",di+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new zr("argument-error",yi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new zr("missing-android-pkg-name")}}else if(void 0!==n)throw new zr("argument-error",ui+" property must be a non null object when specified.");if(this.f=null,(e=t[li])&&"object"==typeof e){if("string"==typeof(e=e[mi])&&e.length)this.f=e;else if(void 0!==e)throw new zr("argument-error",mi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new zr("argument-error",li+" property must be a non null object when specified.");if(void 0!==(e=t[hi])&&"boolean"!=typeof e)throw new zr("argument-error",hi+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ci])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new zr("argument-error",ci+" property must be a non empty string when specified.");this.i=t||null}var ui="android",ci="dynamicLinkDomain",hi="handleCodeInApp",li="iOS",fi="url",pi="installApp",di="minimumVersion",yi="packageName",mi="bundleId";function vi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var gi=null,bi=null;function wi(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function _i(t){return(t=Ei(t))&&t.sub&&t.iss&&t.aud&&t.exp?new wi(t):null}function Ei(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=bi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!gi){gi={},bi={};for(var t=0;t<65;t++)gi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(bi[gi[t]]=t)&&(bi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){e+=String.fromCharCode(t)})),e}(t))}catch(t){}return null}wi.prototype.R=function(){return this.c},wi.prototype.g=function(){return this.b};var Ti,Si={ad:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},cd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},dd:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ii(t){for(var e in Si)if(Si[e].id===t)return{firebaseEndpoint:(t=Si[e]).bb,secureTokenEndpoint:t.ib};return null}Ti=Ii("__EID__")?"__EID__":void 0;var Ci="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ni=["client_id","response_type","scope","redirect_uri","state"],Ai={Wc:{Oa:"locale",Da:500,Ca:600,Pa:"facebook.com",hb:Ni},Yc:{Oa:null,Da:500,Ca:620,Pa:"github.com",hb:Ni},Zc:{Oa:"hl",Da:515,Ca:680,Pa:"google.com",hb:Ni},ed:{Oa:"lang",Da:485,Ca:705,Pa:"twitter.com",hb:Ci}};function ki(t){for(var e in Ai)if(Ai[e].Pa==t)return Ai[e];return null}function Di(t){var e={};e["facebook.com"]=xi,e["google.com"]=Fi,e["github.com"]=Li,e["twitter.com"]=Ui;var n=t&&t[Oi];try{if(n)return e[n]?new e[n](t):new Mi(t);if(void 0!==t[Ri])return new Pi(t)}catch(t){}return null}var Ri="idToken",Oi="providerId";function Pi(t){var e=t[Oi];if(!e&&t[Ri]){var n=_i(t[Ri]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function Mi(t){Pi.call(this,t),xr(this,"profile",Ur((t=Tr(t.rawUserInfo||"{}"))||{}))}function xi(t){if(Mi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Li(t){if(Mi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Fi(t){if(Mi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(Mi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function qi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function Vi(){}function Bi(t,e){return t.then((function(t){if(t[Da]){var n=_i(t[Da]);if(!n||e!=n.f)throw new zr("user-mismatch");return t}throw new zr("user-mismatch")})).s((function(t){throw t&&t.code&&t.code==Xr+"user-not-found"?new zr("user-mismatch"):t}))}function ji(t,e){if(!e)throw new zr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function Wi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Qi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new ji(t.providerId,t.pendingToken)}catch(t){}return null}function Ki(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new zr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function Hi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Gi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Ki(t.providerId,e,t.signInMethod)}catch(t){}}return null}function zi(t,e){this.Fc=e||[],Lr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.cb=(ki(t)||{}).Oa||null,this.ab=null}function Yi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new zr("argument-error",'SAML provider IDs must be prefixed with "saml."');zi.call(this,t,[])}function Xi(t){zi.call(this,t,Ni),this.a=[]}function Ji(){Xi.call(this,"facebook.com")}function $i(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Ji).credential({accessToken:e})}function Zi(){Xi.call(this,"github.com")}function to(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){Xi.call(this,"google.com"),this.wa("profile")}function no(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new eo).credential({idToken:n,accessToken:e})}function ro(){zi.call(this,"twitter.com",Ci)}function io(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new zr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Ki("twitter.com",n,"twitter.com")}function oo(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===so.EMAIL_LINK_SIGN_IN_METHOD?so.EMAIL_LINK_SIGN_IN_METHOD:so.EMAIL_PASSWORD_SIGN_IN_METHOD)}function ao(t){return t&&t.email&&t.password?new oo(t.email,t.password,t.signInMethod):null}function so(){Lr(this,{providerId:"password",isOAuthProvider:!1})}function uo(t,e){if(!(e=co(e)))throw new zr("argument-error","Invalid email link!");return new oo(t,e.code,so.EMAIL_LINK_SIGN_IN_METHOD)}function co(t){return(t=ai(t=qi(t)))&&t.operation===Vr?t:null}function ho(t){if(!(t.Ua&&t.Ta||t.Fa&&t.ba))throw new zr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function lo(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){t[n]&&(e[n]=t[n])})),new ho(e)}return null}function fo(t){return t.a.Fa&&t.a.ba?{temporaryProof:t.a.Fa,phoneNumber:t.a.ba}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function po(t){try{this.a=t||Wo.auth()}catch(t){throw new zr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Lr(this,{providerId:"phone",isOAuthProvider:!1})}function yo(t,e){if(!t)throw new zr("missing-verification-id");if(!e)throw new zr("missing-verification-code");return new ho({Ua:t,Ta:e})}function mo(t){if(t.temporaryProof&&t.phoneNumber)return new ho({Fa:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return no(o,n);case"facebook.com":return $i(n);case"github.com":return to(n);case"twitter.com":return io(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new ji(e,a):new Ki(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Xi(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function vo(t){if(!t.isOAuthProvider)throw new zr("invalid-oauth-provider")}function go(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new zr("invalid-auth-event");if(this.g&&this.a)throw new zr("invalid-auth-event");if(this.g&&!this.f)throw new zr("invalid-auth-event")}function bo(t){return(t=t||{}).type?new go(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Yr(t.error),t.postBody,t.tenantId):null}function wo(){this.b=null,this.a=[]}I(Mi,Pi),I(xi,Mi),I(Li,Mi),I(Fi,Mi),I(Ui,Mi),ji.prototype.na=function(t){return za(t,Wi(this))},ji.prototype.b=function(t,e){var n=Wi(this);return n.idToken=e,Ya(t,n)},ji.prototype.f=function(t,e){return Bi(Xa(t,Wi(this)),e)},ji.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Ki.prototype.na=function(t){return za(t,Hi(this))},Ki.prototype.b=function(t,e){var n=Hi(this);return n.idToken=e,Ya(t,n)},Ki.prototype.f=function(t,e){return Bi(Xa(t,Hi(this)),e)},Ki.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},zi.prototype.Ea=function(t){return this.zb=G(t),this},I(Yi,zi),I(Xi,zi),Xi.prototype.wa=function(t){return V(this.a,t)||this.a.push(t),this},Xi.prototype.Hb=function(){return Q(this.a)},Xi.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new zr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Ki(this.providerId,n,this.providerId)},I(Ji,Xi),xr(Ji,"PROVIDER_ID","facebook.com"),xr(Ji,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),I(Zi,Xi),xr(Zi,"PROVIDER_ID","github.com"),xr(Zi,"GITHUB_SIGN_IN_METHOD","github.com"),I(eo,Xi),xr(eo,"PROVIDER_ID","google.com"),xr(eo,"GOOGLE_SIGN_IN_METHOD","google.com"),I(ro,zi),xr(ro,"PROVIDER_ID","twitter.com"),xr(ro,"TWITTER_SIGN_IN_METHOD","twitter.com"),oo.prototype.na=function(t){return this.signInMethod==so.EMAIL_LINK_SIGN_IN_METHOD?Is(t,is,{email:this.a,oobCode:this.c}):Is(t,_s,{email:this.a,password:this.c})},oo.prototype.b=function(t,e){return this.signInMethod==so.EMAIL_LINK_SIGN_IN_METHOD?Is(t,os,{idToken:e,email:this.a,oobCode:this.c}):Is(t,ys,{idToken:e,email:this.a,password:this.c})},oo.prototype.f=function(t,e){return Bi(this.na(t),e)},oo.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Lr(so,{PROVIDER_ID:"password"}),Lr(so,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Lr(so,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),ho.prototype.na=function(t){return t.Va(fo(this))},ho.prototype.b=function(t,e){var n=fo(this);return n.idToken=e,Is(t,Ts,n)},ho.prototype.f=function(t,e){var n=fo(this);return n.operation="REAUTH",Bi(t=Is(t,Ss,n),e)},ho.prototype.A=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.ba&&(t.phoneNumber=this.a.ba),t},po.prototype.Va=function(t,e){var n=this.a.b;return Yt(e.verify()).then((function(r){if(!s(r))throw new zr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Is(t,ps,e)}(n,{phoneNumber:t,recaptchaToken:r}).then((function(t){return"function"==typeof e.reset&&e.reset(),t}),(function(t){throw"function"==typeof e.reset&&e.reset(),t}));default:throw new zr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Lr(po,{PROVIDER_ID:"phone"}),Lr(po,{PHONE_SIGN_IN_METHOD:"phone"}),go.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},go.prototype.R=function(){return this.h},go.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var _o,Eo=null;function To(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",zr.call(this,e,n)}function So(t,e,n){zr.call(this,t,n),(t=e||{}).Ab&&xr(this,"email",t.Ab),t.ba&&xr(this,"phoneNumber",t.ba),t.credential&&xr(this,"credential",t.credential),t.Qb&&xr(this,"tenantId",t.Qb)}function Io(t){if(t.code){var e=t.code||"";0==e.indexOf(Xr)&&(e=e.substring(Xr.length));var n={credential:mo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new zr(e,t.message||void 0);return new So(e,n,t.message)}return null}function Co(){}function No(t){return t.c||(t.c=t.b())}function Ao(){}function ko(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Do(){}function Ro(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.fc,this),this.a.onerror=E(this.Ib,this),this.a.onprogress=E(this.gc,this),this.a.ontimeout=E(this.kc,this)}function Oo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Po(t,e,n){this.reset(t,e,n,void 0,void 0)}function Mo(t){this.f=t,this.b=this.c=this.a=null}function xo(t,e){this.name=t,this.value=e}I(To,zr),I(So,zr),So.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&Y(t,e),t},So.prototype.toJSON=function(){return this.A()},Co.prototype.c=null,I(Ao,Co),Ao.prototype.a=function(){var t=ko(this);return t?new ActiveXObject(t):new XMLHttpRequest},Ao.prototype.b=function(){var t={};return ko(this)&&(t[0]=!0,t[1]=!0),t},_o=new Ao,I(Do,Co),Do.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Ro;throw Error("Unsupported browser")},Do.prototype.b=function(){return{}},(t=Ro.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Oo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Oo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Oo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Po.prototype.a=null,Po.prototype.reset=function(t,e,n,r,i){delete this.a},xo.prototype.toString=function(){return this.name};var Lo=new xo("SEVERE",1e3),Fo=new xo("WARNING",900),Uo=new xo("CONFIG",700),qo=new xo("FINE",500);Mo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(k("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Po(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Vo,Bo={},jo=null;function Qo(t){var e;if(jo||(jo=new Mo(""),(Bo[""]=jo).c=Uo),!(e=Bo[t])){e=new Mo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Qo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Bo[t]=e}return e}function Ko(t,e){t&&t.log(qo,e,void 0)}function Ho(t){this.f=t}function Go(t){nn.call(this),this.o=t,this.readyState=zo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Qo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}I(Ho,Co),Ho.prototype.a=function(){return new Go(this.f)},Ho.prototype.b=(Vo={},function(){return Vo}),I(Go,nn);var zo=0;function Yo(t){t.c.read().then(t.ec.bind(t)).catch(t.Ma.bind(t))}function Xo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Jo(t)}function Jo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function $o(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=Zo,this.v=this.P=!1}(t=Go.prototype).open=function(t,e){if(this.readyState!=zo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Jo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Xo(this,!1)),this.readyState=zo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Jo(this)),this.a&&(this.readyState=3,Jo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Ma.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Yo(this)):t.text().then(this.ic.bind(this),this.Ma.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Xo(this,!0):Jo(this),3==this.readyState&&Yo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Xo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Xo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(Fo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Xo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Fo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Fo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},I($o,nn);var Zo="";$o.prototype.b=Qo("goog.net.XhrIo");var ta=/^https?$/i,ea=["POST","PUT"];function na(t){return"content-type"==t.toLowerCase()}function ra(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ia(t),aa(t)}function ia(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function oa(t){if(t.c&&void 0!==o)if(t.w[1]&&4==ua(t)&&2==ca(t))Ko(t.b,ha(t,"Local request error detected and ignored"));else if(t.i&&4==ua(t))sn(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==ua(t)){Ko(t.b,ha(t,"Request complete")),t.c=!1;try{var e,n=ca(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(dn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!ta.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<ua(t)?t.a.statusText:""}catch(e){Ko(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+ca(t)+"]",ia(t)}}finally{aa(t)}}}function aa(t,e){if(t.a){sa(t);var n=t.a,r=t.w[0]?l:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(Lo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function sa(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(a.clearTimeout(t.o),t.o=null)}function ua(t){return t.a?t.a.readyState:0}function ca(t){try{return 2<ua(t)?t.a.status:-1}catch(t){return-1}}function ha(t,e){return e+" ["+t.O+" "+t.l+" "+ca(t)+"]"}function la(t){var e=Ea;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function fa(t,e,n){t.a=!0,t.c=n,t.f=!e,ma(t)}function pa(t){if(t.a){if(!t.u)throw new va(t);t.u=!1}}function da(t,e,n,r){t.g.push([e,n,r]),t.a&&ma(t)}function ya(t){return q(t.g,(function(t){return m(t[1])}))}function ma(t){if(t.h&&t.a&&ya(t)){var e=t.h,n=wa[e];n&&(a.clearTimeout(n.a),delete wa[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.o,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(C(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,ya(t)||(n=!0)}}t.c=e,r&&(u=E(t.m,t,!0),r=E(t.m,t,!1),e instanceof la?(da(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new ba(e),wa[e.a]=e,t.h=e.a)}function va(){N.call(this)}function ga(){N.call(this)}function ba(t){this.a=a.setTimeout(E(this.c,this),0),this.b=t}(t=$o.prototype).Ga=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ko(this.b,ha(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ko(this.b,ha(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),aa(this))},t.xa=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),aa(this,!0)),$o.qb.xa.call(this)},t.Lb=function(){this.ta||(this.J||this.i||this.f?oa(this):this.yc())},t.yc=function(){oa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Zo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Lo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ko(this.b,"Can not get response: "+t.message),null}},la.prototype.cancel=function(t){if(this.a)this.c instanceof la&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new ga(this),pa(this),fa(this,!1,t))}},la.prototype.m=function(t,e){this.i=!1,fa(this,t,e)},la.prototype.then=function(t,e,n){var r,i,o=new jt((function(t,e){r=t,i=e}));return da(this,r,(function(t){t instanceof ga?o.cancel():i(t)})),o.then(t,e,n)},la.prototype.$goog_Thenable=!0,I(va,N),va.prototype.message="Deferred has already fired",va.prototype.name="AlreadyCalledError",I(ga,N),ga.prototype.message="Deferred was canceled",ga.prototype.name="CanceledError",ba.prototype.c=function(){throw delete wa[this.a],this.b};var wa={};function _a(t){var e,n=document,r=nt(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ga:void 0},s=new la(o);return e=window.setTimeout((function(){Ta(i,!0);var t=new Ca(Ia,"Timeout reached for loading script "+r);pa(s),fa(s,!1,t)}),5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ta(i,!1,e),pa(s),fa(s,!0,null))},i.onerror=function(){Ta(i,!0,e);var t=new Ca(Sa,"Error while loading script "+r);pa(s),fa(s,!1,t)},Y(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=nt(e),null===h&&(h=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function Ea(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ta(t,!0,this.Ga)}}function Ta(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),0)}var Sa=0,Ia=1;function Ca(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),N.call(this,n),this.code=t}function Na(t){this.f=t}function Aa(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Ra,this.g=G(t.secureTokenHeaders||Oa),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||Pa,this.a=G(t.firebaseHeaders||Ma),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==sr(),!(n=a.XMLHttpRequest||n&&Wo.INTERNAL.node&&Wo.INTERNAL.node.XMLHttpRequest)&&!ar())throw new zr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,ar()?this.f=new Ho(self):ur()?this.f=new Na(n):this.f=new Do,this.b=null}I(Ca,N),I(Na,Co),Na.prototype.a=function(){return new this.f},Na.prototype.b=function(){return{}};var ka,Da="idToken",Ra=new Nr(3e4,6e4),Oa={"Content-Type":"application/x-www-form-urlencoded"},Pa=new Nr(3e4,6e4),Ma={"Content-Type":"application/json"};function xa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function La(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Fa(t,e,n,r,i,o,s){(t=function(){var t=dr();return!((t=lr(t)!=hr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30||me&&Ie&&!(9<Ie))}()||ar()?E(t.o,t):(ka=ka||new jt((function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(a[qa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){da(t,null,e,void 0)}(_a(rt(Ua,{onload:qa})),(function(){e(Error("CORS_UNSUPPORTED"))})))}(t,e)})),E(t.m,t)))(e,n,r,i,o,s)}Aa.prototype.R=function(){return this.b},Aa.prototype.o=function(t,e,n,r,i,o){if(ar()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new zr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new $o(this.f);if(o){u.g=Math.max(0,o);var c=setTimeout((function(){u.dispatchEvent("timeout")}),o)}rn(u,"complete",(function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Ko(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)})),on(u,"ready",(function(){c&&clearTimeout(c),le(this)})),on(u,"timeout",(function(){c&&clearTimeout(c),le(this),e&&e(null)})),function(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():_o.a(),t.w=t.B?No(t.B):No(_o),t.a.onreadystatechange=E(t.Lb,t);try{Ko(t.b,ha(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(e){return Ko(t.b,ha(t,"Error opening Xhr: "+e.message)),void ra(t,e)}e=r||"";var o=new ln(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||s(t))F(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,(function(t,e){o.set(e,t)})),i=function(t){t:{for(var e=na,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:s(t)?t.charAt(e):t[e]}(o.X()),r=a.FormData&&e instanceof a.FormData,!V(ea,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{sa(t),0<t.g&&(t.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Ko(t.b,ha(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ga,t)):t.o=sn(t.Ga,t.g,t)),Ko(t.b,ha(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Ko(t.b,ha(t,"Send error: "+e.message)),ra(t,e)}}(u,t,n,r,i)};var Ua=new X(Z,"https://apis.google.com/js/client.js?onload=%{onload}"),qa="__fcb"+Math.floor(1e6*Math.random()).toString();function Va(t){if(!s(t=t.email)||!nr.test(t))throw new zr("invalid-email")}function Ba(t){"email"in t&&Va(t)}function ja(t){if(!t[Da])throw new zr("internal-error")}function Wa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new zr("internal-error")}else{if(!t.sessionInfo)throw new zr("missing-verification-id");if(!t.code)throw new zr("missing-verification-code")}}Aa.prototype.m=function(t,e,n,r,i){var o=this;ka.then((function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})})).s((function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})}))},Aa.prototype.ob=function(){return Is(this,ms,{})},Aa.prototype.rb=function(t,e){return Is(this,ds,{idToken:t,email:e})},Aa.prototype.sb=function(t,e){return Is(this,ys,{idToken:t,password:e})};var Qa={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ka(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new zr("internal-error")}function Ha(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Ga(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=Io(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=Io(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=Io(t)):t.errorMessage&&(e=Cs(t.errorMessage)),e)throw e;if(!t[Da])throw new zr("internal-error")}function za(t,e){return e.returnIdpCredential=!0,Is(t,vs,e)}function Ya(t,e){return e.returnIdpCredential=!0,Is(t,bs,e)}function Xa(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Is(t,gs,e)}function Ja(t){if(!t.oobCode)throw new zr("invalid-action-code")}(t=Aa.prototype).tb=function(t,e){var n={idToken:t},r=[];return K(Qa,(function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),Is(this,ds,n)},t.kb=function(t,e){return Y(t={requestType:"PASSWORD_RESET",email:t},e),Is(this,cs,t)},t.lb=function(t,e){return Y(t={requestType:"EMAIL_SIGNIN",email:t},e),Is(this,ss,t)},t.jb=function(t,e){return Y(t={requestType:"VERIFY_EMAIL",idToken:t},e),Is(this,us,t)},t.Va=function(t){return Is(this,Es,t)},t.$a=function(t,e){return Is(this,fs,{oobCode:t,newPassword:e})},t.Ka=function(t){return Is(this,Za,{oobCode:t})},t.Xa=function(t){return Is(this,$a,{oobCode:t})};var $a={endpoint:"setAccountInfo",D:Ja,fa:"email",F:!0},Za={endpoint:"resetPassword",D:Ja,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new zr("internal-error")},F:!0},ts={endpoint:"signupNewUser",D:function(t){if(Va(t),!t.password)throw new zr("weak-password")},K:ja,T:!0,F:!0},es={endpoint:"createAuthUri",F:!0},ns={endpoint:"deleteAccount",V:["idToken"]},rs={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new zr("internal-error")}},is={endpoint:"emailLinkSignin",V:["email","oobCode"],D:Va,K:ja,T:!0,F:!0},os={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:Va,K:ja,T:!0},as={endpoint:"getAccountInfo"},ss={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new zr("internal-error");Va(t)},fa:"email",F:!0},us={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new zr("internal-error")},fa:"email",F:!0},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new zr("internal-error");Va(t)},fa:"email",F:!0},hs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ls={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new zr("internal-error")}},fs={endpoint:"resetPassword",D:Ja,fa:"email",F:!0},ps={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ds={endpoint:"setAccountInfo",V:["idToken"],D:Ba,T:!0},ys={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Ba(t),!t.password)throw new zr("weak-password")},K:ja,T:!0},ms={endpoint:"signupNewUser",K:ja,T:!0,F:!0},vs={endpoint:"verifyAssertion",D:Ka,Qa:Ha,K:Ga,T:!0,F:!0},gs={endpoint:"verifyAssertion",D:Ka,Qa:Ha,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new zr("user-not-found");if(t.errorMessage)throw Cs(t.errorMessage);if(!t[Da])throw new zr("internal-error")},T:!0,F:!0},bs={endpoint:"verifyAssertion",D:function(t){if(Ka(t),!t.idToken)throw new zr("internal-error")},Qa:Ha,K:Ga,T:!0},ws={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new zr("invalid-custom-token")},K:ja,T:!0,F:!0},_s={endpoint:"verifyPassword",D:function(t){if(Va(t),!t.password)throw new zr("wrong-password")},K:ja,T:!0,F:!0},Es={endpoint:"verifyPhoneNumber",D:Wa,K:ja,F:!0},Ts={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new zr("internal-error");Wa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",Io(t);ja(t)}},Ss={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Wa,K:ja,F:!0};function Is(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new zr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then((function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=_n(t.h+e);bn(a,"key",t.c),o&&bn(a,"cb",S().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&bn(a,u,r[u]);return new jt((function(e,o){Fa(t,a.toString(),(function(t){t?t.error?o(Ns(t,i||{})):e(t):o(new zr("network-request-failed"))}),n,s?void 0:Qn(Er(r)),t.a,t.i.get())}))}(t,e.endpoint,i,n,e.Yb,e.wb||!1)})).then((function(t){return r=t,e.Qa?e.Qa(n,r):r})).then(e.K).then((function(){if(!e.fa)return r;if(!(e.fa in r))throw new zr("internal-error");return r[e.fa]}))}function Cs(t){return Ns({error:{errors:[{message:t}],code:400,message:t}})}function Ns(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new zr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",Y(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new zr(r[i],e);return!e&&t&&(e=_r(t)),new zr("internal-error",e)}function As(t){this.b=t,this.a=null,this.fb=function(t){return(Os=Os||new jt((function(t,e){function n(){Cr(),yr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Cr(),e(Error("Network Error"))},timeout:Ds.get()})}if(yr("gapi.iframes.Iframe"))t();else if(yr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){yr("gapi.load")?n():e(Error("Network Error"))},Yt(_a(r=rt(ks,{onload:r}))).s((function(){e(Error("Network Error"))}))}})).s((function(t){throw Os=null,t}))).then((function(){return new jt((function(e,n){yr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),Rs.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var ks=new X(Z,"https://apis.google.com/js/api.js?onload=%{onload}"),Ds=new Nr(3e4,6e4),Rs=new Nr(5e3,15e3),Os=null;function Ps(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ms(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function xs(t){try{return Wo.app(t).auth().Aa()}catch(t){return[]}}function Ls(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Fs(t){var e=Xn();return function(t){return Is(t,hs,{}).then((function(t){return t.authorizedDomains||[]}))}(t).then((function(t){t:{var n=_n(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(a=0==o.indexOf("chrome-extension://")?_n(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(er.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new To(Xn())}))}function Us(t){return t.l||(t.l=rr().then((function(){if(!t.o){var e=t.c,n=t.h,r=xs(t.b),i=new Ps(t.u,t.f,t.b);i.f=e,i.b=n,i.c=Q(r||[]),t.o=i.toString()}t.i=new As(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then((function(){t.a.register("authEvent",e,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(t.i,(function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=bo(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Yt(n)}return n.status="ERROR",Yt(n)}))}(t)}))),t.l}function qs(t){return t.m||(t.v=t.c?pr(t.c,xs(t.b)):null,t.m=new Aa(t.f,Ii(t.h),t.v)),t.m}function Vs(t,e,n,r,i,o,a,s,u,c,h){return(t=new Ms(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=G(u||null),t.f=c,t.nb(h).toString()}function Bs(t){if(this.a=t||Wo.INTERNAL.reactNative&&Wo.INTERNAL.reactNative.AsyncStorage,!this.a)throw new zr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function js(t){this.b=t,this.a={},this.f=E(this.c,this)}Ps.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Ms.prototype.nb=function(t){return this.h=t,this},Ms.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=Wo.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.ab=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=G(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.ab&&!n[e.cb]&&(n[e.cb]=e.ab),H(n)||bn(t,"customParameters",_r(n))}if("function"==typeof this.a.Hb&&(e=this.a.Hb()).length&&bn(t,"scopes",e.join(",")),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=xs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Ls.prototype).Fb=function(t,e,n){var r=new zr("popup-closed-by-user"),i=new zr("web-storage-unsupported"),o=this,a=!1;return this.ia().then((function(){(function(t){var e={type:"webStorageSupport"};return Us(t).then((function(){return function(t,e){return t.fb.then((function(){return new jt((function(n){t.a.send(e.type,e,n,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(t.i,e)})).then((function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(t&&Zn(t),e(i),a=!0)}))})).s((function(){})).then((function(){if(!a)return function(t){return new jt((function(e){return function n(){un(2e3).then((function(){if(t&&!t.closed)return n();e()}))}()}))}(t)})).then((function(){if(!a)return un(n).then((function(){e(r)}))}))},t.Ob=function(){var t=dr();return!wr(t)&&!Ir(t)},t.Jb=function(){return!1},t.Db=function(t,e,n,r,i,o,a,s){if(!t)return Xt(new zr("popup-blocked"));if(a&&!wr())return this.ia().s((function(e){Zn(t),i(e)})),r(),Yt();this.a||(this.a=Fs(qs(this)));var u=this;return this.a.then((function(){var e=u.ia().s((function(e){throw Zn(t),i(e),e}));return r(),e})).then((function(){vo(n),a||Jn(Vs(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)})).s((function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t}))},t.Eb=function(t,e,n,r){this.a||(this.a=Fs(qs(this)));var i=this;return this.a.then((function(){vo(e),Jn(Vs(i.u,i.f,i.b,t,e,Xn(),n,i.c,void 0,i.h,r))})).s((function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t}))},t.ia=function(){var t=this;return Us(this).then((function(){return t.i.fb})).s((function(){throw t.a=null,new zr("network-request-failed")}))},t.Rb=function(){return!0},t.ya=function(t){this.g.push(t)},t.La=function(t){j(this.g,(function(e){return e==t}))},(t=Bs.prototype).get=function(t){return Yt(this.a.getItem(t)).then((function(t){return t&&Tr(t)}))},t.set=function(t,e){return Yt(this.a.setItem(t,_r(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Ws,Qs=[];function Ks(t,e,n){H(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Hs(t){this.a=t}function Gs(t){this.c=t,this.b=!1,this.a=[]}function zs(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Xt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt((function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout((function(){r(Error("unsupported_event"))}),h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))})).then((function(e){return Ys(t,c),e})).s((function(e){throw Ys(t,c),e}))}function Ys(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),j(t.a,(function(t){return t==e}))}}function Xs(){if(!$s())throw new zr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=a.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;ar()&&self?(this.l=function(){var t=ar()?self:null;if(F(Qs,(function(n){n.b==t&&(e=n)})),!e){var e=new js(t);Qs.push(e)}return e}(),Ks(this.l,"keyChanged",(function(e,n){return ru(t).then((function(e){return 0<e.length&&F(t.a,(function(t){t(e)})),{keyProcessed:V(e,n.key)}}))})),Ks(this.l,"ping",(function(){return Yt(["keyChanged"])}))):function(){var t=a.navigator;return t&&t.serviceWorker?Yt().then((function(){return t.serviceWorker.ready})).then((function(t){return t.active||null})).s((function(){return null})):Yt(null)}().then((function(e){(t.h=e)&&(t.g=new Gs(new Hs(e)),zs(t.g,"ping",null,!0).then((function(e){e[0].fulfilled&&V(e[0].value,"keyChanged")&&(t.o=!0)})).s((function(){})))}))}function Js(t){return t.m||(t.m=function t(e){return new jt((function(n,r){var i=e.u.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(t){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){r(t)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new jt((function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}}))}(e).then((function(){return t(e)})).then((function(t){n(t)})).s((function(t){r(t)}))}}))}(t)),t.m}function $s(){try{return!!a.indexedDB}catch(t){return!1}}function Zs(t){return t.objectStore("firebaseLocalStorage")}function tu(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function eu(t){return new jt((function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}}))}function nu(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?zs(t.g,"keyChanged",{key:e},t.o).then((function(){})).s((function(){})):Yt()}function ru(t){return Js(t).then((function(t){var e=Zs(tu(t,!1));return e.getAll?eu(e.getAll()):new jt((function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}}))})).then((function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r}))}function iu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function ou(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then((function(){if($s()){var t=Sr(),r="__sak"+t;return Ws=Ws||new Xs,(n=Ws).set(r,t).then((function(){return n.get(r)})).then((function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)})).then((function(){return n})).s((function(){return e.c}))}return e.c})).then((function(t){return e.type=t.type,t.$((function(t){F(e.a,(function(e){e(t)}))})),t}))}function au(){this.a={},this.type="inMemory"}function su(){if(!function(){var t="Node"==sr();if(!(t=uu()||t&&Wo.INTERNAL.node&&Wo.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The LocalStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=uu()||Wo.INTERNAL.node.localStorage,this.type="localStorage"}function uu(){try{var t=a.localStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function cu(){this.type="nullStorage"}function hu(){if(!function(){var t="Node"==sr();if(!(t=lu()||t&&Wo.INTERNAL.node&&Wo.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The SessionStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=lu()||Wo.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function lu(){try{var t=a.sessionStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){var t={};t.Browser=yu,t.Node=mu,t.ReactNative=vu,t.Worker=gu,this.a=t[sr()]}js.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,(function(e){i.push(Yt().then((function(){return e(t.origin,t.data.data)})))})),$t(i).then((function(r){var i=[];F(r,(function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})})),F(i,(function(t){for(var e in t)void 0===t[e]&&delete t[e]})),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})}))}},Hs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Gs.prototype.close=function(){for(;0<this.a.length;)Ys(this,this.a[0]);this.b=!0},(t=Xs.prototype).set=function(t,e){var n,r=!1,i=this;return Js(this).then((function(e){return eu((e=Zs(tu(n=e,!0))).get(t))})).then((function(o){var a=Zs(tu(n,!0));return o?(o.value=e,eu(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,eu(a.add(o)))})).then((function(){return i.c[t]=e,nu(i,t)})).ka((function(){r&&i.b--}))},t.get=function(t){return Js(this).then((function(e){return eu(Zs(tu(e,!1)).get(t))})).then((function(t){return t&&t.value}))},t.S=function(t){var e=!1,n=this;return Js(this).then((function(r){return e=!0,n.b++,eu(Zs(tu(r,!0)).delete(t))})).then((function(){return delete n.c[t],nu(n,t)})).ka((function(){e&&n.b--}))},t.$=function(t){0==this.a.length&&function(t){iu(t),function e(){t.f=setTimeout((function(){t.i=ru(t).then((function(e){0<e.length&&F(t.a,(function(t){t(e)}))})).then((function(){e()})).s((function(t){"STOP_EVENT"!=t.message&&e()}))}),800)}()}(this),this.a.push(t)},t.ea=function(t){j(this.a,(function(e){return e==t})),0==this.a.length&&iu(this)},(t=ou.prototype).get=function(t){return this.b.then((function(e){return e.get(t)}))},t.set=function(t,e){return this.b.then((function(n){return n.set(t,e)}))},t.S=function(t){return this.b.then((function(e){return e.S(t)}))},t.$=function(t){this.a.push(t)},t.ea=function(t){j(this.a,(function(e){return e==t}))},(t=au.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=su.prototype).get=function(t){var e=this;return Yt().then((function(){return Tr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Yt().then((function(){var r=_r(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Yt().then((function(){e.a.removeItem(t)}))},t.$=function(t){a.window&&Qe(a.window,"storage",t)},t.ea=function(t){a.window&&Ge(a.window,"storage",t)},(t=cu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then((function(){return Tr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Yt().then((function(){var r=_r(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Yt().then((function(){e.a.removeItem(t)}))},t.$=function(){},t.ea=function(){};var pu,du,yu={C:su,Sa:hu},mu={C:su,Sa:hu},vu={C:Bs,Sa:cu},gu={C:su,Sa:cu},bu={$c:"local",NONE:"none",bd:"session"};function wu(){var t=!(Ir(dr())||!or()),e=wr(),n=mr();this.m=t,this.h=e,this.l=n,this.a={},t=pu=pu||new fu;try{this.g=!Yn()&&Dr()||!a.indexedDB?new t.a.C:new ou(ar()?new au:new t.a.C)}catch(t){this.g=new au,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new au}this.u=new au,this.f=E(this.Pb,this),this.b={}}function _u(){return du=du||new wu}function Eu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Tu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Su(t,e,n){return n=Tu(e,n),"local"==e.C&&(t.b[n]=null),Eu(t,e.C).S(n)}function Iu(t){t.c&&(clearInterval(t.c),t.c=null)}function Cu(t){this.a=t,this.b=_u()}(t=wu.prototype).get=function(t,e){return Eu(this,t.C).get(Tu(t,e))},t.set=function(t,e,n){var r=Tu(t,n),i=this,o=Eu(this,t.C);return o.set(r,e).then((function(){return o.get(r)})).then((function(e){"local"==t.C&&(i.b[r]=e)}))},t.addListener=function(t,e,n){t=Tu(t,e),this.l&&(this.b[t]=a.localStorage.getItem(t)),H(this.a)&&(Eu(this,"local").$(this.f),this.h||(Yn()||!Dr())&&a.indexedDB||!this.l||function(t){Iu(t),t.c=setInterval((function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Pe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}}),1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Tu(t,e),this.a[t]&&(j(this.a[t],(function(t){return t==n})),0==this.a[t].length&&delete this.a[t]),H(this.a)&&(Eu(this,"local").ea(this.f),Iu(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Za(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Eu(this,"local").ea(this.f):Iu(this),this.m)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.Za(e))},me&&Ie&&10==Ie&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,E(this.Za,this))},t.Za=function(t){this.a[t]&&F(this.a[t],(function(t){t()}))};var Nu,Au={name:"authEvent",C:"local"};function ku(){this.a=_u()}function Du(t,e){this.b=Ru,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=a.Int32Array?new Int32Array(64):Array(64),void 0!==Nu||(Nu=a.Int32Array?new Int32Array(Uu):Uu),this.reset()}I(Du,(function(){this.b=-1}));for(var Ru=64,Ou=Ru-1,Pu=[],Mu=0;Mu<Ou;Mu++)Pu[Mu]=0;var xu=W(128,Pu);function Lu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Nu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Fu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Lu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Lu(t),i=0)}}t.c=i,t.g+=n}Du.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):Q(this.h)};var Uu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function qu(){Du.call(this,8,Vu)}I(qu,Du);var Vu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Bu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new ku,this.g=new Cu(this.h),this.f=null,this.b=[],this.a=this.c=null}function ju(t){return new zr("invalid-cordova-configuration",t)}function Wu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Qu(t){return t.f||(t.f=t.ia().then((function(){return new jt((function(e){t.ya((function n(r){return e(r),t.La(n),!1})),function(t){function e(e){r=!0,i&&i.cancel(),Ku(t).then((function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=qi(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Tr(wn(o=_n(i),"firebaseError")||null))?Yr(o):null)?new go(r.c,r.b,null,null,o,null,r.R()):new go(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}Wu(t,i)}))}var n=new go("unknown",null,null,null,new zr("no-auth-event")),r=!1,i=un(500).then((function(){return Ku(t).then((function(){r||Wu(t,n)}))})),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(yr("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},Eo=Eo||new wo,function(t){var e=Eo;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=yr("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)}))}))),t.f}function Ku(t){var e=null;return function(t){return t.b.get(Au,t.a).then((function(t){return bo(t)}))}(t.g).then((function(n){return e=n,Su((n=t.g).b,Au,n.a)})).then((function(){return e}))}function Hu(t){this.a=t,this.b=_u()}(t=Bu.prototype).ia=function(){return this.Ba?this.Ba:this.Ba=(ir(void 0)?rr().then((function(){return new jt((function(t,e){var n=a.document,r=setTimeout((function(){e(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),t()}),!1)}))})):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof yr("universalLinks.subscribe",a))throw ju("cordova-universal-links-plugin-fix is not installed");if(void 0===yr("BuildInfo.packageName",a))throw ju("cordova-plugin-buildinfo is not installed");if("function"!=typeof yr("cordova.plugins.browsertab.openUrl",a))throw ju("cordova-plugin-browsertab is not installed");if("function"!=typeof yr("cordova.InAppBrowser.open",a))throw ju("cordova-plugin-inappbrowser is not installed")}),(function(){throw new zr("cordova-not-ready")}))},t.Fb=function(t,e){return e(new zr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new zr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new zr("redirect-operation-pending"));var i=this,o=a.document,s=null,u=null,c=null,h=null;return this.c=Yt().then((function(){return vo(e),Qu(i)})).then((function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new go(e,r,null,o,new zr("no-auth-event"),null,i),u=yr("BuildInfo.packageName",a);if("string"!=typeof u)throw new zr("invalid-cordova-configuration");var c=yr("BuildInfo.displayName",a),h={};if(dr().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=u;else{if(!dr().toLowerCase().match(/android/))return Xt(new zr("operation-not-supported-in-this-environment"));h.apn=u}c&&(h.appDisplayName=c),o=function(t){var e=new qu;Fu(e,t),t=[];var n=8*e.g;e.c<56?Fu(e,xu,56-e.c):Fu(e,xu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Lu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return U(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}(t)}(o),h.sessionId=o;var l=Vs(t.u,t.i,t.l,e,n,null,r,t.m,h,t.o,i);return t.ia().then((function(){var e=t.h;return t.v.a.set(Au,s.A(),e)})).then((function(){var e=yr("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new zr("invalid-cordova-configuration");var n=null;e((function(e){if(e){if("function"!=typeof(n=yr("cordova.plugins.browsertab.openUrl",a)))throw new zr("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=yr("cordova.InAppBrowser.open",a)))throw new zr("invalid-cordova-configuration");e=dr(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,t,e,n,r)})).then((function(){return new jt((function(t,e){u=function(){var e=yr("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.ya(u),c=function(){s=s||un(2e3).then((function(){e(new zr("redirect-cancelled-by-user"))}))},h=function(){Ar()&&c()},o.addEventListener("resume",c,!1),dr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)})).s((function(t){return Ku(i).then((function(){throw t}))}))})).ka((function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),s&&s.cancel(),u&&i.La(u),i.c=null}))},t.ya=function(t){this.b.push(t),Qu(this).s((function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new go("unknown",null,null,null,new zr("no-auth-event")),t(e))}))},t.La=function(t){j(this.b,(function(e){return e==t}))};var Gu={name:"pendingRedirect",C:"session"};function zu(t){return Su(t.b,Gu,t.a)}function Yu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=E(this.o,this),this.b=new cc,this.w=new dc,this.g=new Hu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=Xu(this.B,this.u,this.m,Ti)}function Xu(t,e,n,r){var i=Wo.SDK_VERSION||null;return ir()?new Bu(t,e,n,i,r):new Ls(t,e,n,i,r)}function Ju(t){t.f||(t.f=!0,t.a.ya(t.l));var e=t.a;return t.a.ia().s((function(n){throw t.a==e&&t.reset(),n}))}function $u(t){t.a.Ob()&&Ju(t).s((function(e){var n=new go("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));ic(e)&&t.o(n)})),t.a.Jb()||hc(t.b)}function Zu(t,e){V(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(Gu,t.a).then((function(t){return"pending"==t}))}(t.g).then((function(e){e?zu(t.g).then((function(){Ju(t).s((function(e){var n=new go("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));ic(e)&&t.o(n)}))})):$u(t)})).s((function(){$u(t)}))}function tc(t,e){j(t.h,(function(t){return t==e}))}Yu.prototype.reset=function(){this.f=!1,this.a.La(this.l),this.a=Xu(this.B,this.u,this.m),this.i={}},Yu.prototype.o=function(t){if(!t)throw new zr("invalid-auth-event");if(6e5<=S()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=S())),e=!0;break}}return hc(this.b),e};var ec=new Nr(2e3,1e4),nc=new Nr(3e4,6e4);function rc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,(function(){t.f||(t.f=!0,t.a.ya(t.l))}),(function(){t.reset()}),i,o,a)}function ic(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function oc(t,e,n,r,i){var o;return function(t){return t.b.set(Gu,"pending",t.a)}(t.g).then((function(){return t.a.Eb(e,n,r,i).s((function(e){if(ic(e))throw new zr("operation-not-supported-in-this-environment");return o=e,zu(t.g).then((function(){throw o}))})).then((function(){return t.a.Rb()?new jt((function(){})):zu(t.g).then((function(){return t.oa()})).then((function(){})).s((function(){}))}))}))}function ac(t,e,n,r,i){return t.a.Fb(r,(function(t){e.ja(n,null,t,i)}),ec.get())}Yu.prototype.oa=function(){return this.b.oa()};var sc={};function uc(t,e,n){var r=e+":"+n;return sc[r]||(sc[r]=new Yu(t,e,n)),sc[r]}function cc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function hc(t){t.g||(t.g=!0,pc(t,!1,null,null))}function lc(t){t.g&&!t.i&&pc(t,!1,null,null)}function fc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function pc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):fc(t,n):fc(t,{user:null}),t.f=[],t.c=[]}function dc(){}function yc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function mc(t,e){this.a=e,xr(this,"verificationId",t)}function vc(t,e,n,r){return new po(t).Va(e,n).then((function(t){return new mc(t,r)}))}function gc(t){var e=Ei(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new zr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Lr(this,{token:t,expirationTime:kr(1e3*e.exp),authTime:kr(1e3*e.auth_time),issuedAtTime:kr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function bc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function wc(t){this.f=t,this.b=this.a=null,this.c=0}function _c(t,e){var n=e[Da],r=e.refreshToken;e=Ec(e.expiresIn),t.b=n,t.c=e,t.a=r}function Ec(t){return S()+1e3*parseInt(t,10)}function Tc(t,e){this.a=t||null,this.b=e||null,Lr(this,{lastSignInTime:kr(e||null),creationTime:kr(t||null)})}function Sc(t,e,n,r,i,o){Lr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Ic(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Cc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=Wo.SDK_VERSION?pr(Wo.SDK_VERSION):null,this.a=new Aa(this.l,Ii(Ti),t),this.b=new wc(this.a),Pc(this,e[Da]),_c(this.b,e),xr(this,"refreshToken",this.b.a),Lc(this,n||{}),nn.call(this),this.J=!1,this.o&&vr()&&(this.i=uc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new bc((function(){return t.G(!0)}),(function(t){return!(!t||"auth/network-request-failed"!=t.code)}),(function(){var e=t.b.c-S()-3e5;return 0<e?e:0}))}(this),this.W=E(this.Ha,this);var r=this;this.ga=null,this.va=function(t){r.sa(t.g)},this.Z=null,this.P=[],this.ua=function(t){Ac(r,t.c)},this.Y=null}function Nc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.va),(t.Z=e)&&Qe(e,"languageCodeChanged",t.va)}function Ac(t,e){t.P=e,La(t.a,Wo.SDK_VERSION?pr(Wo.SDK_VERSION,t.P):null)}function kc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.ua),(t.Y=e)&&Qe(e,"frameworkChanged",t.ua)}function Dc(t){try{return Wo.app(t.m).auth()}catch(e){throw new zr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Rc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Qe(t,"tokenChanged",t.W))}function Oc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function Pc(t,e){t.ma=e,xr(t,"_lat",e)}function Mc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then((function(){return t}))}function xc(t){t.i&&!t.J&&(t.J=!0,Zu(t.i,t))}function Lc(t,e){Lr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new Tc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Fc(){}function Uc(t){return Yt().then((function(){if(t.B)throw new zr("app-deleted")}))}function qc(t){return U(t.providerData,(function(t){return t.providerId}))}function Vc(t,e){e&&(Bc(t,e.providerId),t.providerData.push(e))}function Bc(t,e){j(t.providerData,(function(t){return t.providerId==e}))}function jc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function Wc(t,e){t!=e&&(Lr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?xr(t,"metadata",function(t){return new Tc(t.a,t.b)}(e.metadata)):xr(t,"metadata",new Tc),F(e.providerData,(function(e){Vc(t,e)})),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),xr(t,"refreshToken",t.b.a))}function Qc(t){return t.G().then((function(e){var n=t.isAnonymous;return function(t,e){return Is(t.a,as,{idToken:e}).then(E(t.zc,t))}(t,e).then((function(){return n||jc(t,"isAnonymous",!1),e}))}))}function Kc(t,e){e[Da]&&t.ma!=e[Da]&&(_c(t.b,e),t.dispatchEvent(new Ic("tokenChanged")),Pc(t,e[Da]),jc(t,"refreshToken",t.b.a))}function Hc(t,e){return Qc(t).then((function(){if(V(qc(t),e))return Mc(t).then((function(){throw new zr("provider-already-linked")}))}))}function Gc(t,e,n){return Fr({user:t,credential:mo(e),additionalUserInfo:e=Di(e),operationType:n})}function zc(t,e){return Kc(t,e),t.reload().then((function(){return t}))}function Yc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=ki(n.providerId),a=Sr(t.uid+":::"),s=null;(!wr()||or())&&t.o&&n.isOAuthProvider&&(s=Vs(t.o,t.l,t.m,e,n,null,a,Wo.SDK_VERSION||null,null,null,t.tenantId));var u=tr(s,o&&o.Da,o&&o.Ca);return r=r().then((function(){if(Jc(t),!i)return t.G().then((function(){}))})).then((function(){return rc(t.i,u,e,n,a,!!s,t.tenantId)})).then((function(){return new jt((function(n,r){t.ja(e,null,new zr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.c=ac(t.i,t,e,u,a)}))})).then((function(t){return u&&Zn(u),t?Fr(t):null})).s((function(t){throw u&&Zn(u),t})),$c(t,r,i)}function Xc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=null,a=Sr(t.uid+":::");return r=r().then((function(){if(Jc(t),!i)return t.G().then((function(){}))})).then((function(){return t.ca=a,Mc(t)})).then((function(e){return t.da&&(e=(e=t.da).b.set(eh,t.A(),e.a)),e})).then((function(){return oc(t.i,e,n,a,t.tenantId)})).s((function(e){if(o=e,t.da)return nh(t.da);throw o})).then((function(){if(o)throw o})),$c(t,r,i)}function Jc(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new zr("internal-error");throw new zr("auth-domain-config-required")}}function $c(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Xt(t.h)):e.s((function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Ic("userInvalidated")),t.h=e),e}))}(t,e,n);return t.I.push(r),r.ka((function(){B(t.I,r)})),r}function Zc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Da]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-S())/1e3;var r=new Cc(e,n,t);return t.providerData&&F(t.providerData,(function(t){t&&Vc(r,Fr(t))})),t.redirectEventId&&(r.ca=t.redirectEventId),r}function th(t){this.a=t,this.b=_u()}cc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},cc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(pc(this,!0,null,t.a),Yt()):e.za(n,r)?function(t,e,n){n=n.za(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then((function(e){pc(t,s,e,null)})).s((function(e){pc(t,s,null,e)}))}(this,t,e):Xt(new zr("invalid-auth-event")):(pc(this,!1,null,null),Yt())}else Xt(new zr("invalid-auth-event"))},cc.prototype.oa=function(){var t=this;return new jt((function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new zr("timeout");t.a&&t.a.cancel(),t.a=un(nc.get()).then((function(){t.b||(t.g=!0,pc(t,!0,null,e))}))}(t))}))},dc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.za(n,r)?function(t,e){var n=t.b,r=t.c;e.za(r,n)(t.g,t.f,t.R(),t.i).then((function(t){e.ja(r,t,null,n)})).s((function(t){e.ja(r,null,t,n)}))}(t,e):Xt(new zr("invalid-auth-event"))}else Xt(new zr("invalid-auth-event"))},mc.prototype.confirm=function(t){return t=yo(this.verificationId,t),this.a(t)},bc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=un(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then((function(){return t=a.document,e=null,Ar()||!t?Yt():new jt((function(n){e=function(){Ar()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)})).s((function(n){throw t.removeEventListener("visibilitychange",e,!1),n}));var t,e})).then((function(){return e.h()})).then((function(){t(e,!0)})).s((function(n){e.i(n)&&t(e,!1)}))}(this,!0)},bc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},wc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},wc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new zr("user-token-expired")):t||!this.b||S()>this.c-3e4?this.a?function(t,e){return function(t,e){return new jt((function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Fa(t,t.l+"?key="+encodeURIComponent(t.c),(function(t){t?t.error?r(Ns(t)):t.access_token&&t.refresh_token?n(t):r(new zr("internal-error")):r(new zr("network-request-failed"))}),"POST",Pn(e).toString(),t.g,t.u.get()):r(new zr("internal-error"))}))}(t.f,e).then((function(e){return t.b=e.access_token,t.c=Ec(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}})).s((function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e}))}(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Tc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},I(Ic,Oe),I(Cc,nn),Cc.prototype.sa=function(t){this.ga=t,xa(this.a,t)},Cc.prototype.ha=function(){return this.ga},Cc.prototype.Aa=function(){return Q(this.P)},Cc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(Cc.prototype,"providerId","firebase"),(t=Cc.prototype).reload=function(){var t=this;return $c(this,Uc(this).then((function(){return Qc(t).then((function(){return Mc(t)})).then(Fc)})))},t.dc=function(t){return this.G(t).then((function(t){return new gc(t)}))},t.G=function(t){var e=this;return $c(this,Uc(this).then((function(){return e.b.getToken(t)})).then((function(t){if(!t)throw new zr("internal-error");return t.accessToken!=e.ma&&(Pc(e,t.accessToken),e.dispatchEvent(new Ic("tokenChanged"))),jc(e,"refreshToken",t.refreshToken),t.accessToken})))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new zr("internal-error");Lc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?U(t,(function(t){return new Sc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)})):[]}(t),n=0;n<e.length;n++)Vc(this,e[n]);jc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Pr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.gb(t)},t.gb=function(t){var e=this,n=null;return $c(this,t.f(this.a,this.uid).then((function(t){return Kc(e,t),n=Gc(e,t,"reauthenticate"),e.h=null,e.reload()})).then((function(){return n})),!0)},t.rc=function(t){return Pr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.eb(t)},t.eb=function(t){var e=this,n=null;return $c(this,Hc(this,t.providerId).then((function(){return e.G()})).then((function(n){return t.b(e.a,n)})).then((function(t){return n=Gc(e,t,"link"),zc(e,t)})).then((function(){return n})))},t.sc=function(t,e){var n=this;return $c(this,Hc(this,"phone").then((function(){return vc(Dc(n),t,e,E(n.eb,n))})))},t.Bc=function(t,e){var n=this;return $c(this,Yt().then((function(){return vc(Dc(n),t,e,E(n.gb,n))})),!0)},t.rb=function(t){var e=this;return $c(this,this.G().then((function(n){return e.a.rb(n,t)})).then((function(t){return Kc(e,t),e.reload()})))},t.Sc=function(t){var e=this;return $c(this,this.G().then((function(n){return t.b(e.a,n)})).then((function(t){return Kc(e,t),e.reload()})))},t.sb=function(t){var e=this;return $c(this,this.G().then((function(n){return e.a.sb(n,t)})).then((function(t){return Kc(e,t),e.reload()})))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Uc(this);var e=this;return $c(this,this.G().then((function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})})).then((function(t){return Kc(e,t),jc(e,"displayName",t.displayName||null),jc(e,"photoURL",t.photoUrl||null),F(e.providerData,(function(t){"password"===t.providerId&&(xr(t,"displayName",e.displayName),xr(t,"photoURL",e.photoURL))})),Mc(e)})).then(Fc))},t.Qc=function(t){var e=this;return $c(this,Qc(this).then((function(n){return V(qc(e),t)?function(t,e,n){return Is(t,rs,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then((function(t){var n={};return F(t.providerUserInfo||[],(function(t){n[t.providerId]=!0})),F(qc(e),(function(t){n[t]||Bc(e,t)})),n[po.PROVIDER_ID]||xr(e,"phoneNumber",null),Mc(e)})):Mc(e).then((function(){throw new zr("no-such-provider")}))})))},t.delete=function(){var t=this;return $c(this,this.G().then((function(e){return Is(t.a,ns,{idToken:e})})).then((function(){t.dispatchEvent(new Ic("userDeleted"))}))).then((function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");Nc(t,null),kc(t,null),t.I=[],t.B=!0,Oc(t),xr(t,"refreshToken",null),t.i&&tc(t.i,t)}))},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?E(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?E(this.Cb,this):null},t.tc=function(t){var e=this;return Yc(this,"linkViaPopup",t,(function(){return Hc(e,t.providerId).then((function(){return Mc(e)}))}),!1)},t.Cc=function(t){return Yc(this,"reauthViaPopup",t,(function(){return Yt()}),!0)},t.uc=function(t){var e=this;return Xc(this,"linkViaRedirect",t,(function(){return Hc(e,t.providerId)}),!1)},t.Dc=function(t){return Xc(this,"reauthViaRedirect",t,(function(){return Yt()}),!0)},t.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return $c(this,this.G().then((function(n){return Ya(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})})).then((function(t){return o=Gc(i,t,"link"),zc(i,t)})).then((function(){return o})))},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return $c(this,Yt().then((function(){return Bi(Xa(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)})).then((function(t){return o=Gc(i,t,"reauthenticate"),Kc(i,t),i.h=null,i.reload()})).then((function(){return o})),!0)},t.jb=function(t){var e=this,n=null;return $c(this,this.G().then((function(e){return n=e,void 0===t||H(t)?{}:vi(new si(t))})).then((function(t){return e.a.jb(n,t)})).then((function(t){if(e.email!=t)return e.reload()})).then((function(){})))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&Y(t,this.metadata.A()),F(this.providerData,(function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))})),t};var eh={name:"redirectUser",C:"session"};function nh(t){return Su(t.b,eh,t.a)}function rh(t){this.a=t,this.b=_u(),this.c=null,this.f=function(t){var e=ah("local"),n=ah("session"),r=ah("none");return function(t,e,n){var r=Tu(e,n),i=Eu(t,e.C);return t.get(e,n).then((function(o){var s=null;try{s=Tr(a.localStorage.getItem(r))}catch(o){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)}))}(t.b,e,t.a).then((function(){return t.b.get(n,t.a)})).then((function(i){return i?n:t.b.get(r,t.a).then((function(n){return n?r:t.b.get(e,t.a).then((function(n){return n?e:t.b.get(oh,t.a).then((function(t){return t?ah(t):e}))}))}))})).then((function(e){return t.c=e,ih(t,e.C)})).s((function(){t.c||(t.c=e)}))}(this),this.b.addListener(ah("local"),this.a,E(this.g,this))}function ih(t,e){var n,r=[];for(n in bu)bu[n]!==e&&r.push(Su(t.b,ah(bu[n]),t.a));return r.push(Su(t.b,oh,t.a)),function(t){return new jt((function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Jt(t[s],T(o,s),a);else e(i)}))}(r)}rh.prototype.g=function(){var t=this,e=ah("local");hh(this,(function(){return Yt().then((function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null})).then((function(n){if(n)return ih(t,"local").then((function(){t.c=e}))}))}))};var oh={name:"persistence",C:"session"};function ah(t){return{name:"authUser",C:t}}function sh(t,e){return hh(t,(function(){return t.b.set(t.c,e.A(),t.a)}))}function uh(t){return hh(t,(function(){return Su(t.b,t.c,t.a)}))}function ch(t,e){return hh(t,(function(){return t.b.get(t.c,t.a).then((function(t){return t&&e&&(t.authDomain=e),Zc(t||{})}))}))}function hh(t,e){return t.f=t.f.then(e,e),t.f}function lh(t){if(this.l=!1,xr(this,"settings",new yc),xr(this,"app",t),!bh(this).options||!bh(this).options.apiKey)throw new zr("invalid-api-key");t=Wo.SDK_VERSION?pr(Wo.SDK_VERSION):null,this.b=new Aa(bh(this).options&&bh(this).options.apiKey,Ii(Ti),t),this.O=[],this.m=[],this.J=[],this.Ub=Wo.INTERNAL.createSubscribe(E(this.oc,this)),this.W=void 0,this.Vb=Wo.INTERNAL.createSubscribe(E(this.pc,this)),vh(this,null),this.h=new rh(bh(this).options.apiKey+":"+bh(this).name),this.w=new th(bh(this).options.apiKey+":"+bh(this).name),this.Y=Th(this,function(t){var e=bh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(eh,t.a).then((function(t){return t&&e&&(t.authDomain=e),Zc(t||{})}))}(t.w,bh(t).options.authDomain).then((function(e){return(t.B=e)&&(e.da=t.w),nh(t.w)}));return Th(t,e)}(t).then((function(){return ch(t.h,e)})).then((function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then((function(){return sh(t.h,e).then((function(){return e}))})).s((function(n){return"auth/network-request-failed"==n.code?e:uh(t.h)}))):null})).then((function(e){vh(t,e||null)}));return Th(t,n)}(this)),this.i=Th(this,function(t){return t.Y.then((function(){return yh(t)})).s((function(){})).then((function(){if(!t.l)return t.ma()})).s((function(){})).then((function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(ah("local"),e.a,t.ma)}}))}(this)),this.ga=!1,this.ma=E(this.Nc,this),this.ub=E(this.aa,this),this.ua=E(this.bc,this),this.va=E(this.mc,this),this.Ha=E(this.nc,this),this.a=null,function(t){var e=bh(t).options.authDomain,n=bh(t).options.apiKey;e&&vr()&&(t.Tb=t.Y.then((function(){if(!t.l){if(t.a=uc(e,n,bh(t).name),Zu(t.a,t),wh(t)&&xc(wh(t)),t.B){xc(t.B);var r=t.B;r.sa(t.ha()),Nc(r,t),Ac(r=t.B,t.I),kc(r,t),t.B=null}return t.a}})))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.sa(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function fh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function ph(t){Oe.call(this,"frameworkChanged"),this.c=t}function dh(t){return t.Tb||Xt(new zr("auth-domain-config-required"))}function yh(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=dh(t).then((function(){return t.a.oa()})).then((function(t){return t?Fr(t):null}));return Th(t,e)}function mh(t,e){var n={};return n.apiKey=bh(t).options.apiKey,n.authDomain=bh(t).options.authDomain,n.appName=bh(t).name,t.Y.then((function(){return function(t,e,n,r){var i=new Cc(t,e);return n&&(i.da=n),r&&Ac(i,r),i.reload().then((function(){return i}))}(n,e,t.w,t.Aa())})).then((function(e){return wh(t)&&e.uid==wh(t).uid?Wc(wh(t),e):(vh(t,e),xc(e)),t.aa(e)})).then((function(){Eh(t)}))}function vh(t,e){wh(t)&&(function(t,e){j(t.O,(function(t){return t==e}))}(wh(t),t.ub),Ge(wh(t),"tokenChanged",t.ua),Ge(wh(t),"userDeleted",t.va),Ge(wh(t),"userInvalidated",t.Ha),Oc(wh(t))),e&&(e.O.push(t.ub),Qe(e,"tokenChanged",t.ua),Qe(e,"userDeleted",t.va),Qe(e,"userInvalidated",t.Ha),0<t.o&&Rc(e)),xr(t,"currentUser",e),e&&(e.sa(t.ha()),Nc(e,t),Ac(e,t.I),kc(e,t))}function gh(t,e){var n=null,r=null;return Th(t,e.then((function(e){return n=mo(e),r=Di(e),mh(t,e)})).then((function(){return Fr({user:wh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function bh(t){return t.app}function wh(t){return t.currentUser}function _h(t){return wh(t)&&wh(t)._lat||null}function Eh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](_h(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](_h(t))}}function Th(t,e){return t.O.push(e),e.ka((function(){B(t.O,e)})),e}function Sh(){}function Ih(){this.a={},this.b=1e12}rh.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new zr("invalid-persistence-type"),n=new zr("unsupported-persistence-type");t:{for(r in bu)if(bu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(sr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!mr()&&"none"!==t)throw n}}(t),hh(this,(function(){return t!=n.c.C?n.b.get(n.c,n.a).then((function(r){return e=r,ih(n,t)})).then((function(){if(n.c=ah(t),e)return n.b.set(n.c,e,n.a)})):Yt()}))},I(lh,nn),I(fh,Oe),I(ph,Oe),(t=lh.prototype).mb=function(t){return Th(this,t=this.h.mb(t))},t.sa=function(t){this.Z===t||this.l||(this.Z=t,xa(this.b,this.Z),this.dispatchEvent(new fh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=a.navigator;this.sa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),La(this.b,Wo.SDK_VERSION?pr(Wo.SDK_VERSION,this.I):null),this.dispatchEvent(new ph(this.I))},t.Aa=function(){return Q(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:bh(this).options.apiKey,authDomain:bh(this).options.authDomain,appName:bh(this).name,currentUser:wh(this)&&wh(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=za(i.b,t).then((function(t){return o=mo(t),a=Di(t),t}));return Th(this,t=i.Y.then((function(){return s})).then((function(t){return mh(i,t)})).then((function(){return Fr({user:wh(i),credential:o,additionalUserInfo:a,operationType:"signIn"})})))},t.Lc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this,n=ki(t.providerId),r=Sr(),i=null;(!wr()||or())&&bh(this).options.authDomain&&t.isOAuthProvider&&(i=Vs(bh(this).options.authDomain,bh(this).options.apiKey,bh(this).name,"signInViaPopup",t,null,r,Wo.SDK_VERSION||null,null,null,this.R()));var o=tr(i,n&&n.Da,n&&n.Ca);return Th(this,n=dh(this).then((function(n){return rc(n,o,"signInViaPopup",t,r,!!i,e.R())})).then((function(){return new jt((function(t,n){e.ja("signInViaPopup",null,new zr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=ac(e.a,e,"signInViaPopup",o,r)}))})).then((function(t){return o&&Zn(o),t?Fr(t):null})).s((function(t){throw o&&Zn(o),t})))},t.Mc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this;return Th(this,dh(this).then((function(){return function(t){return hh(t,(function(){return t.b.set(oh,t.c.C,t.a)}))}(e.h)})).then((function(){return oc(e.a,"signInViaRedirect",t,void 0,e.R())})))},t.oa=function(){var t=this;return yh(this).then((function(e){return t.a&&lc(t.a.b),e})).s((function(e){throw t.a&&lc(t.a.b),e}))},t.Rc=function(t){if(!t)return Xt(new zr("null-user"));if(this.P!=t.tenantId)return Xt(new zr("tenant-id-mismatch"));var e=this,n={};n.apiKey=bh(this).options.apiKey,n.authDomain=bh(this).options.authDomain,n.appName=bh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Da]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-S())/1e3,e=new Cc(e,o),n&&(e.da=n),r&&Ac(e,r),Wc(e,t),e}(t,n,e.w,e.Aa());return Th(this,this.i.then((function(){if(bh(e).options.apiKey!=t.l)return r.reload()})).then((function(){return wh(e)&&t.uid==wh(e).uid?(Wc(wh(e),t),e.aa(t)):(vh(e,r),xc(r),e.aa(r))})).then((function(){Eh(e)})))},t.pb=function(){var t=this;return Th(this,this.i.then((function(){return t.a&&lc(t.a.b),wh(t)?(vh(t,null),uh(t.h).then((function(){Eh(t)}))):Yt()})))},t.Nc=function(){var t=this;return ch(this.h,bh(this).options.authDomain).then((function(e){if(!t.l){var n;if(n=wh(t)&&e){n=wh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Wc(wh(t),e),wh(t).G();(wh(t)||e)&&(vh(t,e),e&&(xc(e),e.da=t.w),t.a&&Zu(t.a,t),Eh(t))}}))},t.aa=function(t){return sh(this.h,t)},t.bc=function(){Eh(this),this.aa(wh(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener((function(){t.next(wh(e))}))},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),Th(t,t.i.then((function(){!t.l&&V(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(_h(t)))})))}(this,(function(){t.next(wh(e))}))},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){m(t)?t(wh(r)):m(t.next)&&t.next(wh(r))})),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){r.W=r.getUid(),m(t)?t(wh(r)):m(t.next)&&t.next(wh(r))})),this.Vb(t,e,n)},t.cc=function(t){var e=this;return Th(this,this.i.then((function(){return wh(e)?wh(e).G(t).then((function(t){return{accessToken:t}})):null})))},t.Hc=function(t){var e=this;return this.i.then((function(){return gh(e,Is(e.b,ws,{token:t}))})).then((function(t){var n=t.user;return jc(n,"isAnonymous",!1),e.aa(n),t}))},t.Ic=function(t,e){var n=this;return this.i.then((function(){return gh(n,Is(n.b,_s,{email:t,password:e}))}))},t.Xb=function(t,e){var n=this;return this.i.then((function(){return gh(n,Is(n.b,ts,{email:t,password:e}))}))},t.Ra=function(t){var e=this;return this.i.then((function(){return gh(e,t.na(e.b))}))},t.Gc=function(t){return Pr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var t=this;return this.i.then((function(){var e=wh(t);return e&&e.isAnonymous?Fr({user:e,credential:null,additionalUserInfo:Fr({providerId:null,isNewUser:!1}),operationType:"signIn"}):gh(t,t.b.ob()).then((function(e){var n=e.user;return jc(n,"isAnonymous",!0),t.aa(n),e}))}))},t.getUid=function(){return wh(this)&&wh(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&wh(this)&&Rc(wh(this))},t.Ec=function(t){var e=this;F(this.m,(function(n){n==t&&e.o--})),this.o<0&&(this.o=0),0==this.o&&wh(this)&&Oc(wh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),Th(this,this.i.then((function(){e.l||V(e.m,t)&&t(_h(e))})))},t.removeAuthTokenListener=function(t){j(this.m,(function(e){return e==t}))},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(ah("local"),t.a,this.ma),this.a&&(tc(this.a,this),lc(this.a.b)),Promise.resolve()},t.$b=function(t){return Th(this,function(t,e){return Is(t,es,{identifier:e,continueUri:gr()?Xn():"http://localhost"}).then((function(t){return t.signinMethods||[]}))}(this.b,t))},t.qc=function(t){return!!co(t)},t.lb=function(t,e){var n=this;return Th(this,Yt().then((function(){var t=new si(e);if(!t.c)throw new zr("argument-error",hi+" must be true when sending sign in link to email");return vi(t)})).then((function(e){return n.b.lb(t,e)})).then((function(){})))},t.Uc=function(t){return this.Ka(t).then((function(t){return t.data.email}))},t.$a=function(t,e){return Th(this,this.b.$a(t,e).then((function(){})))},t.Ka=function(t){return Th(this,this.b.Ka(t).then((function(t){return new qr(t)})))},t.Xa=function(t){return Th(this,this.b.Xa(t).then((function(){})))},t.kb=function(t,e){var n=this;return Th(this,Yt().then((function(){return void 0===e||H(e)?{}:vi(new si(e))})).then((function(e){return n.b.kb(t,e)})).then((function(){})))},t.Kc=function(t,e){return Th(this,vc(this,t,e,E(this.Ra,this)))},t.Jc=function(t,e){var n=this;return Th(this,Yt().then((function(){var r=e||Xn(),i=uo(t,r);if(!(r=co(r)))throw new zr("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new zr("tenant-id-mismatch");return n.Ra(i)})))},Sh.prototype.render=function(){},Sh.prototype.reset=function(){},Sh.prototype.getResponse=function(){},Sh.prototype.execute=function(){};var Ch=null;function Nh(t,e){return(e=Ah(e))&&t.a[e]||null}function Ah(t){return(t=void 0===t?1e12:t)?t.toString():null}function kh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Qe(this.f,"click",this.i)}function Dh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Rh(){}Ih.prototype.render=function(t,e){return this.a[this.b.toString()]=new kh(t,e),this.b++},Ih.prototype.reset=function(t){var e=Nh(this,t);t=Ah(t),e&&t&&(e.delete(),delete this.a[t])},Ih.prototype.getResponse=function(t){return(t=Nh(this,t))?t.getResponse():null},Ih.prototype.execute=function(t){(t=Nh(this,t))&&t.execute()},kh.prototype.getResponse=function(){return Dh(this),this.b},kh.prototype.execute=function(){Dh(this);var t=this;this.a||(this.a=setTimeout((function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout((function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()}),6e4)}),500))},kh.prototype.delete=function(){Dh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Rh.prototype.g=function(){return Yt(Ch=Ch||new Ih)},Rh.prototype.c=function(){};var Oh=null;function Ph(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Mh=new X(Z,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),xh=new Nr(3e4,6e4);Ph.prototype.g=function(t){var e=this;return new jt((function(n,r){var i=setTimeout((function(){r(new zr("network-request-failed"))}),xh.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new zr("internal-error"));delete a[e.a]},Yt(_a(rt(Mh,{onload:e.a,hl:t||""}))).s((function(){clearTimeout(i),r(new zr("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(a.grecaptcha))}))},Ph.prototype.c=function(){this.b--};var Lh=null;function Fh(t,e,n,r,i,o,s){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,s=s?Oh=Oh||new Rh:Lh=Lh||new Ph,this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Vh])throw new zr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Bh],!a.document)throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new zr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Aa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.l=[];var c=this.a[Uh];this.a[Uh]=function(t){if(jh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=yr(c,a);"function"==typeof e&&e(t)}};var h=this.a[qh];this.a[qh]=function(){if(jh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=yr(h,a);"function"==typeof t&&t()}}}var Uh="callback",qh="expired-callback",Vh="sitekey",Bh="size";function jh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Wh(t,e){return t.h.push(e),e.ka((function(){B(t.h,e)})),e}function Qh(t){if(t.B)throw new zr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Kh(t,e,n){var r=!1;try{this.b=n||Wo.app()}catch(t){throw new zr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new zr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Aa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Wo.SDK_VERSION?pr(Wo.SDK_VERSION,o):null,Fh.call(this,n,t,e,(function(){try{var t=i.b.auth().ha()}catch(e){t=null}return t}),o,Ii(Ti),r)}function Hh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new zr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Gh.length)throw new zr("internal-error","Argument validator received an unsupported number of arguments.");n=Gh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new zr("argument-error",t+" failed: "+r)}(t=Fh.prototype).Ba=function(){var t=this;return this.f?this.f:this.f=Wh(this,Yt().then((function(){if(gr()&&!ar())return rr();throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return t.m.g(t.v())})).then((function(e){return t.g=e,Is(t.o,ls,{})})).then((function(e){t.a[Vh]=e.recaptchaSiteKey})).s((function(e){throw t.f=null,e})))},t.render=function(){Qh(this);var t=this;return Wh(this,this.Ba().then((function(){if(null===t.c){var e=t.u;if(!t.i){var n=Vn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Lt(a.name),'"'),a.type){o.push(' type="',Lt(a.type),'"');var u={};Y(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!y(o)||v(o)&&0<o.nodeType?r(o):F(Wn(o)?Q(o):o,r)}}(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c})))},t.verify=function(){Qh(this);var t=this;return Wh(this,this.render().then((function(e){return new jt((function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){j(t.l,(function(t){return t==e}))}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}}))})))},t.reset=function(){Qh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Qh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},I(Kh,Fh);var Gh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function zh(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:s}}function Yh(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:u}}function Xh(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:v}}function Jh(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function $h(t,e){return{name:t||"",M:"null",optional:!!e,N:p}}function Zh(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.na||!n)}}}function tl(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&s(t.type)&&m(t.verify))}}}function el(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function nl(t,e){for(var n in e){var r=e[n].name;t[r]=ol(r,t[n],e[n].j)}}function rl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T((function(t){return this[t]}),n),set:T((function(t,e,n,r){Hh(t,[n],[r],!0),this[e]=r}),r,n,e[n].Ya),enumerable:!0})}}function il(t,e,n,r){t[e]=ol(e,n,r)}function ol(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Hh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}nl(lh.prototype,{Xa:{name:"applyActionCode",j:[zh("code")]},Ka:{name:"checkActionCode",j:[zh("code")]},$a:{name:"confirmPasswordReset",j:[zh("code"),zh("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[zh("email"),zh("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[zh("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[zh("emailLink")]},wc:{name:"onAuthStateChanged",j:[el(Xh(),Jh(),"nextOrObserver"),Jh("opt_error",!0),Jh("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[el(Xh(),Jh(),"nextOrObserver"),Jh("opt_error",!0),Jh("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[zh("email"),el(Xh("opt_actionCodeSettings",!0),$h(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[zh("email"),Xh("actionCodeSettings")]},mb:{name:"setPersistence",j:[zh("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[Zh()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[Zh()]},Hc:{name:"signInWithCustomToken",j:[zh("token")]},Ic:{name:"signInWithEmailAndPassword",j:[zh("email"),zh("password")]},Jc:{name:"signInWithEmailLink",j:[zh("email"),zh("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[zh("phoneNumber"),tl()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[el({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Cc)}},$h(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[zh(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[zh("code")]}}),rl(lh.prototype,{lc:{name:"languageCode",Ya:el(zh(),$h(),"languageCode")},ti:{name:"tenantId",Ya:el(zh(),$h(),"tenantId")}}),(lh.Persistence=bu).LOCAL="local",lh.Persistence.SESSION="session",lh.Persistence.NONE="none",nl(Cc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Yh("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[Yh("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[Zh()]},eb:{name:"linkWithCredential",j:[Zh()]},sc:{name:"linkWithPhoneNumber",j:[zh("phoneNumber"),tl()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Zh()]},gb:{name:"reauthenticateWithCredential",j:[Zh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[zh("phoneNumber"),tl()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[el(Xh("opt_actionCodeSettings",!0),$h(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[zh(null,!0)]},Qc:{name:"unlink",j:[zh("provider")]},rb:{name:"updateEmail",j:[zh("email")]},sb:{name:"updatePassword",j:[zh("password")]},Sc:{name:"updatePhoneNumber",j:[Zh("phone")]},tb:{name:"updateProfile",j:[Xh("profile")]}}),nl(Ih.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),nl(Sh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),nl(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),rl(yc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Ya:Yh("appVerificationDisabledForTesting")}}),nl(mc.prototype,{confirm:{name:"confirm",j:[zh("verificationCode")]}}),il(Vi,"fromJSON",(function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[Gi,ao,lo,Qi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null}),[el(zh(),Xh(),"json")]),il(so,"credential",(function(t,e){return new oo(t,e)}),[zh("email"),zh("password")]),nl(oo.prototype,{A:{name:"toJSON",j:[zh(null,!0)]}}),nl(Ji.prototype,{wa:{name:"addScope",j:[zh("scope")]},Ea:{name:"setCustomParameters",j:[Xh("customOAuthParameters")]}}),il(Ji,"credential",$i,[el(zh(),Xh(),"token")]),il(so,"credentialWithLink",uo,[zh("email"),zh("emailLink")]),nl(Zi.prototype,{wa:{name:"addScope",j:[zh("scope")]},Ea:{name:"setCustomParameters",j:[Xh("customOAuthParameters")]}}),il(Zi,"credential",to,[el(zh(),Xh(),"token")]),nl(eo.prototype,{wa:{name:"addScope",j:[zh("scope")]},Ea:{name:"setCustomParameters",j:[Xh("customOAuthParameters")]}}),il(eo,"credential",no,[el(zh(),el(Xh(),$h()),"idToken"),el(zh(),$h(),"accessToken",!0)]),nl(ro.prototype,{Ea:{name:"setCustomParameters",j:[Xh("customOAuthParameters")]}}),il(ro,"credential",io,[el(zh(),Xh(),"token"),zh("secret",!0)]),nl(Xi.prototype,{wa:{name:"addScope",j:[zh("scope")]},credential:{name:"credential",j:[el(zh(),el(Xh(),$h()),"optionsOrIdToken"),el(zh(),$h(),"accessToken",!0)]},Ea:{name:"setCustomParameters",j:[Xh("customOAuthParameters")]}}),nl(Ki.prototype,{A:{name:"toJSON",j:[zh(null,!0)]}}),nl(ji.prototype,{A:{name:"toJSON",j:[zh(null,!0)]}}),il(po,"credential",yo,[zh("verificationId"),zh("verificationCode")]),nl(po.prototype,{Va:{name:"verifyPhoneNumber",j:[zh("phoneNumber"),tl()]}}),nl(ho.prototype,{A:{name:"toJSON",j:[zh(null,!0)]}}),nl(zr.prototype,{toJSON:{name:"toJSON",j:[zh(null,!0)]}}),nl(So.prototype,{toJSON:{name:"toJSON",j:[zh(null,!0)]}}),nl(To.prototype,{toJSON:{name:"toJSON",j:[zh(null,!0)]}}),nl(Kh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),il($r,"parseLink",ai,[zh("link")]),function(){if(void 0===Wo||!Wo.INTERNAL||!Wo.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Vr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:lh,AuthCredential:Vi,Error:zr};il(t,"EmailAuthProvider",so,[]),il(t,"FacebookAuthProvider",Ji,[]),il(t,"GithubAuthProvider",Zi,[]),il(t,"GoogleAuthProvider",eo,[]),il(t,"TwitterAuthProvider",ro,[]),il(t,"OAuthProvider",Xi,[zh("providerId")]),il(t,"SAMLAuthProvider",Yi,[zh("providerId")]),il(t,"PhoneAuthProvider",po,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof lh)}}]),il(t,"RecaptchaVerifier",Kh,[el(zh(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Xh("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof Wo.app.App)}}]),il(t,"ActionCodeURL",$r,[]),Wo.INTERNAL.registerService("auth",(function(t,e){return e({INTERNAL:{getUid:E((t=new lh(t)).getUid,t),getToken:E(t.cc,t),addAuthTokenListener:E(t.Wb,t),removeAuthTokenListener:E(t.Ec,t)}}),t}),t,(function(t,e){if("create"===t)try{e.auth()}catch(t){}})),Wo.INTERNAL.extendNamespace({User:Cc})}()}).apply(void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Qo=(Ko.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),uo(e))},Ko.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:so(e)},Ko.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},Ko.prototype.prefixedName_=function(t){return this.prefix_+t},Ko.prototype.toString=function(){return this.domStorage_.toString()},Ko);function Ko(t){this.domStorage_=t,this.prefix_="firebase:"}var Ho=(Go.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},Go.prototype.get=function(t){return ho(this.cache_,t)?this.cache_[t]:null},Go.prototype.remove=function(t){delete this.cache_[t]},Go);function Go(){this.cache_={},this.isInMemoryStorage=!0}function zo(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Qo(e)}}catch(t){}return new Ho}function Yo(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;Qi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new yo;n.update(e);var r=n.digest();return Hi.encodeByteArray(r)}function Xo(t,e){Qi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(ca.logLevel=go.VERBOSE,pa=ca.log.bind(ca),e&&ua.set("logging_enabled",!0)):"function"==typeof t?pa=t:(pa=null,ua.remove("logging_enabled"))}function Jo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===da&&(da=!1,null===pa&&!0===ua.get("logging_enabled")&&Xo(!0)),pa){var n=fa.apply(null,t);pa(n)}}function $o(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Jo.apply(void 0,Vi([t],e))}}function Zo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+fa.apply(void 0,Vi(t));ca.error(n)}function ta(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+fa.apply(void 0,Vi(t));throw ca.error(n),new Error(n)}function ea(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+fa.apply(void 0,Vi(t));ca.warn(n)}function na(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function ra(t,e){return t===e?0:t<e?-1:1}function ia(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+uo(e))}function oa(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var aa,sa=zo("localStorage"),ua=zo("sessionStorage"),ca=new Ro("@firebase/database"),ha="FIREBASE_DATABASE_EMULATOR_HOST",la=(aa=1,function(){return aa++}),fa=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=fa.apply(null,t[r]):"object"==typeof t[r]?n+=uo(t[r]):n+=t[r],n+=" ";return n},pa=null,da=!0,ya="[MIN_NAME]",ma="[MAX_NAME]",va=function(t,e){if(t===e)return 0;if(t===ya||e===ma)return-1;if(e===ya||t===ma)return 1;var n=Sa(t),r=Sa(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},ga=function(t){if("object"!=typeof t||null===t)return uo(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=uo(e[i]),r+=":",r+=ga(t[e[i]]);return r+"}"};function ba(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function wa(t){var e,n,r,i,o,a,s;for(Qi(!na(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function _a(t){try{t()}catch(t){setTimeout((function(){throw ea("Exception was thrown by user callback.",t.stack||""),t}),Math.floor(0))}}function Ea(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Ta=new RegExp("^-?\\d{1,10}$"),Sa=function(t){if(Ta.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Ia=(Object.defineProperty(Ca,"Empty",{get:function(){return new Ca("")},enumerable:!0,configurable:!0}),Ca.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Ca.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Ca.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Ca(this.pieces_,t)},Ca.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Ca.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Ca.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Ca.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Ca.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Ca(t,0)},Ca.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Ca)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Ca(e,0)},Ca.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Ca.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Ca.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Ca.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=va(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Ca.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Ca.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Ca);function Ca(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var Na=(Object.defineProperty(Aa,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Aa,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Aa.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=No(t),this.checkValid_()},Aa.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=No(t),0<this.parts_.length&&(this.byteLength_-=1)},Aa.prototype.checkValid_=function(){if(this.byteLength_>Aa.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Aa.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Aa.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Aa.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Aa.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Aa);function Aa(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=No(this.parts_[n]);this.checkValid_()}var ka="firebaseio.com",Da="websocket",Ra="long_polling",Oa=(Pa.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},Pa.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},Pa.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},Pa.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},Pa.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&sa.set("host:"+this.host,this.internalHost))},Pa.prototype.connectionURL=function(t,e){var n;if(Qi("string"==typeof t,"typeof type must == string"),Qi("object"==typeof e,"typeof params must == object"),t===Da)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Ra)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return ba(e,(function(t,e){r.push(t+"="+e)})),n+r.join("&")},Pa.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},Pa.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},Pa);function Pa(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=sa.get("host:"+t)||this.host}function Ma(t){var e=Ha(t),n=e.namespace;"firebase"===e.domain&&ta(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||ta("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ea("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Oa(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Ia(e.pathString)}}function xa(t){return"string"==typeof t&&0!==t.length&&!Ga.test(t)}function La(t){return"string"==typeof t&&0!==t.length&&!za.test(t)}function Fa(t){return null===t||"string"==typeof t||"number"==typeof t&&!na(t)||t&&"object"==typeof t&&ho(t,".sv")}function Ua(t,e,n,r,i){i&&void 0===n||Xa(So(t,e,i),n,r)}function qa(t,e,n,r,i){if(!i||void 0!==n){var o=So(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];ba(n,(function(t,e){var n=new Ia(t);if(Xa(o,e,r.child(n)),".priority"===n.getBack()&&!Fa(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!xa(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Ia.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function Va(t,e,n,r){if(!r||void 0!==n){if(na(n))throw new Error(So(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Fa(n))throw new Error(So(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function Ba(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(So(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ja(t,e,n,r){if(!(r&&void 0===n||xa(n)))throw new Error(So(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Wa(t,e,n,r){if(!(r&&void 0===n||La(n)))throw new Error(So(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function Qa(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function Ka(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!xa(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return La(t=t&&t.replace(/^\/*\.info(\/|$)/,"/"))}(r))throw new Error(So(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var Ha=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=Ui(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):ea("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},Ga=/[\[\].#$\/\u0000-\u001F\u007F]/,za=/[\[\].#$\u0000-\u001F\u007F]/,Ya=10485760,Xa=function(t,e,n){var r=n instanceof Ia?new Na(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(na(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>Ya/3&&No(e)>Ya)throw new Error(t+"contains a string greater than "+Ya+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(ba(e,(function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!xa(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),Xa(t,n,r),r.pop()})),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Ja=($a.prototype.cancel=function(t){To("OnDisconnect.cancel",0,1,arguments.length),Io("OnDisconnect.cancel",1,t,!0);var e=new Yi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},$a.prototype.remove=function(t){To("OnDisconnect.remove",0,1,arguments.length),Qa("OnDisconnect.remove",this.path_),Io("OnDisconnect.remove",1,t,!0);var e=new Yi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},$a.prototype.set=function(t,e){To("OnDisconnect.set",1,2,arguments.length),Qa("OnDisconnect.set",this.path_),Ua("OnDisconnect.set",1,t,this.path_,!1),Io("OnDisconnect.set",2,e,!0);var n=new Yi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},$a.prototype.setWithPriority=function(t,e,n){To("OnDisconnect.setWithPriority",2,3,arguments.length),Qa("OnDisconnect.setWithPriority",this.path_),Ua("OnDisconnect.setWithPriority",1,t,this.path_,!1),Va("OnDisconnect.setWithPriority",2,e,!1),Io("OnDisconnect.setWithPriority",3,n,!0);var r=new Yi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},$a.prototype.update=function(t,e){if(To("OnDisconnect.update",1,2,arguments.length),Qa("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ea("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}qa("OnDisconnect.update",1,t,this.path_,!1),Io("OnDisconnect.update",2,e,!0);var i=new Yi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},$a);function $a(t,e){this.repo_=t,this.path_=e}var Za=(ts.prototype.toJSON=function(){return To("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},ts);function ts(t,e){this.committed=t,this.snapshot=e}var es,ns,rs,is=(es="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ns=0,rs=[],function(t){var e,n=t===ns;ns=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=es.charAt(t%64),t=Math.floor(t/64);Qi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===rs[e];e--)rs[e]=0;rs[e]++}else for(e=0;e<12;e++)rs[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=es.charAt(rs[e]);return Qi(20===i.length,"nextPushId: Length should be 20."),i}),os=(as.Wrap=function(t,e){return new as(t,e)},as);function as(t,e){this.name=t,this.node=e}var ss,us=(cs.prototype.getCompare=function(){return this.compare.bind(this)},cs.prototype.indexedValueChanged=function(t,e){var n=new os(ya,t),r=new os(ya,e);return 0!==this.compare(n,r)},cs.prototype.minPost=function(){return os.MIN},cs);function cs(){}var hs,ls=(Mi(fs,hs=us),Object.defineProperty(fs,"__EMPTY_NODE",{get:function(){return ss},set:function(t){ss=t},enumerable:!0,configurable:!0}),fs.prototype.compare=function(t,e){return va(t.name,e.name)},fs.prototype.isDefinedOn=function(t){throw Ki("KeyIndex.isDefinedOn not expected to be called.")},fs.prototype.indexedValueChanged=function(t,e){return!1},fs.prototype.minPost=function(){return os.MIN},fs.prototype.maxPost=function(){return new os(ma,ss)},fs.prototype.makePost=function(t,e){return Qi("string"==typeof t,"KeyIndex indexValue must always be a string."),new os(t,ss)},fs.prototype.toString=function(){return".key"},fs);function fs(){return null!==hs&&hs.apply(this,arguments)||this}var ps,ds=new ls;function ys(t){return"number"==typeof t?"number:"+wa(t):"string:"+t}function ms(t){if(t.isLeafNode()){var e=t.val();Qi("string"==typeof e||"number"==typeof e||"object"==typeof e&&ho(e,".sv"),"Priority must be a string or number.")}else Qi(t===ps||t.isEmpty(),"priority of unexpected type.");Qi(t===ps||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var vs,gs,bs,ws,_s=(Object.defineProperty(Es,"__childrenNodeConstructor",{get:function(){return vs},set:function(t){vs=t},enumerable:!0,configurable:!0}),Es.prototype.isLeafNode=function(){return!0},Es.prototype.getPriority=function(){return this.priorityNode_},Es.prototype.updatePriority=function(t){return new Es(this.value_,t)},Es.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Es.__childrenNodeConstructor.EMPTY_NODE},Es.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Es.__childrenNodeConstructor.EMPTY_NODE},Es.prototype.hasChild=function(){return!1},Es.prototype.getPredecessorChildName=function(t,e){return null},Es.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Es.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Es.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(Qi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Es.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Es.prototype.isEmpty=function(){return!1},Es.prototype.numChildren=function(){return 0},Es.prototype.forEachChild=function(t,e){return!1},Es.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Es.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+ys(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?wa(this.value_):this.value_,this.lazyHash_=Yo(t)}return this.lazyHash_},Es.prototype.getValue=function(){return this.value_},Es.prototype.compareTo=function(t){return t===Es.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Es.__childrenNodeConstructor?-1:(Qi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Es.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Es.VALUE_TYPE_ORDER.indexOf(e),i=Es.VALUE_TYPE_ORDER.indexOf(n);return Qi(0<=r,"Unknown leaf type: "+e),Qi(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Es.prototype.withIndex=function(){return this},Es.prototype.isIndexed=function(){return!0},Es.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Es.VALUE_TYPE_ORDER=["object","boolean","number","string"],Es);function Es(t,e){void 0===e&&(e=Es.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Qi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ms(this.priorityNode_)}function Ts(){return null!==ws&&ws.apply(this,arguments)||this}var Ss=new(Mi(Ts,ws=us),Ts.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?va(t.name,e.name):i},Ts.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Ts.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Ts.prototype.minPost=function(){return os.MIN},Ts.prototype.maxPost=function(){return new os(ma,new _s("[PRIORITY-POST]",bs))},Ts.prototype.makePost=function(t,e){var n=gs(t);return new os(e,new _s("[PRIORITY-POST]",n))},Ts.prototype.toString=function(){return".priority"},Ts),Is=(Cs.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Cs.prototype.hasNext=function(){return 0<this.nodeStack_.length},Cs.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Cs);function Cs(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Ns=(As.prototype.copy=function(t,e,n,r,i){return new As(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},As.prototype.count=function(){return this.left.count()+1+this.right.count()},As.prototype.isEmpty=function(){return!1},As.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},As.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},As.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},As.prototype.minKey=function(){return this.min_().key},As.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},As.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},As.prototype.removeMin_=function(){if(this.left.isEmpty())return Rs.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},As.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Rs.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},As.prototype.isRed_=function(){return this.color},As.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},As.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},As.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},As.prototype.rotateLeft_=function(){var t=this.copy(null,null,As.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},As.prototype.rotateRight_=function(){var t=this.copy(null,null,As.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},As.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},As.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},As.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},As.RED=!0,As.BLACK=!1,As);function As(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:As.RED,this.left=null!=r?r:Rs.EMPTY_NODE,this.right=null!=i?i:Rs.EMPTY_NODE}var ks=(Ds.prototype.copy=function(t,e,n,r,i){return this},Ds.prototype.insert=function(t,e,n){return new Ns(t,e,null)},Ds.prototype.remove=function(t,e){return this},Ds.prototype.count=function(){return 0},Ds.prototype.isEmpty=function(){return!0},Ds.prototype.inorderTraversal=function(t){return!1},Ds.prototype.reverseTraversal=function(t){return!1},Ds.prototype.minKey=function(){return null},Ds.prototype.maxKey=function(){return null},Ds.prototype.check_=function(){return 0},Ds.prototype.isRed_=function(){return!1},Ds);function Ds(){}var Rs=(Os.prototype.insert=function(t,e){return new Os(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ns.BLACK,null,null))},Os.prototype.remove=function(t){return new Os(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ns.BLACK,null,null))},Os.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},Os.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Os.prototype.isEmpty=function(){return this.root_.isEmpty()},Os.prototype.count=function(){return this.root_.count()},Os.prototype.minKey=function(){return this.root_.minKey()},Os.prototype.maxKey=function(){return this.root_.maxKey()},Os.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},Os.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},Os.prototype.getIterator=function(t){return new Is(this.root_,null,this.comparator_,!1,t)},Os.prototype.getIteratorFrom=function(t,e){return new Is(this.root_,t,this.comparator_,!1,e)},Os.prototype.getReverseIteratorFrom=function(t,e){return new Is(this.root_,t,this.comparator_,!0,e)},Os.prototype.getReverseIterator=function(t){return new Is(this.root_,null,this.comparator_,!0,t)},Os.EMPTY_NODE=new ks,Os);function Os(t,e){void 0===e&&(e=Os.EMPTY_NODE),this.comparator_=t,this.root_=e}var Ps=Math.log(2),Ms=(xs.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},xs);function xs(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ps,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var Ls,Fs,Us=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new Ns(a,o.node,Ns.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new Ns(a,o.node,Ns.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(1+o,s),h=t[o],l=n?n(h):h;u(new Ns(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,Ns.BLACK):(s(l,Ns.BLACK),s(l,Ns.RED))}return o}(new Ms(t.length));return new Rs(r||e,o)},qs={},Vs=(Object.defineProperty(Bs,"Default",{get:function(){return Qi(Ss,"ChildrenNode.ts has not been loaded"),Ls=Ls||new Bs({".priority":qs},{".priority":Ss})},enumerable:!0,configurable:!0}),Bs.prototype.get=function(t){var e=lo(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Rs?e:null},Bs.prototype.hasIndex=function(t){return ho(this.indexSet_,t.toString())},Bs.prototype.addIndex=function(t,e){Qi(t!==ds,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(os.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Us(r,t.getCompare()):qs;var s=t.toString(),u=xi({},this.indexSet_);u[s]=t;var c=xi({},this.indexes_);return c[s]=n,new Bs(c,u)},Bs.prototype.addToIndexes=function(t,e){var n=this;return new Bs(po(this.indexes_,(function(r,i){var o=lo(n.indexSet_,i);if(Qi(o,"Missing index implementation for "+i),r===qs){if(o.isDefinedOn(t.node)){for(var a=[],s=e.getIterator(os.Wrap),u=s.getNext();u;)u.name!=t.name&&a.push(u),u=s.getNext();return a.push(t),Us(a,o.getCompare())}return qs}var c=e.get(t.name),h=r;return c&&(h=h.remove(new os(t.name,c))),h.insert(t,t.node)})),this.indexSet_)},Bs.prototype.removeFromIndexes=function(t,e){return new Bs(po(this.indexes_,(function(n){if(n===qs)return n;var r=e.get(t.name);return r?n.remove(new os(t.name,r)):n})),this.indexSet_)},Bs);function Bs(t,e){this.indexes_=t,this.indexSet_=e}function js(t,e){return va(t.name,e.name)}function Ws(t,e){return va(t,e)}var Qs,Ks=(Object.defineProperty(Hs,"EMPTY_NODE",{get:function(){return Fs=Fs||new Hs(new Rs(Ws),null,Vs.Default)},enumerable:!0,configurable:!0}),Hs.prototype.isLeafNode=function(){return!1},Hs.prototype.getPriority=function(){return this.priorityNode_||Fs},Hs.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new Hs(this.children_,t,this.indexMap_)},Hs.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Fs:e},Hs.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},Hs.prototype.hasChild=function(t){return null!==this.children_.get(t)},Hs.prototype.updateImmediateChild=function(t,e){if(Qi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r,i=new os(t,e),o=void 0;return r=e.isEmpty()?(o=this.children_.remove(t),this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,e),this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?Fs:this.priorityNode_,new Hs(o,n,r)},Hs.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;Qi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},Hs.prototype.isEmpty=function(){return this.children_.isEmpty()},Hs.prototype.numChildren=function(){return this.children_.count()},Hs.prototype.val=function(t){if(this.isEmpty())return null;var e={},n=0,r=0,i=!0;if(this.forEachChild(Ss,(function(o,a){e[o]=a.val(t),n++,i&&Hs.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!t&&i&&r<2*n){var o=[];for(var a in e)o[a]=e[a];return o}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e},Hs.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+ys(this.getPriority().val())+":"),this.forEachChild(Ss,(function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":Yo(t)}return this.lazyHash_},Hs.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new os(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},Hs.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},Hs.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new os(e,this.children_.get(e)):null},Hs.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},Hs.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new os(e,this.children_.get(e)):null},Hs.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},Hs.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},Hs.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getIteratorFrom(t.name,os.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},Hs.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},Hs.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var r=this.children_.getReverseIteratorFrom(t.name,os.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},Hs.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===zs?-1:0},Hs.prototype.withIndex=function(t){if(t===ds||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new Hs(this.children_,this.priorityNode_,e)},Hs.prototype.isIndexed=function(t){return t===ds||this.indexMap_.hasIndex(t)},Hs.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Ss),r=e.getIterator(Ss),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},Hs.prototype.resolveIndex_=function(t){return t===ds?null:this.indexMap_.get(t.toString())},Hs.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,Hs);function Hs(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ms(this.priorityNode_),this.children_.isEmpty()&&Qi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Gs(){return Qs.call(this,new Rs(Ws),Ks.EMPTY_NODE,Vs.Default)||this}var zs=new(Mi(Gs,Qs=Ks),Gs.prototype.compareTo=function(t){return t===this?0:1},Gs.prototype.equals=function(t){return t===this},Gs.prototype.getPriority=function(){return this},Gs.prototype.getImmediateChild=function(t){return Ks.EMPTY_NODE},Gs.prototype.isEmpty=function(){return!1},Gs);Object.defineProperties(os,{MIN:{value:new os(ya,Ks.EMPTY_NODE)},MAX:{value:new os(ma,zs)}}),ls.__EMPTY_NODE=Ks.EMPTY_NODE,_s.__childrenNodeConstructor=Ks,ps=zs,bs=zs;var Ys,Xs=!0;function Js(t,e){if(void 0===e&&(e=null),null===t)return Ks.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Qi(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new _s(t,Js(e));if(t instanceof Array||!Xs){var n=Ks.EMPTY_NODE;return ba(t,(function(e,r){if(ho(t,e)&&"."!==e.substring(0,1)){var i=Js(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}})),n.updatePriority(Js(e))}var r=[],i=!1;if(ba(t,(function(t,e){if("."!==t.substring(0,1)){var n=Js(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new os(t,n)))}})),0==r.length)return Ks.EMPTY_NODE;var o=Us(r,js,(function(t){return t.name}),Ws);if(i){var a=Us(r,Ss.getCompare());return new Ks(o,Js(e),new Vs({".priority":a},{".priority":Ss}))}return new Ks(o,Js(e),Vs.Default)}function $s(){return null!==Ys&&Ys.apply(this,arguments)||this}gs=Js;var Zs,tu=new(Mi($s,Ys=us),$s.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?va(t.name,e.name):n},$s.prototype.isDefinedOn=function(t){return!0},$s.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},$s.prototype.minPost=function(){return os.MIN},$s.prototype.maxPost=function(){return os.MAX},$s.prototype.makePost=function(t,e){var n=Js(t);return new os(e,n)},$s.prototype.toString=function(){return".value"},$s),eu=(Mi(nu,Zs=us),nu.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},nu.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},nu.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?va(t.name,e.name):i},nu.prototype.makePost=function(t,e){var n=Js(t),r=Ks.EMPTY_NODE.updateChild(this.indexPath_,n);return new os(e,r)},nu.prototype.maxPost=function(){var t=Ks.EMPTY_NODE.updateChild(this.indexPath_,zs);return new os(ma,t)},nu.prototype.toString=function(){return this.indexPath_.slice().join("/")},nu);function nu(t){var e=Zs.call(this)||this;return e.indexPath_=t,Qi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var ru=(iu.prototype.val=function(){return To("DataSnapshot.val",0,0,arguments.length),this.node_.val()},iu.prototype.exportVal=function(){return To("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},iu.prototype.toJSON=function(){return To("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},iu.prototype.exists=function(){return To("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},iu.prototype.child=function(t){To("DataSnapshot.child",0,1,arguments.length),Wa("DataSnapshot.child",1,t=String(t),!1);var e=new Ia(t),n=this.ref_.child(e);return new iu(this.node_.getChild(e),n,Ss)},iu.prototype.hasChild=function(t){To("DataSnapshot.hasChild",1,1,arguments.length),Wa("DataSnapshot.hasChild",1,t,!1);var e=new Ia(t);return!this.node_.getChild(e).isEmpty()},iu.prototype.getPriority=function(){return To("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},iu.prototype.forEach=function(t){var e=this;return To("DataSnapshot.forEach",1,1,arguments.length),Io("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,(function(n,r){return t(new iu(r,e.ref_.child(n),Ss))}))},iu.prototype.hasChildren=function(){return To("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(iu.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),iu.prototype.numChildren=function(){return To("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},iu.prototype.getRef=function(){return To("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(iu.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),iu);function iu(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var ou=(au.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},au.prototype.getEventType=function(){return this.eventType},au.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},au.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+uo(this.snapshot.exportVal())},au);function au(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var su=(uu.prototype.getPath=function(){return this.path},uu.prototype.getEventType=function(){return"cancel"},uu.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},uu.prototype.toString=function(){return this.path.toString()+":cancel"},uu);function uu(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var cu=(hu.prototype.respondsTo=function(t){return"value"===t},hu.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new ou("value",this,new ru(t.snapshotNode,e.getRef(),n))},hu.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Qi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},hu.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new su(this,t,e):null},hu.prototype.matches=function(t){return t instanceof hu&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},hu.prototype.hasAnyCallback=function(){return null!==this.callback_},hu);function hu(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var lu,fu=(pu.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,ho(this.callbacks_,e)},pu.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new su(this,t,e):null},pu.prototype.createEvent=function(t,e){Qi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new ou(t.type,this,new ru(t.snapshotNode,n,r),t.prevName)},pu.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Qi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},pu.prototype.matches=function(t){var e=this;if(t instanceof pu){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object.keys(t.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every((function(n){return t.callbacks_[n]===e.callbacks_[n]}));var o=n[0],a=r[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}}}return!1},pu.prototype.hasAnyCallback=function(){return null!==this.callbacks_},pu);function pu(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var du=(Object.defineProperty(yu,"__referenceConstructor",{get:function(){return Qi(lu,"Reference.ts has not been loaded"),lu},set:function(t){lu=t},enumerable:!0,configurable:!0}),yu.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ds){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=ya)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=ma)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ss){if(null!=e&&!Fa(e)||null!=n&&!Fa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Qi(t.getIndex()instanceof eu||t.getIndex()===tu,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},yu.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},yu.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},yu.prototype.getQueryParams=function(){return this.queryParams_},yu.prototype.getRef=function(){return To("Query.ref",0,0,arguments.length),new yu.__referenceConstructor(this.repo,this.path)},yu.prototype.on=function(t,e,n,r){To("Query.on",2,4,arguments.length),Ba("Query.on",1,t,!1),Io("Query.on",2,e,!1);var i=yu.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},yu.prototype.onValueEvent=function(t,e,n){var r=new cu(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},yu.prototype.onChildEvent=function(t,e,n){var r=new fu(t,e,n);this.repo.addEventCallbackForQuery(this,r)},yu.prototype.off=function(t,e,n){To("Query.off",0,3,arguments.length),Ba("Query.off",1,t,!0),Io("Query.off",2,e,!0),Co("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new cu(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new fu(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},yu.prototype.once=function(t,e,n,r){var i=this;To("Query.once",1,4,arguments.length),Ba("Query.once",1,t,!1),Io("Query.once",2,e,!0);var o=yu.getCancelAndContextArgs_("Query.once",n,r),a=!0,s=new Yi;s.promise.catch((function(){}));var u=function(n){a&&(a=!1,i.off(t,u),e&&e.bind(o.context)(n),s.resolve(n))};return this.on(t,u,(function(e){i.off(t,u),o.cancel&&o.cancel.bind(o.context)(e),s.reject(e)})),s.promise},yu.prototype.limitToFirst=function(t){if(To("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new yu(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},yu.prototype.limitToLast=function(t){if(To("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new yu(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},yu.prototype.orderByChild=function(t){if(To("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Wa("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Ia(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new eu(e),r=this.queryParams_.orderBy(n);return yu.validateQueryEndpoints_(r),new yu(this.repo,this.path,r,!0)},yu.prototype.orderByKey=function(){To("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(ds);return yu.validateQueryEndpoints_(t),new yu(this.repo,this.path,t,!0)},yu.prototype.orderByPriority=function(){To("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ss);return yu.validateQueryEndpoints_(t),new yu(this.repo,this.path,t,!0)},yu.prototype.orderByValue=function(){To("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(tu);return yu.validateQueryEndpoints_(t),new yu(this.repo,this.path,t,!0)},yu.prototype.startAt=function(t,e){void 0===t&&(t=null),To("Query.startAt",0,2,arguments.length),Ua("Query.startAt",1,t,this.path,!0),ja("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(yu.validateLimit_(n),yu.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new yu(this.repo,this.path,n,this.orderByCalled_)},yu.prototype.endAt=function(t,e){void 0===t&&(t=null),To("Query.endAt",0,2,arguments.length),Ua("Query.endAt",1,t,this.path,!0),ja("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(yu.validateLimit_(n),yu.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new yu(this.repo,this.path,n,this.orderByCalled_)},yu.prototype.equalTo=function(t,e){if(To("Query.equalTo",1,2,arguments.length),Ua("Query.equalTo",1,t,this.path,!1),ja("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},yu.prototype.toString=function(){return To("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},yu.prototype.toJSON=function(){return To("Query.toJSON",0,1,arguments.length),this.toString()},yu.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},yu.prototype.queryIdentifier=function(){var t=this.queryObject(),e=ga(t);return"{}"===e?"default":e},yu.prototype.isEqual=function(t){if(To("Query.isEqual",1,1,arguments.length),!(t instanceof yu))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},yu.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Io(t,3,r.cancel,!0),r.context=n,Co(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(So(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(yu.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),yu);function yu(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var mu=(vu.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},vu.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new vu);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},vu.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ss,(function(t,e){n.remember(new Ia(t),e)})),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},vu.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,r){var i=new Ia(t.toString()+"/"+n);r.forEachTree(i,e)}))},vu.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},vu);function vu(){this.value=null,this.children=new Map}function gu(t,e){return t&&"object"==typeof t?(Qi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var bu,wu,_u=function(t,e){var n,r=gu(t.getPriority().val(),e);if(t.isLeafNode()){var i=t,o=gu(i.getValue(),e);return o!==i.getValue()||r!==i.getPriority().val()?new _s(o,Js(r)):t}var a=t;return r!==(n=a).getPriority().val()&&(n=n.updatePriority(new _s(r))),a.forEachChild(Ss,(function(t,r){var i=_u(r,e);i!==r&&(n=n.updateImmediateChild(t,i))})),n};(wu=bu=bu||{})[wu.OVERWRITE=0]="OVERWRITE",wu[wu.MERGE=1]="MERGE",wu[wu.ACK_USER_WRITE=2]="ACK_USER_WRITE",wu[wu.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Eu=(Tu.User=new Tu(!0,!1,null,!1),Tu.Server=new Tu(!1,!0,null,!1),Tu.forServerTaggedQuery=function(t){return new Tu(!1,!0,t,!0)},Tu);function Tu(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,Qi(!r||e,"Tagged queries must be from server.")}var Su,Iu=(Cu.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Qi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Ia(t));return new Cu(Ia.Empty,e,this.revert)}return Qi(this.path.getFront()===t,"operationForChild called for unrelated child."),new Cu(this.path.popFront(),this.affectedTree,this.revert)},Cu);function Cu(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=bu.ACK_USER_WRITE,this.source=Eu.User}var Nu=(Au.fromObject=function(t){var e=Au.Empty;return ba(t,(function(t,n){e=e.set(new Ia(t),n)})),e},Au.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Au.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Ia.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Ia(n).child(i.path),value:i.value}},Au.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},Au.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):Au.Empty},Au.prototype.set=function(t,e){if(t.isEmpty())return new Au(e,this.children);var n=t.getFront(),r=(this.children.get(n)||Au.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new Au(this.value,i)},Au.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?Au.Empty:new Au(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?Au.Empty:new Au(this.value,i)}return this},Au.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},Au.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n,r=t.getFront(),i=(this.children.get(r)||Au.Empty).setTree(t.popFront(),e);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new Au(this.value,n)},Au.prototype.fold=function(t){return this.fold_(Ia.Empty,t)},Au.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(t.child(r),e)})),e(t,this.value,n)},Au.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Ia.Empty,e)},Au.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},Au.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Ia.Empty,e)},Au.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):Au.Empty},Au.prototype.foreach=function(t){this.foreach_(Ia.Empty,t)},Au.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,r){r.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},Au.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},Au.Empty=new Au(null),Au);function Au(t,e){void 0===e&&(e=Su=Su||new Rs(ra)),this.value=t,this.children=e}var ku=(Du.prototype.operationForChild=function(t){return this.path.isEmpty()?new Du(this.source,Ia.Empty):new Du(this.source,this.path.popFront())},Du);function Du(t,e){this.source=t,this.path=e,this.type=bu.LISTEN_COMPLETE}var Ru=(Ou.prototype.operationForChild=function(t){return this.path.isEmpty()?new Ou(this.source,Ia.Empty,this.snap.getImmediateChild(t)):new Ou(this.source,this.path.popFront(),this.snap)},Ou);function Ou(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=bu.OVERWRITE}var Pu=(Mu.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Ia(t));return e.isEmpty()?null:e.value?new Ru(this.source,Ia.Empty,e.value):new Mu(this.source,Ia.Empty,e)}return Qi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new Mu(this.source,this.path.popFront(),this.children)},Mu.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Mu);function Mu(t,e,n){this.source=t,this.path=e,this.children=n,this.type=bu.MERGE}var xu=(Lu.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Lu.prototype.isFiltered=function(){return this.filtered_},Lu.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},Lu.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},Lu.prototype.getNode=function(){return this.node_},Lu);function Lu(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var Fu=(Uu.prototype.updateEventSnap=function(t,e,n){return new Uu(new xu(t,e,n),this.serverCache_)},Uu.prototype.updateServerSnap=function(t,e,n){return new Uu(this.eventCache_,new xu(t,e,n))},Uu.prototype.getEventCache=function(){return this.eventCache_},Uu.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Uu.prototype.getServerCache=function(){return this.serverCache_},Uu.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Uu.Empty=new Uu(new xu(Ks.EMPTY_NODE,!1,!1),new xu(Ks.EMPTY_NODE,!1,!1)),Uu);function Uu(t,e){this.eventCache_=t,this.serverCache_=e}var qu=(Vu.valueChange=function(t){return new Vu(Vu.VALUE,t)},Vu.childAddedChange=function(t,e){return new Vu(Vu.CHILD_ADDED,e,t)},Vu.childRemovedChange=function(t,e){return new Vu(Vu.CHILD_REMOVED,e,t)},Vu.childChangedChange=function(t,e,n){return new Vu(Vu.CHILD_CHANGED,e,t,n)},Vu.childMovedChange=function(t,e){return new Vu(Vu.CHILD_MOVED,e,t)},Vu.CHILD_ADDED="child_added",Vu.CHILD_REMOVED="child_removed",Vu.CHILD_CHANGED="child_changed",Vu.CHILD_MOVED="child_moved",Vu.VALUE="value",Vu);function Vu(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var Bu=(ju.prototype.updateChild=function(t,e,n,r,i,o){Qi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(qu.childRemovedChange(e,a)):Qi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(qu.childAddedChange(e,n)):o.trackChildChange(qu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},ju.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ss,(function(t,r){e.hasChild(t)||n.trackChildChange(qu.childRemovedChange(t,r))})),e.isLeafNode()||e.forEachChild(Ss,(function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(qu.childChangedChange(e,r,i))}else n.trackChildChange(qu.childAddedChange(e,r))}))),e.withIndex(this.index_)},ju.prototype.updatePriority=function(t,e){return t.isEmpty()?Ks.EMPTY_NODE:t.updatePriority(e)},ju.prototype.filtersNodes=function(){return!1},ju.prototype.getIndexedFilter=function(){return this},ju.prototype.getIndex=function(){return this.index_},ju);function ju(t){this.index_=t}var Wu=(Qu.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Qi(e==qu.CHILD_ADDED||e==qu.CHILD_CHANGED||e==qu.CHILD_REMOVED,"Only child changes supported for tracking"),Qi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==qu.CHILD_ADDED&&i==qu.CHILD_REMOVED)this.changeMap.set(n,qu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==qu.CHILD_REMOVED&&i==qu.CHILD_ADDED)this.changeMap.delete(n);else if(e==qu.CHILD_REMOVED&&i==qu.CHILD_CHANGED)this.changeMap.set(n,qu.childRemovedChange(n,r.oldSnap));else if(e==qu.CHILD_CHANGED&&i==qu.CHILD_ADDED)this.changeMap.set(n,qu.childAddedChange(n,t.snapshotNode));else{if(e!=qu.CHILD_CHANGED||i!=qu.CHILD_CHANGED)throw Ki("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,qu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},Qu.prototype.getChanges=function(){return Array.from(this.changeMap.values())},Qu);function Qu(){this.changeMap=new Map}function Ku(){}var Hu=new(Ku.prototype.getCompleteChild=function(t){return null},Ku.prototype.getChildAfterChild=function(t,e,n){return null},Ku),Gu=(zu.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new xu(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},zu.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},zu);function zu(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Yu=function(t,e){this.viewCache=t,this.changes=e},Xu=(Ju.prototype.assertIndexed=function(t){Qi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Qi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Ju.prototype.applyOperation=function(t,e,n,r){var i,o,a=new Wu;if(e.type===bu.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(Qi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===bu.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(Qi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===bu.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==bu.LISTEN_COMPLETE)throw Ki("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Ju.maybeAddValueEvent_(t,i,h),new Yu(i,h)},Ju.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(qu.valueChange(e.getCompleteEventSnap()))}},Ju.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(Qi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Ks?u:Ks.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){Qi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Ju.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,Hu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new Gu(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Ju.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new Gu(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ks.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Ju.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Ju.prototype.applyUserMerge_=function(t,e,n,r,i,o){var a=this,s=t;return n.foreach((function(n,u){var c=e.child(n);Ju.cacheHasChild_(t,c.getFront())&&(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),n.foreach((function(n,u){var c=e.child(n);Ju.cacheHasChild_(t,c.getFront())||(s=a.applyUserOverwrite_(s,c,u,r,i,o))})),s},Ju.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},Ju.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:Nu.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new Ia(e),l,r,i,o,a)}})),u.children.inorderTraversal((function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new Ia(e),f,r,i,o,a)}})),c},Ju.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=Nu.Empty;return s.getNode().forEachChild(ds,(function(t,e){u=u.set(new Ia(t),e)})),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=Nu.Empty;return n.foreach((function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))})),this.applyServerMerge_(t,e,c,r,i,a,o)},Ju.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,Hu,r)},Ju.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new Gu(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();Qi(h instanceof Ks,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,Ks.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Ia.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Ju);function Ju(t){this.filter_=t}var $u=(Zu.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach((function(t){t.type===qu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(qu.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(i,qu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,qu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,qu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,qu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,qu.VALUE,t,n,e),i},Zu.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter((function(t){return t.type===e}));a.sort(this.compareChanges_.bind(this)),a.forEach((function(e){var n=o.materializeSingleChange_(e,i);r.forEach((function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))}))}))},Zu.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Zu.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Ki("Should only compare child_ events.");var n=new os(t.childName,t.snapshotNode),r=new os(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Zu);function Zu(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var tc,ec=(nc.prototype.getQuery=function(){return this.query_},nc.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},nc.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},nc.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},nc.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},nc.prototype.removeEventRegistration=function(t,e){var n=[];if(e){Qi(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)}))}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},nc.prototype.applyOperation=function(t,e,n){t.type===bu.MERGE&&null!==t.source.queryId&&(Qi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Qi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),Qi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},nc.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ss,(function(t,e){n.push(qu.childAddedChange(t,e))})),e.isFullyInitialized()&&n.push(qu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},nc.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},nc);function nc(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Bu(n.getIndex()),i=n.getNodeFilter();this.processor_=new Xu(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Ks.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ks.EMPTY_NODE,a.getNode(),null),c=new xu(s,o.isFullyInitialized(),r.filtersNodes()),h=new xu(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Fu(h,c),this.eventGenerator_=new $u(this.query_)}var rc=(Object.defineProperty(ic,"__referenceConstructor",{get:function(){return Qi(tc,"Reference.ts has not been loaded"),tc},set:function(t){Qi(!tc,"__referenceConstructor has already been defined"),tc=t},enumerable:!0,configurable:!0}),ic.prototype.isEmpty=function(){return 0===this.views.size},ic.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return Qi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=Ui(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},ic.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof Ks?n.calcCompleteEventChildren(r):Ks.EMPTY_NODE,!1);var c=new Fu(new xu(u,s,!1),new xu(r,i,!1));a=new ec(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},ic.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=Ui(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=qi(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new ic.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},ic.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=Ui(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},ic.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=Ui(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},ic.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},ic.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},ic.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},ic.prototype.getCompleteView=function(){var t,e;try{for(var n=Ui(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},ic);function ic(){this.views=new Map}var oc=(ac.prototype.addWrite=function(t,e){if(t.isEmpty())return new ac(new Nu(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Ia.relativePath(r,t);return i=i.updateChild(o,e),new ac(this.writeTree_.set(r,i))}var a=new Nu(e);return new ac(this.writeTree_.setTree(t,a))},ac.prototype.addWrites=function(t,e){var n=this;return ba(e,(function(e,r){n=n.addWrite(t.child(e),r)})),n},ac.prototype.removeWrite=function(t){return t.isEmpty()?ac.Empty:new ac(this.writeTree_.setTree(t,Nu.Empty))},ac.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},ac.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Ia.relativePath(e.path,t)):null},ac.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ss,(function(e,n){t.push(new os(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new os(e,n.value))})),t},ac.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new ac(null!=e?new Nu(e):this.writeTree_.subtree(t))},ac.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},ac.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(Qi(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}(Ia.Empty,this.writeTree_,t)},ac.Empty=new ac(new Nu(null)),ac);function ac(t){this.writeTree_=t}var sc=(uc.prototype.childWrites=function(t){return new cc(t,this)},uc.prototype.addOverwrite=function(t,e,n,r){Qi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},uc.prototype.addMerge=function(t,e,n){Qi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},uc.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},uc.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));Qi(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):ba(r.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})),!0)},uc.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},uc.prototype.calcCompleteEventCache=function(t,e,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(t);if(!r&&i.isEmpty())return e;if(r||null!=e||i.hasCompleteWrite(Ia.Empty)){var o=uc.layerTree_(this.allWrites_,(function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t);return u=e||Ks.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(t);if(s.isEmpty())return e;if(null!=e||s.hasCompleteWrite(Ia.Empty)){var u=e||Ks.EMPTY_NODE;return s.apply(u)}return null},uc.prototype.calcCompleteEventChildren=function(t,e){var n=Ks.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ss,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ss,(function(t,e){var r=i.childCompoundWrite(new Ia(t)).apply(e);n=n.updateImmediateChild(t,r)})),i.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},uc.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){Qi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},uc.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},uc.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},uc.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Ia.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},uc.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},uc.prototype.resetTree_=function(){this.visibleWrites_=uc.layerTree_(this.allWrites_,uc.DefaultFilter_,Ia.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},uc.DefaultFilter_=function(t){return t.visible},uc.layerTree_=function(t,e,n){for(var r=oc.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Ia.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Ia.relativePath(a,n),r=r.addWrite(Ia.Empty,o.snap.getChild(s)));else{if(!o.children)throw Ki("WriteRecord should have .snap or .children");if(n.contains(a))s=Ia.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Ia.relativePath(a,n)).isEmpty())r=r.addWrites(Ia.Empty,o.children);else{var u=lo(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Ia.Empty,c)}}}}}return r},uc);function uc(){this.visibleWrites_=oc.Empty,this.allWrites_=[],this.lastWriteId_=-1}var cc=(hc.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},hc.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},hc.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},hc.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},hc.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},hc.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},hc.prototype.child=function(t){return new hc(this.treePath_.child(t),this.writeTree_)},hc);function hc(t,e){this.treePath_=t,this.writeTree_=e}var lc=(fc.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new Ru(Eu.User,t,e)):[]},fc.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Nu.fromObject(e);return this.applyOperationToSyncPoints_(new Pu(Eu.User,t,r))},fc.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Nu.Empty;return null!=n.snap?r=r.set(Ia.Empty,!0):ba(n.children,(function(t,e){r=r.set(new Ia(t),e)})),this.applyOperationToSyncPoints_(new Iu(n.path,r,e))}return[]},fc.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Ru(Eu.Server,t,e))},fc.prototype.applyServerMerge=function(t,e){var n=Nu.fromObject(e);return this.applyOperationToSyncPoints_(new Pu(Eu.Server,t,n))},fc.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ku(Eu.Server,t))},fc.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=fc.parseQueryKey_(r),o=i.path,a=i.queryId,s=Ia.relativePath(o,t),u=new Ru(Eu.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},fc.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=fc.parseQueryKey_(r),o=i.path,a=i.queryId,s=Ia.relativePath(o,t),u=Nu.fromObject(e),c=new Pu(Eu.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},fc.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=fc.parseQueryKey_(n),i=r.path,o=r.queryId,a=Ia.relativePath(i,t),s=new ku(Eu.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},fc.prototype.addEventRegistration=function(t,e){var n=t.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,(function(t,e){var o=Ia.relativePath(t,n);r=r||e.getCompleteServerCache(o),i=i||e.hasCompleteView()}));var o,a=this.syncPointTree_.get(n);a?(i=i||a.hasCompleteView(),r=r||a.getCompleteServerCache(Ia.Empty)):(a=new rc,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r?o=!0:(o=!1,r=Ks.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild((function(t,e){var n=e.getCompleteServerCache(Ia.Empty);n&&(r=r.updateImmediateChild(t,n))})));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=fc.makeQueryKey_(t);Qi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=fc.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(n),l=a.addEventRegistration(t,e,h,r,o);if(!s&&!i){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},fc.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex((function(t){return t.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(i,(function(t,e){return e.hasCompleteView()}));if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(fc.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(fc.queryForListening_(t),null):u.forEach((function(t){var e=r.queryToTagMap.get(fc.makeQueryKey_(t));r.listenProvider_.stopListening(fc.queryForListening_(t),e)}))),this.removeTags_(u)}return a},fc.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,(function(e,n){var r=Ia.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(t,r,e,!0)},fc.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),ba(n,(function(t,e){r=r.concat(e)})),r}))},fc.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=fc.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},fc.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},fc.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(fc.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)Qi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),ba(n,(function(t,e){r=r.concat(e)})),r})),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(fc.queryForListening_(c),this.tagForQuery_(c))}return o},fc.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ks.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},fc.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},fc.parseQueryKey_=function(t){var e=t.indexOf("$");return Qi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Ia(t.substr(0,e))}},fc.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},fc.prototype.tagForQuery_=function(t){var e=fc.makeQueryKey_(t);return this.queryToTagMap.get(e)},fc.getNextQueryTag_=function(){return fc.nextQueryTag_++},fc.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);Qi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},fc.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Ia.Empty))},fc.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Ia.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Ia.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},fc.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(Ia.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(Ia.Empty));var a=[];return e.children.inorderTraversal((function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))})),o&&(a=a.concat(o.applyOperation(t,r,n))),a},fc.nextQueryTag_=1,fc);function fc(t){this.listenProvider_=t,this.syncPointTree_=Nu.Empty,this.pendingWriteTree_=new sc,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var pc=(dc.prototype.getNode=function(t){return this.rootNode_.getChild(t)},dc.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},dc);function dc(){this.rootNode_=Ks.EMPTY_NODE}var yc=(mc.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,(function(t){return t&&"auth/token-not-initialized"===t.code?(Jo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}))},mc.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},mc.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},mc.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ea(t)},mc);function mc(t){this.app_=t}var vc=function(t){this.accessToken=t},gc=(bc.prototype.getToken=function(t){return Promise.resolve(new vc("owner"))},bc.prototype.addTokenChangeListener=function(t){},bc.prototype.removeTokenChangeListener=function(t){},bc.prototype.notifyForInvalidToken=function(){ea('Database emulator unexpectedly rejected fake "owner" credentials.')},bc);function bc(t){this.app_=t}var wc=(_c.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),ho(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},_c.prototype.get=function(){return Gi(this.counters_)},_c);function _c(){this.counters_={}}var Ec=(Tc.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new wc),this.collections_[e]},Tc.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Tc.collections_={},Tc.reporters_={},Tc);function Tc(){}var Sc=(Ic.prototype.get=function(){var t=this.collection_.get(),e=xi({},t);return this.last_&&ba(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},Ic);function Ic(t){this.collection_=t,this.last_=null}var Cc=(Nc.prototype.includeStat=function(t){this.statsToReport_[t]=!0},Nc.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;ba(e,(function(e,i){0<i&&ho(t.statsToReport_,e)&&(n[e]=i,r=!0)})),r&&this.server_.reportStats(n),Ea(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Nc);function Nc(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Sc(t);var n=1e4+2e4*Math.random();Ea(this.reportStats_.bind(this),Math.floor(n))}var Ac=(kc.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Dc(i)),e.add(r)}e&&this.eventLists_.push(e)},kc.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},kc.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},kc.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},kc);function kc(){this.eventLists_=[],this.recursionDepth_=0}var Dc=(Rc.prototype.add=function(t){this.events_.push(t)},Rc.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();pa&&Jo("event: "+e.toString()),_a(n)}}},Rc.prototype.getPath=function(){return this.path_},Rc);function Rc(t){this.path_=t,this.events_=[]}var Oc=(Pc.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=Vi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},Pc.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},Pc.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},Pc.prototype.validateEventType_=function(t){Qi(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},Pc);function Pc(t){this.allowedEvents_=t,this.listeners_={},Qi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var Mc,xc=(Mi(Lc,Mc=Oc),Lc.getInstance=function(){return new Lc},Lc.prototype.getInitialEvent=function(t){return Qi("visible"===t,"Unknown event type: "+t),[this.visible_]},Lc);function Lc(){var t,e,n=Mc.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),n.visible_=!0,e&&document.addEventListener(e,(function(){var e=!document[t];e!==n.visible_&&(n.visible_=e,n.trigger("visible",e))}),!1),n}var Fc,Uc=(Mi(qc,Fc=Oc),qc.getInstance=function(){return new qc},qc.prototype.getInitialEvent=function(t){return Qi("online"===t,"Unknown event type: "+t),[this.online_]},qc.prototype.currentlyOnline=function(){return this.online_},qc);function qc(){var t=Fc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||$i()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}var Vc=(Bc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},Bc.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&_a((function(){n.onMessage_(t[e])}))},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},Bc);function Bc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var jc=(Wc.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Vc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Qc((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=qi(t,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==i)n.id=o,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=qi(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ka)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},Wc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},Wc.forceAllow=function(){Wc.forceAllow_=!0},Wc.forceDisallow=function(){Wc.forceDisallow_=!0},Wc.isAvailable=function(){return!!Wc.forceAllow_||!(Wc.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},Wc.prototype.markConnectionHealthy=function(){},Wc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},Wc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},Wc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},Wc.prototype.send=function(t){var e=uo(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=oa(function(t){var e=Bi(t);return Hi.encodeByteArray(e,!0)}(e),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},Wc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},Wc.prototype.incrementIncomingBytes_=function(t){var e=uo(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},Wc);function Wc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=$o(t),this.stats_=Ec.getCollection(e),this.urlFn=function(t){return e.connectionURL(Ra,t)}}var Qc=(Kc.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Jo("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},Kc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},Kc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},Kc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},Kc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},Kc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(i),r()}))},Kc.prototype.addTag=function(t,e){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){Jo("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}}),Math.floor(1))},Kc);function Kc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=la(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Kc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Jo("frame writing exception"),t.stack&&Jo(t.stack),Jo(t)}}var Hc="",Gc=null;"undefined"!=typeof MozWebSocket?Gc=MozWebSocket:"undefined"!=typeof WebSocket&&(Gc=WebSocket);var zc=(Yc.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(ka)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Da,r)},Yc.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,sa.set("previous_websocket_failure",!0);try{if(to()){var i=Wi.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Hc+"/"+r.platform+"/"+i}},a=r.env,s=0==this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;s&&(o.proxy={origin:s}),this.mySock=new Gc(this.connURL,[],o)}else this.mySock=new Gc(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var u=t.message||t.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},Yc.prototype.start=function(){},Yc.forceDisallow=function(){Yc.forceDisallow_=!0},Yc.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Gc&&!Yc.forceDisallow_},Yc.previouslyFailed=function(){return sa.isInMemoryStorage||!0===sa.get("previous_websocket_failure")},Yc.prototype.markConnectionHealthy=function(){sa.remove("previous_websocket_failure")},Yc.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=so(e);this.onMessage(n)}},Yc.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},Yc.prototype.extractFrameCount_=function(t){if(Qi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},Yc.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},Yc.prototype.send=function(t){this.resetKeepAlive();var e=uo(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=oa(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},Yc.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},Yc.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},Yc.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},Yc.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},Yc.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},Yc.responsesRequiredToBeHealthy=2,Yc.healthyTimeout=3e4,Yc);function Yc(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=$o(this.connId),this.stats_=Ec.getCollection(e),this.connURL=Yc.connectionURL_(e,n,r)}var Xc=(Object.defineProperty(Jc,"ALL_TRANSPORTS",{get:function(){return[jc,zc]},enumerable:!0,configurable:!0}),Jc.prototype.initTransports_=function(t){var e,n,r=zc&&zc.isAvailable(),i=r&&!zc.previouslyFailed();if(t.webSocketOnly&&(r||ea("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[zc];else{var o=this.transports_=[];try{for(var a=Ui(Jc.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Jc.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Jc.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Jc);function Jc(t){this.initTransports_(t)}var $c=(Zc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,r)}),Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Ea((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(i)))},Zc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Zc.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},Zc.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},Zc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Zc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Zc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Zc.prototype.onSecondaryMessageReceived_=function(t){var e=ia("t",t),n=ia("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Zc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Zc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Zc.prototype.onPrimaryMessageReceived_=function(t){var e=ia("t",t),n=ia("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Zc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Zc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Zc.prototype.onControl_=function(t){var e=ia("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Zo("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Zo("Unknown control packet command: "+e)}},Zc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&ea("Protocol version mismatch detected"),this.tryStartUpgrade_())},Zc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Zc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ea((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},Zc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Zc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ea((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},Zc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Zc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Zc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(sa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Zc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Zc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Zc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Zc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Zc);function Zc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=$o("c:"+this.id+":"),this.transportManager_=new Xc(e),this.log_("Connection created"),this.start_()}var th=(eh.prototype.put=function(t,e,n,r){},eh.prototype.merge=function(t,e,n,r){},eh.prototype.refreshAuthToken=function(t){},eh.prototype.onDisconnectPut=function(t,e,n){},eh.prototype.onDisconnectMerge=function(t,e,n){},eh.prototype.onDisconnectCancel=function(t,e){},eh.prototype.reportStats=function(t){},eh);function eh(){}var nh,rh=(Mi(ih,nh=th),ih.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(uo(i)),Qi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},ih.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Qi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Qi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},ih.prototype.sendListen_=function(t){var e=this,n=t.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};t.tag&&(o.q=n.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,s=o.s;ih.warnOnListenWarnings_(a,n),(e.listens.get(r)&&e.listens.get(r).get(i))===t&&(e.log_("listen response",o),"ok"!==s&&e.removeListen_(r,i),t.onComplete&&t.onComplete(s,a))}))},ih.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&ho(t,"w")){var n=lo(t,"w");Array.isArray(n)&&~n.indexOf("no_index")&&ea('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+e.getQueryParams().getIndex().toString()+'" at '+e.path.toString()+" to your security rules for better performance.")}},ih.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},ih.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=co(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},ih.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=function(t){var e=co(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},ih.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Qi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},ih.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},ih.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},ih.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},ih.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},ih.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(function(t){r&&setTimeout((function(){r(t.s,t.d)}),Math.floor(0))}))},ih.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},ih.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},ih.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},ih.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,(function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)}))},ih.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}}))}},ih.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+uo(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},ih.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Zo("Unrecognized action received from server: "+uo(t)+"\nAre you using the latest client?")},ih.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},ih.prototype.scheduleConnect_=function(t){var e=this;Qi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},ih.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},ih.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},ih.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},ih.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ih.nextConnectionId_++,i=this,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){Qi(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then((function(u){a?Jo("getToken() completed but was canceled"):(Jo("getToken() completed. Creating connection."),i.authToken_=u&&u.accessToken,s=new $c(r,i.repoInfo_,t,e,n,(function(t){ea(t+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")}),o))})).then(null,(function(t){i.log_("Failed to get token: "+t),a||u()}))}},ih.prototype.interrupt=function(t){Jo("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},ih.prototype.resume=function(t){Jo("Resuming connection for reason: "+t),delete this.interruptReasons_[t],fo(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},ih.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},ih.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},ih.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return ga(t)})).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},ih.prototype.removeListen_=function(t,e){var n,r=new Ia(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},ih.prototype.onAuthRevoked_=function(t,e){Jo("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},ih.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},ih.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=Ui(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,Ui(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},ih.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Hc.replace(/\./g,"-")]=1,$i()?t["framework.cordova"]=1:Zi()&&(t["framework.reactnative"]=1),this.reportStats(t)},ih.prototype.shouldReconnect_=function(){var t=Uc.getInstance().currentlyOnline();return fo(this.interruptReasons_)&&t},ih.nextPersistentConnectionId_=0,ih.nextConnectionId_=0,ih);function ih(t,e,n,r,i,o){var a=nh.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=ih.nextPersistentConnectionId_++,a.log_=$o("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!to())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),xc.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Uc.getInstance().on("online",a.onOnline_,a),a}var oh,ah=(Mi(sh,oh=th),sh.prototype.reportStats=function(t){throw new Error("Method not implemented.")},sh.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Qi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},sh.prototype.listen=function(t,e,n,r){var i=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=sh.getListenId_(t,n),s={};this.listens_[a]=s;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,(function(t,e){var u=e;404===t&&(t=u=null),null===t&&i.onDataUpdate_(o,u,!1,n),lo(i.listens_,a)===s&&r(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)}))},sh.prototype.unlisten=function(t,e){var n=sh.getListenId_(t,e);delete this.listens_[n]},sh.prototype.refreshAuthToken=function(t){},sh.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}(e);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(200<=s.status&&s.status<300){try{t=so(s.responseText)}catch(t){ea("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&ea("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()}))},sh);function sh(t,e,n){var r=oh.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=$o("p:rest:"),r.listens_={},r}var uh="repo_interrupt",ch=(hh.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},hh.prototype.name=function(){return this.repoInfo_.namespace},hh.prototype.serverTime=function(){var t=this.infoData_.getNode(new Ia(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},hh.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},hh.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Ia(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=po(e,(function(t){return Js(t)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Js(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=po(e,(function(t){return Js(t)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Js(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},hh.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},hh.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},hh.prototype.onServerInfoUpdate_=function(t){var e=this;ba(t,(function(t,n){e.updateInfo_(t,n)}))},hh.prototype.updateInfo_=function(t,e){var n=new Ia("/.info/"+t),r=Js(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},hh.prototype.getNextWriteId_=function(){return this.nextWriteId_++},hh.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=Js(e,n),s=_u(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),(function(e,n){var o="ok"===e;o||ea("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)}));var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},hh.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(ba(e,(function(t,e){i=!1;var n=Js(e);a[t]=_u(n,o)})),i)Jo("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,(function(e,i){var o="ok"===e;o||ea("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)})),ba(e,(function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},hh.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new mu;return t.forEachTree(new Ia(""),(function(t,r){n.remember(t,_u(r,e))})),n}(this.onDisconnect_,e),r=[];n.forEachTree(Ia.Empty,(function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)})),this.onDisconnect_=new mu,this.eventQueue_.raiseEventsForChangedPath(Ia.Empty,r)},hh.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)}))},hh.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Js(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),(function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)}))},hh.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Js(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),(function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)}))},hh.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(fo(e))return Jo("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(i,o){"ok"===i&&ba(e,(function(e,n){var i=Js(n);r.onDisconnect_.remember(t.child(e),i)})),r.callOnCompleteCallback(n,i,o)}))},hh.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},hh.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},hh.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(uh)},hh.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(uh)},hh.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Sc(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);ba(e,(function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)}))}},hh.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},hh.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Jo.apply(void 0,Vi([n],t))},hh.prototype.callOnCompleteCallback=function(t,e,n){t&&_a((function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}}))},Object.defineProperty(hh.prototype,"database",{get:function(){return this.__database||(this.__database=new kh(this))},enumerable:!0,configurable:!0}),hh);function hh(t,e,n){var i,o=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ac,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new mu,this.persistentConnection_=null,i=void 0!==r&&r.env[ha]?new gc(n):new yc(n),this.stats_=Ec.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new ah(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=n.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{uo(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new rh(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a),this.server_=this.persistentConnection_}i.addTokenChangeListener((function(t){o.server_.refreshAuthToken(t)})),this.statsReporter_=Ec.getOrCreateReporter(t,(function(){return new Cc(o.stats_,o.server_)})),this.transactions_init_(),this.infoData_=new pc,this.infoSyncTree_=new lc({startListening:function(t,e,n,r){var i=[],a=o.infoData_.getNode(t.path);return a.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){r("ok")}),0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new lc({startListening:function(t,e,n,r){return o.server_.listen(t,n,e,(function(e,n){var i=r(e,n);o.eventQueue_.raiseEventsForChangedPath(t.path,i)})),[]},stopListening:function(t,e){o.server_.unlisten(t,e)}})}var lh=(fh.prototype.getStartPost=function(){return this.startPost_},fh.prototype.getEndPost=function(){return this.endPost_},fh.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},fh.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new os(e,n))||(n=Ks.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},fh.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ks.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ks.EMPTY_NODE);var i=this;return e.forEachChild(Ss,(function(t,e){i.matches(new os(t,e))||(r=r.updateImmediateChild(t,Ks.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)},fh.prototype.updatePriority=function(t,e){return t},fh.prototype.filtersNodes=function(){return!0},fh.prototype.getIndexedFilter=function(){return this.indexedFilter_},fh.prototype.getIndex=function(){return this.index_},fh.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},fh.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},fh);function fh(t){this.indexedFilter_=new Bu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=fh.getStartPost_(t),this.endPost_=fh.getEndPost_(t)}var ph=(dh.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new os(e,n))||(n=Ks.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},dh.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ks.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ks.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ks.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Ks.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},dh.prototype.updatePriority=function(t,e){return t},dh.prototype.filtersNodes=function(){return!0},dh.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},dh.prototype.getIndex=function(){return this.index_},dh.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;Qi(s.numChildren()==this.limit_,"");var u=new os(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(qu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(qu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,Ks.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(qu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(qu.childRemovedChange(c.name,c.node)),i.trackChildChange(qu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,Ks.EMPTY_NODE)):t},dh);function dh(t){this.rangedFilter_=new lh(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var yh=(mh.prototype.hasStart=function(){return this.startSet_},mh.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===mh.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},mh.prototype.getIndexStartValue=function(){return Qi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},mh.prototype.getIndexStartName=function(){return Qi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ya},mh.prototype.hasEnd=function(){return this.endSet_},mh.prototype.getIndexEndValue=function(){return Qi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},mh.prototype.getIndexEndName=function(){return Qi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ma},mh.prototype.hasLimit=function(){return this.limitSet_},mh.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},mh.prototype.getLimit=function(){return Qi(this.limitSet_,"Only valid if limit has been set"),this.limit_},mh.prototype.getIndex=function(){return this.index_},mh.prototype.copy_=function(){var t=new mh;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},mh.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},mh.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=mh.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},mh.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=mh.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},mh.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},mh.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},mh.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},mh.prototype.getQueryObject=function(){var t=mh.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Ss&&(e[t.INDEX]=this.index_.toString()),e},mh.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},mh.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ss},mh.prototype.getNodeFilter=function(){return this.loadsAllData()?new Bu(this.getIndex()):this.hasLimit()?new ph(this):new lh(this)},mh.prototype.toRestQueryStringParameters=function(){var t,e=mh.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Ss?e.PRIORITY_INDEX:this.index_===tu?e.VALUE_INDEX:this.index_===ds?e.KEY_INDEX:(Qi(this.index_ instanceof eu,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=uo(t),this.startSet_&&(n[e.START_AT]=uo(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+uo(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=uo(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+uo(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},mh.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},mh.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},mh.DEFAULT=new mh,mh);function mh(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ss}var vh,gh=(Mi(bh,vh=du),bh.prototype.getKey=function(){return To("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},bh.prototype.child=function(t){return To("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Ia||(null===this.path.getFront()?function(t,e,n,r){Wa("Reference.child",1,n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),!1)}(0,0,t):Wa("Reference.child",1,t,!1)),new bh(this.repo,this.path.child(t))},bh.prototype.getParent=function(){To("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new bh(this.repo,t)},bh.prototype.getRoot=function(){To("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},bh.prototype.databaseProp=function(){return this.repo.database},bh.prototype.set=function(t,e){To("Reference.set",1,2,arguments.length),Qa("Reference.set",this.path),Ua("Reference.set",1,t,this.path,!1),Io("Reference.set",2,e,!0);var n=new Yi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},bh.prototype.update=function(t,e){if(To("Reference.update",1,2,arguments.length),Qa("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,ea("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}qa("Reference.update",1,t,this.path,!1),Io("Reference.update",2,e,!0);var i=new Yi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},bh.prototype.setWithPriority=function(t,e,n){if(To("Reference.setWithPriority",2,3,arguments.length),Qa("Reference.setWithPriority",this.path),Ua("Reference.setWithPriority",1,t,this.path,!1),Va("Reference.setWithPriority",2,e,!1),Io("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Yi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},bh.prototype.remove=function(t){return To("Reference.remove",0,1,arguments.length),Qa("Reference.remove",this.path),Io("Reference.remove",1,t,!0),this.set(null,t)},bh.prototype.transaction=function(t,e,n){if(To("Reference.transaction",1,3,arguments.length),Qa("Reference.transaction",this.path),Io("Reference.transaction",1,t,!1),Io("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(So("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new Yi;return"function"==typeof e&&r.promise.catch((function(){})),this.repo.startTransaction(this.path,t,(function(t,n,i){t?r.reject(t):r.resolve(new Za(n,i)),"function"==typeof e&&e(t,n,i)}),n),r.promise},bh.prototype.setPriority=function(t,e){To("Reference.setPriority",1,2,arguments.length),Qa("Reference.setPriority",this.path),Va("Reference.setPriority",1,t,!1),Io("Reference.setPriority",2,e,!0);var n=new Yi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},bh.prototype.push=function(t,e){To("Reference.push",0,2,arguments.length),Qa("Reference.push",this.path),Ua("Reference.push",1,t,this.path,!0),Io("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=is(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),o},bh.prototype.onDisconnect=function(){return Qa("Reference.onDisconnect",this.path),new Ja(this.repo,this.path)},Object.defineProperty(bh.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(bh.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(bh.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(bh.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),bh);function bh(t,e){if(!(t instanceof ch))throw new Error("new Reference() no longer supported - use app.database().");return vh.call(this,t,e,yh.DEFAULT,!1)||this}du.__referenceConstructor=gh,rc.__referenceConstructor=gh;var wh,_h,Eh=function(){this.children={},this.childCount=0,this.value=null},Th=(Sh.prototype.subTree=function(t){for(var e,n=t instanceof Ia?t:new Ia(t),r=this;null!==(e=n.getFront());)r=new Sh(e,r,lo(r.node_.children,e)||new Eh),n=n.popFront();return r},Sh.prototype.getValue=function(){return this.node_.value},Sh.prototype.setValue=function(t){Qi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Sh.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Sh.prototype.hasChildren=function(){return 0<this.node_.childCount},Sh.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Sh.prototype.forEachChild=function(t){var e=this;ba(this.node_.children,(function(n,r){t(new Sh(n,e,r))}))},Sh.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},Sh.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Sh.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},Sh.prototype.path=function(){return new Ia(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Sh.prototype.name=function(){return this.name_},Sh.prototype.parent=function(){return this.parent_},Sh.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Sh.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=ho(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Sh);function Sh(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Eh),this.name_=t,this.parent_=e,this.node_=n}(_h=wh=wh||{})[_h.RUN=0]="RUN",_h[_h.SENT=1]="SENT",_h[_h.COMPLETED=2]="COMPLETED",_h[_h.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",_h[_h.NEEDS_ABORT=4]="NEEDS_ABORT",ch.MAX_TRANSACTION_RETRIES_=25,ch.prototype.transactions_init_=function(){this.transactionQueueTree_=new Th},ch.prototype.startTransaction=function(t,e,n,r){function i(){}this.log_("transaction on "+t);var o=new gh(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:la(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new ru(a.currentInputSnapshot,new gh(this,a.path),Ss);a.onComplete(null,!1,c)}}else{Xa("transaction failed: Data returned ",u,a.path),a.status=wh.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;"object"==typeof u&&null!==u&&ho(u,".priority")?(f=lo(u,".priority"),Qi(Fa(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||Ks.EMPTY_NODE).getPriority().val(),f=f;var p=this.generateServerValues(),d=Js(u,f),y=_u(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},ch.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ks.EMPTY_NODE},ch.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);Qi(0<n.length,"Sending zero length transaction queue"),n.every((function(t){return t.status===wh.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},ch.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map((function(t){return t.currentWriteId})),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];Qi(u.status===wh.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=wh.SENT,u.retryCount++;var c=Ia.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,(function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=wh.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new gh(n,e[a].path),c=new ru(s,u,Ss);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)_a(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===wh.SENT_NEEDS_ABORT?e[a].status=wh.NEEDS_ABORT:e[a].status=wh.RUN;else for(ea("transaction at "+l.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=wh.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}}),a)},ch.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},ch.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter((function(t){return t.status===wh.RUN})).map((function(t){return t.currentWriteId})),a=0;a<t.length;a++){var s=t[a],u=Ia.relativePath(e,s.path),c=!1,h=void 0;if(Qi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===wh.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===wh.RUN)if(s.retryCount>=ch.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){Xa("transaction failed: Data returned ",f,s.path);var p=Js(f);"object"==typeof f&&null!=f&&ho(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=_u(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=wh.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new gh(this,t[a].path),g=t[a].currentInputSnapshot,b=new ru(g,v,Ss);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<r.length;a++)_a(r[a]);this.sendReadyTransactions_()}},ch.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},ch.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},ch.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},ch.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==wh.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},ch.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},ch.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===wh.SENT_NEEDS_ABORT||(e[o].status===wh.SENT?(Qi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=wh.SENT_NEEDS_ABORT,e[o].abortReason="set"):(Qi(e[o].status===wh.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)_a(n[o])}};var Ih,Ch="databaseURL",Nh=(Ah.getInstance=function(){return Ih=Ih||new Ah},Ah.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},Ah.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},Ah.prototype.databaseFromApp=function(t,e){var n=e||t.options[Ch];void 0===n&&ta("Can't determine Firebase Database URL.  Be sure to include "+Ch+" option when calling firebase.initializeApp().");var i=Ma(n),o=i.repoInfo,a=void 0;return void 0!==r&&(a=r.env[ha]),a&&(o=(i=Ma(n="http://"+a+"?ns="+o.namespace)).repoInfo),Ka("Invalid Firebase Database URL",1,i),i.path.isEmpty()||ta("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t).database},Ah.prototype.deleteRepo=function(t){var e=lo(this.repos_,t.app.name);e&&lo(e,t.repoInfo_.toURLString())===t||ta("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},Ah.prototype.createRepo=function(t,e){var n=lo(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=lo(n,t.toURLString());return r&&ta("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new ch(t,this.useRestClient_,e),n[t.toURLString()]=r},Ah.prototype.forceRestClient=function(t){this.useRestClient_=t},Ah);function Ah(){this.repos_={},this.useRestClient_=!1}var kh=(Object.defineProperty(Dh.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Dh.prototype.ref=function(t){return this.checkDeleted_("ref"),To("database.ref",0,1,arguments.length),t instanceof gh?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},Dh.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),To(e,1,1,arguments.length);var n=Ma(t);Ka(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&ta(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Dh.prototype.checkDeleted_=function(t){null===this.repo_&&ta("Cannot call "+t+" on a deleted database.")},Dh.prototype.goOffline=function(){To("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Dh.prototype.goOnline=function(){To("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Dh.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Dh);function Dh(t){(this.repo_=t)instanceof ch||ta("Don't call new Database() directly - please use firebase.database()."),this.root_=new gh(t,Ia.Empty),this.INTERNAL=new Rh(this)}var Rh=(Oh.prototype.delete=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return this.database.checkDeleted_("delete"),Nh.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},Oh);function Oh(t){this.database=t}var Ph=Object.freeze({forceLongPolling:function(){zc.forceDisallow(),jc.forceAllow()},forceWebSockets:function(){jc.forceDisallow()},isWebSocketsAvailable:function(){return zc.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),Mh=rh;rh.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},rh.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var xh,Lh,Fh=$c,Uh=Oa,qh=Object.freeze({DataConnection:Mh,RealTimeConnection:Fh,hijackHash:function(t){var e=rh.prototype.put;return rh.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){rh.prototype.put=e}},ConnectionTarget:Uh,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Nh.getInstance().forceRestClient(t)}}),Vh=kh.ServerValue;xh=(Lh=Wo).SDK_VERSION,Hc=xh,Lh.INTERNAL.registerService("database",(function(t,e,n){return Nh.getInstance().databaseFromApp(t,n)}),{Reference:gh,Query:du,Database:kh,DataSnapshot:ru,enableLogging:Xo,INTERNAL:Ph,ServerValue:Vh,TEST_ACCESS:qh},null,!0);var Bh,jh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},Wh=Wh||{},Qh=jh;function Kh(t){return"string"==typeof t}function Hh(t){return"number"==typeof t}function Gh(t,e){t=t.split("."),e=e||Qh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function zh(){}function Yh(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Xh(t){return"array"==Yh(t)}function Jh(t){var e=Yh(t);return"array"==e||"object"==e&&"number"==typeof t.length}function $h(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Zh="closure_uid_"+(1e9*Math.random()>>>0),tl=0;function el(t,e,n){return t.call.apply(t.bind,arguments)}function nl(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function rl(t,e,n){return(rl=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?el:nl).apply(null,arguments)}function il(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var ol=Date.now||function(){return+new Date};function al(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function sl(){this.j=this.j,this.i=this.i}sl.prototype.j=!1,sl.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[Zh]||(this[Zh]=++tl))},sl.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ul=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Kh(t))return Kh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},cl=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Kh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function hl(){return Array.prototype.concat.apply([],arguments)}function ll(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function fl(t){return/^[\s\xa0]*$/.test(t)}var pl,dl=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function yl(t,e){return-1!=t.indexOf(e)}function ml(t,e){return t<e?-1:e<t?1:0}t:{var vl=Qh.navigator;if(vl){var gl=vl.userAgent;if(gl){pl=gl;break t}}pl=""}function bl(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function wl(t){var e,n={};for(e in t)n[e]=t[e];return n}var _l="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function El(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<_l.length;i++)e=_l[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Tl(t){return Tl[" "](t),t}Tl[" "]=zh;var Sl,Il,Cl=yl(pl,"Opera"),Nl=yl(pl,"Trident")||yl(pl,"MSIE"),Al=yl(pl,"Edge"),kl=Al||Nl,Dl=yl(pl,"Gecko")&&!(yl(pl.toLowerCase(),"webkit")&&!yl(pl,"Edge"))&&!(yl(pl,"Trident")||yl(pl,"MSIE"))&&!yl(pl,"Edge"),Rl=yl(pl.toLowerCase(),"webkit")&&!yl(pl,"Edge");function Ol(){var t=Qh.document;return t?t.documentMode:void 0}t:{var Pl="",Ml=(Il=pl,Dl?/rv:([^\);]+)(\)|;)/.exec(Il):Al?/Edge\/([\d\.]+)/.exec(Il):Nl?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Il):Rl?/WebKit\/(\S+)/.exec(Il):Cl?/(?:Version)[ \/]?(\S+)/.exec(Il):void 0);if(Ml&&(Pl=Ml?Ml[1]:""),Nl){var xl=Ol();if(null!=xl&&xl>parseFloat(Pl)){Sl=String(xl);break t}}Sl=Pl}var Ll,Fl={};function Ul(t){return function(e,n){var r=Fl;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=dl(String(Sl)).split("."),r=dl(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=ml(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||ml(0==a[2].length,0==s[2].length)||ml(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}var ql=Qh.document;Ll=ql&&Nl?Ol()||("CSS1Compat"==ql.compatMode?parseInt(Sl,10):5):void 0;var Vl=!Nl||9<=Number(Ll),Bl=Nl&&!Ul("9"),jl=function(){if(!Qh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Qh.addEventListener("test",zh,e),Qh.removeEventListener("test",zh,e)}catch(t){}return t}();function Wl(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function Ql(t,e){if(Wl.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Dl){t:{try{Tl(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Kh(t.pointerType)?t.pointerType:Kl[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Wl.prototype.b=function(){this.Ja=!1},al(Ql,Wl);var Kl={2:"touch",3:"pen",4:"mouse"};Ql.prototype.b=function(){Ql.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Bl)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Hl="closure_listenable_"+(1e6*Math.random()|0),Gl=0;function zl(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Gl,this.X=this.Z=!1}function Yl(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Xl(t){this.src=t,this.a={},this.b=0}function Jl(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=ul(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Yl(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function $l(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Xl.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=$l(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new zl(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Zl="closure_lm_"+(1e6*Math.random()|0),tf={};function ef(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Xh(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=hf(r),e&&e[Hl]?e.Ba(n,r,$h(i)?!!i.capture:!!i,o):nf(e,n,r,!0,i,o)}(t,e,n,r,i);if(Xh(e)){for(var o=0;o<e.length;o++)ef(t,e[o],n,r,i);return null}return n=hf(n),t&&t[Hl]?t.Aa(e,n,$h(r)?!!r.capture:!!r,i):nf(t,e,n,!1,r,i)}function nf(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=$h(i)?!!i.capture:!!i;if(a&&!Vl)return null;var s=uf(t);if(s||(t[Zl]=s=new Xl(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=sf,e=Vl?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)jl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(of(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function rf(t){if(!Hh(t)&&t&&!t.X){var e=t.src;if(e&&e[Hl])Jl(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(of(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=uf(e))?(Jl(n,t),0==n.b&&(n.src=null,e[Zl]=null)):Yl(t)}}}function of(t){return t in tf?tf[t]:tf[t]="on"+t}function af(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&rf(t),n.call(r,e)}function sf(t,e){return!!t.X||af(t,Vl?new Ql(e,this):e=new Ql(e||Gh("window.event"),this))}function uf(t){return(t=t[Zl])instanceof Xl?t:null}var cf="__closure_events_fn_"+(1e9*Math.random()>>>0);function hf(t){return"function"==Yh(t)?t:(t[cf]||(t[cf]=function(e){return t.handleEvent(e)}),t[cf])}function lf(){sl.call(this),this.c=new Xl(this),(this.J=this).B=null}function ff(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Jl(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}al(lf,sl),lf.prototype[Hl]=!0,(Bh=lf.prototype).addEventListener=function(t,e,n,r){ef(this,t,e,n,r)},Bh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Xh(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=$h(i)?!!i.capture:!!i,r=hf(r),e&&e[Hl]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=$l(a=e.a[n],r,i,o))&&(Yl(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&uf(e))&&(n=e.a[n.toString()],e=-1,n&&(e=$l(n,r,i,o)),(r=-1<e?n[e]:null)&&rf(r))}(this,t,e,n,r)},Bh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Kh(t))t=new Wl(t,n);else if(t instanceof Wl)t.target=t.target||n;else{var i=t;El(t=new Wl(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=ff(a,r,!0,t)&&i}if(i=ff(a=t.a=n,r,!0,t)&&i,i=ff(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=ff(a=t.a=e[o],r,!1,t)&&i;return i},Bh.G=function(){if(lf.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Yl(n[r]);delete e.a[t],e.b--}}this.B=null},Bh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},Bh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var pf=Qh.JSON.stringify;function df(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function yf(){this.b=this.a=null}df.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var mf,vf=new df((function(){return new gf}),(function(t){t.reset()}));function gf(){this.next=this.b=this.a=null}function bf(t){Qh.setTimeout((function(){throw t}),0)}function wf(t,e){mf||function(){var t=Qh.Promise.resolve(void 0);mf=function(){t.then(Tf)}}(),_f||(mf(),_f=!0),Ef.add(t,e)}yf.prototype.add=function(t,e){var n=vf.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},gf.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var _f=!(gf.prototype.reset=function(){this.next=this.b=this.a=null}),Ef=new yf;function Tf(){for(var t;r=n=void 0,r=null,(n=Ef).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){bf(t)}var e=vf;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;_f=!1}function Sf(t,e){lf.call(this),this.b=t||1,this.a=e||Qh,this.f=rl(this.gb,this),this.g=ol()}function If(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Cf(t,e,n){if("function"==Yh(t))n&&(t=rl(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=rl(t.handleEvent,t)}return 2147483647<Number(e)?-1:Qh.setTimeout(t,e||0)}function Nf(t,e,n){sl.call(this),this.f=null!=n?rl(t,n):t,this.c=e,this.b=rl(this.ab,this),this.a=[]}function Af(t){t.U=Cf(t.b,t.c),t.f.apply(null,t.a)}function kf(t){sl.call(this),this.b=t,this.a={}}al(Sf,lf),(Bh=Sf.prototype).ba=!1,Bh.L=null,Bh.gb=function(){if(this.ba){var t=ol()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(If(this),this.start()))}},Bh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=ol())},Bh.G=function(){Sf.N.G.call(this),If(this),delete this.a},al(Nf,sl),(Bh=Nf.prototype).ea=!1,Bh.U=null,Bh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Af(this)},Bh.G=function(){Nf.N.G.call(this),this.U&&(Qh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},Bh.ab=function(){this.U=null,this.ea&&(this.ea=!1,Af(this))},al(kf,sl);var Df=[];function Rf(t,e,n,r){Xh(n)||(n&&(Df[0]=n.toString()),n=Df);for(var i=0;i<n.length;i++){var o=ef(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Of(t){bl(t.a,(function(t,e){this.a.hasOwnProperty(e)&&rf(t)}),t),t.a={}}function Pf(){}kf.prototype.G=function(){kf.N.G.call(this),Of(this)},kf.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Mf=new lf;function xf(t){Wl.call(this,"serverreachability",t)}function Lf(t){Mf.dispatchEvent(new xf(Mf,t))}function Ff(t){Wl.call(this,"statevent",t)}function Uf(t){Mf.dispatchEvent(new Ff(Mf,t))}function qf(t){Wl.call(this,"timingevent",t)}function Vf(t,e){if("function"!=Yh(t))throw Error("Fn must not be null and must be a function");return Qh.setTimeout((function(){t()}),e)}al(xf,Wl),al(Ff,Wl),al(qf,Wl);var Bf={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},jf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Wf(){}function Qf(t){var e;return(e=t.a)||(e=t.a={}),e}function Kf(){}Wf.prototype.a=null;var Hf,Gf={OPEN:"a",ib:"b",Na:"c",rb:"d"};function zf(){Wl.call(this,"d")}function Yf(){Wl.call(this,"c")}function Xf(){}function Jf(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new kf(this),this.O=$f,t=kl?125:void 0,this.P=new Sf(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}al(zf,Wl),al(Yf,Wl),al(Xf,Wf),Hf=new Xf;var $f=45e3,Zf={},tp={};function ep(t,e,n){t.F=1,t.f=Cp(bp(e)),t.l=n,t.H=!0,rp(t,null)}function np(t,e,n,r){t.F=1,t.f=Cp(bp(e)),t.l=null,t.H=n,rp(t,r)}function rp(t,e){t.v=ol(),ap(t),t.D=bp(t.f),Ip(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Nf(rl(t.Ka,t,t.a),t.J)),Rf(t.I,t.a,"readystatechange",t.eb),e=t.h?wl(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Lf(1)}function ip(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=op(t,n);if(i==tp){4==e&&(t.c=4,Uf(14),r=!1);break}if(i==Zf){t.c=4,Uf(15),r=!1;break}lp(t,i)}4==e&&0==n.length&&(t.c=1,Uf(16),r=!1),t.b=t.b&&r,r||(hp(t),cp(t))}function op(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?tp:(n=Number(e.substring(n,r)),isNaN(n)?Zf:(r+=1)+n>e.length?tp:(e=e.substr(r,n),t.A=r+n,e))}function ap(t){t.R=ol()+t.O,sp(t,t.O)}function sp(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Vf(rl(t.bb,t),e)}function up(t){t.i&&(Qh.clearTimeout(t.i),t.i=null)}function cp(t){t.g.Da()||t.m||t.g.na(t)}function hp(t){up(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,If(t.P),Of(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function lp(t,e){try{t.g.Ga(t,e),Lf(4)}catch(t){}}function fp(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Jh(t)||Kh(t))cl(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Jh(t)||Kh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Kh(t))return t.split("");if(Jh(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function pp(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof pp)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function dp(t,e){mp(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&yp(t))}function yp(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];mp(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)mp(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function mp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Bh=Jf.prototype).setTimeout=function(t){this.O=t},Bh.eb=function(t){t=t.target;var e=this.B;e&&3==gd(t)?e.Ua():this.Ka(t)},Bh.Ka=function(t){try{if(t==this.a)t:{var e=gd(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!kl&&!this.a.aa())){this.m||4!=e||7==n||Lf(8==n||r<=0?3:2),up(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=bd(this.a,"X-HTTP-Initial-Response");if(a&&!fl(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,Uf(12),hp(this),cp(this);break t}this.s=!0,lp(this,s)}this.H?(ip(this,e,o),kl&&this.b&&3==e&&(Rf(this.I,this.P,"tick",this.cb),this.P.start())):lp(this,o),4==e&&hp(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,ap(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Uf(12)):(this.c=0,Uf(13)),hp(this),cp(this)}}}catch(t){}},Bh.cb=function(){if(this.a){var t=gd(this.a),e=this.a.aa();this.A<e.length&&(up(this),ip(this,t,e),this.b&&4!=t&&ap(this))}},Bh.cancel=function(){this.m=!0,hp(this)},Bh.bb=function(){this.i=null;var t=ol();0<=t-this.R?(2!=this.F&&(Lf(3),Uf(17)),hp(this),this.c=2,cp(this)):sp(this,this.R-t)},(Bh=pp.prototype).C=function(){yp(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},Bh.K=function(){return yp(this),this.a.concat()},Bh.get=function(t,e){return mp(this.b,t)?this.b[t]:e},Bh.set=function(t,e){mp(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},Bh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var vp=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function gp(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof gp?(this.h=void 0!==e?e:t.h,wp(this,t.f),this.j=t.j,_p(this,t.b),Ep(this,t.i),this.a=t.a,Tp(this,Vp(t.c)),this.g=t.g):t&&(n=String(t).match(vp))?(this.h=!!e,wp(this,n[1]||"",!0),this.j=Np(n[2]||""),_p(this,n[3]||"",!0),Ep(this,n[4]),this.a=Np(n[5]||"",!0),Tp(this,n[6]||"",!0),this.g=Np(n[7]||"")):(this.h=!!e,this.c=new xp(null,this.h))}function bp(t){return new gp(t)}function wp(t,e,n){t.f=n?Np(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function _p(t,e,n){t.b=n?Np(e,!0):e}function Ep(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Tp(t,e,n){e instanceof xp?(t.c=e,function(t,e){e&&!t.f&&(Lp(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Fp(this,e),qp(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=Ap(e,Pp)),t.c=new xp(e,t.h))}function Sp(t,e,n){t.c.set(e,n)}function Ip(t,e,n){Xh(n)||(n=[String(n)]),qp(t.c,e,n)}function Cp(t){return Sp(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^ol()).toString(36)),t}function Np(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ap(t,e,n){return Kh(t)?(t=encodeURI(t).replace(e,kp),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function kp(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}gp.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ap(e,Dp,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Ap(e,Dp,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ap(n,"/"==n.charAt(0)?Op:Rp,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Ap(n,Mp)),t.join("")},gp.prototype.resolve=function(t){var e=bp(this),n=!!t.f;n?wp(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?_p(e,t.b):n=null!=t.i;var r=t.a;if(n)Ep(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yl(i,"./")||yl(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Tp(e,Vp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Dp=/[#\/\?@]/g,Rp=/[#\?:]/g,Op=/[#\?]/g,Pp=/[#\?@]/g,Mp=/#/g;function xp(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Lp(t){t.a||(t.a=new pp,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Fp(t,e){Lp(t),e=Bp(t,e),mp(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,dp(t.a,e))}function Up(t,e){return Lp(t),e=Bp(t,e),mp(t.a.b,e)}function qp(t,e,n){Fp(t,e),0<n.length&&(t.c=null,t.a.set(Bp(t,e),ll(n)),t.b+=n.length)}function Vp(t){var e=new xp;return e.c=t.c,t.a&&(e.a=new pp(t.a),e.b=t.b),e}function Bp(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function jp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Wp(t){var e=t.a.F.a;if(null!=e)Uf(4),e?(Uf(10),Rd(t.a,t,!1)):(Uf(11),Rd(t.a,t,!0));else{t.b=new Jf(t,void 0,void 0),t.b.h=t.h,e=Ld(e=t.a,e.Y()?t.f:null,t.i),Uf(4),Ip(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Sp(e,n,r),np(t.b,e,!1,t.f)}}function Qp(){this.a=this.b=null}function Kp(){this.a=new pp}function Hp(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Zh]||(t[Zh]=++tl)):e.charAt(0)+t}function Gp(t,e){this.b=t,this.a=e}function zp(t){this.g=t||Yp,t=Qh.PerformanceNavigationTiming?0<(t=Qh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Qh.ka&&Qh.ka.Ea&&Qh.ka.Ea()&&Qh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Kp),this.b=null,this.c=[]}(Bh=xp.prototype).add=function(t,e){Lp(this),this.c=null,t=Bp(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},Bh.forEach=function(t,e){Lp(this),this.a.forEach((function(n,r){cl(n,(function(n){t.call(e,n,r,this)}),this)}),this)},Bh.K=function(){Lp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Bh.C=function(t){Lp(this);var e=[];if(Kh(t))Up(this,t)&&(e=hl(e,this.a.get(Bp(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=hl(e,t[n])}return e},Bh.set=function(t,e){return Lp(this),this.c=null,Up(this,t=Bp(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},Bh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},Bh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},al((function(){}),(function(){})),(Bh=jp.prototype).M=null,Bh.$=function(t){return this.a.$(t)},Bh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},Bh.Da=function(){return!1},Bh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=bd(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=bd(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void Md(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Md(e,2)}else 1==this.M&&(this.g?Uf(6):"11111"==e?(Uf(5),this.g=!0,(!Nl||10<=Number(Ll))&&(this.c=200,this.b.cancel(),Uf(11),Rd(this.a,this,!0))):(Uf(7),this.g=!1))},Bh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Wp(this)):1==this.M&&(this.g?(Uf(11),Rd(this.a,this,!0)):(Uf(10),Rd(this.a,this,!1)));else{0==this.M?Uf(8):1==this.M&&Uf(9);var t=this.a;t.m=this.c,Md(t,2)}},Bh.Y=function(){return this.a.Y()},Bh.ma=function(){return this.a.ma()},Kp.prototype.add=function(t){this.a.set(Hp(t),t)},Kp.prototype.C=function(){return this.a.C()};var Yp=10;function Xp(t,e){!t.a&&(yl(e,"spdy")||yl(e,"quic")||yl(e,"h2"))&&(t.f=t.g,t.a=new Kp,t.b&&(td(t,t.b),t.b=null))}function Jp(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function $p(t){return t.b?1:t.a?t.a.a.c:0}function Zp(t,e){return t.b?t.b==e:!!t.a&&(e=Hp(e),mp(t.a.a.b,e))}function td(t,e){t.a?t.a.add(e):t.b=e}function ed(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Hp(e),n=mp(t.a.a.b,n)),n&&dp(t.a.a,Hp(e)))}function nd(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return ll(t.c);var e=t.c;return cl(t.a.C(),(function(t){e=e.concat(t.j)})),e}function rd(){}function id(){this.a=new rd}function od(t,e,n){var r=n||"";try{fp(t,(function(t,n){var i=t;$h(t)&&(i=pf(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function ad(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}zp.prototype.cancel=function(){this.c=nd(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(cl(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},rd.prototype.stringify=function(t){return Qh.JSON.stringify(t,void 0)},rd.prototype.parse=function(t){return Qh.JSON.parse(t,void 0)};var sd=Qh.JSON.parse;function ud(t){lf.call(this),this.headers=new pp,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=cd,this.D=this.F=!1}al(ud,lf);var cd="",hd=/^https?$/i,ld=["POST","PUT"];function fd(t){return"content-type"==t.toLowerCase()}function pd(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,dd(t),md(t)}function dd(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function yd(t){if(t.b&&void 0!==Wh&&(!t.s[1]||4!=gd(t)||2!=t.T()))if(t.l&&4==gd(t))Cf(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==gd(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(vp)[1]||null;if(!o&&Qh.self&&Qh.self.location){var a=Qh.self.location.protocol;o=a.substr(0,a.length-1)}i=!hd.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",dd(t))}finally{md(t)}}}function md(t,e){if(t.a){vd(t);var n=t.a,r=t.s[0]?zh:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function vd(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Qh.clearTimeout(t.m),t.m=null)}function gd(t){return t.a?t.a.readyState:0}function bd(t,e){return t.a?t.a.getResponseHeader(e):null}function wd(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return bl(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),Kh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Sp(t,e,n),t}function _d(t){this.f=[],this.F=new Qp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!Gh("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=Gh("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=Gh("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=Gh("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=Gh("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new zp(t&&t.concurrentRequestLimit),this.ja=new id,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Ed(t){if(Td(t),3==t.u){var e=t.P++,n=bp(t.B);Sp(n,"SID",t.H),Sp(n,"RID",e),Sp(n,"TYPE","terminate"),Nd(t,n),(e=new Jf(t,e,void 0)).F=2,e.f=Cp(bp(n)),n=!1,Qh.navigator&&Qh.navigator.sendBeacon&&(n=Qh.navigator.sendBeacon(e.f.toString(),"")),!n&&Qh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=ol(),ap(e)}xd(t)}function Td(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(Qh.clearTimeout(t.l),t.l=null),Od(t),t.b.cancel(),t.h&&(Hh(t.h)&&Qh.clearTimeout(t.h),t.h=null)}function Sd(t,e){t.f.push(new Gp(t.Ra++,e)),3==t.u&&Id(t)}function Id(t){Jp(t.b)||t.h||(t.h=!0,wf(t.Ia,t),t.A=0)}function Cd(t,e){var n;n=e?e.W:t.P++;var r=bp(t.B);Sp(r,"SID",t.H),Sp(r,"RID",n),Sp(r,"AID",t.O),Nd(t,r),t.g&&t.i&&wd(r,t.g,t.i),n=new Jf(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Ad(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),td(t.b,n),ep(n,r,e)}function Nd(t,e){t.c&&fp({},(function(t,n){Sp(e,n,t)}))}function Ad(t,e,n){n=Math.min(t.f.length,n);var r=t.c?rl(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{od(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function kd(t){t.a||t.l||(t.S=1,wf(t.Ha,t),t.v=0)}function Dd(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=Vf(rl(t.Ha,t),Pd(t,t.v)),t.v++,0))}function Rd(t,e,n){var r=e.l;r&&Xp(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Ld(t,null,t.ha),Id(t)}function Od(t){null!=t.s&&(Qh.clearTimeout(t.s),t.s=null)}function Pd(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function Md(t,e){if(2==e){var n=null;t.c&&(n=null);var r=rl(t.fb,t);n||(n=new gp("//www.google.com/images/cleardot.gif"),Qh.location&&"http"==Qh.location.protocol||wp(n,"https"),Cp(n)),function(t,e){var n=new Pf;if(Qh.Image){var r=new Image;r.onload=il(ad,n,r,"TestLoadImage: loaded",!0,e),r.onerror=il(ad,n,r,"TestLoadImage: error",!1,e),r.onabort=il(ad,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=il(ad,n,r,"TestLoadImage: timeout",!1,e),Qh.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Uf(2);t.u=0,t.c&&t.c.ta(e),xd(t),Td(t)}function xd(t){t.u=0,t.m=-1,t.c&&(0==nd(t.b).length&&0==t.f.length||(t.b.c.length=0,ll(t.f),t.f.length=0),t.c.sa())}function Ld(t,e,n){var r=function(t){return t instanceof gp?bp(t):new gp(t,void 0)}(n);if(""!=r.b)e&&_p(r,e+"."+r.b),Ep(r,r.i);else{var i,o=Qh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new gp(null,void 0);return t&&wp(i,t),e&&_p(i,e),n&&Ep(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&bl(t.V,(function(t,e){Sp(r,e,t)})),e=t.j,n=t.I,e&&n&&Sp(r,e,n),Sp(r,"VER",t.wa),Nd(t,r),r}function Fd(){}function Ud(){if(Nl&&!(10<=Number(Ll)))throw Error("Environmental error: no available transport.")}function qd(t,e){lf.call(this),this.a=new _d(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!fl(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!fl(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new jd(this)}function Vd(t){zf.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Bd(){Yf.call(this),this.status=1}function jd(t){this.a=t}(Bh=ud.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Qf(this.H):Qf(Hf),this.a.onreadystatechange=rl(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void pd(this,t)}t=n||"";var i=new pp(this.headers);r&&fp(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=fd,n=t.length,r=Kh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Kh(t)?t.charAt(e):t[e]}(i.K()),n=Qh.FormData&&t instanceof Qh.FormData,0<=ul(ld,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{vd(this),0<this.o&&((this.D=function(t){return Nl&&Ul(9)&&Hh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=rl(this.Ca,this)):this.m=Cf(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){pd(this,t)}},Bh.Ca=function(){void 0!==Wh&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},Bh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),md(this))},Bh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),md(this,!0)),ud.N.G.call(this)},Bh.Fa=function(){this.j||(this.w||this.l||this.g?yd(this):this.$a())},Bh.$a=function(){yd(this)},Bh.T=function(){try{return 2<gd(this)?this.a.status:-1}catch(t){return-1}},Bh.za=function(){try{return 2<gd(this)?this.a.statusText:""}catch(t){return""}},Bh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},Bh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),sd(e)}},Bh.ya=function(){return this.h},Bh.Ya=function(){return Kh(this.f)?this.f:String(this.f)},(Bh=_d.prototype).wa=8,Bh.u=1,Bh.Da=function(){return 0==this.u},Bh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Jf(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?El(r=wl(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Kh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Ad(this,n,e),Sp(i=bp(this.B),"RID",t),Sp(i,"CVER",22),this.o&&this.j&&Sp(i,"X-HTTP-Session-Id",this.j),Nd(this,i),this.g&&r&&wd(i,this.g,r),td(this.b,n),this.W?(Sp(i,"$req",e),Sp(i,"SID","null"),n.S=!0,ep(n,i,null)):ep(n,i,e),this.u=2}}else 3==this.u&&(t?Cd(this,t):0==this.f.length||Jp(this.b)||Cd(this))},Bh.Ha=function(){this.l=null,this.a=new Jf(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=bp(this.pa);Sp(t,"RID","rpc"),Sp(t,"SID",this.H),Sp(t,"CI",this.ia?"0":"1"),Sp(t,"AID",this.O),Nd(this,t),Sp(t,"TYPE","xmlhttp"),this.g&&this.i&&wd(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),np(this.a,t,!0,this.ga)},Bh.Ga=function(t,e){if(0!=this.u&&(this.a==t||Zp(this.b,t)))if(this.m=t.o,!t.s&&Zp(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Xh(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Od(this),this.a.cancel(),this.a=null}Dd(this),Uf(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Vf(rl(this.Za,this),6e3));if($p(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else Md(this,11)}else if(!t.s&&this.a!=t||Od(this),!fl(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Hh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=bd(r,"X-Client-Wire-Protocol"))&&Xp(this.b,i),this.j&&(r=bd(r,"X-HTTP-Session-Id")))&&(this.I=r,Sp(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Ld(this,this.Y()?this.ga:null,this.ha),r.s?(ed(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(up(r),ap(r)),this.a=r):kd(this),0<this.f.length&&Id(this)}else"stop"!=r[0]&&"close"!=r[0]||Md(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Md(this,7):Ed(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},Bh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Dd(this),Uf(19))},Bh.na=function(t){var e=null;if(this.a==t){Od(this),this.a=null;var n=2}else{if(!Zp(this.b,t))return;e=t.j,ed(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=ol()-t.v,Mf.dispatchEvent(new qf(Mf,t.l?t.l.length:0,e,this.A)),Id(this)):kd(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!($p(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=Vf(rl(t.Ia,t,e),Pd(t,t.A)),t.A++,0)))}(this,t)||2==n&&Dd(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Md(this,5);break;case 4:Md(this,10);break;case 3:Md(this,6);break;default:Md(this,2)}}},Bh.fb=function(t){Uf(t?2:1)},Bh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new ud(this.La)).F=this.R,t},Bh.ma=function(){return!!this.c&&!0},Bh.Y=function(){return this.R},(Bh=Fd.prototype).va=function(){},Bh.ua=function(){},Bh.ta=function(){},Bh.sa=function(){},Bh.Ta=function(){},Ud.prototype.a=function(t,e){return new qd(t,e)},al(qd,lf),(Bh=qd.prototype).addEventListener=function(t,e,n,r){qd.N.addEventListener.call(this,t,e,n,r)},Bh.removeEventListener=function(t,e,n,r){qd.N.removeEventListener.call(this,t,e,n,r)},Bh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Uf(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new jp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=wd(e,t.g,t.i)),(t=t.w).i=n,e=Ld(t.a,null,t.i),Uf(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Wp(t)):(Ip(e,"MODE","init"),!t.a.o&&t.a.j&&Ip(e,"X-HTTP-Session-Id",t.a.j),t.b=new Jf(t,void 0,void 0),t.b.h=t.h,np(t.b,e,!1,null),t.M=0)},Bh.close=function(){Ed(this.a)},Bh.Xa=function(t){if(Kh(t)){var e={};e.__data__=t,Sd(this.a,e)}else this.h?((e={}).__data__=pf(t),Sd(this.a,e)):Sd(this.a,t)},Bh.G=function(){this.a.c=null,delete this.f,Ed(this.a),delete this.a,qd.N.G.call(this)},al(Vd,zf),al(Bd,Yf),al(jd,Fd),jd.prototype.va=function(){this.a.dispatchEvent("a")},jd.prototype.ua=function(t){this.a.dispatchEvent(new Vd(t))},jd.prototype.ta=function(t){this.a.dispatchEvent(new Bd(t))},jd.prototype.sa=function(){this.a.dispatchEvent("b")};var Wd=il((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),Ud);Ud.prototype.createWebChannel=Ud.prototype.a,qd.prototype.send=qd.prototype.Xa,qd.prototype.open=qd.prototype.Wa,qd.prototype.close=qd.prototype.close,Bf.NO_ERROR=0,Bf.TIMEOUT=8,Bf.HTTP_ERROR=6,jf.COMPLETE="complete",(Kf.EventType=Gf).OPEN="a",Gf.CLOSE="b",Gf.ERROR="c",Gf.MESSAGE="d",lf.prototype.listen=lf.prototype.Aa,ud.prototype.listenOnce=ud.prototype.Ba,ud.prototype.getLastError=ud.prototype.Ya,ud.prototype.getLastErrorCode=ud.prototype.ya,ud.prototype.getStatus=ud.prototype.T,ud.prototype.getStatusText=ud.prototype.za,ud.prototype.getResponseJson=ud.prototype.Va,ud.prototype.getResponseText=ud.prototype.aa,ud.prototype.send=ud.prototype.ca;var Qd,Kd,Hd={createWebChannelTransport:Wd,ErrorCode:Bf,EventType:jf,WebChannel:Kf,XhrIo:ud},Gd=Hd.createWebChannelTransport,zd=Hd.ErrorCode,Yd=Hd.EventType,Xd=Hd.WebChannel,Jd=Hd.XhrIo,$d=Wo.SDK_VERSION,Zd=new Ro("@firebase/firestore");function ty(){return Zd.logLevel===go.DEBUG?Qd.DEBUG:Zd.logLevel===go.SILENT?Qd.SILENT:Qd.ERROR}function ey(t){switch(t){case Qd.DEBUG:Zd.logLevel=go.DEBUG;break;case Qd.ERROR:Zd.logLevel=go.ERROR;break;case Qd.SILENT:Zd.logLevel=go.SILENT;break;default:Zd.error("Firestore ("+$d+"): Invalid value passed to `setLogLevel`")}}function ny(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Zd.logLevel<=go.DEBUG){var i=n.map(iy);Zd.debug.apply(Zd,["Firestore ("+$d+") ["+t+"]: "+e].concat(i))}}function ry(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Zd.logLevel<=go.ERROR){var r=e.map(iy);Zd.error.apply(Zd,["Firestore ("+$d+"): "+t].concat(r))}}function iy(t){if("string"==typeof t)return t;var e=sy.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function oy(t){var e="FIRESTORE ("+$d+") INTERNAL ASSERTION FAILED: "+t;throw ry(e),new Error(e)}function ay(t,e){t||oy(e)}(Kd=Qd=Qd||{})[Kd.DEBUG=0]="DEBUG",Kd[Kd.ERROR=1]="ERROR",Kd[Kd.SILENT=2]="SILENT";var sy=(uy.setPlatform=function(t){uy.platform&&oy("Platform already defined"),uy.platform=t},uy.getPlatform=function(){return uy.platform||oy("Platform not set"),uy.platform},uy);function uy(){}function cy(){return sy.getPlatform().emptyByteString}var hy,ly={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},fy=(Mi(py,hy=Error),py);function py(t,e){var n=hy.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function dy(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new fy(ly.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function yy(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function my(t,e){return void 0!==t?t:e}function vy(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function gy(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function by(t){for(var e in ay(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function wy(t,e){if(0!==e.length)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ly(e.length,"argument")+".")}function _y(t,e,n){if(e.length!==n)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires "+Ly(n,"argument")+", but was called with "+Ly(e.length,"argument")+".")}function Ey(t,e,n){if(e.length<n)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ly(n,"argument")+", but was called with "+Ly(e.length,"argument")+".")}function Ty(t,e,n,r){if(e.length<n||e.length>r)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ly(e.length,"argument")+".")}function Sy(t,e,n,r){ky(t,e,xy(n)+" argument",r)}function Iy(t,e,n,r){void 0!==r&&Sy(t,e,n,r)}function Cy(t,e,n,r){ky(t,e,n+" option",r)}function Ny(t,e,n,r){void 0!==r&&Cy(t,e,n,r)}function Ay(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Ry(u))}var c=Ry(r);throw new fy(ly.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ky(t,e,n,r){if(!("object"===e?Dy(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ry(r);throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Dy(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ry(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":oy("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Oy(t,e,n){if(void 0===n)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+xy(e)+" argument, but it was undefined.")}function Py(t,e,n){gy(e,(function(e,r){if(n.indexOf(e)<0)throw new fy(ly.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function My(t,e,n,r){var i=Ry(r);return new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires its "+xy(n)+" argument to be a "+e+", but it was: "+i)}function xy(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ly(t,e){return t+" "+e+(1===t?"":"s")}var Fy=(Uy.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return ay(20===e.length,"Invalid auto ID: "+e),e},Uy);function Uy(){}function qy(t,e){return t<e?-1:e<t?1:0}function Vy(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function By(t){return t+"\0"}function jy(){if("undefined"==typeof Uint8Array)throw new fy(ly.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Wy(){if(!sy.getPlatform().base64Available)throw new fy(ly.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Qy=(Ky.fromBase64String=function(t){_y("Blob.fromBase64String",arguments,1),Sy("Blob.fromBase64String","string",1,t),Wy();try{return new Ky(sy.getPlatform().atob(t))}catch(t){throw new fy(ly.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Ky.fromUint8Array=function(t){if(_y("Blob.fromUint8Array",arguments,1),jy(),!(t instanceof Uint8Array))throw My("Blob.fromUint8Array","Uint8Array",1,t);return new Ky(Array.prototype.map.call(t,(function(t){return String.fromCharCode(t)})).join(""))},Ky.prototype.toBase64=function(){return _y("Blob.toBase64",arguments,0),Wy(),sy.getPlatform().btoa(this._binaryString)},Ky.prototype.toUint8Array=function(){_y("Blob.toUint8Array",arguments,0),jy();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},Ky.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ky.prototype.isEqual=function(t){return this._binaryString===t._binaryString},Ky.prototype._compareTo=function(t){return qy(this._binaryString,t._binaryString)},Ky);function Ky(t){Wy(),this._binaryString=t}var Hy=dy(Qy,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Gy=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},zy="(default)",Yy=(Object.defineProperty(Xy.prototype,"isDefaultDatabase",{get:function(){return this.database===zy},enumerable:!0,configurable:!0}),Xy.prototype.isEqual=function(t){return t instanceof Xy&&t.projectId===this.projectId&&t.database===this.database},Xy.prototype.compareTo=function(t){return qy(this.projectId,t.projectId)||qy(this.database,t.database)},Xy);function Xy(t,e){this.projectId=t,this.database=e||zy}var Jy=($y.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},$y.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},$y.INVALID=-1,$y);function $y(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Zy="__name__",tm=(Object.defineProperty(em.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),em.prototype.isEqual=function(t){return 0===em.comparator(this,t)},em.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof em?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},em.prototype.limit=function(){return this.offset+this.length},em.prototype.popFirst=function(t){return t=void 0===t?1:t,ay(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},em.prototype.popLast=function(){return ay(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},em.prototype.firstSegment=function(){return ay(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},em.prototype.lastSegment=function(){return this.get(this.length-1)},em.prototype.get=function(t){return ay(t<this.length,"Index out of range"),this.segments[this.offset+t]},em.prototype.isEmpty=function(){return 0===this.length},em.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},em.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},em.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},em.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},em.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},em);function em(t,e,n){void 0===e?e=0:e>t.length&&oy("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&oy("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var nm,rm=(Mi(im,nm=tm),im.prototype.construct=function(t,e,n){return new im(t,e,n)},im.prototype.canonicalString=function(){return this.toArray().join("/")},im.prototype.toString=function(){return this.canonicalString()},im.fromString=function(t){if(0<=t.indexOf("//"))throw new fy(ly.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new im(t.split("/").filter((function(t){return 0<t.length})))},im.EMPTY_PATH=new im([]),im);function im(){return null!==nm&&nm.apply(this,arguments)||this}var om,am=/^[_a-zA-Z][_a-zA-Z0-9]*$/,sm=(Mi(um,om=tm),um.prototype.construct=function(t,e,n){return new um(t,e,n)},um.isValidIdentifier=function(t){return am.test(t)},um.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),um.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},um.prototype.toString=function(){return this.canonicalString()},um.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Zy},um.keyField=function(){return new um([Zy])},um.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new fy(ly.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new fy(ly.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new fy(ly.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new fy(ly.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new um(e)},um.EMPTY_PATH=new um([]),um);function um(){return null!==om&&om.apply(this,arguments)||this}var cm=(hm.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},hm.prototype.isEqual=function(t){return null!==t&&0===rm.comparator(this.path,t.path)},hm.prototype.toString=function(){return this.path.toString()},hm.comparator=function(t,e){return rm.comparator(t.path,e.path)},hm.isDocumentKey=function(t){return t.length%2==0},hm.fromSegments=function(t){return new hm(new rm(t.slice()))},hm.fromPathString=function(t){return new hm(rm.fromString(t))},hm.EMPTY=new hm(new rm([])),hm);function hm(t){this.path=t,ay(hm.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var lm,fm,pm=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};(fm=lm=lm||{}).All="all",fm.ListenStreamIdle="listen_stream_idle",fm.ListenStreamConnectionBackoff="listen_stream_connection_backoff",fm.WriteStreamIdle="write_stream_idle",fm.WriteStreamConnectionBackoff="write_stream_connection_backoff",fm.OnlineStateTimeout="online_state_timeout",fm.ClientMetadataRefresh="client_metadata_refresh",fm.LruGarbageCollection="lru_garbage_collection",fm.RetryTransaction="retry_transaction";var dm=(ym.createAndSchedule=function(t,e,n,r,i){var o=new ym(t,e,Date.now()+n,r,i);return o.start(n),o},ym.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},ym.prototype.skipDelay=function(){return this.handleDelayElapsed()},ym.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new fy(ly.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},ym.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},ym.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},ym);function ym(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new pm,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}var mm=(Object.defineProperty(vm.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),vm.prototype.enqueueAndForget=function(t){this.enqueue(t)},vm.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},vm.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},vm.prototype.enqueueAndInitiateShutdown=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},vm.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise((function(t){})):this.enqueueInternal(t)},vm.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then((function(){return e.operationInProgress=!0,t().catch((function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw ry("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.operationInProgress=!1,t}))}));return this.tail=n},vm.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),ay(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=dm.createAndSchedule(this,t,e,n,(function(t){return r.removeDelayedOperation(t)}));return this.delayedOperations.push(i),i},vm.prototype.verifyNotFailed=function(){this.failure&&oy("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},vm.prototype.verifyOperationInProgress=function(){ay(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},vm.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))},vm.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},vm.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then((function(){ay(t===lm.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==lm.All&&i.timerId===t)break}return e.drain()}))},vm.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},vm.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);ay(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},vm);function vm(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var gm="",bm="",wm="",_m="";function Em(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Sm(e)),e=Tm(t.get(n),e);return Sm(e)}function Tm(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=gm+wm;break;case gm:n+=gm+_m;break;default:n+=o}}return n}function Sm(t){return t+gm+bm}function Im(t){var e=t.length;if(ay(2<=e,"Invalid path "+t),2===e)return ay(t.charAt(0)===gm&&t.charAt(1)===bm,"Non-empty path "+t+" had length 2"),rm.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(gm,o);switch((a<0||n<a)&&oy('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case bm:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case wm:i+=t.substring(o,a),i+="\0";break;case _m:i+=t.substring(o,a+1);break;default:oy('Invalid encoded resource path: "'+t+'"')}o=a+2}return new rm(r)}var Cm=(Nm.now=function(){return Nm.fromMillis(Date.now())},Nm.fromDate=function(t){return Nm.fromMillis(t.getTime())},Nm.fromMillis=function(t){var e=Math.floor(t/1e3);return new Nm(e,1e6*(t-1e3*e))},Nm.prototype.toDate=function(){return new Date(this.toMillis())},Nm.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Nm.prototype._compareTo=function(t){return this.seconds===t.seconds?qy(this.nanoseconds,t.nanoseconds):qy(this.seconds,t.seconds)},Nm.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Nm.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Nm);function Nm(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new fy(ly.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new fy(ly.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new fy(ly.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new fy(ly.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var Am=(km.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new km(new Cm(e,t%1e6*1e3))},km.fromTimestamp=function(t){return new km(t)},km.forDeletedDoc=function(){return km.MIN},km.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},km.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},km.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},km.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},km.prototype.toTimestamp=function(){return this.timestamp},km.MIN=new km(new Cm(0,0)),km);function km(t){this.timestamp=t}var Dm=(Rm.prototype.insert=function(t,e){return new Rm(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Mm.BLACK,null,null))},Rm.prototype.remove=function(t){return new Rm(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Mm.BLACK,null,null))},Rm.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Rm.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Rm.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Rm.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Rm.prototype.minKey=function(){return this.root.minKey()},Rm.prototype.maxKey=function(){return this.root.maxKey()},Rm.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Rm.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},Rm.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},Rm.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Rm.prototype.getIterator=function(){return new Om(this.root,null,this.comparator,!1)},Rm.prototype.getIteratorFrom=function(t){return new Om(this.root,t,this.comparator,!1)},Rm.prototype.getReverseIterator=function(){return new Om(this.root,null,this.comparator,!0)},Rm.prototype.getReverseIteratorFrom=function(t){return new Om(this.root,t,this.comparator,!0)},Rm);function Rm(t,e){this.comparator=t,this.root=e||Mm.EMPTY}var Om=(Pm.prototype.getNext=function(){ay(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Pm.prototype.hasNext=function(){return 0<this.nodeStack.length},Pm.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Pm);function Pm(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var Mm=(xm.prototype.copy=function(t,e,n,r,i){return new xm(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},xm.prototype.isEmpty=function(){return!1},xm.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},xm.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},xm.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},xm.prototype.minKey=function(){return this.min().key},xm.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},xm.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},xm.prototype.removeMin=function(){if(this.left.isEmpty())return xm.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},xm.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return xm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},xm.prototype.isRed=function(){return this.color},xm.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},xm.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},xm.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},xm.prototype.rotateLeft=function(){var t=this.copy(null,null,xm.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},xm.prototype.rotateRight=function(){var t=this.copy(null,null,xm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},xm.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},xm.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},xm.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw oy("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw oy("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw oy("Black depths differ");return t+(this.isRed()?0:1)},xm.EMPTY=null,xm.RED=!0,xm.BLACK=!1,xm);function xm(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:xm.RED,this.left=null!=r?r:xm.EMPTY,this.right=null!=i?i:xm.EMPTY,this.size=this.left.size+1+this.right.size}var Lm=(Object.defineProperty(Fm.prototype,"key",{get:function(){throw oy("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Fm.prototype,"value",{get:function(){throw oy("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Fm.prototype,"color",{get:function(){throw oy("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Fm.prototype,"left",{get:function(){throw oy("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Fm.prototype,"right",{get:function(){throw oy("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Fm.prototype.copy=function(t,e,n,r,i){return this},Fm.prototype.insert=function(t,e,n){return new Mm(t,e)},Fm.prototype.remove=function(t,e){return this},Fm.prototype.isEmpty=function(){return!0},Fm.prototype.inorderTraversal=function(t){return!1},Fm.prototype.reverseTraversal=function(t){return!1},Fm.prototype.minKey=function(){return null},Fm.prototype.maxKey=function(){return null},Fm.prototype.isRed=function(){return!1},Fm.prototype.checkMaxDepth=function(){return!0},Fm.prototype.check=function(){return 0},Fm);function Fm(){this.size=0}Mm.EMPTY=new Lm;var Um=(qm.fromMapKeys=function(t){var e=new qm(t.comparator);return t.forEach((function(t){e=e.add(t)})),e},qm.prototype.has=function(t){return null!==this.data.get(t)},qm.prototype.first=function(){return this.data.minKey()},qm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(qm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),qm.prototype.indexOf=function(t){return this.data.indexOf(t)},qm.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},qm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},qm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},qm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},qm.prototype.getIterator=function(){return new Vm(this.data.getIterator())},qm.prototype.getIteratorFrom=function(t){return new Vm(this.data.getIteratorFrom(t))},qm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},qm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},qm.prototype.isEmpty=function(){return this.data.isEmpty()},qm.prototype.unionWith=function(t){var e=this;return t.forEach((function(t){e=e.add(t)})),e},qm.prototype.isEqual=function(t){if(!(t instanceof qm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},qm.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},qm.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},qm.prototype.copy=function(t){var e=new qm(this.comparator);return e.data=t,e},qm);function qm(t){this.comparator=t,this.data=new Dm(this.comparator)}var Vm=(Bm.prototype.getNext=function(){return this.iter.getNext().key},Bm.prototype.hasNext=function(){return this.iter.hasNext()},Bm);function Bm(t){this.iter=t}var jm=new Dm(cm.comparator);function Wm(){return jm}function Qm(){return Wm()}var Km=new Dm(cm.comparator);function Hm(){return Km}var Gm=new Dm(cm.comparator);function zm(){return Gm}var Ym=new Um(cm.comparator);function Xm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ym,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Jm=new Um(qy);function $m(){return Jm}var Zm=(tv.prototype.applyToRemoteDocument=function(t,e,n){e&&ay(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;ay(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},tv.prototype.applyToLocalView=function(t,e){e&&ay(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},tv.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},tv.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Xm())},tv.prototype.isEqual=function(t){return this.batchId===t.batchId&&Vy(this.mutations,t.mutations)&&Vy(this.baseMutations,t.baseMutations)},tv);function tv(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,ay(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var ev=(nv.from=function(t,e,n,r){ay(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=zm(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new nv(t,e,n,r,i)},nv);function nv(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var rv=(iv.prototype.catch=function(t){return this.next(void 0,t)},iv.prototype.next=function(t,e){var n=this;return this.callbackAttached&&oy("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new iv((function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}}))},iv.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},iv.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof iv?e:iv.resolve(e)}catch(t){return iv.reject(t)}},iv.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):iv.resolve(e)},iv.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):iv.reject(e)},iv.resolve=function(t){return new iv((function(e,n){e(t)}))},iv.reject=function(t){return new iv((function(e,n){n(t)}))},iv.waitFor=function(t){return new iv((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},iv.or=function(t){for(var e=iv.resolve(!1),n=function(t){e=e.next((function(e){return e?iv.resolve(e):t()}))},r=0,i=t;r<i.length;r++)n(i[r]);return e},iv.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},iv);function iv(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}var ov,av,sv=(uv.forUser=function(t,e,n,r){return ay(""!==t.uid,"UserID must not be an empty string."),new uv(t.isAuthenticated()?t.uid:"",e,n,r)},uv.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fv(t).iterate({index:xb.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},uv.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next((function(e){return e.lastStreamToken=lv(n),dv(t).put(e)}))},uv.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next((function(t){return t.lastStreamToken}))},uv.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next((function(n){return n.lastStreamToken=lv(e),dv(t).put(n)}))},uv.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=pv(t),a=fv(t);return a.add({}).next((function(s){ay("number"==typeof s,"Auto-generated key is not a number");var u=new Zm(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=Fb.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,Fb.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return rv.waitFor(h).next((function(){return u}))}))},uv.prototype.lookupMutationBatch=function(t,e){var n=this;return fv(t).get(e).next((function(t){return t?(ay(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null}))},uv.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?rv.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null}))},uv.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return fv(t).iterate({index:xb.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(ay(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()})).next((function(){return o}))},uv.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return fv(t).iterate({index:xb.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},uv.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fv(t).loadAll(xb.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.fromDbMutationBatch(t)}))}))},uv.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Fb.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return pv(t).iterate({range:i},(function(r,i,a){var s=r[0],u=r[1],c=r[2],h=Im(u);if(s===n.userId&&e.path.isEqual(h))return fv(t).get(c).next((function(t){if(!t)throw oy("Dangling document-mutation reference found: "+r+" which points to "+c);ay(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))}));a.done()})).next((function(){return o}))},uv.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Um(qy),i=[];return e.forEach((function(e){var o=Fb.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=pv(t).iterate({range:a},(function(t,i,o){var a=t[0],s=t[1],u=t[2],c=Im(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(s)})),rv.waitFor(i).next((function(){return n.lookupMutationBatches(t,r)}))},uv.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;ay(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),ay(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Fb.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Um(qy);return pv(t).iterate({range:a},(function(t,e,o){var a=t[0],u=t[1],c=t[2],h=Im(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.lookupMutationBatches(t,s)}))},uv.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(fv(t).get(e).next((function(t){if(null===t)throw oy("Dangling document-mutation reference found, which points to "+e);ay(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))})))})),rv.waitFor(i).next((function(){return r}))},uv.prototype.removeMutationBatch=function(t,e){var n=this;return hv(t.simpleDbTransaction,this.userId,e).next((function(r){return n.removeCachedMutationKeys(e.batchId),rv.forEach(r,(function(e){return n.referenceDelegate.removeMutationReference(t,e)}))}))},uv.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},uv.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return rv.resolve();var r=IDBKeyRange.lowerBound(Fb.prefixForUser(e.userId)),i=[];return pv(t).iterate({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Im(t[1]);i.push(o)}else r.done()})).next((function(){ay(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.canonicalString()})))}))}))},uv.prototype.containsKey=function(t,e){return cv(t,this.userId,e)},uv.prototype.getMutationQueueMetadata=function(t){var e=this;return dv(t).get(this.userId).next((function(t){return t||new Pb(e.userId,-1,"")}))},uv);function uv(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function cv(t,e,n){var r=Fb.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return pv(t).iterate({range:o,keysOnly:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(a=!0),r.done()})).next((function(){return a}))}function hv(t,e,n){var r=t.store(xb.store),i=t.store(Fb.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},(function(t,e,n){return s++,n.delete()}));o.push(u.next((function(){ay(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Fb.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return rv.waitFor(o).next((function(){return c}))}function lv(t){return t instanceof Uint8Array?(ay("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function fv(t){return Dw.getStore(t,xb.store)}function pv(t){return Dw.getStore(t,Fb.store)}function dv(t){return Dw.getStore(t,Pb.store)}(av=ov=ov||{})[av.QueryCache=0]="QueryCache",av[av.SyncEngine=1]="SyncEngine";var yv=(mv.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},mv.prototype.after=function(t){return this.seek(t+2),this.next()},mv.prototype.seek=function(t){ay((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},mv.forQueryCache=function(){return new mv(ov.QueryCache,2)},mv.forSyncEngine=function(){return new mv(ov.SyncEngine)},mv);function mv(t,e){ay((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var vv="SimpleDb",gv=(bv.openOrCreate=function(t,e,n){return ay(bv.isAvailable(),"IndexedDB not supported in current environment."),ny(vv,"Opening database:",t),new rv((function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new bv(e))},o.onblocked=function(){i(new fy(ly.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new fy(ly.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){ny(vv,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result,i=new Ev(o.transaction);n.createOrUpgrade(r,i,e.oldVersion,Nb).next((function(){ny(vv,"Database upgrade to version "+Nb+" complete")}))}})).toPromise()},bv.delete=function(t){return ny(vv,"Removing database:",t),Cv(window.indexedDB.deleteDatabase(t)).toPromise()},bv.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===r.env.USE_MOCK_PERSISTENCE;var t=Ji(),e=bv.getIOSVersion(t),n=0<e&&e<10,i=bv.getAndroidVersion(t),o=0<i&&i<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||o)},bv.getStore=function(t,e){return t.store(e)},bv.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},bv.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},bv.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},bv.prototype.runTransaction=function(t,e,n){var r=Ev.open(this.db,t,e),i=n(r).catch((function(t){return r.abort(t),rv.reject(t)})).toPromise();return i.catch((function(){})),r.completionPromise.then((function(){return i}))},bv.prototype.close=function(){this.db.close()},bv);function bv(t){this.db=t,12.2===bv.getIOSVersion(Ji())&&ry("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var wv=(Object.defineProperty(_v.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(_v.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(_v.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),_v.prototype.done=function(){this.shouldStop=!0},_v.prototype.skip=function(t){this.nextKey=t},_v.prototype.delete=function(){return Cv(this.dbCursor.delete())},_v);function _v(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Ev=(Tv.open=function(t,e,n){return new Tv(t.transaction(n,e))},Object.defineProperty(Tv.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Tv.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(ny(vv,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Tv.prototype.store=function(t){var e=this.transaction.objectStore(t);return ay(!!e,"Object store not part of transaction: "+t),new Sv(e)},Tv);function Tv(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new pm,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=Av(t.target.error);e.completionDeferred.reject(n)}}var Sv=(Iv.prototype.put=function(t,e){return Cv(void 0!==e?(ny(vv,"PUT",this.store.name,t,e),this.store.put(e,t)):(ny(vv,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Iv.prototype.add=function(t){return ny(vv,"ADD",this.store.name,t,t),Cv(this.store.add(t))},Iv.prototype.get=function(t){var e=this;return Cv(this.store.get(t)).next((function(n){return void 0===n&&(n=null),ny(vv,"GET",e.store.name,t,n),n}))},Iv.prototype.delete=function(t){return ny(vv,"DELETE",this.store.name,t),Cv(this.store.delete(t))},Iv.prototype.count=function(){return ny(vv,"COUNT",this.store.name),Cv(this.store.count())},Iv.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,(function(t,e){r.push(e)})).next((function(){return r}))},Iv.prototype.deleteAll=function(t,e){ny(vv,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,(function(t,e,n){return n.delete()}))},Iv.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Iv.prototype.iterateSerial=function(t){var e=this.cursor({});return new rv((function(n,r){e.onerror=function(t){var e=Av(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Iv.prototype.iterateCursor=function(t,e){var n=[];return new rv((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new wv(i),a=e(i.primaryKey,i.value,o);if(a instanceof rv){var s=a.catch((function(t){return o.done(),rv.reject(t)}));n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}})).next((function(){return rv.waitFor(n)}))},Iv.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(ay(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Iv.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Iv);function Iv(t){this.store=t}function Cv(t){return new rv((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Av(t.target.error);n(e)}}))}var Nv=!1;function Av(t){var e=gv.getIOSVersion(Ji());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new fy("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Nv||(Nv=!0,setTimeout((function(){throw r}),0)),r}}return t}var kv=(Dv.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next((function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next((function(){return n.highestTargetId}))}))},Dv.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next((function(t){return Am.fromTimestamp(new Cm(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},Dv.prototype.getHighestSequenceNumber=function(t){return Pv(t.simpleDbTransaction)},Dv.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)}))},Dv.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next((function(){return n.retrieveMetadata(t).next((function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)}))}))},Dv.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},Dv.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Rv(t).delete(e.targetId)})).next((function(){return n.retrieveMetadata(t)})).next((function(e){return ay(0<e.targetCount,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)}))},Dv.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Rv(t).iterate((function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))})).next((function(){return rv.waitFor(o)})).next((function(){return i}))},Dv.prototype.forEachTarget=function(t,e){var n=this;return Rv(t).iterate((function(t,r){var i=n.serializer.fromDbTarget(r);e(i)}))},Dv.prototype.retrieveMetadata=function(t){return Ov(t.simpleDbTransaction)},Dv.prototype.saveMetadata=function(t,e){return function(t){return Dw.getStore(t,Yb.store)}(t).put(Yb.key,e)},Dv.prototype.saveQueryData=function(t,e){return Rv(t).put(this.serializer.toDbTarget(e))},Dv.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Dv.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next((function(t){return t.targetCount}))},Dv.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Rv(t).iterate({range:i,index:Kb.queryTargetsIndexName},(function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())})).next((function(){return o}))},Dv.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Mv(t);return e.forEach((function(e){var a=Em(e.path);i.push(o.put(new Gb(n,a))),i.push(r.referenceDelegate.addReference(t,e))})),rv.waitFor(i)},Dv.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Mv(t);return rv.forEach(e,(function(e){var o=Em(e.path);return rv.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])}))},Dv.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Mv(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Dv.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Mv(t),i=Xm();return r.iterate({range:n,keysOnly:!0},(function(t,e,n){var r=Im(t[1]),o=new cm(r);i=i.add(o)})).next((function(){return i}))},Dv.prototype.containsKey=function(t,e){var n=Em(e.path),r=IDBKeyRange.bound([n],[By(n)],!1,!0),i=0;return Mv(t).iterate({index:Gb.documentTargetsIndex,keysOnly:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},Dv.prototype.getQueryDataForTarget=function(t,e){var n=this;return Rv(t).get(e).next((function(t){return t?n.serializer.fromDbTarget(t):null}))},Dv);function Dv(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=yv.forQueryCache()}function Rv(t){return Dw.getStore(t,Kb.store)}function Ov(t){return gv.getStore(t,Yb.store).get(Yb.key).next((function(t){return ay(null!==t,"Missing metadata row."),t}))}function Pv(t){return Ov(t).next((function(t){return t.highestListenSequenceNumber}))}function Mv(t){return Dw.getStore(t,Gb.store)}var xv=(Lv.fromSet=function(t){return new Lv(t)},Lv.fromArray=function(t){var e=new Um(sm.comparator);return t.forEach((function(t){return e=e.add(t)})),new Lv(e)},Lv.prototype.covers=function(t){var e=!1;return this.fields.forEach((function(n){n.isPrefixOf(t)&&(e=!0)})),e},Lv.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Lv);function Lv(t){this.fields=t}var Fv=(Uv.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Uv);function Uv(t,e){this.field=t,this.transform=e}var qv,Vv,Bv=function(t,e){this.version=t,this.transformResults=e};(Vv=qv=qv||{})[Vv.Set=0]="Set",Vv[Vv.Patch=1]="Patch",Vv[Vv.Transform=2]="Transform",Vv[Vv.Delete=3]="Delete";var jv=(Wv.exists=function(t){return new Wv(void 0,t)},Wv.updateTime=function(t){return new Wv(t)},Object.defineProperty(Wv.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Wv.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof eb&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof eb:(ay(this.isNone,"Precondition should be empty"),!0)},Wv.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Wv.NONE=new Wv,Wv);function Wv(t,e){this.updateTime=t,this.exists=e,ay(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Qv=(Kv.prototype.verifyKeyMatches=function(t){null!=t&&ay(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Kv.getPostMutationVersion=function(t){return t instanceof eb?t.version:Am.MIN},Kv);function Kv(){}var Hv,Gv=(Mi(zv,Hv=Qv),zv.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),ay(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new eb(this.key,n,{hasCommittedMutations:!0},this.value)},zv.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Qv.getPostMutationVersion(t);return new eb(this.key,r,{hasLocalMutations:!0},this.value)},zv.prototype.extractBaseValue=function(t){return null},zv.prototype.isEqual=function(t){return t instanceof zv&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},zv);function zv(t,e,n){var r=Hv.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=qv.Set,r}var Yv,Xv=(Mi(Jv,Yv=Qv),Jv.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),ay(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new sb(this.key,e.version);var n=this.patchDocument(t);return new eb(this.key,e.version,{hasCommittedMutations:!0},n)},Jv.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Qv.getPostMutationVersion(t),i=this.patchDocument(t);return new eb(this.key,r,{hasLocalMutations:!0},i)},Jv.prototype.extractBaseValue=function(t){return null},Jv.prototype.isEqual=function(t){return t instanceof Jv&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Jv.prototype.patchDocument=function(t){var e;return e=t instanceof eb?t.data():Gg.EMPTY,this.patchObject(e)},Jv.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},Jv);function Jv(t,e,n,r){var i=Yv.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=qv.Patch,i}var $v,Zv=(Mi(tg,$v=Qv),tg.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),ay(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new sb(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new eb(this.key,i,{hasCommittedMutations:!0},o)},tg.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new eb(this.key,r.version,{hasLocalMutations:!0},o)},tg.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof eb?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Gg.EMPTY.set(i.field,a):e.set(i.field,a))}return e},tg.prototype.isEqual=function(t){return t instanceof tg&&this.key.isEqual(t.key)&&Vy(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},tg.prototype.requireDocument=function(t){ay(t instanceof eb,"Unknown MaybeDocument type "+t);var e=t;return ay(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},tg.prototype.serverTransformResults=function(t,e){var n=[];ay(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof eb&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},tg.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof eb&&(u=e.field(a.field)),null===u&&n instanceof eb&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},tg.prototype.transformObject=function(t,e){ay(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},tg);function tg(t,e){var n=$v.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=qv.Transform,n.precondition=jv.exists(!0),n}var eg,ng,rg,ig,og,ag=(Mi(sg,eg=Qv),sg.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),ay(null==e.transformResults,"Transform results received by DeleteMutation."),new ib(this.key,e.version,{hasCommittedMutations:!0})},sg.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&ay(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new ib(this.key,Am.forDeletedDoc())):t},sg.prototype.extractBaseValue=function(t){return null},sg.prototype.isEqual=function(t){return t instanceof sg&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},sg);function sg(t,e){var n=eg.call(this)||this;return n.key=t,n.precondition=e,n.type=qv.Delete,n}(rg=ng=ng||{})[rg.NullValue=0]="NullValue",rg[rg.BooleanValue=1]="BooleanValue",rg[rg.NumberValue=2]="NumberValue",rg[rg.TimestampValue=3]="TimestampValue",rg[rg.StringValue=4]="StringValue",rg[rg.BlobValue=5]="BlobValue",rg[rg.RefValue=6]="RefValue",rg[rg.GeoPointValue=7]="GeoPointValue",rg[rg.ArrayValue=8]="ArrayValue",rg[rg.ObjectValue=9]="ObjectValue",(og=ig=ig||{})[og.Default=0]="Default",og[og.Estimate=1]="Estimate",og[og.Previous=2]="Previous";var ug=(cg.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new cg(ig.Estimate,e);case"previous":return new cg(ig.Previous,e);case"none":case void 0:return new cg(ig.Default,e);default:return oy("fromSnapshotOptions() called with invalid options.")}},cg);function cg(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var hg=(lg.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},lg.prototype.defaultCompareTo=function(t){return ay(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),qy(this.typeOrder,t.typeOrder)},lg);function lg(){}var fg,pg=(Mi(dg,fg=hg),dg.prototype.value=function(t){return null},dg.prototype.isEqual=function(t){return t instanceof dg},dg.prototype.compareTo=function(t){return t instanceof dg?0:this.defaultCompareTo(t)},dg.INSTANCE=new dg,dg);function dg(){var t=fg.call(this)||this;return t.typeOrder=ng.NullValue,t.internalValue=null,t}var yg,mg=(Mi(vg,yg=hg),vg.prototype.value=function(t){return this.internalValue},vg.prototype.isEqual=function(t){return t instanceof vg&&this.internalValue===t.internalValue},vg.prototype.compareTo=function(t){return t instanceof vg?qy(this,t):this.defaultCompareTo(t)},vg.of=function(t){return t?vg.TRUE:vg.FALSE},vg.TRUE=new vg(!0),vg.FALSE=new vg(!1),vg);function vg(t){var e=yg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.BooleanValue,e}var gg,bg=(Mi(wg,gg=hg),wg.prototype.value=function(t){return this.internalValue},wg.prototype.compareTo=function(t){return t instanceof wg?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},wg);function wg(t){var e=gg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.NumberValue,e}function _g(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Eg,Tg=(Mi(Sg,Eg=bg),Sg.prototype.isEqual=function(t){return t instanceof Sg&&_g(this.internalValue,t.internalValue)},Sg);function Sg(){return null!==Eg&&Eg.apply(this,arguments)||this}var Ig,Cg=(Mi(Ng,Ig=bg),Ng.prototype.isEqual=function(t){return t instanceof Ng&&_g(this.internalValue,t.internalValue)},Ng.NAN=new Ng(NaN),Ng.POSITIVE_INFINITY=new Ng(1/0),Ng.NEGATIVE_INFINITY=new Ng(-1/0),Ng);function Ng(){return null!==Ig&&Ig.apply(this,arguments)||this}var Ag,kg=(Mi(Dg,Ag=hg),Dg.prototype.value=function(t){return this.internalValue},Dg.prototype.isEqual=function(t){return t instanceof Dg&&this.internalValue===t.internalValue},Dg.prototype.compareTo=function(t){return t instanceof Dg?qy(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Dg);function Dg(t){var e=Ag.call(this)||this;return e.internalValue=t,e.typeOrder=ng.StringValue,e}var Rg,Og=(Mi(Pg,Rg=hg),Pg.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Pg.prototype.isEqual=function(t){return t instanceof Pg&&this.internalValue.isEqual(t.internalValue)},Pg.prototype.compareTo=function(t){return t instanceof Pg?this.internalValue._compareTo(t.internalValue):t instanceof xg?-1:this.defaultCompareTo(t)},Pg);function Pg(t){var e=Rg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.TimestampValue,e}var Mg,xg=(Mi(Lg,Mg=hg),Lg.prototype.value=function(t){return t&&t.serverTimestampBehavior===ig.Estimate?new Og(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===ig.Previous&&this.previousValue?this.previousValue.value(t):null},Lg.prototype.isEqual=function(t){return t instanceof Lg&&this.localWriteTime.isEqual(t.localWriteTime)},Lg.prototype.compareTo=function(t){return t instanceof Lg?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Og?1:this.defaultCompareTo(t)},Lg.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Lg);function Lg(t,e){var n=Mg.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=ng.TimestampValue,n}var Fg,Ug=(Mi(qg,Fg=hg),qg.prototype.value=function(t){return this.internalValue},qg.prototype.isEqual=function(t){return t instanceof qg&&this.internalValue.isEqual(t.internalValue)},qg.prototype.compareTo=function(t){return t instanceof qg?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},qg);function qg(t){var e=Fg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.BlobValue,e}var Vg,Bg=(Mi(jg,Vg=hg),jg.prototype.value=function(t){return this.key},jg.prototype.isEqual=function(t){return t instanceof jg&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},jg.prototype.compareTo=function(t){if(t instanceof jg){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:cm.comparator(this.key,t.key)}return this.defaultCompareTo(t)},jg);function jg(t,e){var n=Vg.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=ng.RefValue,n}var Wg,Qg=(Mi(Kg,Wg=hg),Kg.prototype.value=function(t){return this.internalValue},Kg.prototype.isEqual=function(t){return t instanceof Kg&&this.internalValue.isEqual(t.internalValue)},Kg.prototype.compareTo=function(t){return t instanceof Kg?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Kg);function Kg(t){var e=Wg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.GeoPointValue,e}var Hg,Gg=(Mi(zg,Hg=hg),zg.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal((function(n,r){e[n]=r.value(t)})),e},zg.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},zg.prototype.isEqual=function(t){if(t instanceof zg){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},zg.prototype.compareTo=function(t){if(t instanceof zg){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=qy(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return qy(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},zg.prototype.set=function(t,e){if(ay(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof zg||(n=zg.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},zg.prototype.delete=function(t){if(ay(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new zg(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof zg){var n=e.delete(t.popFirst());return new zg(this.internalValue.insert(t.firstSegment(),n))}return this},zg.prototype.contains=function(t){return null!==this.field(t)},zg.prototype.field=function(t){ay(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach((function(t){e=e instanceof zg?e.internalValue.get(t):null})),e},zg.prototype.fieldMask=function(){var t=new Um(sm.comparator);return this.internalValue.forEach((function(e,n){var r=new sm([e]);if(n instanceof zg){var i=n.fieldMask().fields;i.isEmpty()?t=t.add(r):i.forEach((function(e){t=t.add(r.child(e))}))}else t=t.add(r)})),xv.fromSet(t)},zg.prototype.toString=function(){return this.internalValue.toString()},zg.prototype.child=function(t){return this.internalValue.get(t)||void 0},zg.prototype.setChild=function(t,e){return new zg(this.internalValue.insert(t,e))},zg.EMPTY=new zg(new Dm(qy)),zg);function zg(t){var e=Hg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.ObjectValue,e}var Yg,Xg=(Mi(Jg,Yg=hg),Jg.prototype.value=function(t){return this.internalValue.map((function(e){return e.value(t)}))},Jg.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Jg.prototype.forEach=function(t){this.internalValue.forEach(t)},Jg.prototype.isEqual=function(t){if(t instanceof Jg){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Jg.prototype.compareTo=function(t){if(t instanceof Jg){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return qy(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Jg.prototype.toString=function(){return"["+this.internalValue.map((function(t){return t.toString()})).join(",")+"]"},Jg);function Jg(t){var e=Yg.call(this)||this;return e.internalValue=t,e.typeOrder=ng.ArrayValue,e}var $g=(Zg.compareByKey=function(t,e){return cm.comparator(t.key,e.key)},Zg);function Zg(t,e){this.key=t,this.version=e}var tb,eb=(Mi(nb,tb=$g),nb.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},nb.prototype.data=function(){var t=this;if(!this.objectValue){var e=Gg.EMPTY;gy(this.proto.fields,(function(n,r){e=e.set(new sm([n]),t.converter(r))})),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},nb.prototype.value=function(){return this.data().value()},nb.prototype.isEqual=function(t){return t instanceof nb&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},nb.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(nb.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),nb.prototype.getProtoField=function(t){ay(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields[t.firstSegment()],n=1;n<t.length;++n){if(!e||!e.mapValue)return;e=e.mapValue.fields[t.get(n)]}return e},nb.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):oy("Trying to compare documents on fields that don't exist")},nb);function nb(t,e,n,r,i,o){var a=tb.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,ay(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var rb,ib=(Mi(ob,rb=$g),ob.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(ob.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),ob.prototype.isEqual=function(t){return t instanceof ob&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ob);function ob(t,e,n){var r=rb.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var ab,sb=(Mi(ub,ab=$g),ub.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ub.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),ub.prototype.isEqual=function(t){return t instanceof ub&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ub);function ub(){return null!==ab&&ab.apply(this,arguments)||this}var cb=(hb.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},hb.prototype.has=function(t){return void 0!==this.get(t)},hb.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},hb.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},hb.prototype.forEach=function(t){gy(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}}))},hb.prototype.isEmpty=function(){return by(this.inner)},hb);function hb(t){this.mapKeyFn=t,this.inner={}}var lb=(fb.prototype.addEntry=function(t){this.assertNotApplied(),this.changes.set(t.key,t)},fb.prototype.removeEntry=function(t){this.assertNotApplied(),this.changes.set(t,null)},fb.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?rv.resolve(n):this.getFromCache(t,e)},fb.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},fb.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},fb.prototype.assertNotApplied=function(){ay(!this.changesApplied,"Changes have already been applied.")},fb);function fb(){this.changes=new cb((function(t){return t.toString()})),this.changesApplied=!1}var pb,db="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",yb=(Object.defineProperty(mb.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),mb.prototype.start=function(t){var e=gv.getStore(t,tw.store);return this.synchronizeLastDocumentChangeId(e)},mb.prototype.addEntry=function(t,e,n){var r=this;return bb(t).put(_b(e),n).next((function(){r.indexManager.addToCollectionParentIndex(t,e.path.popLast())}))},mb.prototype.removeEntry=function(t,e){var n=bb(t),r=_b(e);return n.delete(r)},mb.prototype.updateMetadata=function(t,e,n){var r=this;return this.getMetadata(t).next((function(i){return i.byteSize+=n,r.setMetadata(t,i).next((function(){if(r.keepDocumentChangeLog)return wb(t).put({changes:r.serializer.toDbResourcePaths(e)})}))}))},mb.prototype.getEntry=function(t,e){var n=this;return bb(t).get(_b(e)).next((function(t){return t?n.serializer.fromDbRemoteDocument(t):null}))},mb.prototype.getSizedEntry=function(t,e){var n=this;return bb(t).get(_b(e)).next((function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Eb(t)}:null}))},mb.prototype.getEntries=function(t,e){var n=this,r=Qm();return this.forEachDbEntry(t,e,(function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)})).next((function(){return r}))},mb.prototype.getSizedEntries=function(t,e){var n=this,r=Qm(),i=new Dm(cm.comparator);return this.forEachDbEntry(t,e,(function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Eb(e))):(r=r.insert(t,null),i.insert(t,0))})).next((function(){return{maybeDocuments:r,sizeMap:i}}))},mb.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return rv.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return bb(t).iterate({range:r},(function(t,e,r){for(var a=cm.fromSegments(t);o&&cm.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},mb.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;ay(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Hm(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return bb(t).iterate({range:a},(function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof eb&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}})).next((function(){return r}))},mb.prototype.getNewDocumentChanges=function(t){var e=this;ay(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Xm(),r=Wm(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=wb(t);return a.iterate({range:i},(function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next((function(){return rv.reject(new fy(ly.DATA_LOSS,db))}));n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id})).next((function(){var i=[];return n.forEach((function(n){i.push(e.getEntry(t,n).next((function(t){var e=t||new ib(n,Am.forDeletedDoc());r=r.insert(n,e)})))})),rv.waitFor(i)})).next((function(){return r}))},mb.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return wb(t).delete(n)},mb.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},(function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()}))},mb.prototype.newChangeBuffer=function(){return new mb.RemoteDocumentChangeBuffer(this)},mb.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},mb.prototype.getMetadata=function(t){return gb(t).get(Wb.key).next((function(t){return ay(!!t,"Missing document cache metadata"),t}))},mb.prototype.setMetadata=function(t,e){return gb(t).put(Wb.key,e)},mb.RemoteDocumentChangeBuffer=(Mi(vb,pb=lb),vb.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=Xm();return this.changes.forEach((function(o,a){var s=e.documentSizes.get(o);if(ay(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){var u=e.documentCache.serializer.toDbRemoteDocument(a),c=Eb(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else r-=s,n.push(e.documentCache.removeEntry(t,o));i=i.add(o)})),n.push(this.documentCache.updateMetadata(t,i,r)),rv.waitFor(n)},vb.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next((function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)}))},vb.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next((function(t){var e=t.maybeDocuments;return t.sizeMap.forEach((function(t,e){n.documentSizes.set(t,e)})),e}))},vb),mb);function mb(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function vb(t){var e=pb.call(this)||this;return e.documentCache=t,e.documentSizes=new cb((function(t){return t.toString()})),e}function gb(t){return Dw.getStore(t,Wb.store)}function bb(t){return Dw.getStore(t,Bb.store)}function wb(t){return Dw.getStore(t,tw.store)}function _b(t){return t.path.toArray()}function Eb(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw oy("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Tb=(Sb.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),rv.resolve()},Sb.prototype.getCollectionParents=function(t,e){return rv.resolve(this.collectionParentIndex.getEntries(e))},Sb);function Sb(){this.collectionParentIndex=new Ib}var Ib=(Cb.prototype.add=function(t){ay(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Um(rm.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},Cb.prototype.getEntries=function(t){return(this.index[t]||new Um(rm.comparator)).toArray()},Cb);function Cb(){this.index={}}var Nb=8,Ab=(kb.prototype.createOrUpgrade=function(t,e,n,r){var i=this;ay(n<r&&0<=n&&r<=Nb,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(Rb.store)}(t),function(t){t.createObjectStore(Pb.store,{keyPath:Pb.keyPath}),t.createObjectStore(xb.store,{keyPath:xb.keyPath,autoIncrement:!0}).createIndex(xb.userMutationsIndex,xb.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Fb.store)}(t),Zb(t),function(t){t.createObjectStore(Bb.store)}(t));var o=rv.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(Gb.store),t.deleteObjectStore(Kb.store),t.deleteObjectStore(Yb.store)}(t),Zb(t)),o=o.next((function(){return function(t){var e=t.store(Yb.store),n=new Yb(0,0,Am.MIN.toTimestamp(),0);return e.put(Yb.key,n)}(e)}))),n<4&&4<=r&&(0!==n&&(o=o.next((function(){return function(t,e){return e.store(xb.store).loadAll().next((function(n){t.deleteObjectStore(xb.store),t.createObjectStore(xb.store,{keyPath:xb.keyPath,autoIncrement:!0}).createIndex(xb.userMutationsIndex,xb.userMutationsKeyPath,{unique:!0});var r=e.store(xb.store),i=n.map((function(t){return r.put(t)}));return rv.waitFor(i)}))}(t,e)}))),o=o.next((function(){!function(t){t.createObjectStore(nw.store,{keyPath:nw.keyPath})}(t),function(t){t.createObjectStore(tw.store,{keyPath:"id",autoIncrement:!0})}(t)}))),n<5&&5<=r&&(o=o.next((function(){return i.removeAcknowledgedMutations(e)}))),n<6&&6<=r&&(o=o.next((function(){return function(t){t.createObjectStore(Wb.store)}(t),i.addDocumentGlobal(e)}))),n<7&&7<=r&&(o=o.next((function(){return i.ensureSequenceNumbers(e)}))),n<8&&8<=r&&(o=o.next((function(){return i.createCollectionParentIndex(t,e)}))),o},kb.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Bb.store).iterate((function(t,n){e+=Eb(n)})).next((function(){var n=new Wb(e);return t.store(Wb.store).put(Wb.key,n)}))},kb.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Pb.store),r=t.store(xb.store);return n.loadAll().next((function(n){return rv.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(xb.userMutationsIndex,i).next((function(r){return rv.forEach(r,(function(r){ay(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return hv(t,n.userId,i).next((function(){}))}))}))}))}))},kb.prototype.ensureSequenceNumbers=function(t){var e=t.store(Gb.store),n=t.store(Bb.store);return Pv(t).next((function(t){var r=[];return n.iterate((function(n,i){var o=new rm(n),a=function(t){return[0,Em(t)]}(o);r.push(e.get(a).next((function(n){return n?rv.resolve():function(n){return e.put(new Gb(0,Em(n),t))}(o)})))})).next((function(){return rv.waitFor(r)}))}))},kb.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Em(n)})}}t.createObjectStore(Jb.store,{keyPath:Jb.keyPath});var r=e.store(Jb.store),i=new Ib;return e.store(Bb.store).iterate({keysOnly:!0},(function(t,e){return n(new rm(t).popLast())})).next((function(){return e.store(Fb.store).iterate({keysOnly:!0},(function(t,e){t[0];var r=t[1];return n((t[2],Im(r)).popLast())}))}))},kb);function kb(t){this.serializer=t}var Db=function(t,e){this.seconds=t,this.nanoseconds=e},Rb=(Ob.store="owner",Ob.key="owner",Ob);function Ob(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Pb=(Mb.store="mutationQueues",Mb.keyPath="userId",Mb);function Mb(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var xb=(Lb.store="mutations",Lb.keyPath="batchId",Lb.userMutationsIndex="userMutationsIndex",Lb.userMutationsKeyPath=["userId","batchId"],Lb);function Lb(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Fb=(Ub.prefixForUser=function(t){return[t]},Ub.prefixForPath=function(t,e){return[t,Em(e)]},Ub.key=function(t,e,n){return[t,Em(e),n]},Ub.store="documentMutations",Ub.PLACEHOLDER=new Ub,Ub);function Ub(){}var qb=function(t,e){this.path=t,this.readTime=e},Vb=function(t,e){this.path=t,this.version=e},Bb=(jb.store="remoteDocuments",jb);function jb(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var Wb=(Qb.store="remoteDocumentGlobal",Qb.key="remoteDocumentGlobalKey",Qb);function Qb(t){this.byteSize=t}var Kb=(Hb.store="targets",Hb.keyPath="targetId",Hb.queryTargetsIndexName="queryTargetsIndex",Hb.queryTargetsKeyPath=["canonicalId","targetId"],Hb);function Hb(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var Gb=(zb.store="targetDocuments",zb.keyPath=["targetId","path"],zb.documentTargetsIndex="documentTargetsIndex",zb.documentTargetsKeyPath=["path","targetId"],zb);function zb(t,e,n){this.targetId=t,this.path=e,ay(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var Yb=(Xb.key="targetGlobalKey",Xb.store="targetGlobal",Xb);function Xb(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var Jb=($b.store="collectionParents",$b.keyPath=["collectionId","parent"],$b);function $b(t,e){this.collectionId=t,this.parent=e}function Zb(t){t.createObjectStore(Gb.store,{keyPath:Gb.keyPath}).createIndex(Gb.documentTargetsIndex,Gb.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Kb.store,{keyPath:Kb.keyPath}).createIndex(Kb.queryTargetsIndexName,Kb.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Yb.store)}var tw=(ew.store="remoteDocumentChanges",ew.keyPath="id",ew);function ew(t){this.changes=t}var nw=(rw.store="clientMetadata",rw.keyPath="clientId",rw);function rw(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var iw,ow,aw=[Pb.store,xb.store,Fb.store,Bb.store,Kb.store,Rb.store,Yb.store,Gb.store].concat([nw.store,tw.store]).concat([Wb.store]).concat([Jb.store]),sw=(uw.prototype.addToCollectionParentIndex=function(t,e){if(ay(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){ay(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return cw(t).put({collectionId:n,parent:Em(r)})}return rv.resolve()},uw.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[By(e),""],!1,!0);return cw(t).loadAll(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Im(o.parent))}return n}))},uw);function uw(){this.collectionParentsCache=new Ib}function cw(t){return Dw.getStore(t,Jb.store)}(ow=iw=iw||{})[ow.Listen=0]="Listen",ow[ow.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",ow[ow.LimboResolution=2]="LimboResolution";var hw=(lw.prototype.withSequenceNumber=function(t){return new lw(this.query,this.targetId,this.purpose,t,this.snapshotVersion,this.resumeToken)},lw.prototype.withResumeToken=function(t,e){return new lw(this.query,this.targetId,this.purpose,this.sequenceNumber,e,t)},lw.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},lw);function lw(t,e,n,r,i,o){void 0===i&&(i=Am.MIN),void 0===o&&(o=cy()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var fw=(pw.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=cm.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new ib(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=cm.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new sb(e,n)):oy("Unexpected DbRemoteDocument")},pw.prototype.toDbRemoteDocument=function(t){if(t instanceof eb){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Bb(null,null,e,n)}if(t instanceof ib){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Bb(null,new qb(r,i),null,n)}return t instanceof sb?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Bb(new Vb(r,i),null,null,!0)):oy("Unexpected MaybeDocumment")},pw.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Db(e.seconds,e.nanoseconds)},pw.prototype.fromDbTimestamp=function(t){var e=new Cm(t.seconds,t.nanoseconds);return Am.fromTimestamp(e)},pw.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.remoteSerializer.toMutation(t)})),i=e.mutations.map((function(t){return n.remoteSerializer.toMutation(t)}));return new xb(t,e.batchId,e.localWriteTime.toMillis(),r,i)},pw.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.remoteSerializer.fromMutation(t)})),r=t.mutations.map((function(t){return e.remoteSerializer.fromMutation(t)})),i=Cm.fromMillis(t.localWriteTimeMs);return new Zm(t.batchId,i,n,r)},pw.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach((function(t){e.push(Em(t.path))})),e},pw.prototype.fromDbResourcePaths=function(t){for(var e=Xm(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new cm(Im(i)))}return e},pw.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new hw(e,t.targetId,iw.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},pw.prototype.toDbTarget=function(t){ay(iw.Listen===t.purpose,"Only queries with purpose "+iw.Listen+" may be stored, got "+t.purpose);var e,n,i=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(ay("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Kb(t.targetId,t.query.canonicalId(),i,n,t.sequenceNumber,e)},pw);function pw(t){this.remoteSerializer=t}function dw(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=qy(n,i);return 0===a?qy(r,o):a}var yw=(mw.prototype.nextIndex=function(){return++this.previousIndex},mw.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();dw(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(mw.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),mw);function mw(t){this.maxElements=t,this.buffer=new Um(dw),this.previousIndex=0}var vw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},gw=(bw.withCacheSize=function(t){return new bw(t,bw.DEFAULT_COLLECTION_PERCENTILE,bw.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},bw.COLLECTION_DISABLED=-1,bw.MINIMUM_CACHE_SIZE_BYTES=1048576,bw.DEFAULT=new bw(bw.DEFAULT_CACHE_SIZE_BYTES=41943040,bw.DEFAULT_COLLECTION_PERCENTILE=10,bw.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),bw.DISABLED=new bw(bw.COLLECTION_DISABLED,0,0),bw);function bw(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var ww=(_w.prototype.start=function(){ay(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==gw.COLLECTION_DISABLED&&this.scheduleGC()},_w.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(_w.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),_w.prototype.scheduleGC=function(){var t=this;ay(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;ny("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(lm.LruGarbageCollection,e,(function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then((function(){return t.scheduleGC()})).catch(Ow)}))},_w);function _w(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var Ew=(Tw.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next((function(t){return Math.floor(e/100*t)}))},Tw.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return rv.resolve(Jy.INVALID);var r=new yw(e);return this.delegate.forEachTarget(t,(function(t){return r.addElement(t.sequenceNumber)})).next((function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,(function(t){return r.addElement(t)}))})).next((function(){return r.maxValue}))},Tw.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},Tw.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},Tw.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===gw.COLLECTION_DISABLED?(ny("LruGarbageCollector","Garbage collection skipped; disabled"),rv.resolve(vw)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(ny("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),vw):n.runGarbageCollection(t,e)}))},Tw.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},Tw.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(ny("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),ty()<=Qd.DEBUG&&ny("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),rv.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},Tw);function Tw(t,e){this.delegate=t,this.params=e}var Sw,Iw="IndexedDbPersistence",Cw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Nw="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Aw=(Mi(kw,Sw=function(){}),kw);function kw(t,e){var n=Sw.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var Dw=(Rw.getStore=function(t,e){if(t instanceof Aw)return gv.getStore(t.simpleDbTransaction,e);throw oy("IndexedDbPersistence must use instances of IndexedDbTransaction")},Rw.createIndexedDbPersistence=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:if(!Rw.isAvailable())throw new fy(ly.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Rw(t.allowTabSynchronization,t.persistenceKey,t.clientId,t.platform,t.lruParams,t.queue,t.serializer,t.sequenceNumberSyncer)).start()];case 1:return n.sent(),[2,e]}}))}))},Rw.prototype.start=function(){var t=this;return ay(!this.started,"IndexedDbPersistence double-started!"),ay(null!==this.window,"Expected 'window' to be defined"),gv.openOrCreate(this.dbName,Nb,new Ab(this.serializer)).then((function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()})).then((function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()})).then((function(){return t.simpleDb.runTransaction("readonly",[Yb.store],(function(e){return Pv(e).next((function(e){t.listenSequence=new Jy(e,t.sequenceNumberSyncer)}))}))})).then((function(){t._started=!0})).catch((function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)}))},Rw.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",aw,(function(e){return t.remoteDocumentCache.start(e)}))},Rw.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Li(e,void 0,void 0,(function(){return Fi(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},Rw.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener((function(n){return Li(e,void 0,void 0,(function(){return Fi(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},Rw.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget((function(){return Li(e,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},Rw.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",aw,(function(e){return Mw(e).put(new nw(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next((function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next((function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget((function(){return t.primaryStateListener(!1)})))}))})).next((function(){return t.canActAsPrimary(e)})).next((function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget((function(){return t.primaryStateListener(t.isPrimary)})),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0}))}))},Rw.prototype.verifyPrimaryLease=function(t){var e=this;return Pw(t).get(Rb.key).next((function(t){return rv.resolve(e.isLocalClient(t))}))},Rw.prototype.removeClientMetadata=function(t){return Mw(t).delete(this.clientId)},Rw.prototype.maybeGarbageCollectMultiClientState=function(){return Li(this,void 0,void 0,(function(){var t,e,n=this;return Fi(this,(function(r){switch(r.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),e=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(r){var i=Rw.getStore(r,nw.store);return i.loadAll().next((function(r){t=n.filterActiveClients(r,18e5),e=r.filter((function(e){return-1===t.indexOf(e)}))})).next((function(){return rv.forEach(e,(function(t){return i.delete(t.clientId)}))})).next((function(){if(0<(t=t.filter((function(t){return t.clientId!==n.clientId}))).length){var e=t.map((function(t){return t.lastProcessedDocumentChangeId||0})),i=Math.min.apply(Math,e);return n.remoteDocumentCache.removeDocumentChangesThroughChangeId(r,i)}}))}))]);case 1:r.sent(),e.forEach((function(t){n.window.localStorage.removeItem(n.zombiedClientLocalStorageKey(t.clientId))})),r.label=2;case 2:return[2]}}))}))},Rw.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(lm.ClientMetadataRefresh,4e3,(function(){return t.updateClientMetadataAndTryBecomePrimary().then((function(){return t.maybeGarbageCollectMultiClientState()})).then((function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))},Rw.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Rw.prototype.canActAsPrimary=function(t){var e=this;return Pw(t).get(Rb.key).next((function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new fy(ly.FAILED_PRECONDITION,Nw);return!1}}return!(!e.networkEnabled||!e.inForeground)||Mw(t).loadAll().next((function(t){return void 0===e.filterActiveClients(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&ny(Iw,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},Rw.prototype.shutdown=function(){return Li(this,void 0,void 0,(function(){var t=this;return Fi(this,(function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Rb.store,nw.store],(function(e){return t.releasePrimaryLeaseIfHeld(e).next((function(){return t.removeClientMetadata(e)}))}))];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}}))}))},Rw.prototype.filterActiveClients=function(t,e){var n=this;return t.filter((function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)}))},Rw.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[nw.store],(function(e){return Mw(e).loadAll().next((function(e){return t.filterActiveClients(e,18e5).map((function(t){return t.clientId}))}))}))},Rw.clearPersistence=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return Rw.isAvailable()?(e=t+Rw.MAIN_DATABASE,[4,gv.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(Rw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Rw.prototype.getMutationQueue=function(t){return ay(this.started,"Cannot initialize MutationQueue before persistence is started."),sv.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Rw.prototype.getQueryCache=function(){return ay(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},Rw.prototype.getRemoteDocumentCache=function(){return ay(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Rw.prototype.getIndexManager=function(){return ay(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Rw.prototype.runTransaction=function(t,e,n){var r=this;return ny(Iw,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",aw,(function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next((function(e){if(!e)throw ry("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget((function(){return r.primaryStateListener(!1)})),new fy(ly.FAILED_PRECONDITION,Cw);return n(new Aw(i,r.listenSequence.next()))})).next((function(t){return r.acquireOrExtendPrimaryLease(i).next((function(){return t}))})):r.verifyAllowTabSynchronization(i).next((function(){return n(new Aw(i,r.listenSequence.next()))}))}))},Rw.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Pw(t).get(Rb.key).next((function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new fy(ly.FAILED_PRECONDITION,Nw)}))},Rw.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Rb(this.clientId,this.allowTabSynchronization,Date.now());return Pw(t).put(Rb.key,e)},Rw.isAvailable=function(){return gv.isAvailable()},Rw.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Rw.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Pw(t);return n.get(Rb.key).next((function(t){return e.isLocalClient(t)?(ny(Iw,"Releasing primary lease."),n.delete(Rb.key)):rv.resolve()}))},Rw.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(ry("Detected an update time that is in the future: "+t+" > "+n),1))},Rw.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()}))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Rw.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(ay(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Rw.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.windowUnloadHandler))},Rw.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(ay("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Rw.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return ny(Iw,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return ry(Iw,"Failed to get zombied client id.",t),!1}},Rw.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){ry("Failed to set zombie client id.",t)}},Rw.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Rw.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Rw.MAIN_DATABASE="main",Rw);function Rw(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new xw(this,i),this.dbName=e+Rw.MAIN_DATABASE,this.serializer=new fw(a),this.document=r.document,this.queryCache=new kv(this.referenceDelegate,this.serializer),this.indexManager=new sw,this.remoteDocumentCache=new yb(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new fy(ly.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function Ow(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){if(!function(t){return t.code===ly.FAILED_PRECONDITION&&t.message===Cw}(t))throw t;return ny(Iw,"Unexpectedly lost primary lease"),[2]}))}))}function Pw(t){return t.store(Rb.store)}function Mw(t){return t.store(nw.store)}var xw=(Lw.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next((function(t){return e.next((function(e){return t+e}))}))},Lw.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},Lw.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Lw.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,(function(t,n){return e(n)}))},Lw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Lw.prototype.addReference=function(t,e){return Fw(t,e)},Lw.prototype.removeReference=function(t,e){return Fw(t,e)},Lw.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Lw.prototype.removeMutationReference=function(t,e){return Fw(t,e)},Lw.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?rv.resolve(!0):function(t,e){var n=!1;return dv(t).iterateSerial((function(r){return cv(t,r,e).next((function(t){return t&&(n=!0),rv.resolve(!t)}))})).next((function(){return n}))}(t,e)},Lw.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,(function(a,s){if(s<=e){var u=n.isPinned(t,a).next((function(e){if(!e)return o++,r.getEntry(t,a).next((function(){return r.removeEntry(a),Mv(t).delete(function(t){return[0,Em(t.path)]}(a))}))}));i.push(u)}})).next((function(){return rv.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},Lw.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getQueryCache().updateQueryData(t,n)},Lw.prototype.updateLimboDocument=function(t,e){return Fw(t,e)},Lw.prototype.forEachOrphanedDocument=function(t,e){var n,r=Mv(t),i=Jy.INVALID;return r.iterate({index:Gb.documentTargetsIndex},(function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==Jy.INVALID&&e(new cm(Im(n)),i),i=s,n=a):i=Jy.INVALID})).next((function(){i!==Jy.INVALID&&e(new cm(Im(n)),i)}))},Lw.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Lw);function Lw(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Ew(this,e)}function Fw(t,e){return Mv(t).put(function(t,e){return new Gb(0,Em(t.path),e)}(e,t.currentSequenceNumber))}var Uw=(qw.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.getDocumentInternal(t,e,r)}))},qw.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},qw.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Qm();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},qw.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next((function(e){return n.getLocalViewOfDocuments(t,e)}))},qw.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Wm();return i.forEach((function(t,e){e=e||new ib(t,Am.forDeletedDoc()),o=o.insert(t,e)})),o}))},qw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},qw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new cm(e)).next((function(t){var e=Hm();return t instanceof eb&&(e=e.insert(t.key,t)),e}))},qw.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;ay(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Hm();return this.indexManager.getCollectionParents(t,r).next((function(o){return rv.forEach(o,(function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next((function(t){t.forEach((function(t,e){i=i.insert(t,e)}))}))})).next((function(){return i}))}))},qw.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next((function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next((function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof eb?n.insert(c,l):n.remove(c)}}))})).next((function(){return n.forEach((function(t,r){e.matches(r)||(n=n.remove(t))})),n}))},qw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Xm(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Xv&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof eb&&(c=c.insert(t,e))})),c}))},qw);function qw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var Vw=(Bw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},Bw.prototype.addReference=function(t,e){var n=new jw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},Bw.prototype.addReferences=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},Bw.prototype.removeReference=function(t,e){this.removeRef(new jw(t,e))},Bw.prototype.removeReferences=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},Bw.prototype.removeReferencesForId=function(t){var e=this,n=cm.EMPTY,r=new jw(n,t),i=new jw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],(function(t){e.removeRef(t),o.push(t.key)})),o},Bw.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach((function(e){return t.removeRef(e)}))},Bw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},Bw.prototype.referencesForId=function(t){var e=cm.EMPTY,n=new jw(e,t),r=new jw(e,t+1),i=Xm();return this.refsByTarget.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},Bw.prototype.containsKey=function(t){var e=new jw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},Bw);function Bw(){this.refsByKey=new Um(jw.compareByKey),this.refsByTarget=new Um(jw.compareByTargetId)}var jw=(Ww.compareByKey=function(t,e){return cm.comparator(t.key,e.key)||qy(t.targetOrBatchId,e.targetOrBatchId)},Ww.compareByTargetId=function(t,e){return qy(t.targetOrBatchId,e.targetOrBatchId)||cm.comparator(t.key,e.key)},Ww);function Ww(t,e){this.key=t,this.targetOrBatchId=e}var Qw="LocalStore",Kw=(Hw.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",(function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next((function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new Uw(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)})).next((function(t){for(var i=[],o=[],a=Xm(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++)f=m[y],a=a.add(f.key)}return e.localDocuments.getDocuments(n,a).next((function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}}))}))}))},Hw.prototype.localWrite=function(t){var e=this,n=Cm.now(),r=t.reduce((function(t,e){return t.add(e.key)}),Xm());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(i){return e.localDocuments.getDocuments(i,r).next((function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new Xv(u.key,c,c.fieldMask(),jv.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next((function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}}))}))}))},Hw.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(n){return e.mutationQueue.lookupMutationKeys(n,t).next((function(t){return t?e.localDocuments.getDocuments(n,t):rv.resolve(null)}))}))},Hw.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next((function(){return e.applyWriteToRemoteDocuments(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},Hw.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next((function(t){return ay(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},Hw.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))},Hw.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",(function(e){return t.mutationQueue.getLastStreamToken(e)}))},Hw.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",(function(n){return e.mutationQueue.setLastStreamToken(n,t)}))},Hw.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)}))},Hw.prototype.applyRemoteEvent=function(t){var e=this,n=this.remoteDocuments.newChangeBuffer(),r=t.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(i){var o=[];vy(t.targetChanges,(function(t,n){var a=e.queryDataByTarget[t];if(a){o.push(e.queryCache.removeMatchingKeys(i,n.removedDocuments,t).next((function(){return e.queryCache.addMatchingKeys(i,n.addedDocuments,t)})));var s=n.resumeToken;if(0<s.length){var u=a.withResumeToken(s,r);e.queryDataByTarget[t]=u,Hw.shouldPersistQueryData(a,u,n)&&o.push(e.queryCache.updateQueryData(i,u))}}}));var a=Wm(),s=Xm();if(t.documentUpdates.forEach((function(t,e){s=s.add(t)})),o.push(n.getEntries(i,s).next((function(r){t.documentUpdates.forEach((function(s,u){var c=r.get(s);u instanceof ib&&u.version.isEqual(Am.MIN)?(n.removeEntry(s),a=a.insert(s,u)):null==c||0<u.version.compareTo(c.version)||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(Am.MIN.isEqual(t.snapshotVersion)&&ry(Qw,"Cannot add a document when the remote version is zero"),n.addEntry(u),a=a.insert(s,u)):ny(Qw,"Ignoring outdated watch update for ",s,". Current version:",c.version," Watch version:",u.version),t.resolvedLimboDocuments.has(s)&&o.push(e.persistence.referenceDelegate.updateLimboDocument(i,s))}))}))),!r.isEqual(Am.MIN)){var u=e.queryCache.getLastRemoteSnapshotVersion(i).next((function(t){return ay(0<=r.compareTo(t),"Watch stream reverted to previous snapshot?? "+r+" < "+t),e.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,r)}));o.push(u)}return rv.waitFor(o).next((function(){return n.apply(i)})).next((function(){return e.localDocuments.getLocalViewOfDocuments(i,a)}))}))},Hw.shouldPersistQueryData=function(t,e,n){return ay(0<e.resumeToken.length,"Attempted to persist query data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},Hw.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(n){return rv.forEach(t,(function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),rv.forEach(t.removedKeys,(function(t){return e.persistence.referenceDelegate.removeReference(n,t)}))}))}))},Hw.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)}))},Hw.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.localDocuments.getDocument(n,t)}))},Hw.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",(function(n){var r;return e.queryCache.getQueryData(n,t).next((function(i){return i?(r=i,rv.resolve()):e.queryCache.allocateTargetId(n).next((function(i){return r=new hw(t,i,iw.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)}))})).next((function(){return ay(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r}))}))},Hw.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,(function(r){return n.queryCache.getQueryData(r,t).next((function(i){ay(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?rv.resolve():rv.forEach(s,(function(t){return n.persistence.referenceDelegate.removeReference(r,t)})).next((function(){return n.persistence.referenceDelegate.removeTarget(r,a)}))}))}))},Hw.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",(function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)}))},Hw.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",(function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)}))},Hw.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},Hw.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},Hw.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},Hw.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=rv.resolve();return o.forEach((function(r){a=a.next((function(){return n.getEntry(t,r)})).next((function(t){var o=t,a=e.docVersions.get(r);ay(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):ay(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),a.next((function(){return r.mutationQueue.removeMutationBatch(t,i)}))},Hw.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.queryDataByTarget)}))},Hw.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",(function(n){return e.queryCache.getQueryDataForTarget(n,t).next((function(t){return t?t.query:null}))}))},Hw.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(e){return t.remoteDocuments.getNewDocumentChanges(e)}))},Hw.RESUME_TOKEN_MAX_AGE_MICROS=3e8,Hw);function Hw(t,e){this.persistence=t,this.localViewReferences=new Vw,this.queryDataByTarget={},ay(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new Uw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var Gw=(zw.prototype.checkEmpty=function(t){return rv.resolve(0===this.mutationQueue.length)},zw.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");ay(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return ay(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,rv.resolve()},zw.prototype.getLastStreamToken=function(t){return rv.resolve(this.lastStreamToken)},zw.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,rv.resolve()},zw.prototype.addMutationBatch=function(t,e,n,r){ay(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&ay(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Zm(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new jw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return rv.resolve(o)},zw.prototype.lookupMutationBatch=function(t,e){return rv.resolve(this.findMutationBatch(e))},zw.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return ay(null!=n,"Failed to find local mutation batch."),rv.resolve(n.keys())},zw.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return rv.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},zw.prototype.getHighestUnacknowledgedBatchId=function(){return rv.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},zw.prototype.getAllMutationBatches=function(t){return rv.resolve(this.mutationQueue.slice())},zw.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new jw(e,0),i=new jw(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],(function(t){ay(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);ay(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),rv.resolve(o)},zw.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Um(qy);return e.forEach((function(t){var e=new jw(t,0),i=new jw(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],(function(e){ay(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)}))})),rv.resolve(this.findMutationBatches(r))},zw.prototype.getAllMutationBatchesAffectingQuery=function(t,e){ay(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;cm.isDocumentKey(i)||(i=i.child(""));var o=new jw(new cm(i),0),a=new Um(qy);return this.batchesByDocumentKey.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)}),o),rv.resolve(this.findMutationBatches(a))},zw.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)})),n},zw.prototype.removeMutationBatch=function(t,e){var n=this;ay(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return rv.forEach(e.mutations,(function(i){var o=new jw(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)})).next((function(){n.batchesByDocumentKey=r}))},zw.prototype.removeCachedMutationKeys=function(t){},zw.prototype.containsKey=function(t,e){var n=new jw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return rv.resolve(e.isEqual(r&&r.key))},zw.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&ay(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),rv.resolve()},zw.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return ay(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},zw.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},zw.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return ay(n.batchId===t,"If found batch must match"),n},zw);function zw(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=cy(),this.batchesByDocumentKey=new Um(jw.compareByKey)}var Yw=(Xw.prototype.getTargetCount=function(t){return rv.resolve(this.targetCount)},Xw.prototype.forEachTarget=function(t,e){return this.queries.forEach((function(t,n){return e(n)})),rv.resolve()},Xw.prototype.getLastRemoteSnapshotVersion=function(t){return rv.resolve(this.lastRemoteSnapshotVersion)},Xw.prototype.getHighestSequenceNumber=function(t){return rv.resolve(this.highestSequenceNumber)},Xw.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,rv.resolve(e)},Xw.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),rv.resolve()},Xw.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Xw.prototype.addQueryData=function(t,e){return ay(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,rv.resolve()},Xw.prototype.updateQueryData=function(t,e){return ay(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),rv.resolve()},Xw.prototype.removeQueryData=function(t,e){return ay(0<this.targetCount,"Removing a target from an empty cache"),ay(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,rv.resolve()},Xw.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach((function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)})),rv.waitFor(o).next((function(){return i}))},Xw.prototype.getQueryCount=function(t){return rv.resolve(this.targetCount)},Xw.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return rv.resolve(n)},Xw.prototype.getQueryDataForTarget=function(t,e){return oy("Not yet implemented.")},Xw.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.addReference(t,e))})),rv.waitFor(i)},Xw.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.removeReference(t,e))})),rv.waitFor(i)},Xw.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),rv.resolve()},Xw.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return rv.resolve(n)},Xw.prototype.containsKey=function(t,e){return rv.resolve(this.references.containsKey(e))},Xw);function Xw(t){this.persistence=t,this.queries=new cb((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=Am.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Vw,this.targetCount=0,this.targetIdGenerator=yv.forQueryCache()}var Jw,$w=(Zw.prototype.addEntry=function(t,e){var n=e.key,r=this.docs.get(n),i=r?r.size:0,o=this.sizer(e);return this.docs=this.docs.insert(n,{maybeDocument:e,size:o}),this.newDocumentChanges=this.newDocumentChanges.add(n),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())},Zw.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Zw.prototype.getEntry=function(t,e){var n=this.docs.get(e);return rv.resolve(n?n.maybeDocument:null)},Zw.prototype.getEntries=function(t,e){var n=this,r=Qm();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),rv.resolve(r)},Zw.prototype.getDocumentsMatchingQuery=function(t,e){ay(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Hm(),r=new cm(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof eb&&e.matches(s)&&(n=n.insert(s.key,s))}return rv.resolve(n)},Zw.prototype.forEachDocumentKey=function(t,e){return rv.forEach(this.docs,(function(t){return e(t)}))},Zw.prototype.getNewDocumentChanges=function(t){var e=this,n=Wm();return this.newDocumentChanges.forEach((function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new ib(t,Am.forDeletedDoc());n=n.insert(t,i)})),this.newDocumentChanges=Xm(),rv.resolve(n)},Zw.prototype.newChangeBuffer=function(){return new Zw.RemoteDocumentChangeBuffer(this)},Zw.prototype.getSize=function(t){return rv.resolve(this.size)},Zw.RemoteDocumentChangeBuffer=(Mi(t_,Jw=lb),t_.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i?n.push(e.documentCache.addEntry(t,i)):e.documentCache.removeEntry(r)})),rv.waitFor(n)},t_.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},t_.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},t_),Zw);function Zw(t,e){this.indexManager=t,this.sizer=e,this.docs=new Dm(cm.comparator),this.newDocumentChanges=Xm(),this.size=0}function t_(t){var e=Jw.call(this)||this;return e.documentCache=t,e}var e_=(n_.createLruPersistence=function(t,e,n){return new n_(t,(function(t){return new a_(t,new fw(e),n)}))},n_.createEagerPersistence=function(t){return new n_(t,(function(t){return new i_(t)}))},n_.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(n_.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),n_.prototype.getActiveClients=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return[2,[this.clientId]]}))}))},n_.prototype.setPrimaryStateListener=function(t){return t(!0)},n_.prototype.setDatabaseDeletedListener=function(){},n_.prototype.setNetworkEnabled=function(t){},n_.prototype.getIndexManager=function(){return this.indexManager},n_.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Gw(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},n_.prototype.getQueryCache=function(){return this.queryCache},n_.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},n_.prototype.runTransaction=function(t,e,n){var r=this;ny("MemoryPersistence","Starting transaction:",t);var i=new r_(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next((function(t){return r.referenceDelegate.onTransactionCommitted(i).next((function(){return t}))})).toPromise()},n_.prototype.mutationQueuesContainKey=function(t,e){return rv.or(function(t){var e=[];return gy(t,(function(t,n){return e.push(n)})),e}(this.mutationQueues).map((function(n){return function(){return n.containsKey(t,e)}})))},n_);function n_(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Jy(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Yw(this),this.indexManager=new Tb,this.remoteDocumentCache=new $w(this.indexManager,(function(t){return n.referenceDelegate.documentSize(t)}))}var r_=function(t){this.currentSequenceNumber=t},i_=(Object.defineProperty(o_.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw oy("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),o_.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},o_.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),rv.resolve()},o_.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),rv.resolve()},o_.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),rv.resolve()},o_.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.orphanedDocuments.add(t)}))})).next((function(){return r.removeQueryData(t,e)}))},o_.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},o_.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rv.forEach(this.orphanedDocuments,(function(r){return e.isReferenced(t,r).next((function(t){t||n.removeEntry(r)}))})).next((function(){return e._orphanedDocuments=null,n.apply(t)}))},o_.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next((function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)}))},o_.prototype.documentSize=function(t){return 0},o_.prototype.isReferenced=function(t,e){var n=this;return rv.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return rv.resolve(n.inMemoryPins.containsKey(e))}])},o_);function o_(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var a_=(s_.prototype.onTransactionStarted=function(){},s_.prototype.onTransactionCommitted=function(t){return rv.resolve()},s_.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},s_.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},s_.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},s_.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return rv.forEach(this.orphanedSequenceNumbers,(function(r,i){return n.isPinned(t,r,i).next((function(t){return t?rv.resolve():e(i)}))}))},s_.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},s_.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},s_.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,(function(i){return n.isPinned(t,i,e).next((function(t){t||(r++,o.removeEntry(i))}))})).next((function(){return o.apply(t)})).next((function(){return r}))},s_.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),rv.resolve()},s_.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getQueryCache().updateQueryData(t,n)},s_.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),rv.resolve()},s_.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),rv.resolve()},s_.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),rv.resolve()},s_.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw oy("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},s_.prototype.isPinned=function(t,e,n){var r=this;return rv.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return rv.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return rv.resolve(void 0!==t&&n<t)}])},s_.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},s_);function s_(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new cb((function(t){return Em(t.path)})),this.garbageCollector=new Ew(this,n)}var u_=Number,c_=u_.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),h_=u_.MAX_SAFE_INTEGER||Math.pow(2,53)-1,l_=u_.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function f_(t){return null==t}function p_(t){return l_(t)&&t<=h_&&c_<=t}var d_=(y_.prototype.reset=function(){this.currentBaseMs=0},y_.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},y_.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&ny("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){return e.lastAttemptTime=Date.now(),t()})),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},y_.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},y_.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},y_);function y_(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var m_,v_,g_="PersistentStream";(v_=m_=m_||{})[v_.Initial=0]="Initial",v_[v_.Starting=1]="Starting",v_[v_.Open=2]="Open",v_[v_.Error=3]="Error",v_[v_.Backoff=4]="Backoff";var b_=(w_.prototype.isStarted=function(){return this.state===m_.Starting||this.state===m_.Open||this.state===m_.Backoff},w_.prototype.isOpen=function(){return this.state===m_.Open},w_.prototype.start=function(){this.state!==m_.Error?(ay(this.state===m_.Initial,"Already started"),this.auth()):this.performBackoff()},w_.prototype.stop=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(m_.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},w_.prototype.inhibitBackoff=function(){ay(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=m_.Initial,this.backoff.reset()},w_.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,(function(){return t.handleIdleCloseTimer()})))},w_.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},w_.prototype.handleIdleCloseTimer=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return this.isOpen()?[2,this.close(m_.Initial)]:[2]}))}))},w_.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},w_.prototype.close=function(t,e){return Li(this,void 0,void 0,(function(){return Fi(this,(function(n){switch(n.label){case 0:return ay(this.isStarted(),"Only started streams should be closed."),ay(t===m_.Error||f_(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==m_.Error?this.backoff.reset():e&&e.code===ly.RESOURCE_EXHAUSTED?(ry(e.toString()),ry("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===ly.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}}))}))},w_.prototype.tearDown=function(){},w_.prototype.auth=function(){var t=this;ay(this.state===m_.Initial,"Must be in initial state to auth"),this.state=m_.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then((function(e){t.closeCount===n&&t.startStream(e)}),(function(n){e((function(){var e=new fy(ly.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)}))}))},w_.prototype.startStream=function(t){var e=this;ay(this.state===m_.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen((function(){n((function(){return ay(e.state===m_.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=m_.Open,e.listener.onOpen()}))})),this.stream.onClose((function(t){n((function(){return e.handleStreamClose(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},w_.prototype.performBackoff=function(){var t=this;ay(this.state===m_.Error,"Should only perform backoff when in Error state"),this.state=m_.Backoff,this.backoff.backoffAndRun((function(){return Li(t,void 0,void 0,(function(){return Fi(this,(function(t){return ay(this.state===m_.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=m_.Initial,this.start(),ay(this.isStarted(),"PersistentStream should have started"),[2]}))}))}))},w_.prototype.handleStreamClose=function(t){return ay(this.isStarted(),"Can't handle server close on non-started stream"),ny(g_,"close with error: "+t),this.stream=null,this.close(m_.Error,t)},w_.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget((function(){return e.closeCount===t?n():(ny(g_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},w_);function w_(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=m_.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new d_(t,e)}var __,E_=(Mi(T_,__=b_),T_.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},T_.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},T_.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},T_.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},T_);function T_(t,e,n,r,i){var o=__.call(this,t,lm.ListenStreamConnectionBackoff,lm.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var S_,I_=(Mi(C_,S_=b_),Object.defineProperty(C_.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),C_.prototype.start=function(){this.handshakeComplete_=!1,S_.prototype.start.call(this)},C_.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},C_.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},C_.prototype.onMessage=function(t){if(ay(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return ay(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},C_.prototype.writeHandshake=function(){ay(this.isOpen(),"Writing handshake requires an opened stream"),ay(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},C_.prototype.writeMutations=function(t){var e=this;ay(this.isOpen(),"Writing mutations requires an opened stream"),ay(this.handshakeComplete_,"Handshake must be complete before writing mutations"),ay(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map((function(t){return e.serializer.toMutation(t)}))};this.sendRequest(n)},C_);function C_(t,e,n,r,i){var o=S_.call(this,t,lm.WriteStreamConnectionBackoff,lm.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=cy(),o}var N_=(A_.prototype.newPersistentWriteStream=function(t){return new I_(this.queue,this.connection,this.credentials,this.serializer,t)},A_.prototype.newPersistentWatchStream=function(t){return new E_(this.queue,this.connection,this.credentials,this.serializer,t)},A_.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map((function(t){return e.serializer.toMutation(t)}))};return this.invokeRPC("Commit",n).then((function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)}))},A_.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map((function(t){return e.serializer.toName(t)}))};return this.invokeStreamingRPC("BatchGetDocuments",n).then((function(n){var r=Wm();n.forEach((function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);ay(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},A_.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeRPC(t,e,r)})).catch((function(t){throw t.code===ly.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},A_.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeStreamingRPC(t,e,r)})).catch((function(t){throw t.code===ly.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},A_);function A_(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var k_,D_,R_,O_,P_=(M_.prototype.lookup=function(t){return Li(this,void 0,void 0,(function(){var e,n=this;return Fi(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new fy(ly.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof ib||t instanceof eb?n.recordVersion(t):oy("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},M_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},M_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},M_.prototype.delete=function(t){this.write([new ag(t,this.precondition(t))]),this.writtenDocs.add(t)},M_.prototype.commit=function(){return Li(this,void 0,void 0,(function(){var t;return Fi(this,(function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach((function(e){t=t.remove(e.key)})),!t.isEmpty())throw new fy(ly.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}}))}))},M_.prototype.recordVersion=function(t){var e;if(t instanceof eb)e=t.version;else{if(!(t instanceof ib))throw oy("Document in a transaction was a "+t.constructor.name);e=Am.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new fy(ly.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},M_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?jv.updateTime(e):jv.NONE},M_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return jv.exists(!0);if(e.isEqual(Am.forDeletedDoc()))throw new fy(ly.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jv.updateTime(e)},M_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},M_.prototype.ensureCommitNotCalled=function(){ay(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},M_);function M_(t){this.datastore=t,this.readVersions=zm(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(D_=k_=k_||{})[D_.Unknown=0]="Unknown",D_[D_.Online=1]="Online",D_[D_.Offline=2]="Offline",(O_=R_=R_||{})[O_.RemoteStore=0]="RemoteStore",O_[O_.SharedClientState=1]="SharedClientState";var x_,L_,F_=(U_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(k_.Unknown),ay(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(lm.OnlineStateTimeout,1e4,(function(){return t.onlineStateTimer=null,ay(t.state===k_.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(k_.Offline),Promise.resolve()})))},U_.prototype.handleWatchStreamFailure=function(t){this.state===k_.Online?(this.setAndBroadcast(k_.Unknown),ay(0===this.watchStreamFailures,"watchStreamFailures must be 0"),ay(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(k_.Offline)))},U_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===k_.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},U_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},U_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(ry(e),this.shouldWarnClientIsOffline=!1):ny("OnlineStateTracker",e)},U_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},U_);function U_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=k_.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function q_(t){switch(t){case ly.OK:return oy("Treated status OK as error");case ly.CANCELLED:case ly.UNKNOWN:case ly.DEADLINE_EXCEEDED:case ly.RESOURCE_EXHAUSTED:case ly.INTERNAL:case ly.UNAVAILABLE:case ly.UNAUTHENTICATED:return!1;case ly.INVALID_ARGUMENT:case ly.NOT_FOUND:case ly.ALREADY_EXISTS:case ly.PERMISSION_DENIED:case ly.FAILED_PRECONDITION:case ly.ABORTED:case ly.OUT_OF_RANGE:case ly.UNIMPLEMENTED:case ly.DATA_LOSS:return!0;default:return oy("Unknown status code: "+t)}}function V_(t){if(void 0===t)return ry("GRPC error has no .code"),ly.UNKNOWN;switch(t){case x_.OK:return ly.OK;case x_.CANCELLED:return ly.CANCELLED;case x_.UNKNOWN:return ly.UNKNOWN;case x_.DEADLINE_EXCEEDED:return ly.DEADLINE_EXCEEDED;case x_.RESOURCE_EXHAUSTED:return ly.RESOURCE_EXHAUSTED;case x_.INTERNAL:return ly.INTERNAL;case x_.UNAVAILABLE:return ly.UNAVAILABLE;case x_.UNAUTHENTICATED:return ly.UNAUTHENTICATED;case x_.INVALID_ARGUMENT:return ly.INVALID_ARGUMENT;case x_.NOT_FOUND:return ly.NOT_FOUND;case x_.ALREADY_EXISTS:return ly.ALREADY_EXISTS;case x_.PERMISSION_DENIED:return ly.PERMISSION_DENIED;case x_.FAILED_PRECONDITION:return ly.FAILED_PRECONDITION;case x_.ABORTED:return ly.ABORTED;case x_.OUT_OF_RANGE:return ly.OUT_OF_RANGE;case x_.UNIMPLEMENTED:return ly.UNIMPLEMENTED;case x_.DATA_LOSS:return ly.DATA_LOSS;default:return oy("Unknown status code: "+t)}}(L_=x_=x_||{})[L_.OK=0]="OK",L_[L_.CANCELLED=1]="CANCELLED",L_[L_.UNKNOWN=2]="UNKNOWN",L_[L_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L_[L_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L_[L_.NOT_FOUND=5]="NOT_FOUND",L_[L_.ALREADY_EXISTS=6]="ALREADY_EXISTS",L_[L_.PERMISSION_DENIED=7]="PERMISSION_DENIED",L_[L_.UNAUTHENTICATED=16]="UNAUTHENTICATED",L_[L_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L_[L_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L_[L_.ABORTED=10]="ABORTED",L_[L_.OUT_OF_RANGE=11]="OUT_OF_RANGE",L_[L_.UNIMPLEMENTED=12]="UNIMPLEMENTED",L_[L_.INTERNAL=13]="INTERNAL",L_[L_.UNAVAILABLE=14]="UNAVAILABLE",L_[L_.DATA_LOSS=15]="DATA_LOSS";var B_,j_,W_,Q_,K_=(H_.emptySet=function(t){return new H_(t.comparator)},H_.prototype.has=function(t){return null!=this.keyedMap.get(t)},H_.prototype.get=function(t){return this.keyedMap.get(t)},H_.prototype.first=function(){return this.sortedSet.minKey()},H_.prototype.last=function(){return this.sortedSet.maxKey()},H_.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},H_.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(H_.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),H_.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},H_.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},H_.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},H_.prototype.isEqual=function(t){if(!(t instanceof H_))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},H_.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},H_.prototype.copy=function(t,e){var n=new H_;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},H_);function H_(t){this.comparator=t?function(e,n){return t(e,n)||cm.comparator(e.key,n.key)}:function(t,e){return cm.comparator(t.key,e.key)},this.keyedMap=Hm(),this.sortedSet=new Dm(this.comparator)}(j_=B_=B_||{})[j_.Added=0]="Added",j_[j_.Removed=1]="Removed",j_[j_.Modified=2]="Modified",j_[j_.Metadata=3]="Metadata",(Q_=W_=W_||{})[Q_.Local=0]="Local",Q_[Q_.Synced=1]="Synced";var G_=(z_.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==B_.Added&&n.type===B_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===B_.Metadata&&n.type!==B_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===B_.Modified&&n.type===B_.Modified?this.changeMap=this.changeMap.insert(e,{type:B_.Modified,doc:t.doc}):t.type===B_.Modified&&n.type===B_.Added?this.changeMap=this.changeMap.insert(e,{type:B_.Added,doc:t.doc}):t.type===B_.Removed&&n.type===B_.Added?this.changeMap=this.changeMap.remove(e):t.type===B_.Removed&&n.type===B_.Modified?this.changeMap=this.changeMap.insert(e,{type:B_.Removed,doc:n.doc}):t.type===B_.Added&&n.type===B_.Removed?this.changeMap=this.changeMap.insert(e,{type:B_.Modified,doc:t.doc}):oy("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},z_.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal((function(e,n){t.push(n)})),t},z_);function z_(){this.changeMap=new Dm(cm.comparator)}var Y_=(X_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:B_.Added,doc:t})})),new X_(t,e,K_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(X_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),X_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},X_);function X_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var J_=($_.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=Z_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new $_(Am.MIN,r,$m(),Wm(),Xm())},$_);function $_(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var Z_=(tE.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new tE(cy(),e,Xm(),Xm(),Xm())},tE);function tE(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var eE,nE,rE=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},iE=function(t,e){this.targetId=t,this.existenceFilter=e};(nE=eE=eE||{})[nE.NoChange=0]="NoChange",nE[nE.Added=1]="Added",nE[nE.Removed=2]="Removed",nE[nE.Current=3]="Current",nE[nE.Reset=4]="Reset";var oE=function(t,e,n,r){void 0===n&&(n=cy()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},aE=(Object.defineProperty(sE.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(sE.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(sE.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(sE.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),sE.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},sE.prototype.toTargetChange=function(){var t=Xm(),e=Xm(),n=Xm();return this.documentChanges.forEach((function(r,i){switch(i){case B_.Added:t=t.add(r);break;case B_.Modified:e=e.add(r);break;case B_.Removed:n=n.add(r);break;default:oy("Encountered invalid change type: "+i)}})),new Z_(this._resumeToken,this._current,t,e,n)},sE.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=lE()},sE.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},sE.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},sE.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},sE.prototype.recordTargetResponse=function(){this.pendingResponses-=1},sE.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},sE);function sE(){this.pendingResponses=0,this.documentChanges=lE(),this._resumeToken=cy(),this._current=!1,this._hasPendingChanges=!0}var uE=(cE.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof eb?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof ib&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},cE.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ensureTargetState(n);switch(t.state){case eE.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case eE.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case eE.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),ay(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case eE.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case eE.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:oy("Unknown target watch change state: "+t.state)}}))},cE.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):vy(this.targetStates,e)},cE.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new cm(i.path);this.removeDocumentFromTarget(e,o,new ib(o,Am.forDeletedDoc()))}else ay(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},cE.prototype.createRemoteEvent=function(t){var e=this,n={};vy(this.targetStates,(function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new cm(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new ib(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}}));var r=Xm();this.pendingDocumentTargetMapping.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===iw.LimboResolution||(i=!1)})),i&&(r=r.add(t))}));var i=new J_(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Wm(),this.pendingDocumentTargetMapping=hE(),this.pendingTargetResets=new Um(qy),i},cE.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?B_.Modified:B_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},cE.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,B_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},cE.prototype.removeTarget=function(t){delete this.targetStates[t]},cE.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},cE.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},cE.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new aE),this.targetStates[t]},cE.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Um(qy),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},cE.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||ny("WatchChangeAggregator","Detected inactive target",t),e},cE.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},cE.prototype.resetTarget=function(t){var e=this;ay(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new aE,this.metadataProvider.getRemoteKeysForTarget(t).forEach((function(n){e.removeDocumentFromTarget(t,n,null)}))},cE.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},cE);function cE(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Wm(),this.pendingDocumentTargetMapping=hE(),this.pendingTargetResets=new Um(qy)}function hE(){return new Dm(cm.comparator)}function lE(){return new Dm(cm.comparator)}var fE="RemoteStore",pE=(dE.prototype.start=function(){return this.enableNetwork()},dE.prototype.enableNetwork=function(){return Li(this,void 0,void 0,(function(){var t;return Fi(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(k_.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},dE.prototype.disableNetwork=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(k_.Offline),[2]}}))}))},dE.prototype.disableNetworkInternal=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(ny(fE,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}}))}))},dE.prototype.shutdown=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return ny(fE,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(k_.Unknown),[2]}}))}))},dE.prototype.listen=function(t){ay(!yy(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},dE.prototype.unlisten=function(t){ay(yy(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),by(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(k_.Unknown))},dE.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},dE.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},dE.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},dE.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},dE.prototype.startWatchStream=function(){ay(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new uE(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},dE.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!by(this.listenTargets)},dE.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},dE.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},dE.prototype.onWatchStreamOpen=function(){return Li(this,void 0,void 0,(function(){var t=this;return Fi(this,(function(e){return vy(this.listenTargets,(function(e,n){t.sendWatchRequest(n)})),[2]}))}))},dE.prototype.onWatchStreamClose=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){return void 0===t&&ay(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(k_.Unknown),[2]}))}))},dE.prototype.onWatchStreamChange=function(t,e){return Li(this,void 0,void 0,(function(){var n;return Fi(this,(function(r){switch(r.label){case 0:return this.onlineStateTracker.set(k_.Online),t instanceof oE&&t.state===eE.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof rE?this.watchChangeAggregator.handleDocumentChange(t):t instanceof iE?this.watchChangeAggregator.handleExistenceFilter(t):(ay(t instanceof oE,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Am.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},dE.prototype.raiseWatchSnapshot=function(t){var e=this;ay(!t.isEqual(Am.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return vy(n.targetChanges,(function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(cy(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new hw(n.query,t,iw.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}})),this.syncEngine.applyRemoteEvent(n)},dE.prototype.handleTargetError=function(t){var e=this;ay(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return Li(e,void 0,void 0,(function(){return Fi(this,(function(e){return yy(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]}))}))}))})),r},dE.prototype.fillWritePipeline=function(){return Li(this,void 0,void 0,(function(){var t,e;return Fi(this,(function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}}))}))},dE.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},dE.prototype.outstandingWrites=function(){return this.writePipeline.length},dE.prototype.addToWritePipeline=function(t){ay(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},dE.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},dE.prototype.startWriteStream=function(){ay(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},dE.prototype.onWriteStreamOpen=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return this.writeStream.writeHandshake(),[2]}))}))},dE.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}})).catch(Ow)},dE.prototype.onMutationResult=function(t,e){var n=this;ay(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=ev.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return n.fillWritePipeline()}))},dE.prototype.onWriteStreamClose=function(t){return Li(this,void 0,void 0,(function(){var e=this;return Fi(this,(function(n){return void 0===t&&ay(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then((function(){e.shouldStartWriteStream()&&e.startWriteStream()}))]:[2]}))}))},dE.prototype.handleHandshakeError=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){return q_(t.code)?(ny(fE,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=cy(),[2,this.localStore.setLastStreamToken(cy()).catch(Ow)]):[2]}))}))},dE.prototype.handleWriteError=function(t){return Li(this,void 0,void 0,(function(){var e,n=this;return Fi(this,(function(r){return function(t){return q_(t)&&t!==ly.ABORTED}(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then((function(){return n.fillWritePipeline()}))]):[2]}))}))},dE.prototype.createTransaction=function(){return new P_(this.datastore)},dE.prototype.restartNetwork=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(k_.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},dE.prototype.handleCredentialChange=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(ny(fE,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},dE.prototype.applyPrimaryState=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(k_.Unknown),e.label=4;case 4:return[2]}}))}))},dE);function dE(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback((function(t){n.enqueueAndForget((function(){return Li(o,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(ny(fE,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.onlineStateTracker=new F_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var yE=(Object.defineProperty(mE.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(mE.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),mE.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},mE.prototype._compareTo=function(t){return qy(this._lat,t._lat)||qy(this._long,t._long)},mE);function mE(t,e){if(_y("GeoPoint",arguments,2),Sy("GeoPoint","number",1,t),Sy("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new fy(ly.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new fy(ly.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var vE=(gE.atPath=function(t){return new gE(t)},Object.defineProperty(gE.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[KE]:this.memoizedOrderBy=[new WE(t),KE];else{ay(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:qE.ASCENDING;this.memoizedOrderBy.push(a===qE.ASCENDING?KE:HE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),gE.prototype.addFilter=function(t){ay(null==this.getInequalityFilterField()||!(t instanceof EE)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),ay(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new gE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},gE.prototype.addOrderBy=function(t){ay(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new gE(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},gE.prototype.withLimit=function(t){return new gE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},gE.prototype.withStartAt=function(t){return new gE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},gE.prototype.withEndAt=function(t){return new gE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},gE.prototype.asCollectionQueryAtPath=function(t){return new gE(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},gE.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";f_(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},gE.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),f_(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},gE.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},gE.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return ay(n,"orderBy used that doesn't compare on key field"),0},gE.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},gE.prototype.hasLimit=function(){return!f_(this.limit)},gE.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},gE.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof EE&&n.isInequality())return n.field}return null},gE.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof EE&&0<=t.indexOf(r.op))return r.op}return null},gE.prototype.isDocumentQuery=function(){return cm.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},gE.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},gE.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):cm.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},gE.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},gE.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},gE.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},gE.prototype.assertValidBound=function(t){ay(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},gE);function gE(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}var bE=(wE.fromString=function(t){switch(t){case"<":return wE.LESS_THAN;case"<=":return wE.LESS_THAN_OR_EQUAL;case"==":return wE.EQUAL;case">=":return wE.GREATER_THAN_OR_EQUAL;case">":return wE.GREATER_THAN;case"array-contains":return wE.ARRAY_CONTAINS;case"in":return wE.IN;case"array-contains-any":return wE.ARRAY_CONTAINS_ANY;default:return oy("Unknown FieldFilter operator: "+t)}},wE.prototype.toString=function(){return this.name},wE.prototype.isEqual=function(t){return this.name===t.name},wE.LESS_THAN=new wE("<"),wE.LESS_THAN_OR_EQUAL=new wE("<="),wE.EQUAL=new wE("=="),wE.GREATER_THAN=new wE(">"),wE.GREATER_THAN_OR_EQUAL=new wE(">="),wE.ARRAY_CONTAINS=new wE("array-contains"),wE.IN=new wE("in"),wE.ARRAY_CONTAINS_ANY=new wE("array-contains-any"),wE);function wE(t){this.name=t}var _E,EE=(Mi(TE,_E=function(){}),TE.create=function(t,e,n){if(t.isKeyField())return e===bE.IN?(ay(n instanceof Xg,"Comparing on key with IN, but filter value not an ArrayValue"),ay(n.internalValue.every((function(t){return t instanceof Bg})),"Comparing on key with IN, but an array value was not a RefValue"),new AE(t,n)):(ay(n instanceof Bg,"Comparing on key, but filter value not a RefValue"),ay(e!==bE.ARRAY_CONTAINS&&e!==bE.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new IE(t,e,n));if(n.isEqual(pg.INSTANCE)){if(e!==bE.EQUAL)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new TE(t,e,n)}if(n.isEqual(Cg.NAN)){if(e!==bE.EQUAL)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new TE(t,e,n)}return e===bE.ARRAY_CONTAINS?new RE(t,n):e===bE.IN?(ay(n instanceof Xg,"IN filter has invalid value: "+n.toString()),new ME(t,n)):e===bE.ARRAY_CONTAINS_ANY?(ay(n instanceof Xg,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new FE(t,n)):new TE(t,e,n)},TE.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},TE.prototype.matchesComparison=function(t){switch(this.op){case bE.LESS_THAN:return t<0;case bE.LESS_THAN_OR_EQUAL:return t<=0;case bE.EQUAL:return 0===t;case bE.GREATER_THAN:return 0<t;case bE.GREATER_THAN_OR_EQUAL:return 0<=t;default:return oy("Unknown FieldFilter operator: "+this.op)}},TE.prototype.isInequality=function(){return 0<=[bE.LESS_THAN,bE.LESS_THAN_OR_EQUAL,bE.GREATER_THAN,bE.GREATER_THAN_OR_EQUAL].indexOf(this.op)},TE.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},TE.prototype.isEqual=function(t){return t instanceof TE&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},TE.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},TE);function TE(t,e,n){var r=_E.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var SE,IE=(Mi(CE,SE=EE),CE.prototype.matches=function(t){var e=this.value,n=cm.comparator(t.key,e.key);return this.matchesComparison(n)},CE);function CE(){return null!==SE&&SE.apply(this,arguments)||this}var NE,AE=(Mi(kE,NE=EE),kE.prototype.matches=function(t){return this.value.internalValue.some((function(e){return t.key.isEqual(e.key)}))},kE);function kE(t,e){var n=NE.call(this,t,bE.IN,e)||this;return n.value=e,n}var DE,RE=(Mi(OE,DE=EE),OE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Xg&&e.contains(this.value)},OE);function OE(t,e){return DE.call(this,t,bE.ARRAY_CONTAINS,e)||this}var PE,ME=(Mi(xE,PE=EE),xE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},xE);function xE(t,e){var n=PE.call(this,t,bE.IN,e)||this;return n.value=e,n}var LE,FE=(Mi(UE,LE=EE),UE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Xg&&n.internalValue.some((function(t){return e.value.contains(t)}))},UE);function UE(t,e){var n=LE.call(this,t,bE.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var qE=(VE.prototype.toString=function(){return this.name},VE.ASCENDING=new VE("asc"),VE.DESCENDING=new VE("desc"),VE);function VE(t){this.name=t}var BE=(jE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},jE.prototype.sortsBeforeDocument=function(t,e){ay(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())ay(o instanceof Bg,"Bound has a non-key value where the key path is being used."),n=cm.comparator(o.key,e.key);else{var a=e.field(i.field);ay(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===qE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},jE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},jE);function jE(t,e){this.position=t,this.before=e}var WE=(QE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?eb.compareByKey(t,e):eb.compareByField(this.field,t,e);switch(this.dir){case qE.ASCENDING:return n;case qE.DESCENDING:return-1*n;default:return oy("Unknown direction: "+this.dir)}},QE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},QE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},QE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},QE);function QE(t,e){this.field=t,void 0===e&&(e=qE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var KE=new WE(sm.keyField(),qE.ASCENDING),HE=new WE(sm.keyField(),qE.DESCENDING),GE=(zE.prototype.applyToLocalView=function(t,e){return new xg(e,t)},zE.prototype.applyToRemoteDocument=function(t,e){return e},zE.prototype.computeBaseValue=function(t){return null},zE.prototype.isEqual=function(t){return t instanceof zE},zE.instance=new zE,zE);function zE(){}var YE=(XE.prototype.applyToLocalView=function(t,e){return this.apply(t)},XE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},XE.prototype.apply=function(t){for(var e=eT(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Xg(e)},XE.prototype.computeBaseValue=function(t){return null},XE.prototype.isEqual=function(t){return t instanceof XE&&Vy(t.elements,this.elements)},XE);function XE(t){this.elements=t}var JE=($E.prototype.applyToLocalView=function(t,e){return this.apply(t)},$E.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},$E.prototype.apply=function(t){for(var e=eT(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Xg(e)},$E.prototype.computeBaseValue=function(t){return null},$E.prototype.isEqual=function(t){return t instanceof $E&&Vy(t.elements,this.elements)},$E);function $E(t){this.elements=t}var ZE=(tT.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Tg&&this.operand instanceof Tg){var r=n.internalValue+this.operand.internalValue;return new Tg(r)}return r=n.internalValue+this.operand.internalValue,new Cg(r)},tT.prototype.applyToRemoteDocument=function(t,e){return ay(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},tT.prototype.computeBaseValue=function(t){return t instanceof bg?t:new Tg(0)},tT.prototype.isEqual=function(t){return t instanceof tT&&this.operand.isEqual(t.operand)},tT);function tT(t){this.operand=t}function eT(t){return t instanceof Xg?t.internalValue.slice():[]}var nT=(rT.prototype.isEqual=function(t){return t&&t.count===this.count},rT);function rT(t){this.count=t}var iT,oT,aT=((iT={})[qE.ASCENDING.name]="ASCENDING",iT[qE.DESCENDING.name]="DESCENDING",iT),sT=((oT={})[bE.LESS_THAN.name]="LESS_THAN",oT[bE.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",oT[bE.GREATER_THAN.name]="GREATER_THAN",oT[bE.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",oT[bE.EQUAL.name]="EQUAL",oT[bE.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",oT[bE.IN.name]="IN",oT[bE.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",oT),uT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cT(t,e){ay(!f_(t),e+" is missing")}function hT(t){return"number"==typeof t?t:"string"==typeof t?Number(t):oy("can't parse "+t)}var lT=(fT.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},fT.prototype.unsafeCastProtoByteString=function(t){return t},fT.prototype.fromRpcStatus=function(t){var e=void 0===t.code?ly.UNKNOWN:V_(t.code);return new fy(e,t.message||"")},fT.prototype.toInt32Value=function(t){return f_(t)?void 0:{value:t}},fT.prototype.fromInt32Value=function(t){var e;return f_(e="object"==typeof t?t.value:t)?null:e},fT.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},fT.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);ay(!!t,"Cannot deserialize null or undefined timestamp.");var e=hT(t.seconds||"0"),n=t.nanos||0;return new Cm(e,n)},fT.prototype.fromIso8601String=function(t){var e=0,n=uT.exec(t);if(ay(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Cm(o,e)},fT.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},fT.prototype.fromBlob=function(t){return"string"==typeof t?(ay(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Qy.fromBase64String(t)):(ay(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Qy.fromUint8Array(t))},fT.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},fT.prototype.fromVersion=function(t){return ay(!!t,"Trying to deserialize version that isn't set"),Am.fromTimestamp(this.fromTimestamp(t))},fT.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},fT.prototype.fromResourceName=function(t){var e=rm.fromString(t);return ay(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},fT.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},fT.prototype.fromName=function(t){var e=this.fromResourceName(t);return ay(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),ay(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new cm(this.extractLocalPathFromResourceName(e))},fT.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},fT.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?rm.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(fT.prototype,"encodedDatabaseId",{get:function(){return new rm(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),fT.prototype.fullyQualifiedPrefixPath=function(t){return new rm(["projects",t.projectId,"databases",t.database])},fT.prototype.extractLocalPathFromResourceName=function(t){return ay(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},fT.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},fT.prototype.toValue=function(t){if(t instanceof pg)return{nullValue:"NULL_VALUE"};if(t instanceof mg)return{booleanValue:t.value()};if(t instanceof Tg)return{integerValue:""+t.value()};if(t instanceof Cg){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof kg?{stringValue:t.value()}:t instanceof Gg?{mapValue:this.toMapValue(t)}:t instanceof Xg?{arrayValue:this.toArrayValue(t)}:t instanceof Og?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Qg?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ug?{bytesValue:this.toBytes(t.value())}:t instanceof Bg?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:oy("Unknown FieldValue "+JSON.stringify(t))},fT.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return pg.INSTANCE;if("booleanValue"in t)return mg.of(t.booleanValue);if("integerValue"in t)return new Tg(hT(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Cg.NAN;if("Infinity"===t.doubleValue)return Cg.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Cg.NEGATIVE_INFINITY}return new Cg(t.doubleValue)}if("stringValue"in t)return new kg(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){cT(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Xg(n.map((function(t){return e.fromValue(t)})))}if("timestampValue"in t)return cT(t.timestampValue,"timestampValue"),new Og(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){cT(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Qg(new yE(r,i))}if("bytesValue"in t){cT(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Ug(o)}if("referenceValue"in t){cT(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Yy(a.get(1),a.get(3)),u=new cm(this.extractLocalPathFromResourceName(a));return new Bg(s,u)}return oy("Unknown Value proto "+JSON.stringify(t))},fT.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},fT.prototype.toDocument=function(t){return ay(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},fT.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new eb(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.fromValue(t)}))},fT.prototype.toFields=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.toValue(r)})),n},fT.prototype.fromFields=function(t){var e=this,n=t,r=Gg.EMPTY;return gy(n,(function(t,n){r=r.set(new sm([t]),e.fromValue(n))})),r},fT.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},fT.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.toValue(t))})),{values:n}},fT.prototype.fromFound=function(t){var e=this;ay(!!t.found,"Tried to deserialize a found document from a missing document."),cT(t.found.name,"doc.found.name"),cT(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new eb(n,r,{},void 0,t.found,(function(t){return e.fromValue(t)}))},fT.prototype.fromMissing=function(t){ay(!!t.missing,"Tried to deserialize a missing document from a found document."),ay(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new ib(e,n)},fT.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):oy("invalid batch get response: "+JSON.stringify(t))},fT.prototype.toWatchTargetChangeState=function(t){switch(t){case eE.Added:return"ADD";case eE.Current:return"CURRENT";case eE.NoChange:return"NO_CHANGE";case eE.Removed:return"REMOVE";case eE.Reset:return"RESET";default:return oy("Unknown WatchTargetChangeState: "+t)}},fT.prototype.toTestWatchChange=function(t){if(t instanceof iE)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof rE){if(t.newDoc instanceof eb){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof ib)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof oE){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return x_.OK;switch(t){case ly.OK:return x_.OK;case ly.CANCELLED:return x_.CANCELLED;case ly.UNKNOWN:return x_.UNKNOWN;case ly.DEADLINE_EXCEEDED:return x_.DEADLINE_EXCEEDED;case ly.RESOURCE_EXHAUSTED:return x_.RESOURCE_EXHAUSTED;case ly.INTERNAL:return x_.INTERNAL;case ly.UNAVAILABLE:return x_.UNAVAILABLE;case ly.UNAUTHENTICATED:return x_.UNAUTHENTICATED;case ly.INVALID_ARGUMENT:return x_.INVALID_ARGUMENT;case ly.NOT_FOUND:return x_.NOT_FOUND;case ly.ALREADY_EXISTS:return x_.ALREADY_EXISTS;case ly.PERMISSION_DENIED:return x_.PERMISSION_DENIED;case ly.FAILED_PRECONDITION:return x_.FAILED_PRECONDITION;case ly.ABORTED:return x_.ABORTED;case ly.OUT_OF_RANGE:return x_.OUT_OF_RANGE;case ly.UNIMPLEMENTED:return x_.UNIMPLEMENTED;case ly.DATA_LOSS:return x_.DATA_LOSS;default:return oy("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return oy("Unrecognized watch change: "+JSON.stringify(t))},fT.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){cT(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new oE(r,i,o,s||null)}else if("documentChange"in t){cT(t.documentChange,"documentChange"),cT(t.documentChange.document,"documentChange.name"),cT(t.documentChange.document.name,"documentChange.document.name"),cT(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new eb(c,h,{},void 0,u.document,(function(t){return n.fromValue(t)})),f=u.targetIds||[],p=u.removedTargetIds||[];e=new rE(f,p,l.key,l)}else if("documentDelete"in t){cT(t.documentDelete,"documentDelete"),cT(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):Am.forDeletedDoc(),l=new ib(c,h),p=d.removedTargetIds||[],e=new rE([],p,l.key,l)}else if("documentRemove"in t){cT(t.documentRemove,"documentRemove"),cT(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),p=y.removedTargetIds||[],e=new rE([],p,c,null)}else{if(!("filter"in t))return oy("Unknown change type "+JSON.stringify(t));cT(t.filter,"filter"),cT(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new nT(v),b=m.targetId;e=new iE(b,g)}return e},fT.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?eE.NoChange:"ADD"===t?eE.Added:"REMOVE"===t?eE.Removed:"CURRENT"===t?eE.Current:"RESET"===t?eE.Reset:oy("Got unexpected TargetChange.state: "+t)},fT.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Am.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Am.MIN:e.readTime?this.fromVersion(e.readTime):Am.MIN},fT.prototype.toMutation=function(t){var e,n=this;if(t instanceof Gv)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof ag)e={delete:this.toName(t.key)};else if(t instanceof Xv)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Zv))return oy("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.toFieldTransform(t)}))}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},fT.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):jv.NONE;if(t.update){cT(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Xv(r,i,o,n)}return new Gv(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new ag(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map((function(t){return e.fromFieldTransform(t)}));return ay(!0===n.exists,'Transforms only support precondition "exists == true"'),new Zv(r,a)}return oy("unknown mutation proto: "+JSON.stringify(t))},fT.prototype.toPrecondition=function(t){return ay(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:oy("Unknown precondition")},fT.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?jv.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?jv.exists(t.exists):jv.NONE},fT.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map((function(t){return n.fromValue(t)}))),new Bv(r,i)},fT.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(ay(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.fromWriteResult(t,e)}))):[]},fT.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof GE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof YE)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof JE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof ZE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw oy("Unknown transform: "+t.transform)},fT.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)ay("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=GE.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new YE(r.map((function(t){return e.fromValue(t)})))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new JE(r.map((function(t){return e.fromValue(t)})));else if("increment"in t){var i=this.fromValue(t.increment);ay(i instanceof bg,"NUMERIC_ADD transform requires a NumberValue"),n=new ZE(i)}else oy("Unknown transform proto: "+JSON.stringify(t));var o=sm.fromServerFormat(t.fieldPath);return new Fv(o,n)},fT.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},fT.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;ay(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return vE.atPath(this.fromQueryPath(n))},fT.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(ay(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(ay(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},fT.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){ay(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new vE(e,i,s,a,u,c,h)},fT.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},fT.prototype.toLabel=function(t){switch(t){case iw.Listen:return null;case iw.ExistenceFilterMismatch:return"existence-filter-mismatch";case iw.LimboResolution:return"limbo-document";default:return oy("Unrecognized query purpose: "+t)}},fT.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},fT.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof EE?e.toUnaryOrFieldFilter(t):oy("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},fT.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.fromFilter(t)})).reduce((function(t,e){return t.concat(e)})):oy("Unknown filter: "+JSON.stringify(t)):[]},fT.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.toPropertyOrder(t)}))},fT.prototype.fromOrder=function(t){var e=this;return t.map((function(t){return e.fromPropertyOrder(t)}))},fT.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.toValue(t)}))}},fT.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.fromValue(t)}));return new BE(r,n)},fT.prototype.toDirection=function(t){return aT[t.name]},fT.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return qE.ASCENDING;case"DESCENDING":return qE.DESCENDING;default:return}},fT.prototype.toOperatorName=function(t){return sT[t.name]},fT.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return bE.EQUAL;case"GREATER_THAN":return bE.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return bE.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return bE.LESS_THAN;case"LESS_THAN_OR_EQUAL":return bE.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return bE.ARRAY_CONTAINS;case"IN":return bE.IN;case"ARRAY_CONTAINS_ANY":return bE.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return oy("Unspecified operator");default:return oy("Unknown operator")}},fT.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},fT.prototype.fromFieldPathReference=function(t){return sm.fromServerFormat(t.fieldPath)},fT.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},fT.prototype.fromPropertyOrder=function(t){return new WE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},fT.prototype.fromFieldFilter=function(t){return EE.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},fT.prototype.toUnaryOrFieldFilter=function(t){if(t.op===bE.EQUAL){if(t.value.isEqual(Cg.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(pg.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},fT.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return EE.create(e,bE.EQUAL,Cg.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return EE.create(n,bE.EQUAL,pg.INSTANCE);case"OPERATOR_UNSPECIFIED":return oy("Unspecified filter");default:return oy("Unknown filter")}},fT.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}},fT.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map((function(t){return sm.fromServerFormat(t)}));return xv.fromArray(e)},fT);function fT(t,e){this.databaseId=t,this.options=e}var pT=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},dT=(yT.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new pT,this.queries.set(e,r)),r.listeners.push(t),ay(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then((function(t){return r.targetId=t})):Promise.resolve(r.targetId)},yT.prototype.unlisten=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i;return Fi(this,(function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]}))}))},yT.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},yT.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},yT.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].applyOnlineStateChange(t)&&(e=!0)})),e&&this.raiseSnapshotsInSyncEvent()},yT.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},yT.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},yT.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(t){t.next()}))},yT);function yT(t){this.syncEngine=t,this.queries=new cb((function(t){return t.canonicalId()})),this.onlineState=k_.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var mT=(vT.prototype.onViewSnapshot=function(t){if(ay(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==B_.Metadata&&e.push(i)}t=new Y_(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},vT.prototype.onError=function(t){this.queryObserver.error(t)},vT.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},vT.prototype.shouldRaiseInitialEvent=function(t,e){if(ay(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==k_.Offline;return this.options.waitForSyncWhenOnline&&n?(ay(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===k_.Offline},vT.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},vT.prototype.raiseInitialEvent=function(t){ay(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Y_.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},vT);function vT(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=k_.Unknown,this.options=n||{}}var gT=(bT.fromSnapshot=function(t,e){for(var n=Xm(),r=Xm(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case B_.Added:n=n.add(a.doc.key);break;case B_.Removed:r=r.add(a.doc.key)}}return new bT(t,n,r)},bT);function bT(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var wT=function(t){this.key=t},_T=function(t){this.key=t},ET=(Object.defineProperty(TT.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),TT.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new G_,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal((function(t,e){var c=i.get(t),h=e instanceof eb?e:null;h&&(ay(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data().isEqual(h.data())?l!==f&&(r.track({type:B_.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:B_.Modified,doc:h}),p=!0,u&&0<n.query.docComparator(h,u)&&(s=!0)):!c&&h?(r.track({type:B_.Added,doc:h}),p=!0):c&&!h&&(r.track({type:B_.Removed,doc:c}),p=!0,u&&(s=!0)),p&&(o=h?(a=a.add(h),f?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))})),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:B_.Removed,doc:c})}return ay(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},TT.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},TT.prototype.applyChanges=function(t,e,n){var r=this;ay(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort((function(t,e){return function(t,e){function n(t){switch(t){case B_.Added:return 1;case B_.Modified:case B_.Metadata:return 2;case B_.Removed:return 0;default:return oy("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)})),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?W_.Synced:W_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Y_(this.query,t.documentSet,i,o,t.mutatedKeys,s===W_.Local,u,!1),limboChanges:a}:{limboChanges:a}},TT.prototype.applyOnlineStateChange=function(t){return this.current&&t===k_.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new G_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},TT.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},TT.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.add(t)})),t.modifiedDocuments.forEach((function(t){return ay(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")})),t.removedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)})),this.current=t.current)},TT.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Xm(),this.documentSet.forEach((function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))}));var n=[];return e.forEach((function(e){t.limboDocuments.has(e)||n.push(new _T(e))})),this.limboDocuments.forEach((function(t){e.has(t)||n.push(new wT(t))})),n},TT.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Xm();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},TT.prototype.computeInitialSnapshot=function(){return Y_.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===W_.Local)},TT);function TT(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Xm(),this.mutatedKeys=Xm(),this.documentSet=new K_(t.docComparator.bind(t))}var ST=(IT.prototype.run=function(){this.runWithBackOff()},IT.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun((function(){return Li(t,void 0,void 0,(function(){var t,e,n=this;return Fi(this,(function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.handleTransactionError(t)}))}))})).catch((function(t){n.handleTransactionError(t)})),[2]}))}))}))},IT.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!f_(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},IT.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget((function(){return e.runWithBackOff(),Promise.resolve()}))):this.deferred.reject(t)},IT.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!q_(e)},IT);function IT(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new d_(this.asyncQueue,lm.RetryTransaction)}var CT="SyncEngine",NT=function(t,e,n){this.query=t,this.targetId=e,this.view=n},AT=function(t){this.key=t,this.receivedDocument=!1},kT=(Object.defineProperty(DT.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),DT.prototype.subscribe=function(t){ay(null!==t,"SyncEngine listener cannot be null"),ay(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},DT.prototype.listen=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i,o;return Fi(this,(function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}}))}))},DT.prototype.initializeViewAndComputeSnapshot=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c;return Fi(this,(function(h){switch(h.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=h.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return i=h.sent(),o=new ET(n,i),a=o.computeDocChanges(r),s=Z_.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==k_.Offline),ay(0===(u=o.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),ay(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new NT(n,t.targetId,o),this.queryViewsByQuery.set(n,c),this.queryViewsByTarget[t.targetId]=c,[2,u.snapshot]}}))}))},DT.prototype.synchronizeViewAndComputeSnapshot=function(t){return Li(this,void 0,void 0,(function(){var e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}}))}))},DT.prototype.unlisten=function(t){return Li(this,void 0,void 0,(function(){var e,n=this;return Fi(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),ay(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then((function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)})).catch(Ow)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},DT.prototype.write=function(t,e){return Li(this,void 0,void 0,(function(){var n;return Fi(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}}))}))},DT.prototype.runTransaction=function(t,e,n){new ST(t,this.remoteStore,e,n).run()},DT.prototype.applyRemoteEvent=function(t){return Li(this,void 0,void 0,(function(){var e,n=this;return Fi(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),gy(t.targetChanges,(function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(ay(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?r.receivedDocument=!0:0<e.modifiedDocuments.size?ay(r.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(ay(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))})),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Ow(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},DT.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===R_.RemoteStore||!this.isPrimary&&e===R_.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach((function(e,r){var i=r.view.applyOnlineStateChange(t);ay(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},DT.prototype.rejectListen=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o,a,s,u=this;return Fi(this,(function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Dm(cm.comparator)).insert(r,new ib(r,Am.forDeletedDoc())),o=Xm().add(r),a=new J_(Am.MIN,{},new Um(qy),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return ay(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then((function(){return u.removeAndCleanupQuery(s)})).catch(Ow)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}}))}))},DT.prototype.applyBatchState=function(t,e,n){return Li(this,void 0,void 0,(function(){var r;return Fi(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(ny(CT,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):oy("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}}))}))},DT.prototype.applySuccessfulWrite=function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ow(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},DT.prototype.rejectFailedWrite=function(t,e){return Li(this,void 0,void 0,(function(){var n;return Fi(this,(function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ow(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},DT.prototype.registerPendingWritesCallback=function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||ny(CT,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?t.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n)),[2]}}))}))},DT.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach((function(t){t.resolve()})),this.pendingWritesCallbacks.delete(t)},DT.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach((function(e){e.forEach((function(e){e.reject(new fy(ly.CANCELLED,t))}))})),this.pendingWritesCallbacks.clear()},DT.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new Dm(qy)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},DT.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(ay(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},DT.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach((function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)}))}},DT.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},DT.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof wT?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof _T?(ny(CT,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):oy("Unknown limbo change: "+JSON.stringify(i))}},DT.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){ny(CT,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=vE.atPath(e.path);this.limboResolutionsByTarget[n]=new AT(e),this.remoteStore.listen(new hw(r,n,iw.LimboResolution,Jy.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},DT.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},DT.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o=this;return Fi(this,(function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach((function(a,s){i.push(Promise.resolve().then((function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then((function(t){return s.view.computeDocChanges(t,e)})):e})).then((function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=gT.fromSnapshot(s.targetId,a.snapshot);r.push(u)}})))})),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}}))}))},DT.prototype.assertSubscribed=function(t){ay(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},DT.prototype.handleCredentialChange=function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}}))}))},DT.prototype.applyPrimaryState=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u=this;return Fi(this,(function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),vy(this.queryViewsByTarget,(function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then((function(){return u.unlisten(e.query)})),u.remoteStore.unlisten(e.targetId)})),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))},DT.prototype.resetLimboDocuments=function(){var t=this;vy(this.limboResolutionsByTarget,(function(e){t.remoteStore.unlisten(e)})),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Dm(cm.comparator)},DT.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i,o,a,s,u,c;return Fi(this,(function(h){switch(h.label){case 0:e=[],n=[],r=0,i=t,h.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return h.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=h.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=h.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return ay(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return ay(!!(c=h.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=h.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:h.sent(),h.label=9;case 9:e.push(a),h.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}}))}))},DT.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},DT.prototype.applyTargetState=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i,o,a,s;return Fi(this,(function(u){switch(u.label){case 0:if(this.isPrimary)return ny(CT,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return u.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=u.sent(),i=J_.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return u.sent(),[3,11];case 4:return function(t){return t.code===ly.DATA_LOSS&&t.message===db}(o=u.sent())?(a=[],vy(this.queryViewsByTarget,(function(t){return a.push(t)})),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)]):[3,6];case 5:return u.sent(),[3,7];case 6:throw o;case 7:return[3,8];case 8:return s=this.queryViewsByTarget[t],this.removeAndCleanupQuery(s),[4,this.localStore.releaseQuery(s.query,!0)];case 9:return u.sent(),this.syncEngineListener.onWatchError(s.query,n),[3,11];case 10:oy("Unexpected target state: "+e),u.label=11;case 11:return[2]}}))}))},DT.prototype.applyActiveTargetsChange=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,h,l=this;return Fi(this,(function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],ay(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return ay(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return Fi(this,(function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then((function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)})).catch(Ow)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}}))}))},DT.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},DT.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},DT.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Xm().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Xm()},DT);function DT(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new cb((function(t){return t.canonicalId()})),this.queryViewsByTarget={},this.limboTargetsByKey=new Dm(cm.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Vw,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=yv.forSyncEngine(),this.isPrimary=void 0,this.onlineState=k_.Unknown}var RT=(OT.prototype.isAuthenticated=function(){return null!=this.uid},OT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},OT.prototype.isEqual=function(t){return t.uid===this.uid},OT.UNAUTHENTICATED=new OT(null),OT.GOOGLE_CREDENTIALS=new OT("google-credentials-uid"),OT.FIRST_PARTY=new OT("first-party-uid"),OT);function OT(t){this.uid=t}var PT="SharedClientState",MT="firestore_clients",xT="firestore_mutations",LT="firestore_targets",FT=(UT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new fy(r.error.code,r.error.message)),i?new UT(t,e,r.state,o):(ry(PT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},UT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},UT);function UT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,ay(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var qT=(VT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new fy(n.error.code,n.error.message)),r?new VT(t,n.state,i):(ry(PT,"Failed to parse target state for ID '"+t+"': "+e),null)},VT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},VT);function VT(t,e,n){this.targetId=t,this.state=e,ay(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var BT=(jT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=$m(),o=0;r&&o<n.activeTargetIds.length;++o)r=p_(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new jT(t,i):(ry(PT,"Failed to parse client data for instance '"+t+"': "+e),null)},jT);function jT(t,e){this.clientId=t,this.activeTargetIds=e}var WT=(QT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in k_&&"string"==typeof e.clientId?new QT(e.clientId,k_[e.onlineState]):(ry(PT,"Failed to parse online state: "+t),null)},QT);function QT(t,e){this.clientId=t,this.onlineState=e}var KT=(HT.prototype.addQueryTarget=function(t){ay(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},HT.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},HT.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},HT);function HT(){this.activeTargetIds=$m()}var GT=(zT.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},zT.prototype.start=function(){return Li(this,void 0,void 0,(function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return Fi(this,(function(f){switch(f.label){case 0:return ay(!this.started,"WebStorageSharedClientState already started"),ay(null!==this.syncEngine,"syncEngine property must be set before calling start()"),ay(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=BT.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},zT.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},zT.prototype.getAllActiveQueryTargets=function(){var t=$m();return gy(this.activeClients,(function(e,n){t=t.unionWith(n.activeTargetIds)})),t},zT.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},zT.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},zT.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},zT.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=qT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},zT.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},zT.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},zT.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},zT.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},zT.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.removeMutationState(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},zT.prototype.setOnlineState=function(t){this.persistOnlineState(t)},zT.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},zT.prototype.getItem=function(t){var e=this.storage.getItem(t);return ny(PT,"READ",t,e),e},zT.prototype.setItem=function(t,e){ny(PT,"SET",t,e),this.storage.setItem(t,e)},zT.prototype.removeItem=function(t){ny(PT,"REMOVE",t),this.storage.removeItem(t)},zT.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(ny(PT,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void ry("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget((function(){return Li(e,void 0,void 0,(function(){var e,n,r,i,o,a;return Fi(this,(function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(ay(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Jy.INVALID;if(null!=t)try{var n=JSON.parse(t);ay("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){ry(PT,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Jy.INVALID&&this.sequenceNumberHandler(a));return[2]}))}))}))}},Object.defineProperty(zT.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),zT.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},zT.prototype.persistMutationState=function(t,e,n){var r=new FT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},zT.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},zT.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:k_[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},zT.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new qT(t,e,n);this.setItem(r,i.toWebStorageJSON())},zT.prototype.toWebStorageClientStateKey=function(t){return ay(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),MT+"_"+this.persistenceKey+"_"+t},zT.prototype.toWebStorageQueryTargetMetadataKey=function(t){return LT+"_"+this.persistenceKey+"_"+t},zT.prototype.toWebStorageMutationBatchKey=function(t){var e=xT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},zT.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},zT.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return ay(null!==n,"Cannot parse client state key '"+t+"'"),BT.fromWebStorageEntry(n,e)},zT.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);ay(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return FT.fromWebStorageEntry(new RT(i),r,e)},zT.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);ay(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return qT.fromWebStorageEntry(r,e)},zT.prototype.fromWebStorageOnlineState=function(t){return WT.fromWebStorageEntry(t)},zT.prototype.handleMutationBatchEvent=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){return t.user.uid!==this.currentUser.uid?(ny(PT,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]}))}))},zT.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},zT.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach((function(t){return Li(n,void 0,void 0,(function(){return Fi(this,(function(e){return r.has(t)||o.push(t),[2]}))}))})),r.forEach((function(t){return Li(n,void 0,void 0,(function(){return Fi(this,(function(e){return i.has(t)||a.push(t),[2]}))}))})),this.syncEngine.applyActiveTargetsChange(o,a)},zT.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},zT);function zT(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!zT.isAvailable(this.platform))throw new fy(ly.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new KT,this.clientStateKeyRe=new RegExp("^"+MT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+xT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+LT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var YT=(XT.prototype.addPendingMutation=function(t){},XT.prototype.updateMutationState=function(t,e,n){},XT.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},XT.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},XT.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},XT.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},XT.prototype.clearQueryState=function(t){delete this.queryState[t]},XT.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},XT.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},XT.prototype.start=function(){return this.localState=new KT,Promise.resolve()},XT.prototype.handleUserChange=function(t,e,n){},XT.prototype.setOnlineState=function(t){},XT.prototype.shutdown=function(){},XT.prototype.writeSequenceNumber=function(t){},XT);function XT(){this.localState=new KT,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var JT="FirestoreClient",$T=(ZT.prototype.lruParams=function(){return gw.withCacheSize(this.cacheSizeBytes)},ZT);function ZT(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var tS=function(){},eS=(nS.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new pm,r=new pm,i=!1;return this.credentials.setChangeListener((function(o){i?e.asyncQueue.enqueueAndForget((function(){return e.handleCredentialChange(o)})):(i=!0,e.initializePersistence(t,r,o).then((function(t){return e.initializeRest(o,t)})).then(n.resolve,n.reject))})),this.asyncQueue.enqueueAndForget((function(){return n.promise})),r.promise},nS.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.enableNetwork()}))},nS.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof $T?this.startIndexedDbPersistence(n,t).then((function(t){return e.resolve(),t})).catch((function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()})):(e.resolve(),this.startMemoryPersistence())},nS.prototype.canFallback=function(t){return t instanceof fy?t.code===ly.FAILED_PRECONDITION||t.code===ly.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},nS.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new fy(ly.FAILED_PRECONDITION,"The client has already been terminated.")},nS.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Dw.buildStoragePrefix(this.databaseInfo),i=new lT(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then((function(){return Li(n,void 0,void 0,(function(){var n,o;return Fi(this,(function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!GT.isAvailable(this.platform))throw new fy(ly.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new GT(this.asyncQueue,this.platform,r,this.clientId,t):new YT,[4,Dw.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return o=a.sent(),[2,(this.persistence=o).referenceDelegate.garbageCollector]}}))}))}))},nS.prototype.startMemoryPersistence=function(){return this.persistence=e_.createEagerPersistence(this.clientId),this.sharedClientState=new YT,Promise.resolve(null)},nS.prototype.initializeRest=function(t,e){var n=this;return ny(JT,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then((function(r){return Li(n,void 0,void 0,(function(){var n,i,o,a,s,u=this;return Fi(this,(function(c){switch(c.label){case 0:return this.localStore=new Kw(this.persistence,t),e&&(this.lruScheduler=new ww(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),i=this.platform.newSerializer(this.databaseInfo.databaseId),o=new N_(this.asyncQueue,r,this.credentials,i),a=function(t){return u.syncEngine.applyOnlineStateChange(t,R_.RemoteStore)},s=function(t){return u.syncEngine.applyOnlineStateChange(t,R_.SharedClientState)},this.remoteStore=new pE(this.localStore,o,this.asyncQueue,a,n),this.syncEngine=new kT(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new dT(this.syncEngine),[4,this.sharedClientState.start()];case 1:return c.sent(),[4,this.remoteStore.start()];case 2:return c.sent(),[4,this.persistence.setPrimaryStateListener((function(t){return Li(u,void 0,void 0,(function(){return Fi(this,(function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}}))}))}))];case 3:return c.sent(),[4,this.persistence.setDatabaseDeletedListener((function(){return Li(u,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 4:return c.sent(),[2]}}))}))}))},nS.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),ny(JT,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},nS.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.disableNetwork()}))},nS.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return Li(t,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}}))}))}))},nS.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new pm;return this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.registerPendingWritesCallback(e)})),e.promise},nS.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new mT(t,e,n);return this.asyncQueue.enqueueAndForget((function(){return r.eventMgr.listen(i)})),i},nS.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.unlisten(t)}))},nS.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.readDocument(t)})).then((function(t){if(t instanceof eb)return t;if(t instanceof ib)return null;throw new fy(ly.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},nS.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.executeQuery(t)})).then((function(e){var n=Xm(),r=new ET(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot}))},nS.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new pm;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.write(t,n)})),n.promise},nS.prototype.databaseId=function(){return this.databaseInfo.databaseId},nS.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()}))},nS.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(nS.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),nS.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new pm;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()})),n.promise},nS);function nS(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Fy.newId()}var rS=(iS.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},iS.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},iS.prototype.mute=function(){this.muted=!0},iS.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},iS);function iS(t){this.observer=t,this.muted=!1}var oS=(aS.documentId=function(){return aS._DOCUMENT_ID},aS.prototype.isEqual=function(t){if(!(t instanceof aS))throw My("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},aS._DOCUMENT_ID=new aS(sm.keyField().canonicalString()),aS);function aS(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new fy(ly.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Ly(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(Sy("FieldPath","string",n,t[n]),0===t[n].length)throw new fy(ly.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sm(t)}var sS=new RegExp("[~\\*/\\[\\]]"),uS=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},cS=(hS.prototype.getToken=function(){return Promise.resolve(null)},hS.prototype.invalidateToken=function(){},hS.prototype.setChangeListener=function(t){ay(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(RT.UNAUTHENTICATED)},hS.prototype.removeChangeListener=function(){ay(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},hS);function hS(){this.changeListener=null}var lS=(fS.prototype.getToken=function(){var t=this;ay(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then((function(n){if(t.tokenCounter!==e)throw new fy(ly.ABORTED,"getToken aborted due to token change.");return n?(ay("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new uS(n.accessToken,t.currentUser)):null}))},fS.prototype.invalidateToken=function(){this.forceRefresh=!0},fS.prototype.setChangeListener=function(t){ay(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(this.currentUser)},fS.prototype.removeChangeListener=function(){ay(null!=this.tokenListener,"removeChangeListener() called twice"),ay(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},fS.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return ay(null===t||"string"==typeof t,"Received invalid UID: "+t),new RT(t)},fS);function fS(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=RT.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.currentUser=this.getUser(),this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var pS=(Object.defineProperty(dS.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),dS);function dS(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=RT.FIRST_PARTY}var yS=(mS.prototype.getToken=function(){return Promise.resolve(new pS(this.gapi,this.sessionIndex))},mS.prototype.setChangeListener=function(t){t(RT.FIRST_PARTY)},mS.prototype.removeChangeListener=function(){},mS.prototype.invalidateToken=function(){},mS);function mS(t,e){this.gapi=t,this.sessionIndex=e}function vS(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var gS=(bS.delete=function(){return wy("FieldValue.delete",arguments),_S.instance},bS.serverTimestamp=function(){return wy("FieldValue.serverTimestamp",arguments),SS.instance},bS.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ey("FieldValue.arrayUnion",arguments,1),new NS(t)},bS.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ey("FieldValue.arrayRemove",arguments,1),new DS(t)},bS.increment=function(t){return Sy("FieldValue.increment","number",1,t),_y("FieldValue.increment",arguments,1),new PS(t)},bS.prototype.isEqual=function(t){return this===t},bS);function bS(t){this._methodName=t}var wS,_S=(Mi(ES,wS=gS),ES.instance=new ES,ES);function ES(){return wS.call(this,"FieldValue.delete")||this}var TS,SS=(Mi(IS,TS=gS),IS.instance=new IS,IS);function IS(){return TS.call(this,"FieldValue.serverTimestamp")||this}var CS,NS=(Mi(AS,CS=gS),AS);function AS(t){var e=CS.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var kS,DS=(Mi(RS,kS=gS),RS);function RS(t){var e=kS.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var OS,PS=(Mi(MS,OS=gS),MS);function MS(t){var e=OS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var xS=dy(gS,"Use FieldValue.<field>() instead."),LS=/^__.*__$/,FS=(US.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Xv(t,this.data,this.fieldMask,e)):n.push(new Gv(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Zv(t,this.fieldTransforms)),n},US);function US(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var qS,VS,BS=(jS.prototype.toMutations=function(t,e){var n=[new Xv(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Zv(t,this.fieldTransforms)),n},jS);function jS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function WS(t){switch(t){case qS.Set:case qS.MergeSet:case qS.Update:return!0;case qS.Argument:return!1;default:throw oy("Unexpected case for UserDataSource: "+t)}}(VS=qS=qS||{})[VS.Set=0]="Set",VS[VS.Update=1]="Update",VS[VS.MergeSet=2]="MergeSet",VS[VS.Argument=3]="Argument";var QS=(KS.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new KS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},KS.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new KS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},KS.prototype.childContextForArray=function(t){return new KS(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},KS.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new fy(ly.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},KS.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},KS.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},KS.prototype.validatePathSegment=function(t){if(WS(this.dataSource)&&LS.test(t))throw this.createError("Document fields cannot begin and end with __")},KS);function KS(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var HS=function(t,e){this.databaseId=t,this.key=e},GS=(zS.prototype.parseSetData=function(t,e){var n=new QS(qS.Set,t,sm.EMPTY_PATH);XS("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new FS(r,null,n.fieldTransforms)},zS.prototype.parseMergeData=function(t,e,n){var r=new QS(qS.MergeSet,t,sm.EMPTY_PATH);XS("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Um(sm.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof oS)l=h._internalPath;else{if("string"!=typeof h)throw oy("Expected stringOrFieldPath to be a string or a FieldPath");l=$S(t,h)}if(!r.contains(l))throw new fy(ly.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=xv.fromSet(s),o=r.fieldTransforms.filter((function(t){return i.covers(t.field)}))}else i=xv.fromArray(r.fieldMask),o=r.fieldTransforms;return new FS(a,i,o)},zS.prototype.parseUpdateData=function(t,e){var n=this,r=new QS(qS.Update,t,sm.EMPTY_PATH);XS("Data must be an object, but it was:",r,e);var i=new Um(sm.comparator),o=Gg.EMPTY;gy(e,(function(e,a){var s=$S(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof _S)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}}));var a=xv.fromSet(i);return new BS(o,a,r.fieldTransforms)},zS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new QS(qS.Update,t,sm.EMPTY_PATH),o=[JS(t,e)],a=[n];if(r.length%2!=0)throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(JS(t,r[s])),a.push(r[s+1]);var u=new Um(sm.comparator),c=Gg.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof _S)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=xv.fromSet(u);return new BS(c,d,i.fieldTransforms)},zS.prototype.parseQueryValue=function(t,e){var n=new QS(qS.Argument,t,sm.EMPTY_PATH),r=this.parseData(e,n);return ay(null!=r,"Parsed data should not be null."),ay(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},zS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=ZS(t);throw e.createError(n)}},zS.prototype.parseData=function(t,e){if(YS(t=this.runPreConverter(t,e)))return XS("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof gS)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},zS.prototype.parseObject=function(t,e){var n=this,r=new Dm(qy);return by(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):gy(t,(function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))})),new Gg(r)},zS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=pg.INSTANCE),n.push(s),r++}return new Xg(n)},zS.prototype.parseSentinelFieldValue=function(t,e){if(!WS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof _S){if(e.dataSource!==qS.MergeSet)throw e.dataSource===qS.Update?(ay(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof SS)e.fieldTransforms.push(new Fv(e.path,GE.instance));else if(t instanceof NS){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new YE(n);e.fieldTransforms.push(new Fv(e.path,r))}else if(t instanceof DS){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new JE(n);e.fieldTransforms.push(new Fv(e.path,i))}else if(t instanceof PS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new ZE(o);e.fieldTransforms.push(new Fv(e.path,a))}else oy("Unknown FieldValue type: "+t)},zS.prototype.parseScalarValue=function(t,e){if(null===t)return pg.INSTANCE;if("number"==typeof t)return p_(t)?new Tg(t):new Cg(t);if("boolean"==typeof t)return mg.of(t);if("string"==typeof t)return new kg(t);if(t instanceof Date)return new Og(Cm.fromDate(t));if(t instanceof Cm)return new Og(new Cm(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof yE)return new Qg(t);if(t instanceof Qy)return new Ug(t);if(t instanceof HS)return new Bg(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Ry(t))},zS.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map((function(e,r){var i=new QS(qS.Argument,t,sm.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))}))},zS);function zS(t){this.preConverter=t}function YS(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Cm||t instanceof yE||t instanceof Qy||t instanceof HS||t instanceof gS)}function XS(t,e,n){if(!YS(n)||!Dy(n)){var r=Ry(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function JS(t,e){if(e instanceof oS)return e._internalPath;if("string"==typeof e)return $S(t,e);throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function $S(t,e){try{return function(t){if(0<=t.search(sS))throw new fy(ly.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(oS.bind.apply(oS,[void 0].concat(t.split("."))))}catch(e){throw new fy(ly.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=ZS(e);throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function ZS(t){return t instanceof Error?t.message:t.toString()}var tI=gw.COLLECTION_DISABLED,eI=(nI.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},nI);function nI(t){if(void 0===t.host){if(void 0!==t.ssl)throw new fy(ly.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Cy("settings","non-empty string","host",t.host),this.host=t.host,Ny("settings","boolean","ssl",t.ssl),this.ssl=my(t.ssl,!0);if(Py("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ny("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ny("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?ry("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&ry("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=my(t.timestampsInSnapshots,!0),Ny("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=gw.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==tI&&t.cacheSizeBytes<gw.MINIMUM_CACHE_SIZE_BYTES)throw new fy(ly.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+gw.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Ny("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var rI=(iI.prototype.settings=function(t){if(_y("Firestore.settings",arguments,1),Sy("Firestore.settings","object",1,t),yy(t,"persistence"))throw new fy(ly.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new eI(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new fy(ly.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new cS;switch(t.type){case"gapi":var e=t.client;return ay(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new yS(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new fy(ly.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},iI.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},iI.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},iI.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new fy(ly.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&ry("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=my(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new $T(this._settings.cacheSizeBytes,e))},iI.prototype.clearPersistence=function(){var t=this,e=Dw.buildStoragePrefix(this.makeDatabaseInfo()),n=new pm;return this._queue.enqueueAndForgetEvenAfterShutdown((function(){return Li(t,void 0,void 0,(function(){var t;return Fi(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new fy(ly.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Dw.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}}))}))})),n.promise},iI.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(iI.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),iI.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},iI.prototype._onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),vS(t))return this.onSnapshotsInSyncInternal(t);Sy("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},iI.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new rS({next:function(){t.next&&t.next()},error:function(t){throw oy("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},iI.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new tS),this._firestoreClient},iI.prototype.makeDatabaseInfo=function(){return new Gy(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},iI.prototype.configureClient=function(t){ay(!!this._settings.host,"FirestoreSettings.host is not set"),ay(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new eS(sy.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},iI.prototype.createDataConverter=function(t){return new GS((function(e){if(e instanceof cI){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new fy(ly.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new HS(t,e._key)}return e}))},iI.databaseIdFromApp=function(t){var e=t.options;if(!yy(e,"projectId"))throw new fy(ly.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new fy(ly.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Yy(n)},Object.defineProperty(iI.prototype,"app",{get:function(){if(!this._firebaseApp)throw new fy(ly.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),iI.prototype.collection=function(t){return _y("Firestore.collection",arguments,1),Sy("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new TI(rm.fromString(t),this)},iI.prototype.doc=function(t){return _y("Firestore.doc",arguments,1),Sy("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),cI.forPath(rm.fromString(t),this)},iI.prototype.collectionGroup=function(t){if(_y("Firestore.collectionGroup",arguments,1),Sy("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new fy(ly.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new gI(new vE(rm.EMPTY_PATH,t),this)},iI.prototype.runTransaction=function(t){var e=this;return _y("Firestore.runTransaction",arguments,1),Sy("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction((function(n){return t(new oI(e,n))}))},iI.prototype.batch=function(){return this.ensureClientConfigured(),new sI(this)},Object.defineProperty(iI,"logLevel",{get:function(){switch(ty()){case Qd.DEBUG:return"debug";case Qd.ERROR:return"error";case Qd.SILENT:return"silent";default:return oy("Unknown log level: "+ty())}},enumerable:!0,configurable:!0}),iI.setLogLevel=function(t){switch(_y("Firestore.setLogLevel",arguments,1),Sy("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":ey(Qd.DEBUG);break;case"error":ey(Qd.ERROR);break;case"silent":ey(Qd.SILENT);break;default:throw new fy(ly.INVALID_ARGUMENT,"Invalid log level: "+t)}},iI.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},iI);function iI(t){var e=this;if(this._firebaseApp=null,this._queue=new mm,this.INTERNAL={delete:function(){return Li(e,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=iI.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new lS(n)}else{var r=t;if(!r.projectId)throw new fy(ly.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Yy(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new cS}this._settings=new eI({}),this._dataConverter=this.createDataConverter(this._databaseId)}var oI=(aI.prototype.get=function(t){var e=this;_y("Transaction.get",arguments,1);var n=AI("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return oy("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof ib)return new pI(e._firestore,n._key,null,!1,!1);if(r instanceof eb)return new pI(e._firestore,n._key,r,!1,!1);throw oy("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},aI.prototype.set=function(t,e,n){Ty("Transaction.set",arguments,2,3);var r=AI("Transaction.set",t,this._firestore),i=(n=II("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},aI.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof oS?(Ey("Transaction.update",arguments,3),r=AI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(_y("Transaction.update",arguments,2),r=AI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},aI.prototype.delete=function(t){_y("Transaction.delete",arguments,1);var e=AI("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},aI);function aI(t,e){this._firestore=t,this._transaction=e}var sI=(uI.prototype.set=function(t,e,n){Ty("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=AI("WriteBatch.set",t,this._firestore),i=(n=II("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,jv.NONE)),this},uI.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof oS?(Ey("WriteBatch.update",arguments,3),r=AI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(_y("WriteBatch.update",arguments,2),r=AI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,jv.exists(!0))),this},uI.prototype.delete=function(t){_y("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=AI("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new ag(e._key,jv.NONE)),this},uI.prototype.commit=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]}))}))},uI.prototype.verifyNotCommitted=function(){if(this._committed)throw new fy(ly.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},uI);function uI(t){this._firestore=t,this._mutations=[],this._committed=!1}var cI=(hI.forPath=function(t,e){if(t.length%2!=0)throw new fy(ly.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new hI(new cm(t),e)},Object.defineProperty(hI.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(hI.prototype,"parent",{get:function(){return new TI(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(hI.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),hI.prototype.collection=function(t){if(_y("DocumentReference.collection",arguments,1),Sy("DocumentReference.collection","non-empty string",1,t),!t)throw new fy(ly.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=rm.fromString(t);return new TI(this._key.path.child(e),this.firestore)},hI.prototype.isEqual=function(t){if(!(t instanceof hI))throw My("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},hI.prototype.set=function(t,e){Ty("DocumentReference.set",arguments,1,2);var n=(e=II("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,jv.NONE))},hI.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof oS?(Ey("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(_y("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,jv.exists(!0)))},hI.prototype.delete=function(){return _y("DocumentReference.delete",arguments,0),this._firestoreClient.write([new ag(this._key,jv.NONE)])},hI.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ty("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||vS(t[i])||(Py("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ny("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=vS(t[i])?t[i]:(Sy("DocumentReference.onSnapshot","function",i,t[i]),Iy("DocumentReference.onSnapshot","function",i+1,t[i+1]),Iy("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},hI.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new rS({next:function(t){if(e.next){ay(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new pI(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(vE.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},hI.prototype.get=function(t){var e=this;return Ty("DocumentReference.get",arguments,0,1),NI("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then((function(t){n(new pI(e.firestore,e._key,t,!0,t instanceof eb&&t.hasLocalMutations))}),r):e.getViaSnapshotListener(n,r,t)}))},hI.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new fy(ly.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new fy(ly.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},hI);function hI(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var lI=(fI.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},fI);function fI(t,e){this.hasPendingWrites=t,this.fromCache=e}var pI=(dI.prototype.data=function(t){return Ty("DocumentSnapshot.data",arguments,0,1),t=CI("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),ug.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},dI.prototype.get=function(t,e){if(Ty("DocumentSnapshot.get",arguments,1,2),e=CI("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(JS("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,ug.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(dI.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(dI.prototype,"ref",{get:function(){return new cI(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(dI.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(dI.prototype,"metadata",{get:function(){return new lI(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),dI.prototype.isEqual=function(t){if(!(t instanceof dI))throw My("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},dI.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.convertValue(i,e)})),r},dI.prototype.convertValue=function(t,e){if(t instanceof Gg)return this.convertObject(t,e);if(t instanceof Xg)return this.convertArray(t,e);if(t instanceof Bg){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||ry("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new cI(n,this._firestore)}return t.value(e)},dI.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map((function(t){return n.convertValue(t,e)}))},dI);function dI(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var yI,mI=(Mi(vI,yI=pI),vI.prototype.data=function(t){var e=yI.prototype.data.call(this,t);return ay("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},vI);function vI(){return null!==yI&&yI.apply(this,arguments)||this}var gI=(bI.prototype.where=function(t,e,n){_y("Query.where",arguments,3),Oy("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some((function(t){return t===r})))throw new fy(ly.INVALID_ARGUMENT,"Invalid value "+Ry(r)+" provided to function Query.where() for its "+xy(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains"],0,e);var r,i=JS("Query.where",t),o=bE.fromString(e);if(i.isKeyField()){if(o===bE.ARRAY_CONTAINS||o===bE.ARRAY_CONTAINS_ANY)throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===bE.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Xg(a)}else r=this.parseDocumentIdValue(n)}else o!==bE.IN&&o!==bE.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=EE.create(i,o,r);return this.validateNewFilter(h),new bI(this._query.addFilter(h),this.firestore)},bI.prototype.orderBy=function(t,e){var n;if(Ty("Query.orderBy",arguments,1,2),Iy("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=qE.ASCENDING;else{if("desc"!==e)throw new fy(ly.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=qE.DESCENDING}if(null!==this._query.startAt)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=JS("Query.orderBy",t),i=new WE(r,n);return this.validateNewOrderBy(i),new bI(this._query.addOrderBy(i),this.firestore)},bI.prototype.limit=function(t){if(_y("Query.limit",arguments,1),Sy("Query.limit","number",1,t),t<=0)throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new bI(this._query.withLimit(t),this.firestore)},bI.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ey("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new bI(this._query.withStartAt(r),this.firestore)},bI.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ey("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new bI(this._query.withStartAt(r),this.firestore)},bI.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ey("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new bI(this._query.withEndAt(r),this.firestore)},bI.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ey("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new bI(this._query.withEndAt(r),this.firestore)},bI.prototype.isEqual=function(t){if(!(t instanceof bI))throw My("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},bI.prototype.boundFromDocOrFields=function(t,e,n,r){if(Oy(t,1,e),e instanceof pI){if(0<n.length)throw new fy(ly.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new fy(ly.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},bI.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Bg(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof xg)throw new fy(ly.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new fy(ly.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new BE(r,n)},bI.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new fy(ly.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(rm.fromString(a));if(!cm.isDocumentKey(s))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new cm(s);i.push(new Bg(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new BE(i,n)},bI.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ty("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||vS(t[i])||(Py("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ny("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=vS(t[i])?t[i]:(Sy("Query.onSnapshot","function",i,t[i]),Iy("Query.onSnapshot","function",i+1,t[i+1]),Iy("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},bI.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new rS({next:function(t){e.next&&e.next(new wI(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},bI.prototype.get=function(t){var e=this;return Ty("Query.get",arguments,0,1),NI("Query.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then((function(t){n(new wI(e.firestore,e._query,t))}),r):e.getViaSnapshotListener(n,r,t)}))},bI.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new fy(ly.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},bI.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(rm.fromString(t));if(!cm.isDocumentKey(e))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Bg(this.firestore._databaseId,new cm(e))}if(t instanceof cI){var n=t;return new Bg(this.firestore._databaseId,n._key)}throw new fy(ly.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ry(t)+".")},bI.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new fy(ly.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},bI.prototype.validateNewFilter=function(t){if(t instanceof EE){var e=[bE.ARRAY_CONTAINS,bE.ARRAY_CONTAINS_ANY],n=[bE.IN,bE.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new fy(ly.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new fy(ly.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},bI.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},bI.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new fy(ly.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},bI);function bI(t,e){this._query=t,this.firestore=e}var wI=(Object.defineProperty(_I.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(_I.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(_I.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),_I.prototype.forEach=function(t,e){var n=this;Ty("QuerySnapshot.forEach",arguments,1,2),Sy("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach((function(r){t.call(e,n.convertToDocumentImpl(r))}))},Object.defineProperty(_I.prototype,"query",{get:function(){return new gI(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),_I.prototype.docChanges=function(t){t&&(Py("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ny("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new fy(ly.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map((function(e){var o=new mI(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return ay(e.type===B_.Added,"Invalid event type for first snapshot"),ay(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}}))}var o=n.oldDocs;return n.docChanges.filter((function(t){return e||t.type!==B_.Metadata})).map((function(e){var r=new mI(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==B_.Added&&(ay(0<=(i=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),e.type!==B_.Removed&&(a=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case B_.Added:return"added";case B_.Modified:case B_.Metadata:return"modified";case B_.Removed:return"removed";default:return oy("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:a}}))}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},_I.prototype.isEqual=function(t){if(!(t instanceof _I))throw My("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},_I.prototype.convertToDocumentImpl=function(t){return new mI(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},_I);function _I(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new lI(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(wI.prototype.docChanges,t,{get:function(){return function(){throw new fy(ly.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var EI,TI=(Mi(SI,EI=gI),Object.defineProperty(SI.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(SI.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new cI(new cm(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(SI.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),SI.prototype.doc=function(t){if(Ty("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Fy.newId()),Sy("CollectionReference.doc","non-empty string",1,t),""===t)throw new fy(ly.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=rm.fromString(t);return cI.forPath(this._query.path.child(e),this.firestore)},SI.prototype.add=function(t){_y("CollectionReference.add",arguments,1),Sy("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then((function(){return e}))},SI);function SI(t,e){var n=EI.call(this,vE.atPath(t),e)||this;if(t.length%2!=1)throw new fy(ly.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function II(t,e){if(void 0===e)return{merge:!1};if(Py(t,e,["merge","mergeFields"]),Ny(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ry(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new fy(ly.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Ry(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,(function(t){return"string"==typeof t||t instanceof oS})),void 0!==e.mergeFields&&void 0!==e.merge)throw new fy(ly.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function CI(t,e){return void 0===e?{}:(Py(t,e,["serverTimestamps"]),Ay(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function NI(t,e){Iy(t,"object",1,e),e&&(Py(t,e,["source"]),Ay(t,0,"source",e.source,["default","server","cache"]))}function AI(t,e,n){if(e instanceof cI){if(e.firestore!==n)throw new fy(ly.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw My(t,"DocumentReference",1,e)}var kI=dy(rI,"Use firebase.firestore() instead."),DI=dy(oI,"Use firebase.firestore().runTransaction() instead."),RI=dy(sI,"Use firebase.firestore().batch() instead."),OI=dy(cI,"Use firebase.firestore().doc() instead."),PI=dy(pI),MI=dy(mI),xI=dy(gI),LI=dy(wI),FI=dy(TI,"Use firebase.firestore().collection() instead."),UI={Firestore:kI,GeoPoint:yE,Timestamp:Cm,Blob:Hy,Transaction:DI,WriteBatch:RI,DocumentReference:OI,DocumentSnapshot:PI,Query:xI,QueryDocumentSnapshot:MI,QuerySnapshot:LI,CollectionReference:FI,FieldPath:oS,FieldValue:xS,setLogLevel:rI.setLogLevel,CACHE_SIZE_UNLIMITED:tI},qI=(VI.prototype.addCallback=function(t){},VI.prototype.shutdown=function(){},VI);function VI(){}var BI="ConnectivityMonitor",jI=(WI.prototype.addCallback=function(t){this.callbacks.push(t)},WI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},WI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},WI.prototype.onNetworkAvailable=function(){ny(BI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},WI.prototype.onNetworkUnavailable=function(){ny(BI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},WI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},WI);function WI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var QI=(KI.prototype.onOpen=function(t){ay(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},KI.prototype.onClose=function(t){ay(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},KI.prototype.onMessage=function(t){ay(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},KI.prototype.close=function(){this.closeFn()},KI.prototype.send=function(t){this.sendFn(t)},KI.prototype.callOnOpen=function(){ay(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},KI.prototype.callOnClose=function(t){ay(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},KI.prototype.callOnMessage=function(t){ay(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},KI);function KI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var HI="Connection",GI={BatchGetDocuments:"batchGet",Commit:"commit"},zI="gl-js/ fire/"+$d,YI=(XI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=zI},XI.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise((function(o,a){var s=new Jd;s.listenOnce(Yd.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case zd.NO_ERROR:var e=s.getResponseJson();ny(HI,"XHR received:",JSON.stringify(e)),o(e);break;case zd.TIMEOUT:ny(HI,'RPC "'+t+'" timed out'),a(new fy(ly.DEADLINE_EXCEEDED,"Request time out"));break;case zd.HTTP_ERROR:var n=s.getStatus();if(ny(HI,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(ly).indexOf(e)?e:ly.UNKNOWN}(r.status);a(new fy(i,r.message))}else a(new fy(ly.UNKNOWN,"Server responded with status "+s.getStatus()))}else ny(HI,'RPC "'+t+'" failed'),a(new fy(ly.UNAVAILABLE,"Connection failed."));break;default:oy('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{ny(HI,'RPC "'+t+'" completed.')}}));var u=JSON.stringify(e);ny(HI,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)}))},XI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},XI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Gd(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Zi()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}ny(HI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new QI({sendFn:function(t){c?ny(HI,"Not sending because WebChannel is closed:",t):(u||(ny(HI,"Opening WebChannel transport."),s.open(),u=!0),ny(HI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Xd.EventType.OPEN,(function(){c||ny(HI,"WebChannel transport opened.")})),a(Xd.EventType.CLOSE,(function(){c||(c=!0,ny(HI,"WebChannel transport closed"),h.callOnClose())})),a(Xd.EventType.ERROR,(function(t){c||(c=!0,ny(HI,"WebChannel transport errored:",t),h.callOnClose(new fy(ly.UNAVAILABLE,"The operation could not be completed")))})),a(Xd.EventType.MESSAGE,(function(t){if(!c){var e=t.data[0];ay(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){ny(HI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=x_[t];if(void 0!==e)return V_(e)}(i),a=r.message;void 0===o&&(o=ly.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new fy(o,a)),s.close()}else ny(HI,"WebChannel received:",e),h.callOnMessage(e)}})),setTimeout((function(){h.callOnOpen()}),0),h},XI.prototype.makeUrl=function(t){var e=GI[t];ay(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},XI);function XI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var JI=(Object.defineProperty($I.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty($I.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),$I.prototype.loadConnection=function(t){return Promise.resolve(new YI(t))},$I.prototype.newConnectivityMonitor=function(){return jI.isAvailable()?new jI:new qI},$I.prototype.newSerializer=function(t){return new lT(t,{useProto3Json:!0})},$I.prototype.formatJSON=function(t){return JSON.stringify(t)},$I.prototype.atob=function(t){return atob(t)},$I.prototype.btoa=function(t){return btoa(t)},$I);function $I(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}sy.setPlatform(new JI),function(t){t.INTERNAL.registerService("firestore",(function(t){return new rI(t)}),function(t){ay(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(UI))}(Wo);var ZI,tC={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},eC=(Mi(nC,ZI=Error),nC);function nC(t,e,n){var r=ZI.call(this,e)||this;return Object.setPrototypeOf(r,nC.prototype),r.code=t,r.details=n,r}var rC=(iC.prototype.getAuthToken=function(){return Li(this,void 0,void 0,(function(){var t;return Fi(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}}))}))},iC.prototype.getInstanceIdToken=function(){return Li(this,void 0,void 0,(function(){var t;return Fi(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}}))}))},iC.prototype.getContext=function(){return Li(this,void 0,void 0,(function(){var t,e;return Fi(this,(function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}}))}))},iC);function iC(t){this.app=t}function oC(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var aC=(sC.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map((function(t){return e.encode(t)}));if("function"==typeof t||"object"==typeof t)return oC(t,(function(t){return e.encode(t)}));throw new Error("Data cannot be encoded in JSON: "+t)},sC.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map((function(t){return e.decode(t)})):"function"==typeof t||"object"==typeof t?oC(t,(function(t){return e.decode(t)})):t},sC);function sC(){}var uC,cC,hC=(Object.defineProperty(lC.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),lC.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},lC.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},lC.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},lC.prototype.postJSON=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i;return Fi(this,(function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}}))}))},lC.prototype.call=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,h;return Fi(this,(function(l){switch(l.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=l.sent()).authToken&&o.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&o.append("Firebase-Instance-ID-Token",a.instanceIdToken),s=n.timeout||7e4,[4,Promise.race([this.postJSON(r,i,o),function(t){return new Promise((function(e,n){setTimeout((function(){n(new eC("deadline-exceeded","deadline-exceeded"))}),t)}))}(s),this.cancelAllRequests])];case 2:if(!(u=l.sent()))throw new eC("cancelled","Firebase Functions instance was deleted.");if(c=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!tC[s])return new eC("internal","internal");r=tC[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new eC(r,i,o)}(u.status,u.json,this.serializer))throw c;if(!u.json)throw new eC("internal","Response is not valid JSON object.");if(void 0===(h=u.json.data)&&(h=u.json.result),void 0===h)throw new eC("internal","Response is missing data field.");return[2,{data:this.serializer.decode(h)}]}}))}))},lC);function lC(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new aC,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new rC(t),this.cancelAllRequests=new Promise((function(t){n.deleteService=function(){return t()}}))}uC={Functions:hC},Wo.INTERNAL.registerService("functions",(function(t,e,n){return new hC(t,n)}),uC,void 0,!0);var fC,pC,dC,yC,mC=((cC={})["only-available-in-window"]="This method is available in a Window context.",cC["only-available-in-sw"]="This method is available in a service worker context.",cC["should-be-overriden"]="This method should be overriden by extended classes.",cC["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",cC["permission-default"]="The required permissions were not granted and dismissed instead.",cC["permission-blocked"]="The required permissions were not granted and blocked instead.",cC["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",cC["notifications-blocked"]="Notifications have been blocked.",cC["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",cC["sw-registration-expected"]="A service worker registration was the expected input.",cC["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",cC["invalid-saved-token"]="Unable to access details of the saved token.",cC["sw-reg-redundant"]="The service worker being used for push was made redundant.",cC["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",cC["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",cC["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",cC["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",cC["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",cC["token-update-no-token"]="FCM returned no token when updating the user to push.",cC["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",cC["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",cC["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",cC["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",cC["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",cC["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",cC["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",cC["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",cC["failed-to-delete-token"]="Unable to delete the currently saved token.",cC["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",cC["bad-scope"]="The service worker scope must be a string with at least one character.",cC["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",cC["bad-subscription"]="The subscription must be a valid PushSubscription.",cC["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",cC["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",cC["failed-delete-vapid-key"]="The VAPID key could not be deleted.",cC["invalid-public-vapid-key"]="The public VAPID key must be a string.",cC["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",cC["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",cC),vC=new io("messaging","Messaging",mC),gC=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),bC="https://fcm.googleapis.com";function wC(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function _C(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,Vi(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(pC=fC=fC||{}).TYPE_OF_MSG="firebase-messaging-msg-type",pC.DATA="firebase-messaging-msg-data",(yC=dC=dC||{}).PUSH_MSG_RECEIVED="push-msg-received",yC.NOTIFICATION_CLICKED="notification-clicked";var EC=(TC.prototype.getToken=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,h,l;return Fi(this,(function(f){switch(f.label){case 0:r=_C(e.getKey("p256dh")),i=_C(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,wC(n.buffer,gC.buffer)||(a=_C(n),o+="&application_pub_key="+a),(s=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:s,body:o},f.label=1;case 1:return f.trys.push([1,4,,5]),[4,fetch(bC+"/fcm/connect/subscribe",u)];case 2:return[4,f.sent().json()];case 3:return c=f.sent(),[3,5];case 4:throw h=f.sent(),vC.create("token-subscribe-failed",{errorInfo:h});case 5:if(c.error)throw l=c.error.message,vC.create("token-subscribe-failed",{errorInfo:l});if(!c.token)throw vC.create("token-subscribe-no-token");if(!c.pushSet)throw vC.create("token-subscribe-no-push-set");return[2,{token:c.token,pushSet:c.pushSet}]}}))}))},TC.prototype.updateToken=function(t,e,n,r,i){return Li(this,void 0,void 0,(function(){var o,a,s,u,c,h,l,f,p;return Fi(this,(function(d){switch(d.label){case 0:o=_C(r.getKey("p256dh")),a=_C(r.getKey("auth")),s="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+a,wC(i.buffer,gC.buffer)||(u=_C(i),s+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:s},d.label=1;case 1:return d.trys.push([1,4,,5]),[4,fetch(bC+"/fcm/connect/subscribe",h)];case 2:return[4,d.sent().json()];case 3:return l=d.sent(),[3,5];case 4:throw f=d.sent(),vC.create("token-update-failed",{errorInfo:f});case 5:if(l.error)throw p=l.error.message,vC.create("token-update-failed",{errorInfo:p});if(!l.token)throw vC.create("token-update-no-token");return[2,l.token]}}))}))},TC.prototype.deleteToken=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i,o,a,s,u;return Fi(this,(function(c){switch(c.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,fetch(bC+"/fcm/connect/unsubscribe",o)];case 2:return[4,c.sent().json()];case 3:if((a=c.sent()).error)throw s=a.error.message,vC.create("token-unsubscribe-failed",{errorInfo:s});return[3,5];case 4:throw u=c.sent(),vC.create("token-unsubscribe-failed",{errorInfo:u});case 5:return[2]}}))}))},TC);function TC(){}function SC(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var IC="undefined",CC="fcm_token_object_Store",NC=(AC.prototype.get=function(t){return this.createTransaction((function(e){return e.get(t)}))},AC.prototype.getIndex=function(t,e){return this.createTransaction((function(n){return n.index(t).get(e)}))},AC.prototype.put=function(t){return this.createTransaction((function(e){return e.put(t)}),"readwrite")},AC.prototype.delete=function(t){return this.createTransaction((function(e){return e.delete(t)}),"readwrite")},AC.prototype.closeDatabase=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}}))}))},AC.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),Li(this,void 0,void 0,(function(){var n,r,i,o;return Fi(this,(function(a){switch(a.label){case 0:return[4,this.getDb()];case 1:return n=a.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}(t(i))];case 2:return o=a.sent(),[2,new Promise((function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}}))]}}))}))},AC.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise((function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}}))),this.dbPromise},AC);function AC(){this.dbPromise=null}var kC,DC=(Mi(RC,kC=NC),RC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:!function(){var t=indexedDB.open(IC);t.onerror=function(t){},t.onsuccess=function(e){!function(t){if(t.objectStoreNames.contains(CC)){var e=t.transaction(CC).objectStore(CC),n=new EC,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(IC)}}}(t.result)}}();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=xi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=SC(e.vapidKey)),"string"==typeof e.auth&&(n.auth=SC(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=SC(e.p256dh).buffer),t.update(n),t.continue()}}}},RC.prototype.getTokenDetailsFromToken=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){if(!t)throw vC.create("bad-token");return OC({fcmToken:t}),[2,this.getIndex("fcmToken",t)]}))}))},RC.prototype.getTokenDetailsFromSWScope=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){if(!t)throw vC.create("bad-scope");return OC({swScope:t}),[2,this.get(t)]}))}))},RC.prototype.saveTokenDetails=function(t){return Li(this,void 0,void 0,(function(){return Fi(this,(function(e){if(!t.swScope)throw vC.create("bad-scope");if(!t.vapidKey)throw vC.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw vC.create("bad-subscription");if(!t.fcmSenderId)throw vC.create("bad-sender-id");if(!t.fcmToken)throw vC.create("bad-token");if(!t.fcmPushSet)throw vC.create("bad-push-set");return OC(t),[2,this.put(t)]}))}))},RC.prototype.deleteToken=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(vC.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw vC.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}}))}))},RC);function RC(){var t=null!==kC&&kC.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function OC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw vC.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw vC.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw vC.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw vC.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw vC.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw vC.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw vC.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw vC.create("bad-push-set")}var PC,MC=(Mi(xC,PC=NC),xC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},xC.prototype.getVapidFromSWScope=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw vC.create("bad-scope");return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}}))}))},xC.prototype.saveVapidDetails=function(t,e){return Li(this,void 0,void 0,(function(){var n;return Fi(this,(function(r){if("string"!=typeof t||0===t.length)throw vC.create("bad-scope");if(null===e||65!==e.length)throw vC.create("bad-vapid-key");return n={swScope:t,vapidKey:e},[2,this.put(n)]}))}))},xC.prototype.deleteVapidDetails=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw vC.create("delete-scope-not-found");return[4,this.delete(t)];case 2:return n.sent(),[2,e]}}))}))},xC);function xC(){var t=null!==PC&&PC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var LC="messagingSenderId",FC=(UC.prototype.getToken=function(){return Li(this,void 0,void 0,(function(){var t,e,n,r,i;return Fi(this,(function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw vC.create("notifications-blocked");return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}}))}))},UC.prototype.manageExistingToken=function(t,e,n,r){return Li(this,void 0,void 0,(function(){return Fi(this,(function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!wC(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=wC(t.getKey("auth"),n.auth),o=wC(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}}))}))},UC.prototype.updateToken=function(t,e,n,r){return Li(this,void 0,void 0,(function(){var i,o,a;return Fi(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=s.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return s.sent(),[2,i];case 4:return a=s.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw s.sent(),a;case 6:return[2]}}))}))},UC.prototype.getNewToken=function(t,e,n){return Li(this,void 0,void 0,(function(){var r,i;return Fi(this,(function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}}))}))},UC.prototype.deleteToken=function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}}))}))},UC.prototype.deleteTokenFromDB=function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}}))}))},UC.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then((function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})}))},UC.prototype.requestPermission=function(){throw vC.create("only-available-in-window")},UC.prototype.useServiceWorker=function(t){throw vC.create("only-available-in-window")},UC.prototype.usePublicVapidKey=function(t){throw vC.create("only-available-in-window")},UC.prototype.onMessage=function(t,e,n){throw vC.create("only-available-in-window")},UC.prototype.onTokenRefresh=function(t,e,n){throw vC.create("only-available-in-window")},UC.prototype.setBackgroundMessageHandler=function(t){throw vC.create("only-available-in-sw")},UC.prototype.delete=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}}))}))},UC.prototype.getNotificationPermission_=function(){return Notification.permission},UC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},UC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},UC.prototype.getIidModel=function(){return this.iidModel},UC);function UC(t){var e=this;if(!t.options[LC]||"string"!=typeof t.options[LC])throw vC.create("bad-sender-id");this.messagingSenderId=t.options[LC],this.tokenDetailsModel=new DC,this.vapidDetailsModel=new MC,this.iidModel=new EC,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var qC,VC="FCM_MSG",BC=(Mi(jC,qC=FC),jC.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},jC.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},jC.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},jC.prototype.onPush_=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i,o,a;return Fi(this,(function(s){switch(s.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(s){return[2]}return[4,this.hasVisibleClients_()];case 1:return s.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=s.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return s.sent(),[2];case 5:return[2]}}))}))},jC.prototype.onSubChange_=function(t){return Li(this,void 0,void 0,(function(){var t,e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),vC.create("unable-to-resubscribe",{errorInfo:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}}))}))},jC.prototype.onNotificationClick_=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i;return Fi(this,(function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data[VC]?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data[VC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=QC(dC.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}}))}))},jC.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=xi({},t.notification);return n.data=xi({},t.notification.data,((e={})[VC]=t,e)),n}},jC.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw vC.create("bg-handler-function-expected");this.bgMessageHandler=t},jC.prototype.getWindowClient_=function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i;return Fi(this,(function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,WC()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}}))}))},jC.prototype.attemptToMessageClient_=function(t,e){return Li(this,void 0,void 0,(function(){return Fi(this,(function(n){if(!t)throw vC.create("no-window-client-to-msg");return t.postMessage(e),[2]}))}))},jC.prototype.hasVisibleClients_=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){switch(t.label){case 0:return[4,WC()];case 1:return[2,t.sent().some((function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")}))]}}))}))},jC.prototype.sendMessageToWindowClients_=function(t){return Li(this,void 0,void 0,(function(){var e,n,r=this;return Fi(this,(function(i){switch(i.label){case 0:return[4,WC()];case 1:return e=i.sent(),n=QC(dC.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map((function(t){return r.attemptToMessageClient_(t,n)})))];case 2:return i.sent(),[2]}}))}))},jC.prototype.getSWRegistration_=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return[2,self.registration]}))}))},jC.prototype.getPublicVapidKey_=function(){return Li(this,void 0,void 0,(function(){var t,e;return Fi(this,(function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw vC.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,gC]:[2,e]}}))}))},jC);function jC(t){var e=qC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",(function(t){e.onPush(t)})),self.addEventListener("pushsubscriptionchange",(function(t){e.onSubChange(t)})),self.addEventListener("notificationclick",(function(t){e.onNotificationClick(t)})),e}function WC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function QC(t,e){var n;return(n={})[fC.TYPE_OF_MSG]=t,n[fC.DATA]=e,n}var KC,HC,GC=(Mi(zC,KC=FC),zC.prototype.requestPermission=function(){return Li(this,void 0,void 0,(function(){var t;return Fi(this,(function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?vC.create("permission-blocked"):vC.create("permission-default")}}))}))},zC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw vC.create("sw-registration-expected");if(null!=this.registrationToUse)throw vC.create("use-sw-before-get-token");this.registrationToUse=t},zC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw vC.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw vC.create("use-public-key-before-get-token");var e=SC(t);if(65!==e.length)throw vC.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},zC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},zC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},zC.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise((function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(vC.create("sw-reg-redundant"))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(vC.create("sw-reg-redundant"));else n(t);else r(vC.create("no-sw-in-reg"))}))},zC.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch((function(t){throw vC.create("failed-serviceworker-registration",{browserErrorMessage:t.message})})).then((function(e){return t.waitForRegistrationToActivate_(e).then((function(){return(t.registrationToUse=e).update(),e}))})))},zC.prototype.getPublicVapidKey_=function(){return Li(this,void 0,void 0,(function(){return Fi(this,(function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,gC]}))}))},zC.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",(function(e){if(e.data&&e.data[fC.TYPE_OF_MSG]){var n=e.data;switch(n[fC.TYPE_OF_MSG]){case dC.PUSH_MSG_RECEIVED:case dC.NOTIFICATION_CLICKED:var r=n[fC.DATA];t.messageObserver&&t.messageObserver.next(r)}}}),!1)},zC);function zC(t){var e=KC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=vo((function(t){e.messageObserver=t})),e.onTokenRefreshInternal=vo((function(t){e.tokenRefreshObserver=t})),e.setupSWMessageListener_(),e}function YC(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}HC={isSupported:YC},Wo.INTERNAL.registerService("messaging",(function(t){if(!YC())throw vC.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new BC(t):new GC(t)}),HC);var XC="firebasestorage.googleapis.com",JC="storageBucket",$C=(ZC.prototype.codeProp=function(){return this.code},ZC.prototype.codeEquals=function(t){return eN(t)===this.codeProp()},ZC.prototype.serverResponseProp=function(){return this.serverResponse_},ZC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(ZC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(ZC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(ZC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(ZC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),ZC);function ZC(t,e){this.code_=eN(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var tN={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function eN(t){return"storage/"+t}function nN(){return new $C(tN.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function rN(){return new $C(tN.CANCELED,"User canceled the upload/download.")}function iN(){return new $C(tN.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function oN(t,e,n){return new $C(tN.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function aN(){return new $C(tN.APP_DELETED,"The Firebase app was deleted.")}function sN(t,e){return new $C(tN.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function uN(t){throw new $C(tN.INTERNAL_ERROR,"Internal error: "+t)}var cN={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function hN(t){switch(t){case cN.RAW:case cN.BASE64:case cN.BASE64URL:case cN.DATA_URL:return;default:throw"Expected one of the event types: ["+cN.RAW+", "+cN.BASE64+", "+cN.BASE64URL+", "+cN.DATA_URL+"]."}}var lN=function(t,e){this.data=t,this.contentType=e||null};function fN(t,e){switch(t){case cN.RAW:return new lN(pN(e));case cN.BASE64:case cN.BASE64URL:return new lN(dN(t,e));case cN.DATA_URL:return new lN(function(t){var e=new vN(t);return e.base64?dN(cN.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw sN(cN.DATA_URL,"Malformed data URL.")}return pN(e)}(e.rest)}(e),function(t){return new vN(t).contentType}(e))}throw nN()}function pN(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function dN(t,e){switch(t){case cN.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw sN(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case cN.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw sN(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw sN(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var yN,mN,vN=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw sN(cN.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)},gN={STATE_CHANGED:"state_changed"},bN="running",wN="pausing",_N="paused",EN="success",TN="canceling",SN="canceled",IN="error",CN={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function NN(t){switch(t){case bN:case wN:case TN:return CN.RUNNING;case _N:return CN.PAUSED;case EN:return CN.SUCCESS;case SN:return CN.CANCELED;case IN:default:return CN.ERROR}}function AN(t){return null!=t}function kN(t){return void 0!==t}function DN(t){return"function"==typeof t}function RN(t){return"object"==typeof t}function ON(t){return"string"==typeof t||t instanceof String}function PN(t){return"number"==typeof t||t instanceof Number}function MN(t){return xN()&&t instanceof Blob}function xN(){return"undefined"!=typeof Blob}(mN=yN=yN||{})[mN.NO_ERROR=0]="NO_ERROR",mN[mN.NETWORK_ERROR=1]="NETWORK_ERROR",mN[mN.ABORT=2]="ABORT";var LN=(FN.prototype.send=function(t,e,n,r){if(this.sent_)throw uN("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),AN(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return AN(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},FN.prototype.getErrorCode=function(){if(!this.sent_)throw uN("cannot .getErrorCode() before sending");return this.errorCode_},FN.prototype.getStatus=function(){if(!this.sent_)throw uN("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},FN.prototype.getResponseText=function(){if(!this.sent_)throw uN("cannot .getResponseText() before sending");return this.xhr_.responseText},FN.prototype.abort=function(){this.xhr_.abort()},FN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},FN.prototype.addUploadProgressListener=function(t){AN(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},FN.prototype.removeUploadProgressListener=function(t){AN(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},FN);function FN(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=yN.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=yN.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=yN.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}var UN=(qN.prototype.createXhrIo=function(){return new LN},qN);function qN(){}function VN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(xN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var BN=(jN.prototype.size=function(){return this.size_},jN.prototype.type=function(){return this.type_},jN.prototype.slice=function(t,e){if(MN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new jN(n)}return new jN(new Uint8Array(this.data_.buffer,t,e-t),!0)},jN.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(xN()){var n=t.map((function(t){return t instanceof jN?t.data_:t}));return new jN(VN.apply(null,n))}var r=t.map((function(t){return ON(t)?fN(cN.RAW,t).data:t.data_})),i=0;r.forEach((function(t){i+=t.byteLength}));var o=new Uint8Array(i),a=0;return r.forEach((function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]})),new jN(o,!0)},jN.prototype.uploadData=function(){return this.data_},jN);function jN(t,e){var n=0,r="";MN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var WN=(Object.defineProperty(QN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(QN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),QN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},QN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},QN.makeFromBucketSpec=function(t){var e;try{e=QN.makeFromUrl(t)}catch(e){return new QN(t,"")}if(""===e.path)return e;throw function(t){return new $C(tN.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(t)},QN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=XC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new QN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new $C(tN.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},QN);function QN(t,e){this.bucket=t,this.path_=e}function KN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return RN(t)&&!Array.isArray(t)}(e)?e:null}function HN(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function GN(t){return"https://"+XC+"/v0"+t}function zN(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}function YN(t,e){return e}var XN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||YN},JN=null;function $N(t,e,n){var r=KN(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new WN(n,r);return e.makeStorageReference(i)}})}(r,t),r}(t,r,n)}function ZN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function tA(t){if(!RN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!RN(n))throw"Expected object for 'customMetadata' mapping."}else if(RN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var eA="maxResults",nA=1e3,rA="pageToken",iA="prefixes",oA="items";function aA(t){if(!RN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===eA){if(!PN(n=t[eA])||!Number.isInteger(n)||t[eA]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[eA])throw"Expected maxResults to be less than or equal to "+nA+"."}else{if(e!==rA)throw"Unknown option: "+e;if(t[rA]&&!ON(t[rA]))throw"Expected pageToken to be string."}var n}var sA=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function uA(t){if(!t)throw nN()}function cA(t,e){return function(n,r){var i=$N(t,r,e);return uA(null!==i),i}}function hA(t){return function(e,n){var r=function(t,e){var n=KN(e);return null===n?null:function(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new $C(tN.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+JC+"' property when initializing the app?");if(e[iA])for(var i=0,o=e[iA];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new WN(r,a));n.prefixes.push(s)}if(e[oA])for(var u=0,c=e[oA];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new WN(r,h.name)),n.items.push(s)}return n}(t,n)}(t,n);return uA(null!==r),r}}function lA(t,e){return function(n,r){var i=$N(t,r,e);return uA(null!==i),function(t,e){var n=KN(e);if(null===n)return null;if(!ON(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(e){var n=t.bucket,r=t.fullPath;return GN("/b/"+i(n)+"/o/"+i(r))+zN({alt:"media",token:e})}))[0]}(i,r)}}function fA(t){return function(e,n){var r;return(r=401===e.getStatus()?new $C(tN.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(t){return new $C(tN.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(t.bucket):403===e.getStatus()?function(t){return new $C(tN.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(t.path):n).setServerResponseProp(n.serverResponseProp()),r}}function pA(t){var e=fA(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=function(t){return new $C(tN.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(t.path)),i.setServerResponseProp(r.serverResponseProp()),i}}function dA(t,e,n){var r=GN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new sA(r,"GET",cA(t,n),i);return o.errorHandler=pA(e),o}function yA(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var mA=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function vA(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){uA(!1)}return uA(!!n&&-1!==(e||["active"]).indexOf(n)),n}var gA=function(t,e,n){if(DN(t)||AN(e)||AN(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},bA=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function wA(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new $C(tN.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,t,n.length);for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?oN(o,t,e.message):oN(o,t,e)}}var _A=function(t,e){var n=this;this.validator=function(e){n.optional&&!kN(e)||t(e)},this.optional=!!e};function EA(t,e){function n(t){if(!ON(t))throw"Expected string."}var r;return r=t?function(t,e){return function(n){t(n),e(n)}}(n,t):n,new _A(r,e)}function TA(t){return new _A(tA,t)}function SA(){return new _A((function(t){if(!(PN(t)&&0<=t))throw"Expected a number 0 or greater."}))}function IA(t,e){return new _A((function(e){if(!(null===e||AN(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)}),e)}function CA(t){return new _A((function(t){if(null!==t&&!DN(t))throw"Expected a Function."}),t)}function NA(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}var AA=(kA.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},kA.prototype.shouldDoResumable_=function(t){return 262144<t.size()},kA.prototype.start_=function(){this.state_===bN&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},kA.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then((function(n){switch(e.state_){case bN:t(n);break;case TN:e.transition_(SN);break;case wN:e.transition_(_N)}}))},kA.prototype.createResumable_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=yA(e,r,i),s={name:a.fullPath},u=GN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=ZN(a,n),l=t.maxUploadRetryTime(),f=new sA(u,"POST",(function(t){var e;vA(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){uA(!1)}return uA(ON(e)),e}),l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=fA(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()}),t.errorHandler_)}))},kA.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_((function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new sA(n,"POST",(function(t){var e=vA(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){uA(!1)}n||uA(!1);var i=Number(n);return uA(!isNaN(i)),new mA(i,r.size(),"final"===e)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=fA(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);(t.request_=i).getPromise().then((function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()}),t.errorHandler_)}))},kA.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new mA(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var o;try{o=function(t,e,n,r,i,o,a,s){var u=new mA(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new $C(tN.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;0<i&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw iN();var y=e.maxUploadRetryTime(),m=new sA(n,"POST",(function(t,n){var i,a=vA(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?cA(e,o)(t,n):null,new mA(s,c,"final"===a,i)}),y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=s||null,m.errorHandler=fA(t),m}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(i){return t.error_=i,void t.transition_(IN)}var a=t.authWrapper_.makeRequest(o,i);(t.request_=a).getPromise().then((function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(EN)):t.completeTransitions_()}),t.errorHandler_)}))},kA.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},kA.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_((function(e){var n=dA(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.metadata_=e,t.transition_(EN)}),t.metadataErrorHandler_)}))},kA.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=yA(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ZN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=BN.getBlob(c,r,h);if(null===l)throw iN();var f={name:u.fullPath},p=GN(o),d=t.maxUploadRetryTime(),y=new sA(p,"POST",cA(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=fA(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then((function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(EN)}),t.errorHandler_)}))},kA.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},kA.prototype.transition_=function(t){if(this.state_!==t)switch(t){case TN:case wN:this.state_=t,null!==this.request_&&this.request_.cancel();break;case bN:var e=this.state_===_N;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case _N:this.state_=t,this.notifyObservers_();break;case SN:this.error_=rN(),this.state_=t,this.notifyObservers_();break;case IN:case EN:this.state_=t,this.notifyObservers_()}},kA.prototype.completeTransitions_=function(){switch(this.state_){case wN:this.transition_(_N);break;case TN:this.transition_(SN);break;case bN:this.start_()}},Object.defineProperty(kA.prototype,"snapshot",{get:function(){var t=NN(this.state_);return new bA(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),kA.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=CA(!0).validator,a=IA(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(kN(t.next)||kN(t.error)||kN(t.complete)))throw"";return}catch(t){throw i}}wA("on",[EA((function(){if(t!==gN.STATE_CHANGED)throw"Expected one of the event types: ["+gN.STATE_CHANGED+"]."})),IA(s,!0),CA(!0),CA(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&wA("on",t,arguments);var o=new gA(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[IA((function(t){if(null===t)throw i;s(t)})),CA(!0),CA(!0)];return kN(e)||kN(n)||kN(r)?c(null)(e,n,r):c(h)},kA.prototype.then=function(t,e){return this.promise_.then(t,e)},kA.prototype.catch=function(t){return this.then(null,t)},kA.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},kA.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},kA.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach((function(e){t.notifyObserver_(e)}))},kA.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(NN(this.state_)){case CN.SUCCESS:NA(this.resolve_.bind(null,this.snapshot))();break;case CN.CANCELED:case CN.ERROR:NA(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},kA.prototype.notifyObserver_=function(t){switch(NN(this.state_)){case CN.RUNNING:case CN.PAUSED:t.next&&NA(t.next.bind(t,this.snapshot))();break;case CN.SUCCESS:t.complete&&NA(t.complete.bind(t))();break;case CN.CANCELED:case CN.ERROR:t.error&&NA(t.error.bind(t,this.error_))();break;default:t.error&&NA(t.error.bind(t,this.error_))()}},kA.prototype.resume=function(){wA("resume",[],arguments);var t=this.state_===_N||this.state_===wN;return t&&this.transition_(bN),t},kA.prototype.pause=function(){wA("pause",[],arguments);var t=this.state_===bN;return t&&this.transition_(wN),t},kA.prototype.cancel=function(){wA("cancel",[],arguments);var t=this.state_===bN||this.state_===wN;return t&&this.transition_(TN),t},kA);function kA(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=bN,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(tN.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(IN))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(tN.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(IN))},this.promise_=new Promise((function(t,e){a.resolve_=t,a.reject_=e,a.start_()})),this.promise_.then(null,(function(){}))}var DA=(RA.prototype.toString=function(){return wA("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},RA.prototype.newRef=function(t,e){return new RA(t,e)},RA.prototype.mappings=function(){return function(){if(JN)return JN;var t=[];t.push(new XN("bucket")),t.push(new XN("generation")),t.push(new XN("metageneration")),t.push(new XN("name","fullPath",!0));var e=new XN("name");e.xform=function(t,e){return function(t){return!ON(t)||t.length<2?t:HN(t)}(e)},t.push(e);var n=new XN("size");return n.xform=function(t,e){return AN(e)?Number(e):e},t.push(n),t.push(new XN("timeCreated")),t.push(new XN("updated")),t.push(new XN("md5Hash",null,!0)),t.push(new XN("cacheControl",null,!0)),t.push(new XN("contentDisposition",null,!0)),t.push(new XN("contentEncoding",null,!0)),t.push(new XN("contentLanguage",null,!0)),t.push(new XN("contentType",null,!0)),t.push(new XN("metadata","customMetadata",!0)),JN=t}()},RA.prototype.child=function(t){wA("child",[EA()],arguments);var e=function(t,e){var n=e.split("/").filter((function(t){return 0<t.length})).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new WN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(RA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new WN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(RA.prototype,"root",{get:function(){var t=new WN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(RA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(RA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(RA.prototype,"name",{get:function(){return HN(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(RA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),RA.prototype.put=function(t,e){return void 0===e&&(e=null),wA("put",[new _A((function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||xN()&&t instanceof Blob))throw"Expected Blob or File."})),TA(!0)],arguments),this.throwIfRoot_("put"),new AA(this,this.authWrapper,this.location,this.mappings(),new BN(t),e)},RA.prototype.putString=function(t,e,n){void 0===e&&(e=cN.RAW),wA("putString",[EA(),EA(hN,!0),TA(!0)],arguments),this.throwIfRoot_("putString");var r=fN(e,t),i=Object.assign({},n);return!AN(i.contentType)&&AN(r.contentType)&&(i.contentType=r.contentType),new AA(this,this.authWrapper,this.location,this.mappings(),new BN(r.data,!0),i)},RA.prototype.delete=function(){var t=this;return wA("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then((function(e){var n=function(t,e){var n=GN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new sA(n,"DELETE",(function(t,e){}),r);return i.successCodes=[200,204],i.errorHandler=pA(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()}))},RA.prototype.listAll=function(){wA("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then((function(){return t}))},RA.prototype.listAllHelper=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o;return Fi(this,(function(a){switch(a.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=a.sent(),(i=t.prefixes).push.apply(i,r.prefixes),(o=t.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))},RA.prototype.list=function(t){wA("list",[new _A(aA,!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then((function(n){var r=t||{},i=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",0<"/".length&&(o.delimiter="/"),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=GN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new sA(a,"GET",hA(t),s);return u.urlParams=o,u.errorHandler=fA(e),u}(e.authWrapper,e.location,0,r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()}))},RA.prototype.getMetadata=function(){var t=this;return wA("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then((function(e){var n=dA(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()}))},RA.prototype.updateMetadata=function(t){var e=this;return wA("updateMetadata",[TA()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then((function(n){var r=function(t,e,n,r){var i=GN(e.fullServerUrl()),o=ZN(n,r),a=t.maxOperationRetryTime(),s=new sA(i,"PATCH",cA(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=pA(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()}))},RA.prototype.getDownloadURL=function(){var t=this;return wA("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then((function(e){var n=function(t,e,n){var r=GN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new sA(r,"GET",lA(t,n),i);return o.errorHandler=pA(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw new $C(tN.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t}))}))},RA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new $C(tN.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},RA);function RA(t,e){this.authWrapper=t,this.location=e instanceof WN?e:WN.makeFromUrl(e)}var OA=(PA.prototype.getPromise=function(){return this.promise_},PA.prototype.cancel=function(t){},PA);function PA(t){this.promise_=Promise.reject(t)}var MA=(xA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then((function(){return e.map.delete(n)}),(function(){return e.map.delete(n)}))},xA.prototype.clear=function(){this.map.forEach((function(t){t&&t.cancel(!0)})),this.map.clear()},xA);function xA(){this.map=new Map,this.id=-9007199254740991}var LA=(FA.extractBucket_=function(t){var e=t[JC]||null;return null==e?null:WN.makeFromBucketSpec(e).bucket},FA.prototype.getAuthToken=function(){return null!==this.app_&&AN(this.app_.INTERNAL)&&AN(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then((function(t){return null!==t?t.accessToken:null}),(function(){return null})):Promise.resolve(null)},FA.prototype.bucket=function(){if(this.deleted_)throw aN();return this.bucket_},FA.prototype.service=function(){return this.service_},FA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},FA.prototype.makeRequest=function(t,e){if(this.deleted_)return new OA(aN());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},FA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},FA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},FA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},FA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},FA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},FA);function FA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;AN(o)&&(this.bucket_=FA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new MA}var UA=(qA.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());kN(s)?i(s):i()}catch(e){o(e)}else null!==a?((r=nN()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?aN():rN()):o(r=new $C(tN.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new VA(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout((function(){i=null,t(l,s())}),e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout((function(){p(o=!0)}),n),p}((function(e,n){if(n)e(!1,new VA(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===yN.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new VA(a,n))}else{var s=n.getErrorCode()===yN.ABORT;e(!1,new VA(!1,null,s))}}))}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}}),e,this.timeout_)},qA.prototype.getPromise=function(){return this.promise_},qA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},qA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},qA);function qA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise((function(t,e){l.resolve_=t,l.reject_=e,l.start_()}))}var VA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function BA(t,e,n){var r=zN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==Wo?Wo.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new UA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var jA=(WA.prototype.ref=function(t){if(wA("ref",[EA((function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}),!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new DA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},WA.prototype.refFromURL=function(t){return wA("refFromURL",[EA((function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{WN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}}),!1)],arguments),new DA(this.authWrapper_,t)},Object.defineProperty(WA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),WA.prototype.setMaxUploadRetryTime=function(t){wA("setMaxUploadRetryTime",[SA()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},WA.prototype.setMaxOperationRetryTime=function(t){wA("setMaxOperationRetryTime",[SA()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(WA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(WA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),WA);function WA(t,e,n){if(this.bucket_=null,this.authWrapper_=new LA(t,(function(t,e){return new DA(t,e)}),BA,this,e),this.app_=t,null!=n)this.bucket_=WN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new WN(r,""))}this.internals_=new KA(this)}var QA,KA=(HA.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},HA);function HA(t){this.service_=t}function GA(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function zA(t,e,n){var r,i=new Promise((function(i,o){GA(r=t[e].apply(t,n)).then(i,o)}));return i.request=r,i}function YA(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function XA(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return zA(this[e],r,arguments)})}))}function JA(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function $A(t,e,n,r){r.forEach((function(r){r in n.prototype&&(t.prototype[r]=function(){return function(t,e,n){var r=zA(t,e,n);return r.then((function(t){if(t)return new tk(t,r.request)}))}(this[e],r,arguments)})}))}function ZA(t){this._index=t}function tk(t,e){this._cursor=t,this._request=e}function ek(t){this._store=t}function nk(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function rk(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new nk(n)}function ik(t){this._db=t}QA={TaskState:CN,TaskEvent:gN,StringFormat:cN,Storage:jA,Reference:DA},Wo.INTERNAL.registerService("storage",(function(t,e,n){return new jA(t,new UN,n)}),QA,void 0,!0),YA(ZA,"_index",["name","keyPath","multiEntry","unique"]),XA(ZA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),$A(ZA,"_index",IDBIndex,["openCursor","openKeyCursor"]),YA(tk,"_cursor",["direction","key","primaryKey","value"]),XA(tk,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(tk.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,n),GA(e._request).then((function(t){if(t)return new tk(t,e._request)}))}))})})),ek.prototype.createIndex=function(){return new ZA(this._store.createIndex.apply(this._store,arguments))},ek.prototype.index=function(){return new ZA(this._store.index.apply(this._store,arguments))},YA(ek,"_store",["name","keyPath","indexNames","autoIncrement"]),XA(ek,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),$A(ek,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),JA(ek,"_store",IDBObjectStore,["deleteIndex"]),nk.prototype.objectStore=function(){return new ek(this._tx.objectStore.apply(this._tx,arguments))},YA(nk,"_tx",["objectStoreNames","mode"]),JA(nk,"_tx",IDBTransaction,["abort"]),rk.prototype.createObjectStore=function(){return new ek(this._db.createObjectStore.apply(this._db,arguments))},YA(rk,"_db",["name","version","objectStoreNames"]),JA(rk,"_db",IDBDatabase,["deleteObjectStore","close"]),ik.prototype.transaction=function(){return new nk(this._db.transaction.apply(this._db,arguments))},YA(ik,"_db",["name","version","objectStoreNames"]),JA(ik,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[ek,ZA].forEach((function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[ZA,ek].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise((function(i){n.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)}))}))})}));var ok,ak=1e4,sk="w:0.2.7",uk="FIS_v2",ck="https://firebaseinstallations.googleapis.com/v1",hk=36e5,lk=((ok={})["missing-app-config-values"]="Missing App configuration values.",ok["create-installation-failed"]="Could not register Firebase Installation.",ok["generate-token-failed"]="Could not generate Auth Token.",ok["not-registered"]="Firebase Installation is not registered.",ok["installation-not-found"]="Firebase Installation not found.",ok["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',ok["app-offline"]="Could not process request. Application offline.",ok["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",ok),fk=new io("installations","Installations",lk);function pk(t){return t instanceof no&&t.code.includes("request-failed")}function dk(t){if(!t||!t.options)throw fk.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw fk.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function yk(t){var e=t.projectId;return ck+"/projects/"+e+"/installations"}function mk(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function vk(t,e){return Li(this,void 0,void 0,(function(){var n,r;return Fi(this,(function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,fk.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function gk(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function bk(t,e){var n=e.refreshToken,r=gk(t);return r.append("Authorization",function(t){return uk+" "+t}(n)),r}function wk(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return 500<=(e=n.sent()).status&&e.status<600?[2,t()]:[2,e]}}))}))}function _k(t){return new Promise((function(e){setTimeout(e,t)}))}var Ek=/^[cdef][\w-]{21}$/,Tk="";function Sk(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,Vi(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return Ek.test(e)?e:Tk}catch(t){return Tk}}var Ik="firebase-installations-database",Ck=1,Nk="firebase-installations-store",Ak=null;function kk(){return Ak=Ak||function(t,e,n){var r=zA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new rk(i.result,t.oldVersion,i.transaction))}),r.then((function(t){return new ik(t)}))}(Ik,Ck,(function(t){switch(t.oldVersion){case 0:t.createObjectStore(Nk)}}))}function Dk(t,e){return Li(this,void 0,void 0,(function(){var n,r,i;return Fi(this,(function(o){switch(o.label){case 0:return n=Pk(t),[4,kk()];case 1:return r=o.sent(),[4,(i=r.transaction(Nk,"readwrite")).objectStore(Nk).put(e,n)];case 2:return o.sent(),[4,i.complete];case 3:return o.sent(),[2,e]}}))}))}function Rk(t){return Li(this,void 0,void 0,(function(){var e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return e=Pk(t),[4,kk()];case 1:return n=i.sent(),[4,(r=n.transaction(Nk,"readwrite")).objectStore(Nk).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function Ok(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o,a,s;return Fi(this,(function(u){switch(u.label){case 0:return n=Pk(t),[4,kk()];case 1:return r=u.sent(),i=r.transaction(Nk,"readwrite"),[4,(o=i.objectStore(Nk)).get(n)];case 2:return a=u.sent(),(s=e(a))===a?[2,s]:void 0!==s?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),[2,s]}}))}))}function Pk(t){return t.appName+"!"+t.appId}function Mk(t){return Li(this,void 0,void 0,(function(){var e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return[4,Ok(t,(function(n){var r=function(t){var e=t||{fid:Sk(),registrationStatus:0};return Lk(e)?{fid:e.fid,registrationStatus:0}:e}(n),i=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return[4,xk(t)];case 1:e=n.sent(),n.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,_k(100)];case 3:return n.sent(),[4,xk(t)];case 4:return e=n.sent(),[3,2];case 5:if(0===e.registrationStatus)throw fk.create("create-installation-failed");return[2,e]}}))}))}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(fk.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=function(t,e){return Li(this,void 0,void 0,(function(){var n,r;return Fi(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,function(t,e){var n=e.fid;return Li(this,void 0,void 0,(function(){var e,r,i,o,a,s;return Fi(this,(function(u){switch(u.label){case 0:return e=yk(t),r=gk(t),i={fid:n,authVersion:uk,appId:t.appId,sdkVersion:sk},o={method:"POST",headers:r,body:JSON.stringify(i)},[4,wk((function(){return fetch(e,o)}))];case 1:return(a=u.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,{fid:(s=u.sent()).fid||n,registrationStatus:2,refreshToken:s.refreshToken,authToken:mk(s.authToken)}];case 3:return[4,vk("Create Installation",a)];case 4:throw u.sent()}}))}))}(t,e)];case 1:return n=i.sent(),[2,Dk(t,n)];case 2:return pk(r=i.sent())&&409===r.serverCode?[4,Rk(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,Dk(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(t,n);return{installationEntry:n,registrationPromise:r}}(t,r);return e=i.registrationPromise,i.installationEntry}))];case 1:return(n=i.sent()).fid!==Tk?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}}))}))}function xk(t){return Ok(t,(function(t){if(!t)throw fk.create("installation-not-found");return Lk(t)?{fid:t.fid,registrationStatus:0}:t}))}function Lk(t){return 1===t.registrationStatus&&t.registrationTime+ak<Date.now()}function Fk(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o,a;return Fi(this,(function(s){switch(s.label){case 0:return n=function(t,e){var n=e.fid;return yk(t)+"/"+n+"/authTokens:generate"}(t,e),r=bk(t,e),i={installation:{sdkVersion:sk}},o={method:"POST",headers:r,body:JSON.stringify(i)},[4,wk((function(){return fetch(n,o)}))];case 1:return(a=s.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,mk(s.sent())];case 3:return[4,vk("Generate Auth Token",a)];case 4:throw s.sent()}}))}))}function Uk(t){return Li(this,void 0,void 0,(function(){var e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return[4,Ok(t,(function(n){if(!Vk(n))throw fk.create("not-registered");var r=n.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+hk}(t)}(r))return n;if(1===r.requestStatus)return e=function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:return[4,qk(t)];case 1:e=r.sent(),r.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,_k(100)];case 3:return r.sent(),[4,qk(t)];case 4:return e=r.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw fk.create("generate-token-failed");return[2,n]}}))}))}(t),n;if(!navigator.onLine)throw fk.create("app-offline");var i=function(t){var e={requestStatus:1,requestTime:Date.now()};return xi({},t,{authToken:e})}(n);return e=function(t,e){return Li(this,void 0,void 0,(function(){var n,r,i;return Fi(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,Fk(t,e)];case 1:return n=o.sent(),i=xi({},e,{authToken:n}),[4,Dk(t,i)];case 2:return o.sent(),[2,n];case 3:return!pk(r=o.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,Rk(t)];case 4:return o.sent(),[3,7];case 5:return i=xi({},e,{authToken:{requestStatus:0}}),[4,Dk(t,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}}))}))}(t,i),i}))];case 1:return n=i.sent(),e?[4,e]:[3,3];case 2:return r=i.sent(),[3,4];case 3:r=n.authToken,i.label=4;case 4:return[2,r.token]}}))}))}function qk(t){return Ok(t,(function(t){if(!Vk(t))throw fk.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+ak<Date.now()}(t.authToken)?xi({},t,{authToken:{requestStatus:0}}):t}))}function Vk(t){return void 0!==t&&2===t.registrationStatus}function Bk(t,e){return Li(this,void 0,void 0,(function(){var n,r,i,o;return Fi(this,(function(a){switch(a.label){case 0:return n=function(t,e){var n=e.fid;return yk(t)+"/"+n}(t,e),r=bk(t,e),i={method:"DELETE",headers:r},[4,wk((function(){return fetch(n,i)}))];case 1:return(o=a.sent()).ok?[3,3]:[4,vk("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}}))}))}Wo.INTERNAL.registerService("installations",(function(t){return dk(t),{app:t,getId:function(){return function(t){return Li(this,void 0,void 0,(function(){var e,n,r,i;return Fi(this,(function(o){switch(o.label){case 0:return[4,Mk(e=dk(t))];case 1:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch((function(){})),2===r.registrationStatus&&Uk(e).catch((function(){})),[2,r.fid]}}))}))}(t)},getToken:function(){return function(t){return Li(this,void 0,void 0,(function(){var e;return Fi(this,(function(n){switch(n.label){case 0:return[4,function(t){return Li(this,void 0,void 0,(function(){var e,n,r;return Fi(this,(function(i){switch(i.label){case 0:return[4,Mk(t)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return i.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw fk.create("create-installation-failed");i.label=4;case 4:return[2]}}))}))}(e=dk(t))];case 1:return n.sent(),[2,Uk(e)]}}))}))}(t)},delete:function(){return function(t){return Li(this,void 0,void 0,(function(){var e,n;return Fi(this,(function(r){switch(r.label){case 0:return[4,Ok(e=dk(t),(function(t){if(!t||0!==t.registrationStatus)return t}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw fk.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw fk.create("app-offline");case 3:return[4,Bk(e,n)];case 4:return r.sent(),[4,Rk(e)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(t)}}}));var jk,Wk,Qk,Kk,Hk="0.2.19",Gk="FB-PERF-TRACE-MEASURE",zk="@firebase/performance/config",Yk="@firebase/performance/configexpire",Xk="Performance",Jk=((jk={})["trace started"]="Trace {$traceName} was started before.",jk["trace stopped"]="Trace {$traceName} is not running.",jk["no window"]="Window is not available.",jk["no app id"]="App id is not available.",jk["no project id"]="Project id is not available.",jk["no api key"]="Api key is not available.",jk["invalid cc log"]="Attempted to queue invalid cc event",jk["FB not default"]="Performance can only start when Firebase app instance is the default one.",jk["RC response not ok"]="RC response is not ok",jk["invalid attribute name"]="Attribute name {$attributeName} is invalid.",jk["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",jk["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",jk),$k=new io("performance",Xk,Jk),Zk=(tD.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},tD.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},tD.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},tD.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},tD.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},tD.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},tD.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},tD.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver((function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}})).observe({entryTypes:[t]})},tD.getInstance=function(){return void 0===Wk&&(Wk=new tD(Qk)),Wk},tD);function tD(t){if(!t)throw $k.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var eD,nD,rD,iD=(oD.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw $k.create("no app id");return t},oD.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw $k.create("no project id");return t},oD.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw $k.create("no api key");return t},oD.getInstance=function(){return void 0===Kk&&(Kk=new oD),Kk},oD);function oD(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function aD(){return eD}(rD=nD=nD||{})[rD.UNKNOWN=0]="UNKNOWN",rD[rD.VISIBLE=1]="VISIBLE",rD[rD.HIDDEN=2]="HIDDEN",rD[rD.PRERENDER=3]="PRERENDER",rD[rD.UNLOADED=4]="UNLOADED";var sD=["firebase_","google_","ga_"],uD=new RegExp("^[a-zA-Z]\\w*$");function cD(){switch(Zk.getInstance().document.visibilityState){case"visible":return nD.VISIBLE;case"hidden":return nD.HIDDEN;case"prerender":return nD.PRERENDER;default:return nD.UNKNOWN}}var hD=new Ro(Xk);hD.logLevel=go.INFO;var lD="0.0.1",fD={loggingEnabled:!0},pD="FIREBASE_INSTALLATIONS_AUTH",dD="Could not fetch config, will use default configs";function yD(t){if(!t)return t;var e=iD.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=fD.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=mD(e.tracesSamplingRate),e.logNetworkAfterSampling=mD(e.networkRequestsSamplingRate),t}function mD(t){return Math.random()<=t}var vD,gD=1;function bD(){return gD=2,vD=vD||function(){var t=Zk.getInstance().document;return new Promise((function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()}))}().then((function(){return function(){var t=iD.getInstance().firebaseAppInstance.installations().getId();return t.then((function(t){eD=t})),t}()})).then((function(t){return function(t){var e=function(){var t=Zk.getInstance().localStorage,e=t.getItem(Yk);if(e&&function(t){return Number(t)>Date.now()}(e)){var n=t.getItem(zk);if(n)try{return JSON.parse(n)}catch(t){return}}}();return e?(yD(e),Promise.resolve()):function(t){return function(){var t=iD.getInstance().firebaseAppInstance.installations().getToken();return t.then((function(t){})),t}().then((function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+iD.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+iD.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:pD+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:iD.getInstance().getAppId(),app_version:Hk,sdk_version:lD})});return fetch(r).then((function(t){if(t.ok)return t.json();throw $k.create("RC response not ok")}))})).catch((function(){hD.info(dD)}))}(t).then((function(t){return yD(t)})).then((function(t){return function(t){if(t){var e=Zk.getInstance().localStorage;e.setItem(zk,JSON.stringify(t)),e.setItem(Yk,String(Date.now()+60*iD.getInstance().configTimeToLive*60*1e3))}}(t)}),(function(){}))}(t)})).then((function(){return wD()}),(function(){return wD()}))}function wD(){gD=3}var _D,ED=3,TD=[];function SD(){if(_D)return _D;var t=function(t){return function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];!function(t){if(!t.eventTime||!t.message)throw $k.create("invalid cc log");TD=TD.concat([t])}({message:t.apply(void 0,r),eventTime:Date.now()})}}(ND);return(_D=new Ro("@firebase/performance/cc")).logHandler=t,_D}function ID(t){var e=iD.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Zk.getInstance().requiredApisAvailable()&&(t.isAuto&&cD()!==nD.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===gD?CD(t):bD().then((function(){return CD(t)}),(function(){return CD(t)}))))}function CD(t){aD()&&setTimeout((function(){return SD().log(t,1)}),0)}function ND(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:AD(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=kD(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=kD(n));var r={application_info:AD(),trace_metric:e};return JSON.stringify(r)}(t)}function AD(){return{google_app_id:iD.getInstance().getAppId(),app_instance_id:aD(),web_app_info:{sdk_version:Hk,page_url:Zk.getInstance().getUrl(),service_worker_status:function(){var t=Zk.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:cD(),effective_connection_type:function(){var t=Zk.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function kD(t){return Object.keys(t).map((function(e){return{key:e,value:t[e]}}))}!function t(e){setTimeout((function(){if(0!==ED){if(!TD.length)return t(1e4);var e=TD.slice();TD=[];var n=e.map((function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}})),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:iD.getInstance().logSource,log_event:n};fetch(iD.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then((function(t){return t.ok||hD.info("Call to Firebase backend failed."),t.json()})).then((function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?1e4:Math.max(1e4,n);ED=3,t(r)})).catch((function(){TD=e.concat(TD),ED--,hD.info("Tries left: "+ED+"."),t(1e4)}))}}),e)}(5500);var DD=["_fp","_fcp","_fid"],RD=(OD.prototype.start=function(){if(1!==this.state)throw $k.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},OD.prototype.stop=function(){if(2!==this.state)throw $k.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),ID(this)},OD.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=xi({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}ID(this)},OD.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},OD.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<DD.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw $k.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},OD.prototype.getMetric=function(t){return this.counters[t]||0},OD.prototype.putAttribute=function(t,e){var n=function(t){return!(0===t.length||40<t.length||sD.some((function(e){return t.startsWith(e)}))||!t.match(uD))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw $k.create("invalid attribute name",{attributeName:t});if(!r)throw $k.create("invalid attribute value",{attributeValue:e})}},OD.prototype.getAttribute=function(t){return this.customAttributes[t]},OD.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},OD.prototype.getAttributes=function(){return xi({},this.customAttributes)},OD.prototype.setStartTime=function(t){this.startTimeUs=t},OD.prototype.setDuration=function(t){this.durationUs=t},OD.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},OD.createOobTrace=function(t,e,n){var r=Zk.getInstance().getUrl();if(r){var i=new OD("_wt_"+r,!0),o=Math.floor(1e3*Zk.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find((function(t){return"first-paint"===t.name}));a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find((function(t){return"first-contentful-paint"===t.name}));s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}ID(i)}},OD.createUserTimingTrace=function(t){ID(new OD(t,!1,t))},OD);function OD(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Zk.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||Gk+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function PD(t){var e=t;if(e&&void 0!==e.responseStart){var n=Zk.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=iD.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout((function(){return SD().log(t,0)}),0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var MD=5e3;function xD(){aD()&&(setTimeout((function(){return function(){var t=Zk.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout((function(){RD.createOobTrace(e,n),r=void 0}),MD);t.onFirstInputDelay((function(t){r&&(clearTimeout(r),RD.createOobTrace(e,n,t))}))}else RD.createOobTrace(e,n)}()}),0),setTimeout((function(){return function(){for(var t=Zk.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)PD(n[e]);t.setupObserver("resource",PD)}()}),0),setTimeout((function(){return function(){for(var t=Zk.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)LD(n[e]);t.setupObserver("measure",LD)}()}),0))}function LD(t){var e=t.name;e.substring(0,Gk.length)!==Gk&&RD.createUserTimingTrace(e)}var FD=(UD.prototype.trace=function(t){return new RD(t)},Object.defineProperty(UD.prototype,"instrumentationEnabled",{get:function(){return iD.getInstance().instrumentationEnabled},set:function(t){iD.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(UD.prototype,"dataCollectionEnabled",{get:function(){return iD.getInstance().dataCollectionEnabled},set:function(t){iD.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),UD);function UD(t){this.app=t,Zk.getInstance().requiredApisAvailable()?bD().then(xD,xD):hD.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return Wo.INTERNAL.registerService("performance",(function(t){if("[DEFAULT]"!==t.name)throw $k.create("FB not default");if("undefined"==typeof window)throw $k.create("no window");return function(t){Qk=t}(window),iD.getInstance().firebaseAppInstance=t,new FD(t)}),{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Wo}()}).call(this,n(28),n(124).setImmediate,n(37))},124:function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(125),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(28))},125:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},h=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){d(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},f.clearImmediate=p}function p(t){delete c[t]}function d(t){if(h)setTimeout(d,0,t);else{var e=c[t];if(e){h=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{p(t),h=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(28),n(37))}}]);