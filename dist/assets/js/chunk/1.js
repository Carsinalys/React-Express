(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{128:function(t,e,n){(function(e,n,r){t.exports=function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),p(t)},d.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},d.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),p(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(t,e){return new Promise(function(n,i){var o=new w(t,e),a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:function(t){var e=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e}(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new E(e,t))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}function o(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var a=setTimeout;function s(t){return Boolean(t&&void 0!==t.length)}function u(){}function c(t){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],y(t,this)}function h(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,c._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(n){return void f(e.promise,n)}l(e.promise,r)}else(1===t._state?l:f)(e.promise,t._value)})):t._deferreds.push(e)}function l(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof c)return t._state=3,t._value=e,void p(t);if("function"==typeof n)return void y(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,p(t)}catch(e){f(t,e)}}function f(t,e){t._state=2,t._value=e,p(t)}function p(t){2===t._state&&0===t._deferreds.length&&c._immediateFn(function(){t._handled||c._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)h(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function y(t,e){var n=!1;try{t(function(t){n||(n=!0,l(e,t))},function(t){n||(n=!0,f(e,t))})}catch(t){if(n)return;n=!0,f(e,t)}}c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var n=new this.constructor(u);return h(this,new d(t,e,n)),n},c.prototype.finally=o,c.all=function(t){return new c(function(e,n){if(!s(t))return n(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(t,e)},n)}r[t]=a,0==--i&&e(r)}catch(a){n(a)}}for(var a=0;a<r.length;a++)o(a,r[a])})},c.resolve=function(t){return t&&"object"==typeof t&&t.constructor===c?t:new c(function(e){e(t)})},c.reject=function(t){return new c(function(e,n){n(t)})},c.race=function(t){return new c(function(e,n){if(!s(t))return n(new TypeError("Promise.race accepts an array"));for(var r=0,i=t.length;r<i;r++)c.resolve(t[r]).then(e,n)})},c._immediateFn="function"==typeof n&&function(t){n(t)}||function(t){a(t,0)},c._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var m=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();function v(t){return t&&t.Math==Math&&t}function g(t){try{return!!t()}catch(t){return!0}}function b(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function w(t){return V.call(t).slice(8,-1)}function _(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function E(t){return j(_(t))}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function S(t,e){if(!T(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!T(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!T(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function I(t,e){return W.call(t,e)}function C(t){return K?Q.createElement(t):{}}function N(t){if(!T(t))throw TypeError(String(t)+" is not an object");return t}function A(t,e){try{J(x,t,e)}catch(n){x[t]=e}return e}function k(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++rt+it).toString(36)}function D(t){return ot[t]||(ot[t]=k(t))}"Promise"in m?m.Promise.prototype.finally||(m.Promise.prototype.finally=o):m.Promise=c;var R,O,P,M="object",x=v(typeof globalThis==M&&globalThis)||v(typeof window==M&&window)||v(typeof self==M&&self)||v(typeof t==M&&t)||Function("return this")(),L=!g(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),F={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,q={f:U&&!F.call({1:2},1)?function(t){var e=U(this,t);return!!e&&e.enumerable}:F},V={}.toString,B="".split,j=g(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==w(t)?B.call(t,""):Object(t)}:Object,W={}.hasOwnProperty,Q=x.document,K=T(Q)&&T(Q.createElement),H=!L&&!g(function(){return 7!=Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a}),G=Object.getOwnPropertyDescriptor,z={f:L?G:function(t,e){if(t=E(t),e=S(e,!0),H)try{return G(t,e)}catch(t){}if(I(t,e))return b(!q.f.call(t,e),t[e])}},Y=Object.defineProperty,X={f:L?Y:function(t,e,n){if(N(t),e=S(e,!0),N(n),H)try{return Y(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},J=L?function(t,e,n){return X.f(t,e,b(1,n))}:function(t,e,n){return t[e]=n,t},$=!1,Z=i(function(t){var e="__core-js_shared__",n=x[e]||A(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.2.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),tt=Z("native-function-to-string",Function.toString),et=x.WeakMap,nt="function"==typeof et&&/native code/.test(tt.call(et)),rt=0,it=Math.random(),ot=Z("keys"),at={},st=x.WeakMap;if(nt){var ut=new st,ct=ut.get,ht=ut.has,lt=ut.set;R=function(t,e){return lt.call(ut,t,e),e},O=function(t){return ct.call(ut,t)||{}},P=function(t){return ht.call(ut,t)}}else{var ft=D("state");at[ft]=!0,R=function(t,e){return J(t,ft,e),e},O=function(t){return I(t,ft)?t[ft]:{}},P=function(t){return I(t,ft)}}function pt(t){return"function"==typeof t?t:void 0}function dt(t,e){return arguments.length<2?pt(Rt[t])||pt(x[t]):Rt[t]&&Rt[t][e]||x[t]&&x[t][e]}function yt(t){return isNaN(t=+t)?0:(0<t?Pt:Ot)(t)}function mt(t){return 0<t?Mt(yt(t),9007199254740991):0}function vt(t){return function(e,n,r){var i,o=E(e),a=mt(o.length),s=function(t,e){var n=yt(t);return n<0?xt(n+e,0):Lt(n,e)}(r,a);if(t&&n!=n){for(;s<a;)if((i=o[s++])!=i)return!0}else for(;s<a;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}function gt(t,e){var n,r=E(t),i=0,o=[];for(n in r)!I(at,n)&&I(r,n)&&o.push(n);for(;e.length>i;)I(r,n=e[i++])&&(~Ft(o,n)||o.push(n));return o}function bt(t,e){for(var n=jt(e),r=X.f,i=z.f,o=0;o<n.length;o++){var a=n[o];I(t,a)||r(t,a,i(e,a))}}function wt(t,e){var n=Kt[Qt(t)];return n==Gt||n!=Ht&&("function"==typeof e?g(e):!!e)}function _t(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?x:c?x[s]||A(s,{}):(x[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Yt(n,r))&&a.value:n[r],!zt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;bt(o,i)}(t.sham||i&&i.sham)&&J(o,"sham",!0),Dt(n,r,o,t)}}function Et(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Tt(t,e,n){if(Et(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}function St(t){return Object(_(t))}function It(t){return Zt[t]||(Zt[t]=Jt&&$t[t]||(Jt?$t:k)("Symbol."+t))}function Ct(t,e){var n;return Xt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Xt(n.prototype)?T(n)&&null===(n=n[te])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Nt(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=5==t||o;return function(s,u,c,h){for(var l,f,p=St(s),d=j(p),y=Tt(u,c,3),m=mt(d.length),v=0,g=h||Ct,b=e?g(s,m):n?g(s,0):void 0;v<m;v++)if((a||v in d)&&(f=y(l=d[v],v,p),t))if(e)b[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:ee.call(b,l)}else if(i)return!1;return o?-1:r||i?i:b}}function At(){}var kt={set:R,get:O,has:P,enforce:function(t){return P(t)?O(t):R(t,{})},getterFor:function(t){return function(e){var n;if(!T(e)||(n=O(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Dt=i(function(t){var e=kt.get,n=kt.enforce,r=String(tt).split("toString");Z("inspectSource",function(t){return tt.call(t)}),(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||I(i,"name")||J(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==x?(a?!u&&t[e]&&(s=!0):delete t[e],s?t[e]=i:J(t,e,i)):s?t[e]=i:A(e,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||tt.call(this)})}),Rt=x,Ot=Math.ceil,Pt=Math.floor,Mt=Math.min,xt=Math.max,Lt=Math.min,Ft=(vt(!0),vt(!1)),Ut=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qt=Ut.concat("length","prototype"),Vt={f:Object.getOwnPropertyNames||function(t){return gt(t,qt)}},Bt={f:Object.getOwnPropertySymbols},jt=dt("Reflect","ownKeys")||function(t){var e=Vt.f(N(t)),n=Bt.f;return n?e.concat(n(t)):e},Wt=/#|\.prototype\./,Qt=wt.normalize=function(t){return String(t).replace(Wt,".").toLowerCase()},Kt=wt.data={},Ht=wt.NATIVE="N",Gt=wt.POLYFILL="P",zt=wt,Yt=z.f,Xt=Array.isArray||function(t){return"Array"==w(t)},Jt=!!Object.getOwnPropertySymbols&&!g(function(){return!String(Symbol())}),$t=x.Symbol,Zt=Z("wks"),te=It("species"),ee=[].push,ne={forEach:Nt(0),map:Nt(1),filter:Nt(2),some:Nt(3),every:Nt(4),find:Nt(5),findIndex:Nt(6)},re=Object.keys||function(t){return gt(t,Ut)},ie=L?Object.defineProperties:function(t,e){N(t);for(var n,r=re(e),i=r.length,o=0;o<i;)X.f(t,n=r[o++],e[n]);return t},oe=dt("document","documentElement"),ae=D("IE_PROTO"),se="prototype",ue=function(){var t,e=C("iframe"),n=Ut.length;for(e.style.display="none",oe.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ue=t.F;n--;)delete ue[se][Ut[n]];return ue()},ce=Object.create||function(t,e){var n;return null!==t?(At[se]=N(t),n=new At,At[se]=null,n[ae]=t):n=ue(),void 0===e?n:ie(n,e)};at[ae]=!0;var he=It("unscopables"),le=Array.prototype;function fe(t){le[he][t]=!0}null==le[he]&&J(le,he,ce(null));var pe=ne.find,de="find",ye=!0;function me(t,e,n){return Tt(ve,x[t].prototype[e],n)}de in[]&&Array(1)[de](function(){ye=!1}),_t({target:"Array",proto:!0,forced:ye},{find:function(t,e){return pe(this,t,1<arguments.length?e:void 0)}}),fe(de);var ve=Function.call,ge=(me("Array","find"),ne.findIndex),be="findIndex",we=!0;function _e(t){return function(e,n){var r,i,o=String(_(e)),a=yt(n),s=o.length;return a<0||s<=a?t?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(i=o.charCodeAt(a+1))<56320||57343<i?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}be in[]&&Array(1)[be](function(){we=!1}),_t({target:"Array",proto:!0,forced:we},{findIndex:function(t,e){return ge(this,t,1<arguments.length?e:void 0)}}),fe(be),me("Array","findIndex");var Ee,Te,Se,Ie={codeAt:_e(!1),charAt:_e(!0)},Ce=!g(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ne=D("IE_PROTO"),Ae=Object.prototype,ke=Ce?Object.getPrototypeOf:function(t){return I(t=St(t),Ne)?t[Ne]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ae:null},De=It("iterator"),Re=!1;function Oe(t,e,n){t&&!I(t=n?t:t.prototype,Ue)&&Fe(t,Ue,{configurable:!0,value:e})}function Pe(){return this}function Me(){return this}function xe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!We&&t in p)return p[t];switch(t){case"keys":case Ke:case He:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ce(Ve,{next:b(1,n)}),Oe(t,r,!1),qe[r]=Pe}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Qe]||p["@@iterator"]||i&&p[i],y=!We&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=ke(m.call(new t)),je!==Object.prototype&&u.next&&(ke(u)!==je&&(Be?Be(u,je):"function"!=typeof u[Qe]&&J(u,Qe,Me)),Oe(u,l,!0))),i==Ke&&d&&d.name!==Ke&&(f=!0,y=function(){return d.call(this)}),p[Qe]!==y&&J(p,Qe,y),qe[e]=y,i)if(c={values:s(Ke),keys:o?y:s("keys"),entries:s(He)},a)for(h in c)!We&&!f&&h in p||Dt(p,h,c[h]);else _t({target:e,proto:!0,forced:We||f},c);return c}[].keys&&("next"in(Se=[].keys())?(Te=ke(ke(Se)))!==Object.prototype&&(Ee=Te):Re=!0),null==Ee&&(Ee={}),I(Ee,De)||J(Ee,De,function(){return this});var Le={IteratorPrototype:Ee,BUGGY_SAFARI_ITERATORS:Re},Fe=X.f,Ue=It("toStringTag"),qe={},Ve=Le.IteratorPrototype,Be=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(n){}return function(n,r){return N(n),function(t){if(!T(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),je=Le.IteratorPrototype,We=Le.BUGGY_SAFARI_ITERATORS,Qe=It("iterator"),Ke="values",He="entries",Ge=Ie.charAt,ze="String Iterator",Ye=kt.set,Xe=kt.getterFor(ze);function Je(t,e,n,r){try{return r?e(N(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&N(i.call(t)),e}}function $e(t){return void 0!==t&&(qe.Array===t||rn[nn]===t)}function Ze(t,e,n){var r=S(e);r in t?X.f(t,r,b(0,n)):t[r]=n}function tn(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),on))?n:an?w(e):"Object"==(r=w(e))&&"function"==typeof e.callee?"Arguments":r}function en(t){if(null!=t)return t[sn]||t["@@iterator"]||qe[tn(t)]}xe(String,"String",function(t){Ye(this,{type:ze,string:String(t),index:0})},function(){var t,e=Xe(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ge(n,r),e.index+=t.length,{value:t,done:!1})});var nn=It("iterator"),rn=Array.prototype,on=It("toStringTag"),an="Arguments"==w(function(){return arguments}()),sn=It("iterator"),un=It("iterator"),cn=!1;try{var hn=0,ln={next:function(){return{done:!!hn++}},return:function(){cn=!0}};ln[un]=function(){return this},Array.from(ln,function(){throw 2})}catch(Co){}function fn(t,e){if(!e&&!cn)return!1;var n=!1;try{var r={};r[un]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}_t({target:"Array",stat:!0,forced:!fn(function(t){Array.from(t)})},{from:function(t,e,n){var r,i,o,a,s=St(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=en(s);if(l&&(h=Tt(h,2<c?n:void 0,2)),null==p||u==Array&&$e(p))for(i=new u(r=mt(s.length));f<r;f++)Ze(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Ze(i,f,l?Je(a,h,[o.value,f],!0):o.value);return i.length=f,i}}),Rt.Array.from;var pn,dn=ne.some;_t({target:"Array",proto:!0,forced:(pn=[].some,!pn||!g(function(){pn.call(null,function(){throw 1},1)}))},{some:function(t,e){return dn(this,t,1<arguments.length?e:void 0)}}),me("Array","some");var yn=Object.assign,mn=!yn||g(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=yn({},t)[n]||re(yn({},e)).join("")!=r})?function(t,e){for(var n=St(t),r=arguments.length,i=1,o=Bt.f,a=q.f;i<r;)for(var s,u=j(arguments[i++]),c=o?re(u).concat(o(u)):re(u),h=c.length,l=0;l<h;)s=c[l++],L&&!a.call(u,s)||(n[s]=u[s]);return n}:yn;function vn(t){return function(e){for(var n,r=E(e),i=re(r),o=i.length,a=0,s=[];a<o;)n=i[a++],L&&!gn.call(r,n)||s.push(t?[n,r[n]]:r[n]);return s}}_t({target:"Object",stat:!0,forced:Object.assign!==mn},{assign:mn}),Rt.Object.assign;var gn=q.f,bn={entries:vn(!0),values:vn(!1)},wn=bn.entries;_t({target:"Object",stat:!0},{entries:function(t){return wn(t)}}),Rt.Object.entries;var _n=bn.values;function En(t){if(function(t){var e;return T(t)&&(void 0!==(e=t[Tn])?!!e:"RegExp"==w(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}_t({target:"Object",stat:!0},{values:function(t){return _n(t)}}),Rt.Object.values;var Tn=It("match"),Sn=It("match"),In="".startsWith,Cn=Math.min;function Nn(t){if(!T(t))return!1;var e=t[kn];return void 0!==e?!!e:Xt(t)}_t({target:"String",proto:!0,forced:!function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Sn]=!1,"/./"[t](e)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(_(this));En(t);var r=mt(Cn(1<arguments.length?e:void 0,n.length)),i=String(t);return In?In.call(n,i,r):n.slice(r,r+i.length)===i}}),me("String","startsWith"),_t({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(_(this)),n="",r=yt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),me("String","repeat");var An=It("species"),kn=It("isConcatSpreadable"),Dn=9007199254740991,Rn="Maximum allowed index exceeded",On=!g(function(){var t=[];return t[kn]=!1,t.concat()[0]!==t}),Pn=!g(function(){var t=[];return(t.constructor={})[An]=function(){return{foo:1}},1!==t.concat(Boolean).foo});_t({target:"Array",proto:!0,forced:!On||!Pn},{concat:function(t){var e,n,r,i,o,a=St(this),s=Ct(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Nn(o=-1===e?a:arguments[e])){if(i=mt(o.length),Dn<u+i)throw TypeError(Rn);for(n=0;n<i;n++,u++)n in o&&Ze(s,u,o[n])}else{if(Dn<=u)throw TypeError(Rn);Ze(s,u++,o)}return s.length=u,s}});var Mn={};Mn[It("toStringTag")]="z";var xn="[object z]"!==String(Mn)?function(){return"[object "+tn(this)+"]"}:Mn.toString,Ln=Object.prototype;function Fn(t){var e=Rt.Symbol||(Rt.Symbol={});I(e,t)||Gn(e,t,{value:Hn.f(t)})}function Un(t,e){var n=cr[t]=ce(nr[Jn]);return Zn(n,{type:Xn,tag:t,description:e}),L||(n.description=e),n}function qn(t,e){N(t);var n=E(e),r=re(n).concat(wr(n));return zn(r,function(e){L&&!br.call(n,e)||gr(t,e,n[e])}),t}function Vn(t,e){var n=E(t),r=S(e,!0);if(n!==er||!I(cr,r)||I(hr,r)){var i=or(n,r);return!i||!I(cr,r)||I(n,Yn)&&n[Yn][r]||(i.enumerable=!0),i}}function Bn(t){var e=sr(E(t)),n=[];return zn(e,function(t){I(cr,t)||I(at,t)||n.push(t)}),n}xn!==Ln.toString&&Dt(Ln,"toString",xn,{unsafe:!0});var jn=Vt.f,Wn={}.toString,Qn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Kn={f:function(t){return Qn&&"[object Window]"==Wn.call(t)?function(t){try{return jn(t)}catch(t){return Qn.slice()}}(t):jn(E(t))}},Hn={f:It},Gn=X.f,zn=ne.forEach,Yn=D("hidden"),Xn="Symbol",Jn="prototype",$n=It("toPrimitive"),Zn=kt.set,tr=kt.getterFor(Xn),er=Object[Jn],nr=x.Symbol,rr=x.JSON,ir=rr&&rr.stringify,or=z.f,ar=X.f,sr=Kn.f,ur=q.f,cr=Z("symbols"),hr=Z("op-symbols"),lr=Z("string-to-symbol-registry"),fr=Z("symbol-to-string-registry"),pr=Z("wks"),dr=x.QObject,yr=!dr||!dr[Jn]||!dr[Jn].findChild,mr=L&&g(function(){return 7!=ce(ar({},"a",{get:function(){return ar(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=or(er,e);r&&delete er[e],ar(t,e,n),r&&t!==er&&ar(er,e,r)}:ar,vr=Jt&&"symbol"==typeof nr.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof nr},gr=function(t,e,n){t===er&&gr(hr,e,n),N(t);var r=S(e,!0);return N(n),I(cr,r)?(n.enumerable?(I(t,Yn)&&t[Yn][r]&&(t[Yn][r]=!1),n=ce(n,{enumerable:b(0,!1)})):(I(t,Yn)||ar(t,Yn,b(1,{})),t[Yn][r]=!0),mr(t,r,n)):ar(t,r,n)},br=function(t){var e=S(t,!0),n=ur.call(this,e);return!(this===er&&I(cr,e)&&!I(hr,e))&&(!(n||!I(this,e)||!I(cr,e)||I(this,Yn)&&this[Yn][e])||n)},wr=function(t){var e=t===er,n=sr(e?hr:E(t)),r=[];return zn(n,function(t){!I(cr,t)||e&&!I(er,t)||r.push(cr[t])}),r};Jt||(Dt((nr=function(t){if(this instanceof nr)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=k(e),r=function(t){this===er&&r.call(hr,t),I(this,Yn)&&I(this[Yn],n)&&(this[Yn][n]=!1),mr(this,n,b(1,t))};return L&&yr&&mr(er,n,{configurable:!0,set:r}),Un(n,e)})[Jn],"toString",function(){return tr(this).tag}),q.f=br,X.f=gr,z.f=Vn,Vt.f=Kn.f=Bn,Bt.f=wr,L&&(ar(nr[Jn],"description",{configurable:!0,get:function(){return tr(this).description}}),Dt(er,"propertyIsEnumerable",br,{unsafe:!0})),Hn.f=function(t){return Un(It(t),t)}),_t({global:!0,wrap:!0,forced:!Jt,sham:!Jt},{Symbol:nr}),zn(re(pr),function(t){Fn(t)}),_t({target:Xn,stat:!0,forced:!Jt},{for:function(t){var e=String(t);if(I(lr,e))return lr[e];var n=nr(e);return lr[e]=n,fr[n]=e,n},keyFor:function(t){if(!vr(t))throw TypeError(t+" is not a symbol");if(I(fr,t))return fr[t]},useSetter:function(){yr=!0},useSimple:function(){yr=!1}}),_t({target:"Object",stat:!0,forced:!Jt,sham:!L},{create:function(t,e){return void 0===e?ce(t):qn(ce(t),e)},defineProperty:gr,defineProperties:qn,getOwnPropertyDescriptor:Vn}),_t({target:"Object",stat:!0,forced:!Jt},{getOwnPropertyNames:Bn,getOwnPropertySymbols:wr}),_t({target:"Object",stat:!0,forced:g(function(){Bt.f(1)})},{getOwnPropertySymbols:function(t){return Bt.f(St(t))}}),rr&&_t({target:"JSON",stat:!0,forced:!Jt||g(function(){var t=nr();return"[null]"!=ir([t])||"{}"!=ir({a:t})||"{}"!=ir(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(T(e)||void 0!==t)&&!vr(t))return Xt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!vr(e))return e}),r[1]=e,ir.apply(rr,r)}}),nr[Jn][$n]||J(nr[Jn],$n,nr[Jn].valueOf),Oe(nr,Xn),at[Yn]=!0,Fn("asyncIterator");var _r=X.f,Er=x.Symbol;if(L&&"function"==typeof Er&&!("description"in Er.prototype&&void 0===Er().description)){var Tr={},Sr=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Sr?new Er(e):void 0===e?Er():Er(e);return""===e&&(Tr[n]=!0),n};bt(Sr,Er);var Ir=Sr.prototype=Er.prototype;Ir.constructor=Sr;var Cr=Ir.toString,Nr="Symbol(test)"==String(Er("test")),Ar=/^Symbol\((.*)\)[^)]+$/;_r(Ir,"description",{configurable:!0,get:function(){var t=T(this)?this.valueOf():this,e=Cr.call(t);if(I(Tr,t))return"";var n=Nr?e.slice(7,-1):e.replace(Ar,"$1");return""===n?void 0:n}}),_t({global:!0,forced:!0},{Symbol:Sr})}Fn("hasInstance"),Fn("isConcatSpreadable"),Fn("iterator"),Fn("match"),Fn("matchAll"),Fn("replace"),Fn("search"),Fn("species"),Fn("split"),Fn("toPrimitive"),Fn("toStringTag"),Fn("unscopables"),Oe(Math,"Math",!0),Oe(x.JSON,"JSON",!0),Rt.Symbol,Fn("asyncDispose"),Fn("dispose"),Fn("observable"),Fn("patternMatch"),Fn("replaceAll");var kr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Dr="Array Iterator",Rr=kt.set,Or=kt.getterFor(Dr),Pr=xe(Array,"Array",function(t,e){Rr(this,{type:Dr,target:E(t),index:0,kind:e})},function(){var t=Or(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");qe.Arguments=qe.Array,fe("keys"),fe("values"),fe("entries");var Mr=It("iterator"),xr=It("toStringTag"),Lr=Pr.values;for(var Fr in kr){var Ur=x[Fr],qr=Ur&&Ur.prototype;if(qr){if(qr[Mr]!==Lr)try{J(qr,Mr,Lr)}catch(Co){qr[Mr]=Lr}if(qr[xr]||J(qr,xr,Fr),kr[Fr])for(var Vr in Pr)if(qr[Vr]!==Pr[Vr])try{J(qr,Vr,Pr[Vr])}catch(Co){qr[Vr]=Pr[Vr]}}}function Br(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function jr(t,e,n,r,i){function o(t){var e=s[t];Dt(s,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return i&&!T(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!T(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})}var a=x[t],s=a&&a.prototype,u=a,c=r?"set":"add",h={};if(zt(t,"function"!=typeof a||!(i||s.forEach&&!g(function(){(new a).entries().next()}))))u=n.getConstructor(e,t,r,c),Hr.REQUIRED=!0;else if(zt(t,!0)){var l=new u,f=l[c](i?{}:-0,1)!=l,p=g(function(){l.has(1)}),d=fn(function(t){new a(t)}),y=!i&&g(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=e(function(e,n){Br(e,u,t);var i=function(t,e,n){var r,i;return Be&&"function"==typeof(r=e.constructor)&&r!==n&&T(i=r.prototype)&&i!==n.prototype&&Be(t,i),t}(new a,e,u);return null!=n&&Gr(n,i[c],i,r),i})).prototype=s).constructor=u),(p||y)&&(o("delete"),o("has"),r&&o("get")),(y||f)&&o(c),i&&s.clear&&delete s.clear}return h[t]=u,_t({global:!0,forced:u!=a},h),Oe(u,t),i||n.setStrong(u,t,r),u}function Wr(t,e,n){for(var r in e)Dt(t,r,e[r],n);return t}function Qr(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Et(this),(r=void 0!==u)&&Et(u),null==t?new this:(i=[],r?(o=0,a=Tt(u,2<s?n:void 0,2),Gr(t,function(t){i.push(a(t,o++))})):Gr(t,i.push,i),new this(i))}Hn.f("iterator");var Kr=!g(function(){return Object.isExtensible(Object.preventExtensions({}))}),Hr=i(function(t){function e(t){n(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var n=X.f,r=k("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,n){if(!T(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!I(t,r)){if(!o(t))return"F";if(!n)return"E";e(t)}return t[r].objectID},getWeakData:function(t,n){if(!I(t,r)){if(!o(t))return!0;if(!n)return!1;e(t)}return t[r].weakData},onFreeze:function(t){return Kr&&a.REQUIRED&&o(t)&&!I(t,r)&&e(t),t}};at[r]=!0}),Gr=(Hr.REQUIRED,Hr.fastKey,Hr.getWeakData,Hr.onFreeze,i(function(t){function e(t,e){this.stopped=t,this.result=e}(t.exports=function(t,n,r,i,o){var a,s,u,c,h,l,f=Tt(n,r,i?2:1);if(o)a=t;else{if("function"!=typeof(s=en(t)))throw TypeError("Target is not iterable");if($e(s)){for(u=0,c=mt(t.length);u<c;u++)if((h=i?f(N(l=t[u])[0],l[1]):f(t[u]))&&h instanceof e)return h;return new e(!1)}a=s.call(t)}for(;!(l=a.next()).done;)if((h=Je(a,f,l.value,i))&&h instanceof e)return h;return new e(!1)}).stop=function(t){return new e(!0,t)}})),zr=It("species"),Yr=X.f,Xr=Hr.fastKey,Jr=kt.set,$r=kt.getterFor,Zr={getConstructor:function(t,e,n,r){function i(t,e,n){var r,i,o=a(t),u=s(t,e);return u?u.value=n:(o.last=u={index:i=Xr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=u),r&&(r.next=u),L?o.size++:t.size++,"F"!==i&&(o.index[i]=u)),t}var o=t(function(t,i){Br(t,o,e),Jr(t,{type:e,index:ce(null),first:void 0,last:void 0,size:0}),L||(t.size=0),null!=i&&Gr(i,t[r],t,n)}),a=$r(e),s=function(t,e){var n,r=a(t),i=Xr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Wr(o.prototype,{clear:function(){for(var t=a(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,L?t.size=0:this.size=0},delete:function(t){var e=a(this),n=s(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),L?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=a(this),i=Tt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!s(this,t)}}),Wr(o.prototype,n?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return i(this,0===t?0:t,e)}}:{add:function(t){return i(this,t=0===t?0:t,t)}}),L&&Yr(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,n){var r=e+" Iterator",i=$r(e),o=$r(r);xe(t,e,function(t,e){Jr(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),function(t){var e=dt(t),n=X.f;L&&e&&!e[zr]&&n(e,zr,{configurable:!0,get:function(){return this}})}(e)}};function ti(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}function ei(){for(var t,e=N(this),n=Et(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}function ni(t){return Map.prototype.entries.call(t)}function ri(t,e){var n,r=N(t).constructor;return void 0===r||null==(n=N(r)[ii])?e:Et(n)}jr("Map",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Zr,!0),Rt.Map,_t({target:"Map",stat:!0},{from:Qr}),_t({target:"Map",stat:!0},{of:ti}),_t({target:"Map",proto:!0,real:!0,forced:$},{deleteAll:function(){return ei.apply(this,arguments)}}),_t({target:"Map",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3);return!Gr(r,function(t,e){if(!i(e,t,n))return Gr.stop()},void 0,!0,!0).stopped}});var ii=It("species");function oi(t){return Set.prototype.values.call(t)}_t({target:"Map",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ri(n,dt("Map"))),a=Et(o.set);return Gr(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3);return Gr(r,function(t,e){if(i(e,t,n))return Gr.stop(e)},void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{findKey:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3);return Gr(r,function(t,e){if(i(e,t,n))return Gr.stop(t)},void 0,!0,!0).result}}),_t({target:"Map",stat:!0},{groupBy:function(t,e){var n=new this;Et(e);var r=Et(n.has),i=Et(n.get),o=Et(n.set);return Gr(t,function(t){var a=e(t);r.call(n,a)?i.call(n,a).push(t):o.call(n,a,[t])}),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{includes:function(t){return Gr(ni(N(this)),function(e,n){if(function(e,n){return e===t||e!=e&&t!=t}(n))return Gr.stop()},void 0,!0,!0).stopped}}),_t({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Et(e);var r=Et(n.set);return Gr(t,function(t){r.call(n,e(t),t)}),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{keyOf:function(t){return Gr(ni(N(this)),function(e,n){if(n===t)return Gr.stop(e)},void 0,!0,!0).result}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapKeys:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ri(n,dt("Map"))),a=Et(o.set);return Gr(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{mapValues:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ri(n,dt("Map"))),a=Et(o.set);return Gr(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),_t({target:"Map",proto:!0,real:!0,forced:$},{merge:function(t){for(var e=N(this),n=Et(e.set),r=0;r<arguments.length;)Gr(arguments[r++],n,e,!0);return e}}),_t({target:"Map",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=ni(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty map with no initial value");n=r.value[1]}return Gr(o,function(e,r){n=t(n,r,e,i)},void 0,!0,!0),n}}),_t({target:"Map",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=ni(n),i=Tt(t,1<arguments.length?e:void 0,3);return Gr(r,function(t,e){if(i(e,t,n))return Gr.stop()},void 0,!0,!0).stopped}}),_t({target:"Map",proto:!0,real:!0,forced:$},{update:function(t,e,n){var r=N(this),i=arguments.length;Et(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Et(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}}),_t({target:"Map",proto:!0,real:!0,forced:$},{updateOrInsert:function(t,e,n){var r=N(this);Et(e),Et(n);var i=r.has(t)?e(r.get(t)):n();return r.set(t,i),i}}),jr("Set",function(t){return function(e){return t(this,arguments.length?e:void 0)}},Zr),Rt.Set,_t({target:"Set",stat:!0},{from:Qr}),_t({target:"Set",stat:!0},{of:ti}),_t({target:"Set",proto:!0,real:!0,forced:$},{addAll:function(){return function(){for(var t=N(this),e=Et(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{deleteAll:function(){return ei.apply(this,arguments)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{every:function(t,e){var n=N(this),r=oi(n),i=Tt(t,1<arguments.length?e:void 0,3);return!Gr(r,function(t){if(!i(t,t,n))return Gr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{difference:function(t){var e=N(this),n=new(ri(e,dt("Set")))(e),r=Et(n.delete);return Gr(t,function(t){r.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{filter:function(t,e){var n=N(this),r=oi(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ri(n,dt("Set"))),a=Et(o.add);return Gr(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{find:function(t,e){var n=N(this),r=oi(n),i=Tt(t,1<arguments.length?e:void 0,3);return Gr(r,function(t){if(i(t,t,n))return Gr.stop(t)},void 0,!1,!0).result}}),_t({target:"Set",proto:!0,real:!0,forced:$},{intersection:function(t){var e=N(this),n=new(ri(e,dt("Set"))),r=Et(e.has),i=Et(n.add);return Gr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isDisjointFrom:function(t){var e=N(this),n=Et(e.has);return!Gr(t,function(t){if(!0===n.call(e,t))return Gr.stop()}).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSubsetOf:function(t){var e=function(t){var e=en(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return N(e.call(t))}(this),n=N(t),r=n.has;return"function"!=typeof r&&(n=new(dt("Set"))(t),r=Et(n.has)),!Gr(e,function(t){if(!1===r.call(n,t))return Gr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{isSupersetOf:function(t){var e=N(this),n=Et(e.has);return!Gr(t,function(t){if(!1===n.call(e,t))return Gr.stop()}).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{join:function(t){var e=oi(N(this)),n=void 0===t?",":String(t),r=[];return Gr(e,r.push,r,!1,!0),r.join(n)}}),_t({target:"Set",proto:!0,real:!0,forced:$},{map:function(t,e){var n=N(this),r=oi(n),i=Tt(t,1<arguments.length?e:void 0,3),o=new(ri(n,dt("Set"))),a=Et(o.add);return Gr(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),_t({target:"Set",proto:!0,real:!0,forced:$},{reduce:function(t,e){var n,r,i=N(this),o=oi(i);if(Et(t),1<arguments.length)n=e;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return Gr(o,function(e){n=t(n,e,e,i)},void 0,!1,!0),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{some:function(t,e){var n=N(this),r=oi(n),i=Tt(t,1<arguments.length?e:void 0,3);return Gr(r,function(t){if(i(t,t,n))return Gr.stop()},void 0,!1,!0).stopped}}),_t({target:"Set",proto:!0,real:!0,forced:$},{symmetricDifference:function(t){var e=N(this),n=new(ri(e,dt("Set")))(e),r=Et(n.delete),i=Et(n.add);return Gr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),_t({target:"Set",proto:!0,real:!0,forced:$},{union:function(t){var e=N(this),n=new(ri(e,dt("Set")))(e);return Gr(t,Et(n.add),n),n}});var ai=function(t,e){return(ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function si(t,e){function n(){this.constructor=t}ai(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ui=function(){return(ui=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ci(t,e,n,r){return new(n=n||Promise)(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function hi(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function li(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function fi(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function pi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(fi(arguments[e]));return t}function di(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function yi(t){try{return bi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var mi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},vi=function(t,e){if(!t)throw gi(e)},gi=function(t){return new Error("Firebase Database ("+mi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},bi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(di(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function wi(t){return _i(void 0,t)}function _i(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=_i(t[n],e[n]));return t}var Ei=(Ti.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},Ti);function Ti(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}function Si(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ii(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Si())}function Ci(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ni(){return!0===mi.NODE_ADMIN}var Ai,ki=(si(Di,Ai=Error),Di);function Di(t,e){var n=Ai.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Di.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ri.prototype.create),n}var Ri=(Oi.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return o.replace(Pi,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(0,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new ki(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Oi);function Oi(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Pi=/\{\$([^}]+)}/g;function Mi(t){return JSON.parse(t)}function xi(t){return JSON.stringify(t)}function Li(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Mi(yi(o[0])||""),n=Mi(yi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Fi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ui(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function qi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Vi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Bi=(ji.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},ji.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},ji.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},ji.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},ji);function ji(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Wi(t,e){var n=new Hi(t,e);return n.subscribe.bind(n)}var Qi,Ki,Hi=(Gi.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},Gi.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},Gi.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Gi.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=zi),void 0===r.error&&(r.error=zi),void 0===r.complete&&(r.complete=zi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Gi.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Gi.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Gi.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Gi.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Gi);function Gi(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function zi(){}function Yi(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Xi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function Ji(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Xi(t,e,r)+"must be a valid function.")}function $i(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Xi(t,e,r)+"must be a valid context object.")}function Zi(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}function to(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Qi.DEBUG:case Qi.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}(Ki=Qi=Qi||{})[Ki.DEBUG=0]="DEBUG",Ki[Ki.VERBOSE=1]="VERBOSE",Ki[Ki.INFO=2]="INFO",Ki[Ki.WARN=3]="WARN",Ki[Ki.ERROR=4]="ERROR",Ki[Ki.SILENT=5]="SILENT";var eo,no=Qi.INFO,ro=(Object.defineProperty(io.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Qi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(io.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),io.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.DEBUG].concat(t))},io.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.VERBOSE].concat(t))},io.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.INFO].concat(t))},io.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.WARN].concat(t))},io.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.ERROR].concat(t))},io);function io(t){this.name=t,this._logLevel=no,this._logHandler=to}var oo=((eo={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",eo["bad-app-name"]="Illegal App name: '{$appName}",eo["duplicate-app"]="Firebase App named '{$appName}' already exists",eo["app-deleted"]="Firebase App named '{$appName}' already deleted",eo["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",eo),ao=new Ri("app","Firebase",oo),so="[DEFAULT]",uo=[],co=(Object.defineProperty(ho.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(ho.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(ho.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),ho.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},ho.prototype._getService=function(t,e){if(void 0===e&&(e=so),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==so?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},ho.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=so),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},ho.prototype.extendApp=function(t){var e=this;_i(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(uo.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),uo=[])},ho.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ao.create("app-deleted",{appName:this.name_})},ho);function ho(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=wi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){uo.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){uo=uo.filter(function(e){return e!==t})}}}co.prototype.name&&co.prototype.options||co.prototype.delete||console.log("dc");var lo=new ro("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){lo.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var fo=self.firebase.SDK_VERSION;fo&&0<=fo.indexOf("LITE")&&lo.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var po=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var o=r;void 0===o.name&&(o.name=so);var a=o.name;if("string"!=typeof a||!a)throw ao.create("bad-app-name",{appName:String(a)});if(Fi(e,a))throw ao.create("duplicate-app",{appName:a});var u=new t(n,o,i);return s(e[a]=u,"create"),u},app:o,apps:null,SDK_VERSION:"6.4.2",INTERNAL:{registerService:function(e,s,u,c,h){if(void 0===h&&(h=!1),n[e])return lo.debug("There were multiple attempts to register service "+e+"."),i[e];function l(t){if(void 0===t&&(t=o()),"function"!=typeof t[e])throw ao.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=s,c&&(r[e]=c,a().forEach(function(t){c("create",t)})),void 0!==u&&_i(l,u),i[e]=l,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,h?t:[])},l},removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u}};function o(t){if(!Fi(e,t=t||so))throw ao.create("no-app",{appName:t});return e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=u(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function u(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:a}),o.App=t,i}(co);return e.INTERNAL=ui({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){_i(e,t)},createSubscribe:Wi,ErrorFactory:Ri,deepExtend:_i}),e}(),yo=po.initializeApp;po.initializeApp=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}()&&lo.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),yo.apply(void 0,t)};var mo=po;(function(){var t,n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},r="undefined"!=typeof window&&window===this?this:void 0!==e&&null!=e?e:this;function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var i=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(e=e(o=i[t=t[t.length-1]]))!=o&&null!=e&&n(i,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function n(){this.a=null}function o(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;n.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var a=r.setTimeout;n.prototype.c=function(t){a(t,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},n.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.o),reject:t(this.g)}},e.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.u(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.l(t):this.h(t)}},e.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},e.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new n;return e.prototype.u=function(t){var e=this.f();t.Ha(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(e){o(e)}}:e}var i,o,a=new e(function(t,e){i=t,o=e});return this.Ha(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ha=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).Ha(e,n)})},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e(function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}for(var a=[],s=0;a.push(void 0),s++,o(r.value).Ha(i(a.length-1),e),!(r=n.next()).done;);})},e});var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+\/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function d(t){return"array"==f(t)}function y(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==f(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),b=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function _(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:_).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function I(t,e){function n(){}n.prototype=e.prototype,t.mb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).ad=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function C(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function N(t){if(Error.captureStackTrace)Error.captureStackTrace(this,N);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function A(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");N.call(this,n+t[r])}function k(t,e){throw new A("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function D(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function R(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function O(){this.b=this.a=null}I(N,Error),N.prototype.name="CustomError",I(A,N),A.prototype.name="AssertionError",D.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var P=new D(function(){return new M},function(t){t.reset()});function M(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;k("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}O.prototype.add=function(t,e){var n=P.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},M.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},M.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},q=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=L(t,e)}function B(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function j(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length})}function W(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function H(t){for(var e in t)return!1;return!0}function G(t){var e,n={};for(e in t)n[e]=t[e];return n}var z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<z.length;o++)n=z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t,e){this.a=t===Z&&e||"",this.b=$}function J(t){return t instanceof X&&t.constructor===X&&t.b===$?t.a:(k("expected object of type Const, got '"+t+"'"),"type_error:Const")}X.prototype.na=!0,X.prototype.ma=function(){return this.a},X.prototype.toString=function(){return"Const{"+this.a+"}"};var $={},Z={},tt=new X(Z,"");function et(){this.a="",this.b=at}function nt(t){return t instanceof et&&t.constructor===et&&t.b===at?t.a:(k("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function rt(t,e){var n=J(t);if(!ot.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return st(t=n.replace(it,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof X?J(t):encodeURIComponent(String(t))}))}et.prototype.na=!0,et.prototype.ma=function(){return this.a.toString()},et.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var it=/%{(\w+)}/g,ot=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,at={};function st(t){var e=new et;return e.a=t,e}var ut=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ct=/&/g,ht=/</g,lt=/>/g,ft=/"/g,pt=/'/g,dt=/\x00/g,yt=/[\x00&<>"']/;function mt(t,e){return-1!=t.indexOf(e)}function vt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function bt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(k("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}gt.prototype.na=!0,gt.prototype.ma=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var wt=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function _t(t){return t instanceof gt?t:(t="object"==typeof t&&t.na?t.ma():String(t),wt.test(t)||(t="about:invalid#zClosurez"),St(t))}var Et,Tt={};function St(t){var e=new gt;return e.a=t,e}St("about:blank");t:{var It=a.navigator;if(It){var Ct=It.userAgent;if(Ct){Et=Ct;break t}}Et=""}function Nt(t){return mt(Et,t)}function At(){this.a="",this.b=Dt}function kt(t){return t instanceof At&&t.constructor===At&&t.b===Dt?t.a:(k("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}At.prototype.na=!0,At.prototype.ma=function(){return this.a.toString()},At.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Dt={};function Rt(t){var e=new At;return e.a=t,e}Rt("<!DOCTYPE html>");var Ot,Pt,Mt=Rt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return yt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ct,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ht,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(lt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(ft,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(pt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(dt,"&#0;"))),t}function Ft(t){a.setTimeout(function(){throw t},0)}function Ut(t,e){Pt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Pt=function(){t.then(Bt)}}else Pt=function(){var t=Bt;!m(a.setImmediate)||a.Window&&a.Window.prototype&&!Nt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Ot=Ot||function(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Nt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=st(J(tt));x(t,"HTMLIFrameElement"),t.src=nt(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(kt(Mt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=E(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Nt("Trident")||Nt("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).ub;n.ub=null,t()}},function(t){r.next={ub:t},r=r.next,e.port2.postMessage(0)}}())(t):a.setImmediate(t)}}(),qt||(Pt(),qt=!0),Vt.add(t,e)}Rt("<br>");var qt=!1,Vt=new O;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Ft(t)}R(P,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,function(t){ee(n,Qt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Kt,t)})}catch(t){ee(this,Kt,t)}}var Wt=0,Qt=2,Kt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new D(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(l);return ee(e,Qt,t),e}function Xt(t){return new jt(function(e,n){n(t)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(t){return new jt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Cb:!0,value:o}:{Cb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Jt(t[o],T(i,o,!0),T(i,o,!1));else e(r)})}function Zt(t,e){t.b||t.a!=Qt&&t.a!=Kt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,e,n,r){var i=zt(null,null,null);return i.a=new jt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof ue?o(e):t(i)}catch(e){o(e)}}:o}),Zt(i.a.c=t,i),i.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Kt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Jc,t.Kc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Kt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||l,n||null,r)),!0;if(C(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Ub,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Kt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}R(Gt,e)}function ae(t,e,n){e==Qt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ha=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Kt,n)))}e.c=null}else ee(e,Kt,n)}(this,new ue(t))},this)},t.Jc=function(t){this.a=Wt,ee(this,Qt,t)},t.Kc=function(t){this.a=Wt,ee(this,Kt,t)},t.Ub=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Ft;function ue(t){N.call(this,t)}function ce(){this.qa=this.qa,this.ia=this.ia}I(ue,N);var he=0;function le(t){t.qa||(t.qa=!0,t.va(),0==he)||t[g]||(t[g]=++b)}function fe(t){return fe[" "](t),t}ce.prototype.qa=!(ue.prototype.name="cancel"),ce.prototype.va=function(){if(this.ia)for(;this.ia.length;)this.ia.shift()()},fe[" "]=l;var pe,de,ye=Nt("Opera"),me=Nt("Trident")||Nt("MSIE"),ve=Nt("Edge"),ge=ve||me,be=Nt("Gecko")&&!(mt(Et.toLowerCase(),"webkit")&&!Nt("Edge"))&&!(Nt("Trident")||Nt("MSIE"))&&!Nt("Edge"),we=mt(Et.toLowerCase(),"webkit")&&!Nt("Edge");function _e(){var t=a.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=Et,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(t){return function(e,n){var r=Ce;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=ut(String(pe)).split("."),r=ut(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=vt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||vt(0==a[2].length,0==s[2].length)||vt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}Ie=a.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Ib=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Ib=!1},I(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.mb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++Le,this.oa=this.Ga=!1}function Ue(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&B(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ga=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ga=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Qe(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Qe(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!1,r,i)}function Ke(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=$e,e=ke?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,v(r)?!!r.capture:!!r,i):Ke(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.m,(e=String(e).toString())in t.a&&-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[xe])Ve(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.La||t.src;return t.Ga&&ze(t),n.call(r,e)}function $e(t,e){if(t.oa)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(t){return m(t)?t:(t[tn]||(t[tn]=function(e){return t.handleEvent(e)}),t[tn])}function nn(){ce.call(this),this.m=new qe(this),(this.Nb=this).Ua=null}function rn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.La||a.src;a.Ga&&Ve(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ib}function sn(t,e,n){if(m(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function un(t){var e=null;return new jt(function(n,r){-1==(e=sn(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw a.clearTimeout(e),t})}function cn(t){if(t.S&&"function"==typeof t.S)return t.S();if(s(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}I(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Qe(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Ua;if(n)for(e=[];n;n=n.Ua)e.push(n);n=this.Nb;var r=t.type||t;if(s(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;Y(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.va=function(){if(nn.mb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Ua=null},(t=ln.prototype).S=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.m),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return s(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)vn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(mt(i,"./")||mt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(t){t.a||(t.a=new ln,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),Q(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){On(this),this.a.forEach(function(n,r){F(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){On(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){On(this);var e=[];if(s(t))xn(this,t)&&(e=W(e,this.a.get(Un(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return s(t)?e.getElementById(t):t}function Bn(t,e){K(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:jn.hasOwnProperty(n)?t.setAttribute(jn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),zn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":zn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Kn,t,e),e.join("")}function Kn(){}var Hn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Gn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function zn(t,e){e.push('"',t.replace(Gn,function(t){var e=Hn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Hn[t]=e),e}),'"')}function Yn(){var t=dr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Xn(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function Jn(t,e){e=e||a.window;var n="about:blank";t&&(n=bt(_t(t)).toString()),e.location.href=n}function $n(t){return!!((t=(t||dr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Zn(t){t=t||a.window;try{t.close()}catch(t){}}function tr(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=dr().toLowerCase(),r&&(e.target=r,mt(n,"crios/")&&(e.target="_blank")),lr(dr())==cr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:_t(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Nt("iPhone")&&!Nt("iPod")&&!Nt("iPad")||Nt("iPad")||Nt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.na?e.ma():String(e),wt.test(e)||(e="about:invalid#zClosurez"),e=St(e)),a.href=bt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=bt(e).toString(),a&&(ge&&mt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Rt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(kt(t)),a.document.close())):(a=r.open(bt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var er=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nr=/^[^@]+@[^@]+$/;function rr(){var t=null;return new jt(function(e){"complete"==a.document.readyState?e():(t=function(){e()},He(window,"load",t))}).s(function(e){throw Ge(window,"load",t),e})}function ir(t){return t=t||dr(),!("file:"!==br()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function or(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function ar(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function sr(){return mo.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":mo.INTERNAL.hasOwnProperty("node")?"Node":ar()?"Worker":"Browser"}function ur(){var t=sr();return"ReactNative"===t||"Node"===t}var cr="Firefox",hr="Chrome";function lr(t){var e=t.toLowerCase();return mt(e,"opera/")||mt(e,"opr/")||mt(e,"opios/")?"Opera":mt(e,"iemobile")?"IEMobile":mt(e,"msie")||mt(e,"trident/")?"IE":mt(e,"edge/")?"Edge":mt(e,"firefox/")?cr:mt(e,"silk/")?"Silk":mt(e,"blackberry")?"Blackberry":mt(e,"webos")?"Webos":!mt(e,"safari/")||mt(e,"chrome/")||mt(e,"crios/")||mt(e,"android")?!mt(e,"chrome/")&&!mt(e,"crios/")||mt(e,"edge/")?mt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":hr:"Safari"}var fr={Qc:"FirebaseCore-web",Sc:"FirebaseUI-web"};function pr(t,e){e=e||[];var n,r=[],i={};for(n in fr)i[fr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=sr())?r=lr(i=dr()):"Worker"===r&&(r=lr(i=dr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function dr(){return a.navigator&&a.navigator.userAgent||""}function yr(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function mr(){try{var t=a.localStorage,e=Sr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Yn()||!!a.indexedDB}catch(t){return ar()&&!!a.indexedDB}return!1}function vr(){return(gr()||"chrome-extension:"===br()||ir())&&!ur()&&mr()&&!ar()}function gr(){return"http:"===br()||"https:"===br()}function br(){return a.location&&a.location.protocol||null}function wr(t){return!$n(t=t||dr())&&lr(t)!=cr}function _r(t){return void 0===t?null:Qn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Tr(t){if(null!==t)return JSON.parse(t)}function Sr(t){return t||Math.floor(1e9*Math.random()).toString()}function Ir(t){return"Safari"!=lr(t=t||dr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Cr(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Nr(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=dr(),e=sr(),this.b=$n(t)||"ReactNative"===e}function Ar(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function kr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Dr(){return!(!yr("fireauth.oauthhelper",a)&&!yr("fireauth.iframe",a))}Nr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!gr()&&"chrome-extension:"!==br()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Rr,Or={};function Pr(t){Or[t]||(Or[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Rr=2==Mr.abcd}catch(t){Rr=!1}function xr(t,e,n){Rr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Lr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Fr(t){var e={};return Lr(e,t),e}function Ur(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Ur(t[n]));return e}function qr(t){var e={},n=t[Br],r=t[jr];if(!(t=t[Wr])||t!=Vr&&!n)throw Error("Invalid provider user info!");e[Kr]=r||null,e[Qr]=n||null,xr(this,Gr,t),xr(this,Hr,Ur(e))}var Vr="EMAIL_SIGNIN",Br="email",jr="newEmail",Wr="requestType",Qr="email",Kr="fromEmail",Hr="data",Gr="operation";function zr(t,e){this.code=Xr+t,this.message=e||Jr[t]||""}function Yr(t){var e=t&&t.code;return e?new zr(e.substring(Xr.length),t.message):null}I(zr,Error),zr.prototype.A=function(){return{code:this.code,message:this.message}},zr.prototype.toJSON=function(){return this.A()};var Xr="auth/",Jr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function $r(t){var e=t[ri];if(void 0===e)throw new zr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new zr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Zr];if(n&&"object"==typeof n){e=n[ai];var r=n[ii];if(n=n[oi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new zr("argument-error",ii+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new zr("argument-error",oi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new zr("argument-error",ai+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new zr("missing-android-pkg-name")}}else if(void 0!==n)throw new zr("argument-error",Zr+" property must be a non null object when specified.");if(this.f=null,(e=t[ni])&&"object"==typeof e){if("string"==typeof(e=e[si])&&e.length)this.f=e;else if(void 0!==e)throw new zr("argument-error",si+" property must be a non empty string when specified.")}else if(void 0!==e)throw new zr("argument-error",ni+" property must be a non null object when specified.");if(void 0!==(e=t[ei])&&"boolean"!=typeof e)throw new zr("argument-error",ei+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ti])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new zr("argument-error",ti+" property must be a non empty string when specified.");this.i=t||null}var Zr="android",ti="dynamicLinkDomain",ei="handleCodeInApp",ni="iOS",ri="url",ii="installApp",oi="minimumVersion",ai="packageName",si="bundleId";function ui(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ci=null,hi=null;function li(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function fi(t){return(t=pi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new li(t):null}function pi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=hi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ci){ci={},hi={};for(var t=0;t<65;t++)ci[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(hi[ci[t]]=t)&&(hi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}(t))}catch(t){}return null}li.prototype.f=function(){return this.b};var di,yi={Wc:{Za:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://securetoken.googleapis.com/v1/token",id:"p"},Yc:{Za:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Zc:{Za:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",fb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function mi(t){for(var e in yi)if(yi[e].id===t)return{firebaseEndpoint:(t=yi[e]).Za,secureTokenEndpoint:t.fb};return null}di=mi("__EID__")?"__EID__":void 0;var vi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),gi=["client_id","response_type","scope","redirect_uri","state"],bi={Rc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",eb:gi},Tc:{Ma:null,Ba:500,Aa:620,Na:"github.com",eb:gi},Uc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",eb:gi},$c:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",eb:vi}};function wi(t){for(var e in bi)if(bi[e].Na==t)return bi[e];return null}function _i(t){var e={};e["facebook.com"]=Ci,e["google.com"]=Ai,e["github.com"]=Ni,e["twitter.com"]=ki;var n=t&&t[Ti];try{if(n)return e[n]?new e[n](t):new Ii(t);if(void 0!==t[Ei])return new Si(t)}catch(t){}return null}var Ei="idToken",Ti="providerId";function Si(t){var e=t[Ti];if(!e&&t[Ei]){var n=fi(t[Ei]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function Ii(t){Si.call(this,t),xr(this,"profile",Ur((t=Tr(t.rawUserInfo||"{}"))||{}))}function Ci(t){if(Ii.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ni(t){if(Ii.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Ai(t){if(Ii.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function ki(t){if(Ii.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function Di(t){this.a=_n(t)}function Ri(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function Oi(){}function Pi(t,e){return t.then(function(t){if(t[Ea]){var n=fi(t[Ea]);if(!n||e!=n.c)throw new zr("user-mismatch");return t}throw new zr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Xr+"user-not-found"?new zr("user-mismatch"):t})}function Mi(t,e){if(!e)throw new zr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function xi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Li(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Mi(t.providerId,t.pendingToken)}catch(t){}return null}function Fi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new zr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function Ui(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function qi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Fi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Vi(t,e){this.Ac=e||[],Lr(this,{providerId:t,isOAuthProvider:!0}),this.vb={},this.$a=(wi(t)||{}).Ma||null,this.Ya=null}function Bi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new zr("argument-error",'SAML provider IDs must be prefixed with "saml."');Vi.call(this,t,[])}function ji(t){Vi.call(this,t,gi),this.a=[]}function Wi(){ji.call(this,"facebook.com")}function Qi(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Wi).credential({accessToken:e})}function Ki(){ji.call(this,"github.com")}function Hi(t){if(!t)throw new zr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Ki).credential({accessToken:e})}function Gi(){ji.call(this,"google.com"),this.ua("profile")}function zi(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new Gi).credential({idToken:n,accessToken:e})}function Yi(){Vi.call(this,"twitter.com",vi)}function Xi(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new zr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Fi("twitter.com",n,"twitter.com")}function Ji(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===Zi.EMAIL_LINK_SIGN_IN_METHOD?Zi.EMAIL_LINK_SIGN_IN_METHOD:Zi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function $i(t){return t&&t.email&&t.password?new Ji(t.email,t.password,t.signInMethod):null}function Zi(){Lr(this,{providerId:"password",isOAuthProvider:!1})}function to(t,e){if(!(e=eo(e)))throw new zr("argument-error","Invalid email link!");return new Ji(t,e,Zi.EMAIL_LINK_SIGN_IN_METHOD)}function eo(t){var e=wn((t=new Di(t=Ri(t))).a,"oobCode")||null;return"signIn"===(wn(t.a,"mode")||null)&&e?e:null}function no(t){if(!(t.Sa&&t.Ra||t.Da&&t.$))throw new zr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function ro(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new no(e)}return null}function io(t){return t.a.Da&&t.a.$?{temporaryProof:t.a.Da,phoneNumber:t.a.$}:{sessionInfo:t.a.Sa,code:t.a.Ra}}function oo(t){try{this.a=t||mo.auth()}catch(t){throw new zr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Lr(this,{providerId:"phone",isOAuthProvider:!1})}function ao(t,e){if(!t)throw new zr("missing-verification-id");if(!e)throw new zr("missing-verification-code");return new no({Sa:t,Ra:e})}function so(t){if(t.temporaryProof&&t.phoneNumber)return new no({Da:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return zi(o,n);case"facebook.com":return Qi(n);case"github.com":return Hi(n);case"twitter.com":return Xi(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Mi(e,a):new Fi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new ji(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function uo(t){if(!t.isOAuthProvider)throw new zr("invalid-oauth-provider")}function co(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new zr("invalid-auth-event");if(this.g&&this.a)throw new zr("invalid-auth-event");if(this.g&&!this.f)throw new zr("invalid-auth-event")}function ho(t){return(t=t||{}).type?new co(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Yr(t.error),t.postBody):null}function lo(){this.b=null,this.a=[]}I(Ii,Si),I(Ci,Ii),I(Ni,Ii),I(Ai,Ii),I(ki,Ii),Mi.prototype.ka=function(t){return Va(t,xi(this))},Mi.prototype.b=function(t,e){var n=xi(this);return n.idToken=e,Ba(t,n)},Mi.prototype.f=function(t,e){return Pi(ja(t,xi(this)),e)},Mi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Fi.prototype.ka=function(t){return Va(t,Ui(this))},Fi.prototype.b=function(t,e){var n=Ui(this);return n.idToken=e,Ba(t,n)},Fi.prototype.f=function(t,e){return Pi(ja(t,Ui(this)),e)},Fi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Vi.prototype.Ca=function(t){return this.vb=G(t),this},I(Bi,Vi),I(ji,Vi),ji.prototype.ua=function(t){return V(this.a,t)||this.a.push(t),this},ji.prototype.Db=function(){return Q(this.a)},ji.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new zr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Fi(this.providerId,n,this.providerId)},I(Wi,ji),xr(Wi,"PROVIDER_ID","facebook.com"),xr(Wi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),I(Ki,ji),xr(Ki,"PROVIDER_ID","github.com"),xr(Ki,"GITHUB_SIGN_IN_METHOD","github.com"),I(Gi,ji),xr(Gi,"PROVIDER_ID","google.com"),xr(Gi,"GOOGLE_SIGN_IN_METHOD","google.com"),I(Yi,Vi),xr(Yi,"PROVIDER_ID","twitter.com"),xr(Yi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Ji.prototype.ka=function(t){return this.signInMethod==Zi.EMAIL_LINK_SIGN_IN_METHOD?vs(t,Xa,{email:this.a,oobCode:this.c}):vs(t,ps,{email:this.a,password:this.c})},Ji.prototype.b=function(t,e){return this.signInMethod==Zi.EMAIL_LINK_SIGN_IN_METHOD?vs(t,Ja,{idToken:e,email:this.a,oobCode:this.c}):vs(t,ss,{idToken:e,email:this.a,password:this.c})},Ji.prototype.f=function(t,e){return Pi(this.ka(t),e)},Ji.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Lr(Zi,{PROVIDER_ID:"password"}),Lr(Zi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Lr(Zi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),no.prototype.ka=function(t){return t.Ta(io(this))},no.prototype.b=function(t,e){var n=io(this);return n.idToken=e,vs(t,ys,n)},no.prototype.f=function(t,e){var n=io(this);return n.operation="REAUTH",Pi(t=vs(t,ms,n),e)},no.prototype.A=function(){var t={providerId:"phone"};return this.a.Sa&&(t.verificationId=this.a.Sa),this.a.Ra&&(t.verificationCode=this.a.Ra),this.a.Da&&(t.temporaryProof=this.a.Da),this.a.$&&(t.phoneNumber=this.a.$),t},oo.prototype.Ta=function(t,e){var n=this.a.c;return Yt(e.verify()).then(function(r){if(!s(r))throw new zr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return vs(n,os,e)}(0,{phoneNumber:t,recaptchaToken:r}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new zr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Lr(oo,{PROVIDER_ID:"phone"}),Lr(oo,{PHONE_SIGN_IN_METHOD:"phone"}),co.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},co.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.A()}};var fo,po=null;function yo(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",zr.call(this,e,n)}function vo(t,e,n){zr.call(this,t,n),(t=e||{}).wb&&xr(this,"email",t.wb),t.$&&xr(this,"phoneNumber",t.$),t.credential&&xr(this,"credential",t.credential)}function go(t){if(t.code){var e=t.code||"";0==e.indexOf(Xr)&&(e=e.substring(Xr.length));var n={credential:so(t)};if(t.email)n.wb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new zr(e,t.message||void 0);return new vo(e,n,t.message)}return null}function bo(){}function wo(t){return t.c||(t.c=t.b())}function _o(){}function Eo(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function To(){}function So(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.ac,this),this.a.onerror=E(this.Eb,this),this.a.onprogress=E(this.bc,this),this.a.ontimeout=E(this.fc,this)}function Io(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Co(t,e,n){this.reset(t,e,n,void 0,void 0)}function No(t){this.f=t,this.b=this.c=this.a=null}function Ao(t,e){this.name=t,this.value=e}I(yo,zr),I(vo,zr),vo.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.A();return e&&Y(t,e),t},vo.prototype.toJSON=function(){return this.A()},bo.prototype.c=null,I(_o,bo),_o.prototype.a=function(){var t=Eo(this);return t?new ActiveXObject(t):new XMLHttpRequest},_o.prototype.b=function(){var t={};return Eo(this)&&(t[0]=!0,t[1]=!0),t},fo=new _o,I(To,bo),To.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new So;throw Error("Unsupported browser")},To.prototype.b=function(){return{}},(t=So.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.ac=function(){this.status=200,this.response=this.responseText=this.a.responseText,Io(this,4)},t.Eb=function(){this.status=500,this.response=this.responseText="",Io(this,4)},t.fc=function(){this.Eb()},t.bc=function(){this.status=200,Io(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Co.prototype.a=null,Co.prototype.reset=function(t,e,n,r,i){delete this.a},Ao.prototype.toString=function(){return this.name};var ko=new Ao("SEVERE",1e3),Do=new Ao("WARNING",900),Ro=new Ao("CONFIG",700),Oo=new Ao("FINE",500);No.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(k("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Co(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Po,Mo={},xo=null;function Lo(t){var e;if(xo||(xo=new No(""),(Mo[""]=xo).c=Ro),!(e=Mo[t])){e=new No(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Lo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Mo[t]=e}return e}function Fo(t,e){t&&t.log(Oo,e,void 0)}function Uo(t){this.f=t}function qo(t){nn.call(this),this.u=t,this.readyState=Vo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Lo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}I(Uo,bo),Uo.prototype.a=function(){return new qo(this.f)},Uo.prototype.b=(Po={},function(){return Po}),I(qo,nn);var Vo=0;function Bo(t){t.c.read().then(t.$b.bind(t)).catch(t.Ka.bind(t))}function jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Wo(t)}function Wo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Qo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Ko,this.v=this.O=!1}(t=qo.prototype).open=function(t,e){if(this.readyState!=Vo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Wo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.ec.bind(this),this.Ka.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,jo(this,!1)),this.readyState=Vo},t.ec=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Wo(this)),this.a&&(this.readyState=3,Wo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.cc.bind(this),this.Ka.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Bo(this)):t.text().then(this.dc.bind(this),this.Ka.bind(this)))))},t.$b=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?jo(this,!0):Wo(this),3==this.readyState&&Bo(this)}},t.dc=function(t){this.a&&(this.response=this.responseText=t,jo(this,!0))},t.cc=function(t){this.a&&(this.response=t,jo(this,!0))},t.Ka=function(t){var e=this.h;e&&e.log(Do,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Do,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Do,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},I(Qo,nn);var Ko="";Qo.prototype.b=Lo("goog.net.XhrIo");var Ho=/^https?$/i,Go=["POST","PUT"];function zo(t){return"content-type"==t.toLowerCase()}function Yo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Xo(t),$o(t)}function Xo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Jo(t){if(t.c&&void 0!==o)if(t.w[1]&&4==ta(t)&&2==ea(t))Fo(t.b,na(t,"Local request error detected and ignored"));else if(t.i&&4==ta(t))sn(t.Hb,0,t);else if(t.dispatchEvent("readystatechange"),4==ta(t)){Fo(t.b,na(t,"Request complete")),t.c=!1;try{var e,n=ea(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(dn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!Ho.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<ta(t)?t.a.statusText:""}catch(e){Fo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+ea(t)+"]",Xo(t)}}finally{$o(t)}}}function $o(t,e){if(t.a){Zo(t);var n=t.a,r=t.w[0]?l:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(ko,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Zo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(a.clearTimeout(t.u),t.u=null)}function ta(t){return t.a?t.a.readyState:0}function ea(t){try{return 2<ta(t)?t.a.status:-1}catch(t){return-1}}function na(t,e){return e+" ["+t.N+" "+t.l+" "+ea(t)+"]"}function ra(t){var e=da;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.m=0}function ia(t,e,n){t.a=!0,t.c=n,t.f=!e,ua(t)}function oa(t){if(t.a){if(!t.l)throw new ca(t);t.l=!1}}function aa(t,e,n,r){t.g.push([e,n,r]),t.a&&ua(t)}function sa(t){return q(t.g,function(t){return m(t[1])})}function ua(t){if(t.h&&t.a&&sa(t)){var e=t.h,n=fa[e];n&&(a.clearTimeout(n.a),delete fa[e]),t.h=0}t.b&&(t.b.m--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(C(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,sa(t)||(n=!0)}}t.c=e,r&&(u=E(t.o,t,!0),r=E(t.o,t,!1),e instanceof ra?(aa(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new la(e),fa[e.a]=e,t.h=e.a)}function ca(){N.call(this)}function ha(){N.call(this)}function la(t){this.a=a.setTimeout(E(this.c,this),0),this.b=t}(t=Qo.prototype).Ea=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Fo(this.b,na(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Fo(this.b,na(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),$o(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),$o(this,!0)),Qo.mb.va.call(this)},t.Hb=function(){this.qa||(this.I||this.i||this.f?Jo(this):this.tc())},t.tc=function(){Jo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Ko:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(ko,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Fo(this.b,"Can not get response: "+t.message),null}},ra.prototype.cancel=function(t){if(this.a)this.c instanceof ra&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new ha(this),oa(this),ia(this,!1,t))}},ra.prototype.o=function(t,e){this.i=!1,ia(this,t,e)},ra.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return aa(this,r,function(t){t instanceof ha?o.cancel():i(t)}),o.then(t,e,n)},ra.prototype.$goog_Thenable=!0,I(ca,N),ca.prototype.message="Deferred has already fired",ca.prototype.name="AlreadyCalledError",I(ha,N),ha.prototype.message="Deferred was canceled",ha.prototype.name="CanceledError",la.prototype.c=function(){throw delete fa[this.a],this.b};var fa={};function pa(t){var e,n=document,r=nt(t).toString(),i=document.createElement("SCRIPT"),o={Jb:i,Ea:void 0},s=new ra(o);return e=window.setTimeout(function(){ya(i,!0);var t=new ga(va,"Timeout reached for loading script "+r);oa(s),ia(s,!1,t)},5e3),o.Ea=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(ya(i,!1,e),oa(s),ia(s,!0,null))},i.onerror=function(){ya(i,!0,e);var t=new ga(ma,"Error while loading script "+r);oa(s),ia(s,!1,t)},Y(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=nt(e),null===h&&(h=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function da(){if(this&&this.Jb){var t=this.Jb;t&&"SCRIPT"==t.tagName&&ya(t,!0,this.Ea)}}function ya(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ma=0,va=1;function ga(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),N.call(this,n),this.code=t}function ba(t){this.f=t}function wa(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ta,this.f=G(t.secureTokenHeaders||Sa),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Ia,this.a=G(t.firebaseHeaders||Ca),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==sr(),!(n=a.XMLHttpRequest||n&&mo.INTERNAL.node&&mo.INTERNAL.node.XMLHttpRequest)&&!ar())throw new zr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,ar()?this.c=new Uo(self):ur()?this.c=new ba(n):this.c=new To}I(ga,N),I(ba,bo),ba.prototype.a=function(){return new this.f},ba.prototype.b=function(){return{}};var _a,Ea="idToken",Ta=new Nr(3e4,6e4),Sa={"Content-Type":"application/x-www-form-urlencoded"},Ia=new Nr(3e4,6e4),Ca={"Content-Type":"application/json"};function Na(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Aa(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function ka(t,e,n,r,i,o,s){(t=function(){var t=dr();return!((t=lr(t)!=hr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30||me&&Ie&&!(9<Ie))}()||ar()?E(t.o,t):(_a=_a||new jt(function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(a[Ra]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){aa(pa(rt(Da,{onload:Ra})),null,e,void 0)}(0,function(){e(Error("CORS_UNSUPPORTED"))}))}(t,e)}),E(t.l,t)))(e,n,r,i,o,s)}wa.prototype.o=function(t,e,n,r,i,o){if(ar()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new zr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new Qo(this.c);if(o){u.g=Math.max(0,o);var c=setTimeout(function(){u.dispatchEvent("timeout")},o)}rn(u,"complete",function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Fo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),on(u,"ready",function(){c&&clearTimeout(c),le(this)}),on(u,"timeout",function(){c&&clearTimeout(c),le(this),e&&e(null)}),function(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.N=n,t.G=!1,t.c=!0,t.a=t.B?t.B.a():fo.a(),t.w=t.B?wo(t.B):wo(fo),t.a.onreadystatechange=E(t.Hb,t);try{Fo(t.b,na(t,"Opening Xhr")),t.I=!0,t.a.open(n,String(e),!0),t.I=!1}catch(e){return Fo(t.b,na(t,"Error opening Xhr: "+e.message)),void Yo(t,e)}e=r||"";var o=new ln(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||s(t))F(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=zo,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:s(t)?t.charAt(e):t[e]}(o.U()),r=a.FormData&&e instanceof a.FormData,!V(Go,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.o&&(t.a.responseType=t.o),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{Zo(t),0<t.g&&(t.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Fo(t.b,na(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ea,t)):t.u=sn(t.Ea,t.g,t)),Fo(t.b,na(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Fo(t.b,na(t,"Send error: "+e.message)),Yo(t,e)}}(u,t,n,r,i)};var Da=new X(Z,"https://apis.google.com/js/client.js?onload=%{onload}"),Ra="__fcb"+Math.floor(1e6*Math.random()).toString();function Oa(t){if(!s(t=t.email)||!nr.test(t))throw new zr("invalid-email")}function Pa(t){"email"in t&&Oa(t)}function Ma(t){if(!t[Ea])throw new zr("internal-error")}function xa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new zr("internal-error")}else{if(!t.sessionInfo)throw new zr("missing-verification-id");if(!t.code)throw new zr("missing-verification-code")}}wa.prototype.l=function(t,e,n,r,i){var o=this;_a.then(function(){window.gapi.client.setApiKey(o.b);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},wa.prototype.kb=function(){return vs(this,us,{})},wa.prototype.nb=function(t,e){return vs(this,as,{idToken:t,email:e})},wa.prototype.ob=function(t,e){return vs(this,ss,{idToken:t,password:e})};var La={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Fa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new zr("internal-error")}function Ua(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function qa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=go(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=go(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=go(t)):t.errorMessage&&(e=gs(t.errorMessage)),e)throw e;if(!t[Ea])throw new zr("internal-error")}function Va(t,e){return e.returnIdpCredential=!0,vs(t,cs,e)}function Ba(t,e){return e.returnIdpCredential=!0,vs(t,ls,e)}function ja(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,vs(t,hs,e)}function Wa(t){if(!t.oobCode)throw new zr("invalid-action-code")}(t=wa.prototype).pb=function(t,e){var n={idToken:t},r=[];return K(La,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),vs(this,as,n)},t.hb=function(t,e){return Y(t={requestType:"PASSWORD_RESET",email:t},e),vs(this,es,t)},t.ib=function(t,e){return Y(t={requestType:"EMAIL_SIGNIN",email:t},e),vs(this,Za,t)},t.gb=function(t,e){return Y(t={requestType:"VERIFY_EMAIL",idToken:t},e),vs(this,ts,t)},t.Ta=function(t){return vs(this,ds,t)},t.Xa=function(t,e){return vs(this,is,{oobCode:t,newPassword:e})},t.Ia=function(t){return vs(this,Ka,{oobCode:t})},t.Va=function(t){return vs(this,Qa,{oobCode:t})};var Qa={endpoint:"setAccountInfo",D:Wa,da:"email"},Ka={endpoint:"resetPassword",D:Wa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new zr("internal-error")}},Ha={endpoint:"signupNewUser",D:function(t){if(Oa(t),!t.password)throw new zr("weak-password")},J:Ma,R:!0},Ga={endpoint:"createAuthUri"},za={endpoint:"deleteAccount",T:["idToken"]},Ya={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new zr("internal-error")}},Xa={endpoint:"emailLinkSignin",T:["email","oobCode"],D:Oa,J:Ma,R:!0},Ja={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],D:Oa,J:Ma,R:!0},$a={endpoint:"getAccountInfo"},Za={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new zr("internal-error");Oa(t)},da:"email"},ts={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new zr("internal-error")},da:"email"},es={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new zr("internal-error");Oa(t)},da:"email"},ns={sb:!0,endpoint:"getProjectConfig",Gb:"GET"},rs={sb:!0,endpoint:"getRecaptchaParam",Gb:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new zr("internal-error")}},is={endpoint:"resetPassword",D:Wa,da:"email"},os={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},as={endpoint:"setAccountInfo",T:["idToken"],D:Pa,R:!0},ss={endpoint:"setAccountInfo",T:["idToken"],D:function(t){if(Pa(t),!t.password)throw new zr("weak-password")},J:Ma,R:!0},us={endpoint:"signupNewUser",J:Ma,R:!0},cs={endpoint:"verifyAssertion",D:Fa,Oa:Ua,J:qa,R:!0},hs={endpoint:"verifyAssertion",D:Fa,Oa:Ua,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new zr("user-not-found");if(t.errorMessage)throw gs(t.errorMessage);if(!t[Ea])throw new zr("internal-error")},R:!0},ls={endpoint:"verifyAssertion",D:function(t){if(Fa(t),!t.idToken)throw new zr("internal-error")},Oa:Ua,J:qa,R:!0},fs={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new zr("invalid-custom-token")},J:Ma,R:!0},ps={endpoint:"verifyPassword",D:function(t){if(Oa(t),!t.password)throw new zr("wrong-password")},J:Ma,R:!0},ds={endpoint:"verifyPhoneNumber",D:xa,J:Ma},ys={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new zr("internal-error");xa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",go(t);Ma(t)}},ms={Tb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:xa,J:Ma};function vs(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Xt(new zr("internal-error"));var r,i=e.Gb||"POST";return Yt(n).then(e.D).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var a=_n(t.g+e);bn(a,"key",t.b),o&&bn(a,"cb",S().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&bn(a,u,r[u]);return new jt(function(e,o){ka(t,a.toString(),function(t){t?t.error?o(bs(t,i||{})):e(t):o(new zr("network-request-failed"))},n,s?void 0:Qn(Er(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Tb,e.sb||!1)}).then(function(t){return r=t,e.Oa?e.Oa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new zr("internal-error");return r[e.da]})}function gs(t){return bs({error:{errors:[{message:t}],code:400,message:t}})}function bs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new zr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",Y(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new zr(r[i],e);return!e&&t&&(e=_r(t)),new zr("internal-error",e)}function ws(t){this.b=t,this.a=null,this.bb=function(t){return(Ss=Ss||new jt(function(t,e){function n(){Cr(),yr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Cr(),e(Error("Network Error"))},timeout:Es.get()})}if(yr("gapi.iframes.Iframe"))t();else if(yr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){yr("gapi.load")?n():e(Error("Network Error"))},Yt(pa(r=rt(_s,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ss=null,t})).then(function(){return new jt(function(e,n){yr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},Ts.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var _s=new X(Z,"https://apis.google.com/js/api.js?onload=%{onload}"),Es=new Nr(3e4,6e4),Ts=new Nr(5e3,15e3),Ss=null;function Is(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Cs(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function Ns(t){try{return mo.app(t).auth().ya()}catch(t){return[]}}function As(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function ks(t){var e=Xn();return function(t){return vs(t,ns,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=_n(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(a=0==o.indexOf("chrome-extension://")?_n(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(er.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new yo(Xn())})}function Ds(t){return t.m||(t.m=rr().then(function(){if(!t.u){var e=t.c,n=t.h,r=Ns(t.b),i=new Is(t.l,t.f,t.b);i.f=e,i.b=n,i.c=Q(r||[]),t.u=i.toString()}t.i=new ws(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.bb.then(function(){t.a.register("authEvent",e,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=ho(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Yt(n)}return n.status="ERROR",Yt(n)})}(t)})),t.m}function Rs(t){return t.o||(t.v=t.c?pr(t.c,Ns(t.b)):null,t.o=new wa(t.f,mi(t.h),t.v)),t.o}function Os(t,e,n,r,i,o,a,s,u,c){return(t=new Cs(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=G(u||null),t.f=c,t.toString()}function Ps(t){if(this.a=t||mo.INTERNAL.reactNative&&mo.INTERNAL.reactNative.AsyncStorage,!this.a)throw new zr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ms(t){this.b=t,this.a={},this.f=E(this.c,this)}Is.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Cs.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.l),bn(t,"appName",this.c),bn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=mo.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.Ya=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).vb))n[r]=n[r].toString();r=e.Ac,n=G(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.$a&&e.Ya&&!n[e.$a]&&(n[e.$a]=e.Ya),H(n)||bn(t,"customParameters",_r(n))}if("function"==typeof this.a.Db&&(e=this.a.Db()).length&&bn(t,"scopes",e.join(",")),this.i?bn(t,"redirectUrl",this.i):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.h?bn(t,"v",this.h):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Ns(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=As.prototype).Bb=function(t,e,n){var r=new zr("popup-closed-by-user"),i=new zr("web-storage-unsupported"),o=this,a=!1;return this.fa().then(function(){(function(t){var e={type:"webStorageSupport"};return Ds(t).then(function(){return function(t,e){return t.bb.then(function(){return new jt(function(n){t.a.send(e.type,e,n,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&Zn(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new jt(function(e){return function n(){un(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return un(n).then(function(){e(r)})})},t.Kb=function(){var t=dr();return!wr(t)&&!Ir(t)},t.Fb=function(){return!1},t.zb=function(t,e,n,r,i,o,a){if(!t)return Xt(new zr("popup-blocked"));if(a&&!wr())return this.fa().s(function(e){Zn(t),i(e)}),r(),Yt();this.a||(this.a=ks(Rs(this)));var s=this;return this.a.then(function(){var e=s.fa().s(function(e){throw Zn(t),i(e),e});return r(),e}).then(function(){uo(n),a||Jn(Os(s.l,s.f,s.b,e,n,null,o,s.c,void 0,s.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ab=function(t,e,n){this.a||(this.a=ks(Rs(this)));var r=this;return this.a.then(function(){uo(e),Jn(Os(r.l,r.f,r.b,t,e,Xn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.fa=function(){var t=this;return Ds(this).then(function(){return t.i.bb}).s(function(){throw t.a=null,new zr("network-request-failed")})},t.Mb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ja=function(t){j(this.g,function(e){return e==t})},(t=Ps.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Tr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,_r(e)))},t.P=function(t){return Yt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var xs,Ls=[];function Fs(t,e,n){H(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Us(t){this.a=t}function qs(t){this.c=t,this.b=!1,this.a=[]}function Vs(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Xt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Bs(t,c),e}).s(function(e){throw Bs(t,c),e})}function Bs(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),j(t.a,function(t){return t==e})}}function js(){if(!Qs())throw new zr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=a.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var t=this;ar()&&self?(this.m=function(){var t=ar()?self:null;if(F(Ls,function(n){n.b==t&&(e=n)}),!e){var e=new Ms(t);Ls.push(e)}return e}(),Fs(this.m,"keyChanged",function(e,n){return Ys(t).then(function(e){return 0<e.length&&F(t.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Fs(this.m,"ping",function(){return Yt(["keyChanged"])})):function(){var t=a.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(e){(t.h=e)&&(t.g=new qs(new Us(e)),Vs(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&V(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function Ws(t){return t.o||(t.o=function t(e){return new jt(function(n,r){var i=e.l.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(t){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){r(t)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new jt(function(e,n){var r=t.l.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(e).then(function(){return t(e)}).then(function(t){n(t)}).s(function(t){r(t)})}})}(t)),t.o}function Qs(){try{return!!a.indexedDB}catch(t){return!1}}function Ks(t){return t.objectStore("firebaseLocalStorage")}function Hs(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Gs(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function zs(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Vs(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Yt()}function Ys(t){return Ws(t).then(function(t){var e=Ks(Hs(t,!1));return e.getAll?Gs(e.getAll()):new jt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function Xs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Js(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(Qs()){var t=Sr(),r="__sak"+t;return xs=xs||new js,(n=xs).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){F(e.a,function(e){e(t)})}),t})}function $s(){this.a={},this.type="inMemory"}function Zs(){if(!function(){var t="Node"==sr();if(!(t=tu()||t&&mo.INTERNAL.node&&mo.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The LocalStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=tu()||mo.INTERNAL.node.localStorage,this.type="localStorage"}function tu(){try{var t=a.localStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function eu(){this.type="nullStorage"}function nu(){if(!function(){var t="Node"==sr();if(!(t=ru()||t&&mo.INTERNAL.node&&mo.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==sr())throw new zr("internal-error","The SessionStorage compatibility library was not found.");throw new zr("web-storage-unsupported")}this.a=ru()||mo.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function ru(){try{var t=a.sessionStorage,e=Sr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function iu(){var t={};t.Browser=su,t.Node=uu,t.ReactNative=cu,t.Worker=hu,this.a=t[sr()]}Ms.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,function(e){i.push(Yt().then(function(){return e(t.origin,t.data.data)}))}),$t(i).then(function(r){var i=[];F(r,function(t){i.push({fulfilled:t.Cb,value:t.value,reason:t.reason?t.reason.message:void 0})}),F(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Us.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},qs.prototype.close=function(){for(;0<this.a.length;)Bs(this,this.a[0]);this.b=!0},(t=js.prototype).set=function(t,e){var n,r=!1,i=this;return Ws(this).then(function(e){return Gs((e=Ks(Hs(n=e,!0))).get(t))}).then(function(o){var a=Ks(Hs(n,!0));return o?(o.value=e,Gs(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Gs(a.add(o)))}).then(function(){return i.c[t]=e,zs(i,t)}).ha(function(){r&&i.b--})},t.get=function(t){return Ws(this).then(function(e){return Gs(Ks(Hs(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return Ws(this).then(function(r){return e=!0,n.b++,Gs(Ks(Hs(r,!0)).delete(t))}).then(function(){return delete n.c[t],zs(n,t)}).ha(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){Xs(t),function e(){t.f=setTimeout(function(){t.i=Ys(t).then(function(e){0<e.length&&F(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){j(this.a,function(e){return e==t}),0==this.a.length&&Xs(this)},(t=Js.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){j(this.a,function(e){return e==t})},(t=$s.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.P=function(t){return delete this.a[t],Yt()},t.Y=function(){},t.ca=function(){},(t=Zs.prototype).get=function(t){var e=this;return Yt().then(function(){return Tr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Yt().then(function(){var r=_r(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(t){a.window&&Qe(a.window,"storage",t)},t.ca=function(t){a.window&&Ge(a.window,"storage",t)},(t=eu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.P=function(){return Yt()},t.Y=function(){},t.ca=function(){},(t=nu.prototype).get=function(t){var e=this;return Yt().then(function(){return Tr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Yt().then(function(){var r=_r(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var ou,au,su={C:Zs,Qa:nu},uu={C:Zs,Qa:nu},cu={C:Ps,Qa:eu},hu={C:Zs,Qa:eu},lu={Vc:"local",NONE:"none",Xc:"session"};function fu(){var t=!(Ir(dr())||!or()),e=wr(),n=mr();this.o=t,this.h=e,this.m=n,this.a={},t=ou=ou||new iu;try{this.g=!Yn()&&Dr()||!a.indexedDB?new t.a.C:new Js(ar()?new $s:new t.a.C)}catch(t){this.g=new $s,this.h=!0}try{this.i=new t.a.Qa}catch(t){this.i=new $s}this.l=new $s,this.f=E(this.Lb,this),this.b={}}function pu(){return au=au||new fu}function du(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function yu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function mu(t,e,n){return n=yu(e,n),"local"==e.C&&(t.b[n]=null),du(t,e.C).P(n)}function vu(t){t.c&&(clearInterval(t.c),t.c=null)}function gu(t){this.a=t,this.b=pu()}(t=fu.prototype).get=function(t,e){return du(this,t.C).get(yu(t,e))},t.set=function(t,e,n){var r=yu(t,n),i=this,o=du(this,t.C);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.C&&(i.b[r]=e)})},t.addListener=function(t,e,n){t=yu(t,e),this.m&&(this.b[t]=a.localStorage.getItem(t)),H(this.a)&&(du(this,"local").Y(this.f),this.h||(Yn()||!Dr())&&a.indexedDB||!this.m||function(t){vu(t),t.c=setInterval(function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Pe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Lb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=yu(t,e),this.a[t]&&(j(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),H(this.a)&&(du(this,"local").ca(this.f),vu(this))},t.Lb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Wa(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?du(this,"local").ca(this.f):vu(this),this.o)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.Wa(e))},me&&Ie&&10==Ie&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,E(this.Wa,this))},t.Wa=function(t){this.a[t]&&F(this.a[t],function(t){t()})};var bu,wu={name:"authEvent",C:"local"};function _u(){this.a=pu()}function Eu(t,e){this.b=Tu,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=a.Int32Array?new Int32Array(64):Array(64),void 0!==bu||(bu=a.Int32Array?new Int32Array(Du):Du),this.reset()}I(Eu,function(){this.b=-1});for(var Tu=64,Su=Tu-1,Iu=[],Cu=0;Cu<Su;Cu++)Iu[Cu]=0;var Nu=W(128,Iu);function Au(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|bu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function ku(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Au(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Au(t),i=0)}}t.c=i,t.g+=n}Eu.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):Q(this.h)};var Du=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Ru(){Eu.call(this,8,Ou)}I(Ru,Eu);var Ou=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Pu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new _u,this.g=new gu(this.h),this.f=null,this.b=[],this.a=this.c=null}function Mu(t){return new zr("invalid-cordova-configuration",t)}function xu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Lu(t){return t.f||(t.f=t.fa().then(function(){return new jt(function(e){t.wa(function n(r){return e(r),t.Ja(n),!1}),function(t){function e(e){r=!0,i&&i.cancel(),Fu(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Ri(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Tr(wn(o=_n(i),"firebaseError")||null))?Yr(o):null)?new co(r.c,r.b,null,null,o):new co(r.c,r.b,i,r.f)),i=o||n}xu(t,i)})}var n=new co("unknown",null,null,null,new zr("no-auth-event")),r=!1,i=un(500).then(function(){return Fu(t).then(function(){r||xu(t,n)})}),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(yr("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},po=po||new lo,function(t){var e=po;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=yr("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)})})),t.f}function Fu(t){var e=null;return function(t){return t.b.get(wu,t.a).then(function(t){return ho(t)})}(t.g).then(function(n){return e=n,mu((n=t.g).b,wu,n.a)}).then(function(){return e})}function Uu(t){this.a=t,this.b=pu()}(t=Pu.prototype).fa=function(){return this.za?this.za:this.za=(ir(void 0)?rr().then(function(){return new jt(function(t,e){var n=a.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof yr("universalLinks.subscribe",a))throw Mu("cordova-universal-links-plugin-fix is not installed");if(void 0===yr("BuildInfo.packageName",a))throw Mu("cordova-plugin-buildinfo is not installed");if("function"!=typeof yr("cordova.plugins.browsertab.openUrl",a))throw Mu("cordova-plugin-browsertab is not installed");if("function"!=typeof yr("cordova.InAppBrowser.open",a))throw Mu("cordova-plugin-inappbrowser is not installed")},function(){throw new zr("cordova-not-ready")})},t.Bb=function(t,e){return e(new zr("operation-not-supported-in-this-environment")),Yt()},t.zb=function(){return Xt(new zr("operation-not-supported-in-this-environment"))},t.Mb=function(){return!1},t.Kb=function(){return!0},t.Fb=function(){return!0},t.Ab=function(t,e,n){if(this.c)return Xt(new zr("redirect-operation-pending"));var r=this,i=a.document,o=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return uo(e),Lu(r)}).then(function(){return function(t,e,n,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new co(e,r,null,i,new zr("no-auth-event")),s=yr("BuildInfo.packageName",a);if("string"!=typeof s)throw new zr("invalid-cordova-configuration");var u=yr("BuildInfo.displayName",a),c={};if(dr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!dr().toLowerCase().match(/android/))return Xt(new zr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),i=function(t){var e=new Ru;ku(e,t),t=[];var n=8*e.g;e.c<56?ku(e,Nu,56-e.c):ku(e,Nu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Au(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return U(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}(i),c.sessionId=i;var h=Os(t.l,t.i,t.m,e,n,null,r,t.o,c,t.u);return t.fa().then(function(){var e=t.h;return t.v.a.set(wu,o.A(),e)}).then(function(){var e=yr("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new zr("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=yr("cordova.plugins.browsertab.openUrl",a)))throw new zr("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=yr("cordova.InAppBrowser.open",a)))throw new zr("invalid-cordova-configuration");e=dr(),t.a=n(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new jt(function(t,e){s=function(){var e=yr("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(s),u=function(){o=o||un(2e3).then(function(){e(new zr("redirect-cancelled-by-user"))})},c=function(){Ar()&&u()},i.addEventListener("resume",u,!1),dr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",c,!1)}).s(function(t){return Fu(r).then(function(){throw t})})}).ha(function(){u&&i.removeEventListener("resume",u,!1),c&&i.removeEventListener("visibilitychange",c,!1),o&&o.cancel(),s&&r.Ja(s),r.c=null})},t.wa=function(t){this.b.push(t),Lu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new co("unknown",null,null,null,new zr("no-auth-event")),t(e))})},t.Ja=function(t){j(this.b,function(e){return e==t})};var qu={name:"pendingRedirect",C:"session"};function Vu(t){return mu(t.b,qu,t.a)}function Bu(t,e,n){this.i={},this.v=0,this.B=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=E(this.u,this),this.b=new ec,this.w=new ac,this.g=new Uu(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=ju(this.B,this.l,this.o,di)}function ju(t,e,n,r){var i=mo.SDK_VERSION||null;return ir()?new Pu(t,e,n,i,r):new As(t,e,n,i,r)}function Wu(t){t.f||(t.f=!0,t.a.wa(t.m));var e=t.a;return t.a.fa().s(function(n){throw t.a==e&&t.reset(),n})}function Qu(t){t.a.Kb()&&Wu(t).s(function(e){var n=new co("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));Xu(e)&&t.u(n)}),t.a.Fb()||nc(t.b)}function Ku(t,e){V(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(qu,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?Vu(t.g).then(function(){Wu(t).s(function(e){var n=new co("unknown",null,null,null,new zr("operation-not-supported-in-this-environment"));Xu(e)&&t.u(n)})}):Qu(t)}).s(function(){Qu(t)})}function Hu(t,e){j(t.h,function(t){return t==e})}Bu.prototype.reset=function(){this.f=!1,this.a.Ja(this.m),this.a=ju(this.B,this.l,this.o),this.i={}},Bu.prototype.u=function(t){if(!t)throw new zr("invalid-auth-event");if(6e5<=S()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.tb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=S())),e=!0;break}}return nc(this.b),e};var Gu=new Nr(2e3,1e4),zu=new Nr(3e4,6e4);function Yu(t,e,n,r,i,o){return t.a.zb(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function Xu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function Ju(t,e,n,r){var i;return function(t){return t.b.set(qu,"pending",t.a)}(t.g).then(function(){return t.a.Ab(e,n,r).s(function(e){if(Xu(e))throw new zr("operation-not-supported-in-this-environment");return i=e,Vu(t.g).then(function(){throw i})}).then(function(){return t.a.Mb()?new jt(function(){}):Vu(t.g).then(function(){return t.la()}).then(function(){}).s(function(){})})})}function $u(t,e,n,r,i){return t.a.Bb(r,function(t){e.ga(n,null,t,i)},Gu.get())}Bu.prototype.la=function(){return this.b.la()};var Zu={};function tc(t,e,n){var r=e+":"+n;return Zu[r]||(Zu[r]=new Bu(t,e,n)),Zu[r]}function ec(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function nc(t){t.g||(t.g=!0,oc(t,!1,null,null))}function rc(t){t.g&&!t.i&&oc(t,!1,null,null)}function ic(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function oc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):ic(t,n):ic(t,{user:null}),t.f=[],t.c=[]}function ac(){}function sc(){this.qb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.qb},set:function(t){this.qb=t},enumerable:!1})}function uc(t,e){this.a=e,xr(this,"verificationId",t)}function cc(t,e,n,r){return new oo(t).Ta(e,n).then(function(t){return new uc(t,r)})}function hc(t){var e=pi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new zr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Lr(this,{token:t,expirationTime:kr(1e3*e.exp),authTime:kr(1e3*e.auth_time),issuedAtTime:kr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function lc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function fc(t){this.f=t,this.b=this.a=null,this.c=0}function pc(t,e){var n=e[Ea],r=e.refreshToken;e=dc(e.expiresIn),t.b=n,t.c=e,t.a=r}function dc(t){return S()+1e3*parseInt(t,10)}function yc(t,e){this.a=t||null,this.b=e||null,Lr(this,{lastSignInTime:kr(e||null),creationTime:kr(t||null)})}function mc(t,e,n,r,i,o){Lr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function vc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function gc(t,e,n){this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=mo.SDK_VERSION?pr(mo.SDK_VERSION):null,this.a=new wa(this.l,mi(di),t),this.c=new fc(this.a),Ic(this,e[Ea]),pc(this.c,e),xr(this,"refreshToken",this.c.a),Ac(this,n||{}),nn.call(this),this.I=!1,this.u&&vr()&&(this.i=tc(this.u,this.l,this.o)),this.N=[],this.h=null,this.w=function(t){return new lc(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.c.c-S()-3e5;return 0<e?e:0})}(this),this.V=E(this.Fa,this);var r=this;this.ja=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){wc(r,t.c)},this.W=null}function bc(t,e){t.X&&Ge(t.X,"languageCodeChanged",t.ta),(t.X=e)&&Qe(e,"languageCodeChanged",t.ta)}function wc(t,e){t.O=e,Aa(t.a,mo.SDK_VERSION?pr(mo.SDK_VERSION,t.O):null)}function _c(t,e){t.W&&Ge(t.W,"frameworkChanged",t.sa),(t.W=e)&&Qe(e,"frameworkChanged",t.sa)}function Ec(t){try{return mo.app(t.o).auth()}catch(e){throw new zr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.o+"'!")}}function Tc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.V),Qe(t,"tokenChanged",t.V))}function Sc(t){Ge(t,"tokenChanged",t.V),t.w.stop()}function Ic(t,e){t.ra=e,xr(t,"_lat",e)}function Cc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return $t(e).then(function(){return t})}function Nc(t){t.i&&!t.I&&(t.I=!0,Ku(t.i,t))}function Ac(t,e){Lr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new yc(e.createdAt,e.lastLoginAt),providerData:[]})}function kc(){}function Dc(t){return Yt().then(function(){if(t.B)throw new zr("app-deleted")})}function Rc(t){return U(t.providerData,function(t){return t.providerId})}function Oc(t,e){e&&(Pc(t,e.providerId),t.providerData.push(e))}function Pc(t,e){j(t.providerData,function(t){return t.providerId==e})}function Mc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function xc(t,e){t!=e&&(Lr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?xr(t,"metadata",function(t){return new yc(t.a,t.b)}(e.metadata)):xr(t,"metadata",new yc),F(e.providerData,function(e){Oc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.c,e.c),xr(t,"refreshToken",t.c.a))}function Lc(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return vs(t.a,$a,{idToken:e}).then(E(t.uc,t))}(t,e).then(function(){return n||Mc(t,"isAnonymous",!1),e})})}function Fc(t,e){e[Ea]&&t.ra!=e[Ea]&&(pc(t.c,e),t.dispatchEvent(new vc("tokenChanged")),Ic(t,e[Ea]),Mc(t,"refreshToken",t.c.a))}function Uc(t,e){return Lc(t).then(function(){if(V(Rc(t),e))return Cc(t).then(function(){throw new zr("provider-already-linked")})})}function qc(t,e,n){return Fr({user:t,credential:so(e),additionalUserInfo:e=_i(e),operationType:n})}function Vc(t,e){return Fc(t,e),t.reload().then(function(){return t})}function Bc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=wi(n.providerId),a=Sr(t.uid+":::"),s=null;(!wr()||or())&&t.u&&n.isOAuthProvider&&(s=Os(t.u,t.l,t.o,e,n,null,a,mo.SDK_VERSION||null));var u=tr(s,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(Wc(t),!i)return t.F().then(function(){})}).then(function(){return Yu(t.i,u,e,n,a,!!s)}).then(function(){return new jt(function(n,r){t.ga(e,null,new zr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.b=$u(t.i,t,e,u,a)})}).then(function(t){return u&&Zn(u),t?Fr(t):null}).s(function(t){throw u&&Zn(u),t}),Qc(t,r,i)}function jc(t,e,n,r,i){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Xt(t.h);var o=null,a=Sr(t.uid+":::");return r=r().then(function(){if(Wc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=a,Cc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(Gc,t.A(),e.a)),e}).then(function(){return Ju(t.i,e,n,a)}).s(function(e){if(o=e,t.ba)return zc(t.ba);throw o}).then(function(){if(o)throw o}),Qc(t,r,i)}function Wc(t){if(!t.i||!t.I){if(t.i&&!t.I)throw new zr("internal-error");throw new zr("auth-domain-config-required")}}function Qc(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Xt(t.h)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new vc("userInvalidated")),t.h=e),e})}(t,e,n);return t.G.push(r),r.ha(function(){B(t.G,r)}),r}function Kc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ea]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-S())/1e3;var r=new gc(e,n,t);return t.providerData&&F(t.providerData,function(t){t&&Oc(r,Fr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Hc(t){this.a=t,this.b=pu()}ec.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},ec.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(oc(this,!0,null,t.a),Yt()):e.xa(n,r)?function(t,e,n){n=n.xa(e.c,e.b);var r=e.g,i=e.f,o=e.h,a=!!e.c.match(/Redirect$/);n(r,i,o).then(function(e){oc(t,a,e,null)}).s(function(e){oc(t,a,null,e)})}(this,t,e):Xt(new zr("invalid-auth-event")):(oc(this,!1,null,null),Yt())}else Xt(new zr("invalid-auth-event"))},ec.prototype.la=function(){var t=this;return new jt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new zr("timeout");t.a&&t.a.cancel(),t.a=un(zu.get()).then(function(){t.b||(t.g=!0,oc(t,!0,null,e))})}(t))})},ac.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ga(t.c,null,t.a,t.b),Yt()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ga(r,t,null,n)}).s(function(t){e.ga(r,null,t,n)})}(t,e):Xt(new zr("invalid-auth-event"))}else Xt(new zr("invalid-auth-event"))},uc.prototype.confirm=function(t){return t=ao(this.verificationId,t),this.a(t)},lc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=un(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=a.document,e=null,Ar()||!t?Yt():new jt(function(n){e=function(){Ar()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},lc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},fc.prototype.A=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},fc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new zr("user-token-expired")):t||!this.b||S()>this.c-3e4?this.a?function(t,e){return function(t,e){return new jt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?ka(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(bs(t)):t.access_token&&t.refresh_token?n(t):r(new zr("internal-error")):r(new zr("network-request-failed"))},"POST",Pn(e).toString(),t.f,t.m.get()):r(new zr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=dc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},yc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},I(vc,Oe),I(gc,nn),gc.prototype.pa=function(t){this.ja=t,Na(this.a,t)},gc.prototype.ea=function(){return this.ja},gc.prototype.ya=function(){return Q(this.O)},gc.prototype.Fa=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(gc.prototype,"providerId","firebase"),(t=gc.prototype).reload=function(){var t=this;return Qc(this,Dc(this).then(function(){return Lc(t).then(function(){return Cc(t)}).then(kc)}))},t.Zb=function(t){return this.F(t).then(function(t){return new hc(t)})},t.F=function(t){var e=this;return Qc(this,Dc(this).then(function(){return e.c.getToken(t)}).then(function(t){if(!t)throw new zr("internal-error");return t.accessToken!=e.ra&&(Ic(e,t.accessToken),e.dispatchEvent(new vc("tokenChanged"))),Mc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.uc=function(t){if(!(t=t.users)||!t.length)throw new zr("internal-error");Ac(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?U(t,function(t){return new mc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Oc(this,e[n]);Mc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.vc=function(t){return Pr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.cb(t)},t.cb=function(t){var e=this,n=null;return Qc(this,t.f(this.a,this.uid).then(function(t){return Fc(e,t),n=qc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.mc=function(t){return Pr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.ab(t)},t.ab=function(t){var e=this,n=null;return Qc(this,Uc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=qc(e,t,"link"),Vc(e,t)}).then(function(){return n}))},t.nc=function(t,e){var n=this;return Qc(this,Uc(this,"phone").then(function(){return cc(Ec(n),t,e,E(n.ab,n))}))},t.wc=function(t,e){var n=this;return Qc(this,Yt().then(function(){return cc(Ec(n),t,e,E(n.cb,n))}),!0)},t.nb=function(t){var e=this;return Qc(this,this.F().then(function(n){return e.a.nb(n,t)}).then(function(t){return Fc(e,t),e.reload()}))},t.Nc=function(t){var e=this;return Qc(this,this.F().then(function(n){return t.b(e.a,n)}).then(function(t){return Fc(e,t),e.reload()}))},t.ob=function(t){var e=this;return Qc(this,this.F().then(function(n){return e.a.ob(n,t)}).then(function(t){return Fc(e,t),e.reload()}))},t.pb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Dc(this);var e=this;return Qc(this,this.F().then(function(n){return e.a.pb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Fc(e,t),Mc(e,"displayName",t.displayName||null),Mc(e,"photoURL",t.photoUrl||null),F(e.providerData,function(t){"password"===t.providerId&&(xr(t,"displayName",e.displayName),xr(t,"photoURL",e.photoURL))}),Cc(e)}).then(kc))},t.Lc=function(t){var e=this;return Qc(this,Lc(this).then(function(n){return V(Rc(e),t)?function(t,e,n){return vs(t,Ya,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return F(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),F(Rc(e),function(t){n[t]||Pc(e,t)}),n[oo.PROVIDER_ID]||xr(e,"phoneNumber",null),Cc(e)}):Cc(e).then(function(){throw new zr("no-such-provider")})}))},t.delete=function(){var t=this;return Qc(this,this.F().then(function(e){return vs(t.a,za,{idToken:e})}).then(function(){t.dispatchEvent(new vc("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");bc(t,null),_c(t,null),t.G=[],t.B=!0,Sc(t),xr(t,"refreshToken",null),t.i&&Hu(t.i,t)})},t.tb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ga=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.xb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.yb,this):"linkViaRedirect"==t&&(this.aa||null)==e?E(this.xb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?E(this.yb,this):null},t.oc=function(t){var e=this;return Bc(this,"linkViaPopup",t,function(){return Uc(e,t.providerId).then(function(){return Cc(e)})},!1)},t.xc=function(t){return Bc(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.pc=function(t){var e=this;return jc(this,"linkViaRedirect",t,function(){return Uc(e,t.providerId)},!1)},t.yc=function(t){return jc(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.xb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Qc(this,this.F().then(function(i){return Ba(r.a,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=qc(r,t,"link"),Vc(r,t)}).then(function(){return i}))},t.yb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Qc(this,Yt().then(function(){return Pi(ja(r.a,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=qc(r,t,"reauthenticate"),Fc(r,t),r.h=null,r.reload()}).then(function(){return i}),!0)},t.gb=function(t){var e=this,n=null;return Qc(this,this.F().then(function(e){return n=e,void 0===t||H(t)?{}:ui(new $r(t))}).then(function(t){return e.a.gb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.c.A(),redirectEventId:this.aa||null};return this.metadata&&Y(t,this.metadata.A()),F(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var Gc={name:"redirectUser",C:"session"};function zc(t){return mu(t.b,Gc,t.a)}function Yc(t){this.a=t,this.b=pu(),this.c=null,this.f=function(t){var e=$c("local"),n=$c("session"),r=$c("none");return function(t,e,n){var r=yu(e,n),i=du(t,e.C);return t.get(e,n).then(function(o){var s=null;try{s=Tr(a.localStorage.getItem(r))}catch(o){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(i){return i?n:t.b.get(r,t.a).then(function(n){return n?r:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(Jc,t.a).then(function(t){return t?$c(t):e})})})}).then(function(e){return t.c=e,Xc(t,e.C)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener($c("local"),this.a,E(this.g,this))}function Xc(t,e){var n,r=[];for(n in lu)lu[n]!==e&&r.push(mu(t.b,$c(lu[n]),t.a));return r.push(mu(t.b,Jc,t.a)),function(t){return new jt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Jt(t[s],T(o,s),a);else e(i)})}(r)}Yc.prototype.g=function(){var t=this,e=$c("local");nh(this,function(){return Yt().then(function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null}).then(function(n){if(n)return Xc(t,"local").then(function(){t.c=e})})})};var Jc={name:"persistence",C:"session"};function $c(t){return{name:"authUser",C:t}}function Zc(t,e){return nh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function th(t){return nh(t,function(){return mu(t.b,t.c,t.a)})}function eh(t,e){return nh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Kc(t||{})})})}function nh(t,e){return t.f=t.f.then(e,e),t.f}function rh(t){if(this.l=!1,xr(this,"settings",new sc),xr(this,"app",t),!lh(this).options||!lh(this).options.apiKey)throw new zr("invalid-api-key");t=mo.SDK_VERSION?pr(mo.SDK_VERSION):null,this.c=new wa(lh(this).options&&lh(this).options.apiKey,mi(di),t),this.N=[],this.o=[],this.I=[],this.Pb=mo.INTERNAL.createSubscribe(E(this.ic,this)),this.O=void 0,this.Qb=mo.INTERNAL.createSubscribe(E(this.jc,this)),ch(this,null),this.h=new Yc(lh(this).options.apiKey+":"+lh(this).name),this.w=new Hc(lh(this).options.apiKey+":"+lh(this).name),this.V=yh(this,function(t){var e=lh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Gc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Kc(t||{})})}(t.w,lh(t).options.authDomain).then(function(e){return(t.B=e)&&(e.ba=t.w),zc(t.w)});return yh(t,e)}(t).then(function(){return eh(t.h,e)}).then(function(e){return e?(e.ba=t.w,t.B&&(t.B.aa||null)==(e.aa||null)?e:e.reload().then(function(){return Zc(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:th(t.h)})):null}).then(function(e){ch(t,e||null)});return yh(t,n)}(this)),this.i=yh(this,function(t){return t.V.then(function(){return sh(t)}).s(function(){}).then(function(){if(!t.l)return t.ja()}).s(function(){}).then(function(){if(!t.l){t.X=!0;var e=t.h;e.b.addListener($c("local"),e.a,t.ja)}})}(this)),this.X=!1,this.ja=E(this.Ic,this),this.Fa=E(this.Z,this),this.ra=E(this.Xb,this),this.sa=E(this.gc,this),this.ta=E(this.hc,this),this.a=null,function(t){var e=lh(t).options.authDomain,n=lh(t).options.apiKey;e&&vr()&&(t.Ob=t.V.then(function(){if(!t.l){if(t.a=tc(e,n,lh(t).name),Ku(t.a,t),fh(t)&&Nc(fh(t)),t.B){Nc(t.B);var r=t.B;r.pa(t.ea()),bc(r,t),wc(r=t.B,t.G),_c(r,t),t.B=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.qc,this),this.u=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function ih(t){Oe.call(this,"languageCodeChanged"),this.g=t}function oh(t){Oe.call(this,"frameworkChanged"),this.c=t}function ah(t){return t.Ob||Xt(new zr("auth-domain-config-required"))}function sh(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=ah(t).then(function(){return t.a.la()}).then(function(t){return t?Fr(t):null});return yh(t,e)}function uh(t,e){var n={};return n.apiKey=lh(t).options.apiKey,n.authDomain=lh(t).options.authDomain,n.appName=lh(t).name,t.V.then(function(){return function(t,e,n,r){var i=new gc(t,e);return n&&(i.ba=n),r&&wc(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.ya())}).then(function(e){return fh(t)&&e.uid==fh(t).uid?xc(fh(t),e):(ch(t,e),Nc(e)),t.Z(e)}).then(function(){dh(t)})}function ch(t,e){fh(t)&&(function(t,e){j(t.N,function(t){return t==e})}(fh(t),t.Fa),Ge(fh(t),"tokenChanged",t.ra),Ge(fh(t),"userDeleted",t.sa),Ge(fh(t),"userInvalidated",t.ta),Sc(fh(t))),e&&(e.N.push(t.Fa),Qe(e,"tokenChanged",t.ra),Qe(e,"userDeleted",t.sa),Qe(e,"userInvalidated",t.ta),0<t.u&&Tc(e)),xr(t,"currentUser",e),e&&(e.pa(t.ea()),bc(e,t),wc(e,t.G),_c(e,t))}function hh(t,e){var n=null,r=null;return yh(t,e.then(function(e){return n=so(e),r=_i(e),uh(t,e)}).then(function(){return Fr({user:fh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function lh(t){return t.app}function fh(t){return t.currentUser}function ph(t){return fh(t)&&fh(t)._lat||null}function dh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](ph(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](ph(t))}}function yh(t,e){return t.N.push(e),e.ha(function(){B(t.N,e)}),e}function mh(){}function vh(){this.a={},this.b=1e12}Yc.prototype.jb=function(t){var e=null,n=this;return function(t){var e=new zr("invalid-persistence-type"),n=new zr("unsupported-persistence-type");t:{for(r in lu)if(lu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(sr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!mr()&&"none"!==t)throw n}}(t),nh(this,function(){return t!=n.c.C?n.b.get(n.c,n.a).then(function(r){return e=r,Xc(n,t)}).then(function(){if(n.c=$c(t),e)return n.b.set(n.c,e,n.a)}):Yt()})},I(rh,nn),I(ih,Oe),I(oh,Oe),(t=rh.prototype).jb=function(t){return yh(this,t=this.h.jb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,Na(this.c,this.W),this.dispatchEvent(new ih(this.ea())))},t.ea=function(){return this.W},t.Oc=function(){var t=a.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.qc=function(t){this.G.push(t),Aa(this.c,mo.SDK_VERSION?pr(mo.SDK_VERSION,this.G):null),this.dispatchEvent(new oh(this.G))},t.ya=function(){return Q(this.G)},t.toJSON=function(){return{apiKey:lh(this).options.apiKey,authDomain:lh(this).options.authDomain,appName:lh(this).name,currentUser:fh(this)&&fh(this).A()}},t.tb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ga=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.Wb,this):null},t.Wb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=Va(r.c,t).then(function(t){return i=so(t),o=_i(t),t});return yh(this,t=r.V.then(function(){return a}).then(function(t){return uh(r,t)}).then(function(){return Fr({user:fh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Gc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this,n=wi(t.providerId),r=Sr(),i=null;(!wr()||or())&&lh(this).options.authDomain&&t.isOAuthProvider&&(i=Os(lh(this).options.authDomain,lh(this).options.apiKey,lh(this).name,"signInViaPopup",t,null,r,mo.SDK_VERSION||null));var o=tr(i,n&&n.Ba,n&&n.Aa);return yh(this,n=ah(this).then(function(e){return Yu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new jt(function(t,n){e.ga("signInViaPopup",null,new zr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.b=$u(e.a,e,"signInViaPopup",o,r)})}).then(function(t){return o&&Zn(o),t?Fr(t):null}).s(function(t){throw o&&Zn(o),t}))},t.Hc=function(t){if(!vr())return Xt(new zr("operation-not-supported-in-this-environment"));var e=this;return yh(this,ah(this).then(function(){return function(t){return nh(t,function(){return t.b.set(Jc,t.c.C,t.a)})}(e.h)}).then(function(){return Ju(e.a,"signInViaRedirect",t)}))},t.la=function(){var t=this;return sh(this).then(function(e){return t.a&&rc(t.a.b),e}).s(function(e){throw t.a&&rc(t.a.b),e})},t.Mc=function(t){if(!t)return Xt(new zr("null-user"));var e=this,n={};n.apiKey=lh(this).options.apiKey,n.authDomain=lh(this).options.authDomain,n.appName=lh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.c,o={};return o[Ea]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-S())/1e3,e=new gc(e,o),n&&(e.ba=n),r&&wc(e,r),xc(e,t),e}(t,n,e.w,e.ya());return yh(this,this.i.then(function(){if(lh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return fh(e)&&t.uid==fh(e).uid?(xc(fh(e),t),e.Z(t)):(ch(e,r),Nc(r),e.Z(r))}).then(function(){dh(e)}))},t.lb=function(){var t=this;return yh(this,this.i.then(function(){return t.a&&rc(t.a.b),fh(t)?(ch(t,null),th(t.h).then(function(){dh(t)})):Yt()}))},t.Ic=function(){var t=this;return eh(this.h,lh(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=fh(t)&&e){n=fh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return xc(fh(t),e),fh(t).F();(fh(t)||e)&&(ch(t,e),e&&(Nc(e),e.ba=t.w),t.a&&Ku(t.a,t),dh(t))}})},t.Z=function(t){return Zc(this.h,t)},t.Xb=function(){dh(this),this.Z(fh(this))},t.gc=function(){this.lb()},t.hc=function(){this.lb()},t.ic=function(t){var e=this;this.addAuthTokenListener(function(){t.next(fh(e))})},t.jc=function(t){var e=this;!function(t,e){t.I.push(e),yh(t,t.i.then(function(){!t.l&&V(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(ph(t)))}))}(this,function(){t.next(fh(e))})},t.sc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){m(t)?t(fh(r)):m(t.next)&&t.next(fh(r))}),this.Pb(t,e,n)},t.rc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),m(t)?t(fh(r)):m(t.next)&&t.next(fh(r))}),this.Qb(t,e,n)},t.Yb=function(t){var e=this;return yh(this,this.i.then(function(){return fh(e)?fh(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Cc=function(t){var e=this;return this.i.then(function(){return hh(e,vs(e.c,fs,{token:t}))}).then(function(t){var n=t.user;return Mc(n,"isAnonymous",!1),e.Z(n),t})},t.Dc=function(t,e){var n=this;return this.i.then(function(){return hh(n,vs(n.c,ps,{email:t,password:e}))})},t.Sb=function(t,e){var n=this;return this.i.then(function(){return hh(n,vs(n.c,Ha,{email:t,password:e}))})},t.Pa=function(t){var e=this;return this.i.then(function(){return hh(e,t.ka(e.c))})},t.Bc=function(t){return Pr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Pa(t)},t.kb=function(){var t=this;return this.i.then(function(){var e=fh(t);return e&&e.isAnonymous?Fr({user:e,credential:null,additionalUserInfo:Fr({providerId:null,isNewUser:!1}),operationType:"signIn"}):hh(t,t.c.kb()).then(function(e){var n=e.user;return Mc(n,"isAnonymous",!0),t.Z(n),e})})},t.getUid=function(){return fh(this)&&fh(this).uid||null},t.Rb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&fh(this)&&Tc(fh(this))},t.zc=function(t){var e=this;F(this.o,function(n){n==t&&e.u--}),this.u<0&&(this.u=0),0==this.u&&fh(this)&&Sc(fh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),yh(this,this.i.then(function(){e.l||V(e.o,t)&&t(ph(e))}))},t.removeAuthTokenListener=function(t){j(this.o,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener($c("local"),t.a,this.ja),this.a&&(Hu(this.a,this),rc(this.a.b)),Promise.resolve()},t.Vb=function(t){return yh(this,function(t,e){return vs(t,Ga,{identifier:e,continueUri:gr()?Xn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.c,t))},t.kc=function(t){return!!eo(t)},t.ib=function(t,e){var n=this;return yh(this,Yt().then(function(){var t=new $r(e);if(!t.c)throw new zr("argument-error",ei+" must be true when sending sign in link to email");return ui(t)}).then(function(e){return n.c.ib(t,e)}).then(function(){}))},t.Pc=function(t){return this.Ia(t).then(function(t){return t.data.email})},t.Xa=function(t,e){return yh(this,this.c.Xa(t,e).then(function(){}))},t.Ia=function(t){return yh(this,this.c.Ia(t).then(function(t){return new qr(t)}))},t.Va=function(t){return yh(this,this.c.Va(t).then(function(){}))},t.hb=function(t,e){var n=this;return yh(this,Yt().then(function(){return void 0===e||H(e)?{}:ui(new $r(e))}).then(function(e){return n.c.hb(t,e)}).then(function(){}))},t.Fc=function(t,e){return yh(this,cc(this,t,e,E(this.Pa,this)))},t.Ec=function(t,e){var n=this;return yh(this,Yt().then(function(){var r=to(t,e||Xn());return n.Pa(r)}))},mh.prototype.render=function(){},mh.prototype.reset=function(){},mh.prototype.getResponse=function(){},mh.prototype.execute=function(){};var gh=null;function bh(t,e){return(e=wh(e))&&t.a[e]||null}function wh(t){return(t=void 0===t?1e12:t)?t.toString():null}function _h(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Qe(this.f,"click",this.i)}function Eh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Th(){}vh.prototype.render=function(t,e){return this.a[this.b.toString()]=new _h(t,e),this.b++},vh.prototype.reset=function(t){var e=bh(this,t);t=wh(t),e&&t&&(e.delete(),delete this.a[t])},vh.prototype.getResponse=function(t){return(t=bh(this,t))?t.getResponse():null},vh.prototype.execute=function(t){(t=bh(this,t))&&t.execute()},_h.prototype.getResponse=function(){return Eh(this),this.b},_h.prototype.execute=function(){Eh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},_h.prototype.delete=function(){Eh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Th.prototype.g=function(){return Yt(gh=gh||new vh)},Th.prototype.c=function(){};var Sh=null;function Ih(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Ch=new X(Z,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Nh=new Nr(3e4,6e4);Ih.prototype.g=function(t){var e=this;return new jt(function(n,r){var i=setTimeout(function(){r(new zr("network-request-failed"))},Nh.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new zr("internal-error"));delete a[e.a]},Yt(pa(rt(Ch,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(i),r(new zr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),n(a.grecaptcha))})},Ih.prototype.c=function(){this.b--};var Ah=null;function kh(t,e,n,r,i,o,s){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.l=e,this.g=null,s=s?Sh=Sh||new Th:Ah=Ah||new Ih,this.o=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Oh])throw new zr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ph],!a.document)throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new zr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new wa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.m=[];var c=this.a[Dh];this.a[Dh]=function(t){if(Mh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=yr(c,a);"function"==typeof e&&e(t)}};var h=this.a[Rh];this.a[Rh]=function(){if(Mh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=yr(h,a);"function"==typeof t&&t()}}}var Dh="callback",Rh="expired-callback",Oh="sitekey",Ph="size";function Mh(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function xh(t,e){return t.h.push(e),e.ha(function(){B(t.h,e)}),e}function Lh(t){if(t.B)throw new zr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Fh(t,e,n){var r=!1;try{this.b=n||mo.app()}catch(t){throw new zr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new zr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=mo.SDK_VERSION?pr(mo.SDK_VERSION,o):null,kh.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,mi(di),r)}function Uh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new zr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=qh.length)throw new zr("internal-error","Argument validator received an unsupported number of arguments.");n=qh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new zr("argument-error",t+" failed: "+r)}(t=kh.prototype).za=function(){var t=this;return this.f?this.f:this.f=xh(this,Yt().then(function(){if(gr()&&!ar())return rr();throw new zr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.o.g(t.v())}).then(function(e){return t.g=e,vs(t.u,rs,{})}).then(function(e){t.a[Oh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){Lh(this);var t=this;return xh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Vn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Lt(a.name),'"'),a.type){o.push(' type="',Lt(a.type),'"');var u={};Y(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!y(o)||v(o)&&0<o.nodeType?r(o):F(Wn(o)?Q(o):o,r)}}(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){Lh(this);var t=this;return xh(this,this.render().then(function(e){return new jt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(e,n){j(t.m,function(t){return t==n})}(0,i),n(e))};t.m.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){Lh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Lh(this),this.B=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},I(Fh,kh);var qh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Vh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:s}}function Bh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:u}}function jh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:v}}function Wh(t,e){return{name:t||"",K:"a function",optional:!!e,M:m}}function Qh(t,e){return{name:t||"",K:"null",optional:!!e,M:p}}function Kh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.ka||!n)}}}function Hh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&s(t.type)&&m(t.verify))}}}function Gh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function zh(t,e){for(var n in e){var r=e[n].name;t[r]=Jh(r,t[n],e[n].j)}}function Yh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){Uh(t,[n],[r],!0),this[e]=r},r,n,e[n].rb),enumerable:!0})}}function Xh(t,e,n,r){t[e]=Jh(e,n,r)}function Jh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Uh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}zh(rh.prototype,{Va:{name:"applyActionCode",j:[Vh("code")]},Ia:{name:"checkActionCode",j:[Vh("code")]},Xa:{name:"confirmPasswordReset",j:[Vh("code"),Vh("newPassword")]},Sb:{name:"createUserWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Vb:{name:"fetchSignInMethodsForEmail",j:[Vh("email")]},la:{name:"getRedirectResult",j:[]},kc:{name:"isSignInWithEmailLink",j:[Vh("emailLink")]},rc:{name:"onAuthStateChanged",j:[Gh(jh(),Wh(),"nextOrObserver"),Wh("opt_error",!0),Wh("opt_completed",!0)]},sc:{name:"onIdTokenChanged",j:[Gh(jh(),Wh(),"nextOrObserver"),Wh("opt_error",!0),Wh("opt_completed",!0)]},hb:{name:"sendPasswordResetEmail",j:[Vh("email"),Gh(jh("opt_actionCodeSettings",!0),Qh(null,!0),"opt_actionCodeSettings",!0)]},ib:{name:"sendSignInLinkToEmail",j:[Vh("email"),jh("actionCodeSettings")]},jb:{name:"setPersistence",j:[Vh("persistence")]},Bc:{name:"signInAndRetrieveDataWithCredential",j:[Kh()]},kb:{name:"signInAnonymously",j:[]},Pa:{name:"signInWithCredential",j:[Kh()]},Cc:{name:"signInWithCustomToken",j:[Vh("token")]},Dc:{name:"signInWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Ec:{name:"signInWithEmailLink",j:[Vh("email"),Vh("emailLink",!0)]},Fc:{name:"signInWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},Gc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Hc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"updateCurrentUser",j:[Gh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof gc)}},Qh(),"user")]},lb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Oc:{name:"useDeviceLanguage",j:[]},Pc:{name:"verifyPasswordResetCode",j:[Vh("code")]}}),Yh(rh.prototype,{lc:{name:"languageCode",rb:Gh(Vh(),Qh(),"languageCode")}}),(rh.Persistence=lu).LOCAL="local",rh.Persistence.SESSION="session",rh.Persistence.NONE="none",zh(gc.prototype,{delete:{name:"delete",j:[]},Zb:{name:"getIdTokenResult",j:[Bh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Bh("opt_forceRefresh",!0)]},mc:{name:"linkAndRetrieveDataWithCredential",j:[Kh()]},ab:{name:"linkWithCredential",j:[Kh()]},nc:{name:"linkWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},oc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},pc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},vc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Kh()]},cb:{name:"reauthenticateWithCredential",j:[Kh()]},wc:{name:"reauthenticateWithPhoneNumber",j:[Vh("phoneNumber"),Hh()]},xc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},yc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},gb:{name:"sendEmailVerification",j:[Gh(jh("opt_actionCodeSettings",!0),Qh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Lc:{name:"unlink",j:[Vh("provider")]},nb:{name:"updateEmail",j:[Vh("email")]},ob:{name:"updatePassword",j:[Vh("password")]},Nc:{name:"updatePhoneNumber",j:[Kh("phone")]},pb:{name:"updateProfile",j:[jh("profile")]}}),zh(vh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zh(mh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),zh(jt.prototype,{ha:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Yh(sc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",rb:Bh("appVerificationDisabledForTesting")}}),zh(uc.prototype,{confirm:{name:"confirm",j:[Vh("verificationCode")]}}),Xh(Oi,"fromJSON",function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[qi,$i,ro,Li],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Gh(Vh(),jh(),"json")]),Xh(Zi,"credential",function(t,e){return new Ji(t,e)},[Vh("email"),Vh("password")]),zh(Ji.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Wi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Wi,"credential",Qi,[Gh(Vh(),jh(),"token")]),Xh(Zi,"credentialWithLink",to,[Vh("email"),Vh("emailLink")]),zh(Ki.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Ki,"credential",Hi,[Gh(Vh(),jh(),"token")]),zh(Gi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Gi,"credential",zi,[Gh(Vh(),Gh(jh(),Qh()),"idToken"),Gh(Vh(),Qh(),"accessToken",!0)]),zh(Yi.prototype,{Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Yi,"credential",Xi,[Gh(Vh(),jh(),"token"),Vh("secret",!0)]),zh(ji.prototype,{ua:{name:"addScope",j:[Vh("scope")]},credential:{name:"credential",j:[Gh(Vh(),Gh(jh(),Qh()),"optionsOrIdToken"),Gh(Vh(),Qh(),"accessToken",!0)]},Ca:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),zh(Fi.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Mi.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),Xh(oo,"credential",ao,[Vh("verificationId"),Vh("verificationCode")]),zh(oo.prototype,{Ta:{name:"verifyPhoneNumber",j:[Vh("phoneNumber"),Hh()]}}),zh(no.prototype,{A:{name:"toJSON",j:[Vh(null,!0)]}}),zh(zr.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(vo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(yo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),zh(Fh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===mo||!mo.INTERNAL||!mo.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:rh,AuthCredential:Oi,Error:zr};Xh(t,"EmailAuthProvider",Zi,[]),Xh(t,"FacebookAuthProvider",Wi,[]),Xh(t,"GithubAuthProvider",Ki,[]),Xh(t,"GoogleAuthProvider",Gi,[]),Xh(t,"TwitterAuthProvider",Yi,[]),Xh(t,"OAuthProvider",ji,[Vh("providerId")]),Xh(t,"SAMLAuthProvider",Bi,[Vh("providerId")]),Xh(t,"PhoneAuthProvider",oo,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof rh)}}]),Xh(t,"RecaptchaVerifier",Fh,[Gh(Vh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),jh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof mo.app.App)}}]),mo.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:E((t=new rh(t)).getUid,t),getToken:E(t.Yb,t),addAuthTokenListener:E(t.Rb,t),removeAuthTokenListener:E(t.zc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),mo.INTERNAL.extendNamespace({User:gc})}()}).apply(void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var vo=(go.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),xi(e))},go.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Mi(e)},go.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},go.prototype.prefixedName_=function(t){return this.prefix_+t},go.prototype.toString=function(){return this.domStorage_.toString()},go);function go(t){this.domStorage_=t,this.prefix_="firebase:"}var bo=(wo.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},wo.prototype.get=function(t){return Fi(this.cache_,t)?this.cache_[t]:null},wo.prototype.remove=function(t){delete this.cache_[t]},wo);function wo(){this.cache_={},this.isInMemoryStorage=!0}function _o(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vo(e)}}catch(t){}return new bo}function Eo(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;vi(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Bi;n.update(e);var r=n.digest();return bi.encodeByteArray(r)}function To(t,e){vi(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Lo.logLevel=Qi.VERBOSE,Vo=Lo.log.bind(Lo),e&&xo.set("logging_enabled",!0)):"function"==typeof t?Vo=t:(Vo=null,xo.remove("logging_enabled"))}function So(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Bo&&(Bo=!1,null===Vo&&!0===xo.get("logging_enabled")&&To(!0)),Vo){var n=qo.apply(null,t);Vo(n)}}function Io(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];So.apply(void 0,pi([t],e))}}function Co(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+qo.apply(void 0,pi(t));Lo.error(n)}function No(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+qo.apply(void 0,pi(t));throw Lo.error(n),new Error(n)}function Ao(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+qo.apply(void 0,pi(t));Lo.warn(n)}function ko(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Do(t,e){return t===e?0:t<e?-1:1}function Ro(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+xi(e))}function Oo(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Po,Mo=_o("localStorage"),xo=_o("sessionStorage"),Lo=new ro("@firebase/database"),Fo="FIREBASE_DATABASE_EMULATOR_HOST",Uo=(Po=1,function(){return Po++}),qo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=qo.apply(null,t[r]):"object"==typeof t[r]?n+=xi(t[r]):n+=t[r],n+=" ";return n},Vo=null,Bo=!0,jo="[MIN_NAME]",Wo="[MAX_NAME]",Qo=function(t,e){if(t===e)return 0;if(t===jo||e===Wo)return-1;if(e===jo||t===Wo)return 1;var n=Jo(t),r=Jo(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ko=function(t){if("object"!=typeof t||null===t)return xi(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=xi(e[i]),r+=":",r+=Ko(t[e[i]]);return r+"}"};function Ho(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Go(t){var e,n,r,i,o,a,s;for(vi(!ko(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function zo(t){try{t()}catch(t){setTimeout(function(){throw Ao("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}}function Yo(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Xo=new RegExp("^-?\\d{1,10}$"),Jo=function(t){if(Xo.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},$o=(Object.defineProperty(Zo,"Empty",{get:function(){return new Zo("")},enumerable:!0,configurable:!0}),Zo.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Zo.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Zo.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Zo(this.pieces_,t)},Zo.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Zo.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Zo.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Zo.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Zo.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Zo(t,0)},Zo.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Zo)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Zo(e,0)},Zo.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Zo.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Zo.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Zo.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Qo(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Zo.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Zo.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Zo);function Zo(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var ta=(Object.defineProperty(ea,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(ea,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),ea.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Zi(t),this.checkValid_()},ea.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Zi(t),0<this.parts_.length&&(this.byteLength_-=1)},ea.prototype.checkValid_=function(){if(this.byteLength_>ea.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+ea.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>ea.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ea.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},ea.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},ea);function ea(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Zi(this.parts_[n]);this.checkValid_()}var na="firebaseio.com",ra="websocket",ia="long_polling",oa=(aa.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},aa.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},aa.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},aa.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},aa.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Mo.set("host:"+this.host,this.internalHost))},aa.prototype.connectionURL=function(t,e){var n;if(vi("string"==typeof t,"typeof type must == string"),vi("object"==typeof e,"typeof params must == object"),t===ra)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==ia)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Ho(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},aa.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},aa.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},aa);function aa(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Mo.get("host:"+t)||this.host}function sa(t){var e=ba(t),n=e.namespace;"firebase"===e.domain&&No(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||No("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ao("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new oa(e.host,e.secure,n,r,"",n!=e.subdomain),path:new $o(e.pathString)}}function ua(t){return"string"==typeof t&&0!==t.length&&!wa.test(t)}function ca(t){return"string"==typeof t&&0!==t.length&&!_a.test(t)}function ha(t){return null===t||"string"==typeof t||"number"==typeof t&&!ko(t)||t&&"object"==typeof t&&Fi(t,".sv")}function la(t,e,n,r,i){i&&void 0===n||Ta(Xi(t,e,i),n,r)}function fa(t,e,n,r,i){if(!i||void 0!==n){var o=Xi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Ho(n,function(t,e){var n=new $o(t);if(Ta(o,e,r.child(n)),".priority"===n.getBack()&&!ha(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ua(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort($o.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function pa(t,e,n,r){if(!r||void 0!==n){if(ko(n))throw new Error(Xi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ha(n))throw new Error(Xi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function da(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Xi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ya(t,e,n,r){if(!(r&&void 0===n||ua(n)))throw new Error(Xi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function ma(t,e,n,r){if(!(r&&void 0===n||ca(n)))throw new Error(Xi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function va(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function ga(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ua(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return ca(t=t&&t.replace(/^\/*\.info(\/|$)/,"/"))}(r))throw new Error(Xi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var ba=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=li(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Ao("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},wa=/[\[\].#$\/\u0000-\u001F\u007F]/,_a=/[\[\].#$\u0000-\u001F\u007F]/,Ea=10485760,Ta=function(t,e,n){var r=n instanceof $o?new ta(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(ko(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>Ea/3&&Zi(e)>Ea)throw new Error(t+"contains a string greater than "+Ea+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(Ho(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!ua(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),Ta(t,n,r),r.pop()}),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Sa=(Ia.prototype.cancel=function(t){Yi("OnDisconnect.cancel",0,1,arguments.length),Ji("OnDisconnect.cancel",1,t,!0);var e=new Ei;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Ia.prototype.remove=function(t){Yi("OnDisconnect.remove",0,1,arguments.length),va("OnDisconnect.remove",this.path_),Ji("OnDisconnect.remove",1,t,!0);var e=new Ei;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Ia.prototype.set=function(t,e){Yi("OnDisconnect.set",1,2,arguments.length),va("OnDisconnect.set",this.path_),la("OnDisconnect.set",1,t,this.path_,!1),Ji("OnDisconnect.set",2,e,!0);var n=new Ei;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Ia.prototype.setWithPriority=function(t,e,n){Yi("OnDisconnect.setWithPriority",2,3,arguments.length),va("OnDisconnect.setWithPriority",this.path_),la("OnDisconnect.setWithPriority",1,t,this.path_,!1),pa("OnDisconnect.setWithPriority",2,e,!1),Ji("OnDisconnect.setWithPriority",3,n,!0);var r=new Ei;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Ia.prototype.update=function(t,e){if(Yi("OnDisconnect.update",1,2,arguments.length),va("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Ao("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fa("OnDisconnect.update",1,t,this.path_,!1),Ji("OnDisconnect.update",2,e,!0);var i=new Ei;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Ia);function Ia(t,e){this.repo_=t,this.path_=e}var Ca=(Na.prototype.toJSON=function(){return Yi("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Na);function Na(t,e){this.committed=t,this.snapshot=e}var Aa,ka,Da,Ra=(Aa="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ka=0,Da=[],function(t){var e,n=t===ka;ka=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Aa.charAt(t%64),t=Math.floor(t/64);vi(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Da[e];e--)Da[e]=0;Da[e]++}else for(e=0;e<12;e++)Da[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Aa.charAt(Da[e]);return vi(20===i.length,"nextPushId: Length should be 20."),i}),Oa=(Pa.Wrap=function(t,e){return new Pa(t,e)},Pa);function Pa(t,e){this.name=t,this.node=e}var Ma,xa=(La.prototype.getCompare=function(){return this.compare.bind(this)},La.prototype.indexedValueChanged=function(t,e){var n=new Oa(jo,t),r=new Oa(jo,e);return 0!==this.compare(n,r)},La.prototype.minPost=function(){return Oa.MIN},La);function La(){}var Fa,Ua=(si(qa,Fa=xa),Object.defineProperty(qa,"__EMPTY_NODE",{get:function(){return Ma},set:function(t){Ma=t},enumerable:!0,configurable:!0}),qa.prototype.compare=function(t,e){return Qo(t.name,e.name)},qa.prototype.isDefinedOn=function(t){throw gi("KeyIndex.isDefinedOn not expected to be called.")},qa.prototype.indexedValueChanged=function(t,e){return!1},qa.prototype.minPost=function(){return Oa.MIN},qa.prototype.maxPost=function(){return new Oa(Wo,Ma)},qa.prototype.makePost=function(t,e){return vi("string"==typeof t,"KeyIndex indexValue must always be a string."),new Oa(t,Ma)},qa.prototype.toString=function(){return".key"},qa);function qa(){return null!==Fa&&Fa.apply(this,arguments)||this}var Va,Ba=new Ua;function ja(t){return"number"==typeof t?"number:"+Go(t):"string:"+t}function Wa(t){if(t.isLeafNode()){var e=t.val();vi("string"==typeof e||"number"==typeof e||"object"==typeof e&&Fi(e,".sv"),"Priority must be a string or number.")}else vi(t===Va||t.isEmpty(),"priority of unexpected type.");vi(t===Va||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Qa,Ka,Ha,Ga,za=(Object.defineProperty(Ya,"__childrenNodeConstructor",{get:function(){return Qa},set:function(t){Qa=t},enumerable:!0,configurable:!0}),Ya.prototype.isLeafNode=function(){return!0},Ya.prototype.getPriority=function(){return this.priorityNode_},Ya.prototype.updatePriority=function(t){return new Ya(this.value_,t)},Ya.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Ya.__childrenNodeConstructor.EMPTY_NODE},Ya.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Ya.__childrenNodeConstructor.EMPTY_NODE},Ya.prototype.hasChild=function(){return!1},Ya.prototype.getPredecessorChildName=function(t,e){return null},Ya.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Ya.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Ya.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(vi(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Ya.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Ya.prototype.isEmpty=function(){return!1},Ya.prototype.numChildren=function(){return 0},Ya.prototype.forEachChild=function(t,e){return!1},Ya.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Ya.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+ja(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Go(this.value_):this.value_,this.lazyHash_=Eo(t)}return this.lazyHash_},Ya.prototype.getValue=function(){return this.value_},Ya.prototype.compareTo=function(t){return t===Ya.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Ya.__childrenNodeConstructor?-1:(vi(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Ya.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Ya.VALUE_TYPE_ORDER.indexOf(e),i=Ya.VALUE_TYPE_ORDER.indexOf(n);return vi(0<=r,"Unknown leaf type: "+e),vi(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Ya.prototype.withIndex=function(){return this},Ya.prototype.isIndexed=function(){return!0},Ya.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Ya.VALUE_TYPE_ORDER=["object","boolean","number","string"],Ya);function Ya(t,e){void 0===e&&(e=Ya.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,vi(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Wa(this.priorityNode_)}function Xa(){return null!==Ga&&Ga.apply(this,arguments)||this}var Ja=new(si(Xa,Ga=xa),Xa.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Qo(t.name,e.name):i},Xa.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Xa.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Xa.prototype.minPost=function(){return Oa.MIN},Xa.prototype.maxPost=function(){return new Oa(Wo,new za("[PRIORITY-POST]",Ha))},Xa.prototype.makePost=function(t,e){var n=Ka(t);return new Oa(e,new za("[PRIORITY-POST]",n))},Xa.prototype.toString=function(){return".priority"},Xa),$a=(Za.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Za.prototype.hasNext=function(){return 0<this.nodeStack_.length},Za.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Za);function Za(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var ts=(es.prototype.copy=function(t,e,n,r,i){return new es(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},es.prototype.count=function(){return this.left.count()+1+this.right.count()},es.prototype.isEmpty=function(){return!1},es.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},es.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},es.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},es.prototype.minKey=function(){return this.min_().key},es.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},es.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},es.prototype.removeMin_=function(){if(this.left.isEmpty())return is.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},es.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return is.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},es.prototype.isRed_=function(){return this.color},es.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},es.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},es.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},es.prototype.rotateLeft_=function(){var t=this.copy(null,null,es.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},es.prototype.rotateRight_=function(){var t=this.copy(null,null,es.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},es.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},es.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},es.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},es.RED=!0,es.BLACK=!1,es);function es(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:es.RED,this.left=null!=r?r:is.EMPTY_NODE,this.right=null!=i?i:is.EMPTY_NODE}var ns=(rs.prototype.copy=function(t,e,n,r,i){return this},rs.prototype.insert=function(t,e,n){return new ts(t,e,null)},rs.prototype.remove=function(t,e){return this},rs.prototype.count=function(){return 0},rs.prototype.isEmpty=function(){return!0},rs.prototype.inorderTraversal=function(t){return!1},rs.prototype.reverseTraversal=function(t){return!1},rs.prototype.minKey=function(){return null},rs.prototype.maxKey=function(){return null},rs.prototype.check_=function(){return 0},rs.prototype.isRed_=function(){return!1},rs);function rs(){}var is=(os.prototype.insert=function(t,e){return new os(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ts.BLACK,null,null))},os.prototype.remove=function(t){return new os(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ts.BLACK,null,null))},os.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},os.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},os.prototype.isEmpty=function(){return this.root_.isEmpty()},os.prototype.count=function(){return this.root_.count()},os.prototype.minKey=function(){return this.root_.minKey()},os.prototype.maxKey=function(){return this.root_.maxKey()},os.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},os.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},os.prototype.getIterator=function(t){return new $a(this.root_,null,this.comparator_,!1,t)},os.prototype.getIteratorFrom=function(t,e){return new $a(this.root_,t,this.comparator_,!1,e)},os.prototype.getReverseIteratorFrom=function(t,e){return new $a(this.root_,t,this.comparator_,!0,e)},os.prototype.getReverseIterator=function(t){return new $a(this.root_,null,this.comparator_,!0,t)},os.EMPTY_NODE=new ns,os);function os(t,e){void 0===e&&(e=os.EMPTY_NODE),this.comparator_=t,this.root_=e}var as=Math.log(2),ss=(us.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},us);function us(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/as,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var cs,hs,ls=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new ts(a,o.node,ts.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new ts(a,o.node,ts.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(1+o,s),h=t[o],l=n?n(h):h;u(new ts(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,ts.BLACK):(s(l,ts.BLACK),s(l,ts.RED))}return o}(new ss(t.length));return new is(r||e,o)},fs={},ps=(Object.defineProperty(ds,"Default",{get:function(){return vi(Ja,"ChildrenNode.ts has not been loaded"),cs=cs||new ds({".priority":fs},{".priority":Ja})},enumerable:!0,configurable:!0}),ds.prototype.get=function(t){var e=Ui(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof is?e:null},ds.prototype.hasIndex=function(t){return Fi(this.indexSet_,t.toString())},ds.prototype.addIndex=function(t,e){vi(t!==Ba,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Oa.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?ls(r,t.getCompare()):fs;var s=t.toString(),u=ui({},this.indexSet_);u[s]=t;var c=ui({},this.indexes_);return c[s]=n,new ds(c,u)},ds.prototype.addToIndexes=function(t,e){var n=this;return new ds(Vi(this.indexes_,function(r,i){var o=Ui(n.indexSet_,i);if(vi(o,"Missing index implementation for "+i),r===fs){if(o.isDefinedOn(t.node)){for(var a=[],s=e.getIterator(Oa.Wrap),u=s.getNext();u;)u.name!=t.name&&a.push(u),u=s.getNext();return a.push(t),ls(a,o.getCompare())}return fs}var c=e.get(t.name),h=r;return c&&(h=h.remove(new Oa(t.name,c))),h.insert(t,t.node)}),this.indexSet_)},ds.prototype.removeFromIndexes=function(t,e){return new ds(Vi(this.indexes_,function(n){if(n===fs)return n;var r=e.get(t.name);return r?n.remove(new Oa(t.name,r)):n}),this.indexSet_)},ds);function ds(t,e){this.indexes_=t,this.indexSet_=e}function ys(t,e){return Qo(t.name,e.name)}function ms(t,e){return Qo(t,e)}var vs,gs=(Object.defineProperty(bs,"EMPTY_NODE",{get:function(){return hs=hs||new bs(new is(ms),null,ps.Default)},enumerable:!0,configurable:!0}),bs.prototype.isLeafNode=function(){return!1},bs.prototype.getPriority=function(){return this.priorityNode_||hs},bs.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new bs(this.children_,t,this.indexMap_)},bs.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?hs:e},bs.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},bs.prototype.hasChild=function(t){return null!==this.children_.get(t)},bs.prototype.updateImmediateChild=function(t,e){if(vi(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r,i=new Oa(t,e),o=void 0;return r=e.isEmpty()?(o=this.children_.remove(t),this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,e),this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?hs:this.priorityNode_,new bs(o,n,r)},bs.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;vi(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},bs.prototype.isEmpty=function(){return this.children_.isEmpty()},bs.prototype.numChildren=function(){return this.children_.count()},bs.prototype.val=function(t){if(this.isEmpty())return null;var e={},n=0,r=0,i=!0;if(this.forEachChild(Ja,function(o,a){e[o]=a.val(t),n++,i&&bs.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!t&&i&&r<2*n){var o=[];for(var a in e)o[a]=e[a];return o}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e},bs.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+ja(this.getPriority().val())+":"),this.forEachChild(Ja,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":Eo(t)}return this.lazyHash_},bs.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Oa(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},bs.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},bs.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Oa(e,this.children_.get(e)):null},bs.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},bs.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Oa(e,this.children_.get(e)):null},bs.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},bs.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},bs.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Oa.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},bs.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},bs.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Oa.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},bs.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===_s?-1:0},bs.prototype.withIndex=function(t){if(t===Ba||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new bs(this.children_,this.priorityNode_,e)},bs.prototype.isIndexed=function(t){return t===Ba||this.indexMap_.hasIndex(t)},bs.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Ja),r=e.getIterator(Ja),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},bs.prototype.resolveIndex_=function(t){return t===Ba?null:this.indexMap_.get(t.toString())},bs.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,bs);function bs(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Wa(this.priorityNode_),this.children_.isEmpty()&&vi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function ws(){return vs.call(this,new is(ms),gs.EMPTY_NODE,ps.Default)||this}var _s=new(si(ws,vs=gs),ws.prototype.compareTo=function(t){return t===this?0:1},ws.prototype.equals=function(t){return t===this},ws.prototype.getPriority=function(){return this},ws.prototype.getImmediateChild=function(t){return gs.EMPTY_NODE},ws.prototype.isEmpty=function(){return!1},ws);Object.defineProperties(Oa,{MIN:{value:new Oa(jo,gs.EMPTY_NODE)},MAX:{value:new Oa(Wo,_s)}}),Ua.__EMPTY_NODE=gs.EMPTY_NODE,za.__childrenNodeConstructor=gs,Va=_s,Ha=_s;var Es,Ts=!0;function Ss(t,e){if(void 0===e&&(e=null),null===t)return gs.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),vi(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new za(t,Ss(e));if(t instanceof Array||!Ts){var n=gs.EMPTY_NODE;return Ho(t,function(e,r){if(Fi(t,e)&&"."!==e.substring(0,1)){var i=Ss(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}}),n.updatePriority(Ss(e))}var r=[],i=!1;if(Ho(t,function(t,e){if("."!==t.substring(0,1)){var n=Ss(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Oa(t,n)))}}),0==r.length)return gs.EMPTY_NODE;var o=ls(r,ys,function(t){return t.name},ms);if(i){var a=ls(r,Ja.getCompare());return new gs(o,Ss(e),new ps({".priority":a},{".priority":Ja}))}return new gs(o,Ss(e),ps.Default)}function Is(){return null!==Es&&Es.apply(this,arguments)||this}Ka=Ss;var Cs,Ns=new(si(Is,Es=xa),Is.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Qo(t.name,e.name):n},Is.prototype.isDefinedOn=function(t){return!0},Is.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Is.prototype.minPost=function(){return Oa.MIN},Is.prototype.maxPost=function(){return Oa.MAX},Is.prototype.makePost=function(t,e){var n=Ss(t);return new Oa(e,n)},Is.prototype.toString=function(){return".value"},Is),As=(si(ks,Cs=xa),ks.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},ks.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},ks.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Qo(t.name,e.name):i},ks.prototype.makePost=function(t,e){var n=Ss(t),r=gs.EMPTY_NODE.updateChild(this.indexPath_,n);return new Oa(e,r)},ks.prototype.maxPost=function(){var t=gs.EMPTY_NODE.updateChild(this.indexPath_,_s);return new Oa(Wo,t)},ks.prototype.toString=function(){return this.indexPath_.slice().join("/")},ks);function ks(t){var e=Cs.call(this)||this;return e.indexPath_=t,vi(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Ds=(Rs.prototype.val=function(){return Yi("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Rs.prototype.exportVal=function(){return Yi("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Rs.prototype.toJSON=function(){return Yi("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Rs.prototype.exists=function(){return Yi("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Rs.prototype.child=function(t){Yi("DataSnapshot.child",0,1,arguments.length),ma("DataSnapshot.child",1,t=String(t),!1);var e=new $o(t),n=this.ref_.child(e);return new Rs(this.node_.getChild(e),n,Ja)},Rs.prototype.hasChild=function(t){Yi("DataSnapshot.hasChild",1,1,arguments.length),ma("DataSnapshot.hasChild",1,t,!1);var e=new $o(t);return!this.node_.getChild(e).isEmpty()},Rs.prototype.getPriority=function(){return Yi("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Rs.prototype.forEach=function(t){var e=this;return Yi("DataSnapshot.forEach",1,1,arguments.length),Ji("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(n,r){return t(new Rs(r,e.ref_.child(n),Ja))})},Rs.prototype.hasChildren=function(){return Yi("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Rs.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Rs.prototype.numChildren=function(){return Yi("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Rs.prototype.getRef=function(){return Yi("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Rs.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Rs);function Rs(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var Os=(Ps.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Ps.prototype.getEventType=function(){return this.eventType},Ps.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ps.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+xi(this.snapshot.exportVal())},Ps);function Ps(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Ms=(xs.prototype.getPath=function(){return this.path},xs.prototype.getEventType=function(){return"cancel"},xs.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},xs.prototype.toString=function(){return this.path.toString()+":cancel"},xs);function xs(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Ls=(Fs.prototype.respondsTo=function(t){return"value"===t},Fs.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Os("value",this,new Ds(t.snapshotNode,e.getRef(),n))},Fs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){vi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},Fs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ms(this,t,e):null},Fs.prototype.matches=function(t){return t instanceof Fs&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},Fs.prototype.hasAnyCallback=function(){return null!==this.callback_},Fs);function Fs(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Us,qs=(Vs.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Fi(this.callbacks_,e)},Vs.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ms(this,t,e):null},Vs.prototype.createEvent=function(t,e){vi(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Os(t.type,this,new Ds(t.snapshotNode,n,r),t.prevName)},Vs.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){vi(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Vs.prototype.matches=function(t){var e=this;if(t instanceof Vs){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var n=Object.keys(t.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every(function(n){return t.callbacks_[n]===e.callbacks_[n]});var o=n[0],a=r[0];return!(a!==o||t.callbacks_[o]&&this.callbacks_[a]&&t.callbacks_[o]!==this.callbacks_[a])}}}return!1},Vs.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Vs);function Vs(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var Bs=(Object.defineProperty(js,"__referenceConstructor",{get:function(){return vi(Us,"Reference.ts has not been loaded"),Us},set:function(t){Us=t},enumerable:!0,configurable:!0}),js.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Ba){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=jo)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Wo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ja){if(null!=e&&!ha(e)||null!=n&&!ha(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(vi(t.getIndex()instanceof As||t.getIndex()===Ns,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},js.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},js.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},js.prototype.getQueryParams=function(){return this.queryParams_},js.prototype.getRef=function(){return Yi("Query.ref",0,0,arguments.length),new js.__referenceConstructor(this.repo,this.path)},js.prototype.on=function(t,e,n,r){Yi("Query.on",2,4,arguments.length),da("Query.on",1,t,!1),Ji("Query.on",2,e,!1);var i=js.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},js.prototype.onValueEvent=function(t,e,n){var r=new Ls(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},js.prototype.onChildEvent=function(t,e,n){var r=new qs(t,e,n);this.repo.addEventCallbackForQuery(this,r)},js.prototype.off=function(t,e,n){Yi("Query.off",0,3,arguments.length),da("Query.off",1,t,!0),Ji("Query.off",2,e,!0),$i("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Ls(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new qs(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},js.prototype.once=function(t,e,n,r){var i=this;Yi("Query.once",1,4,arguments.length),da("Query.once",1,t,!1),Ji("Query.once",2,e,!0);var o=js.getCancelAndContextArgs_("Query.once",n,r),a=!0,s=new Ei;s.promise.catch(function(){});var u=function(n){a&&(a=!1,i.off(t,u),e&&e.bind(o.context)(n),s.resolve(n))};return this.on(t,u,function(e){i.off(t,u),o.cancel&&o.cancel.bind(o.context)(e),s.reject(e)}),s.promise},js.prototype.limitToFirst=function(t){if(Yi("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new js(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},js.prototype.limitToLast=function(t){if(Yi("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new js(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},js.prototype.orderByChild=function(t){if(Yi("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ma("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new $o(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new As(e),r=this.queryParams_.orderBy(n);return js.validateQueryEndpoints_(r),new js(this.repo,this.path,r,!0)},js.prototype.orderByKey=function(){Yi("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Ba);return js.validateQueryEndpoints_(t),new js(this.repo,this.path,t,!0)},js.prototype.orderByPriority=function(){Yi("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ja);return js.validateQueryEndpoints_(t),new js(this.repo,this.path,t,!0)},js.prototype.orderByValue=function(){Yi("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ns);return js.validateQueryEndpoints_(t),new js(this.repo,this.path,t,!0)},js.prototype.startAt=function(t,e){void 0===t&&(t=null),Yi("Query.startAt",0,2,arguments.length),la("Query.startAt",1,t,this.path,!0),ya("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(js.validateLimit_(n),js.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new js(this.repo,this.path,n,this.orderByCalled_)},js.prototype.endAt=function(t,e){void 0===t&&(t=null),Yi("Query.endAt",0,2,arguments.length),la("Query.endAt",1,t,this.path,!0),ya("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(js.validateLimit_(n),js.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new js(this.repo,this.path,n,this.orderByCalled_)},js.prototype.equalTo=function(t,e){if(Yi("Query.equalTo",1,2,arguments.length),la("Query.equalTo",1,t,this.path,!1),ya("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},js.prototype.toString=function(){return Yi("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},js.prototype.toJSON=function(){return Yi("Query.toJSON",0,1,arguments.length),this.toString()},js.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},js.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Ko(t);return"{}"===e?"default":e},js.prototype.isEqual=function(t){if(Yi("Query.isEqual",1,1,arguments.length),!(t instanceof js))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},js.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Ji(t,3,r.cancel,!0),r.context=n,$i(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Xi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(js.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),js);function js(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var Ws=(Qs.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Qs.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Qs);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Qs.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ja,function(t,e){n.remember(new $o(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Qs.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild(function(n,r){var i=new $o(t.toString()+"/"+n);r.forEachTree(i,e)})},Qs.prototype.forEachChild=function(t){this.children.forEach(function(e,n){t(n,e)})},Qs);function Qs(){this.value=null,this.children=new Map}function Ks(t,e){return t&&"object"==typeof t?(vi(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Hs,Gs,zs=function(t,e){var n,r=Ks(t.getPriority().val(),e);if(t.isLeafNode()){var i=t,o=Ks(i.getValue(),e);return o!==i.getValue()||r!==i.getPriority().val()?new za(o,Ss(r)):t}var a=t;return r!==(n=a).getPriority().val()&&(n=n.updatePriority(new za(r))),a.forEachChild(Ja,function(t,r){var i=zs(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};(Gs=Hs=Hs||{})[Gs.OVERWRITE=0]="OVERWRITE",Gs[Gs.MERGE=1]="MERGE",Gs[Gs.ACK_USER_WRITE=2]="ACK_USER_WRITE",Gs[Gs.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Ys=(Xs.User=new Xs(!0,!1,null,!1),Xs.Server=new Xs(!1,!0,null,!1),Xs.forServerTaggedQuery=function(t){return new Xs(!1,!0,t,!0)},Xs);function Xs(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,vi(!r||e,"Tagged queries must be from server.")}var Js,$s=(Zs.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return vi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new $o(t));return new Zs($o.Empty,e,this.revert)}return vi(this.path.getFront()===t,"operationForChild called for unrelated child."),new Zs(this.path.popFront(),this.affectedTree,this.revert)},Zs);function Zs(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Hs.ACK_USER_WRITE,this.source=Ys.User}var tu=(eu.fromObject=function(t){var e=eu.Empty;return Ho(t,function(t,n){e=e.set(new $o(t),n)}),e},eu.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},eu.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:$o.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new $o(n).child(i.path),value:i.value}},eu.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},eu.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):eu.Empty},eu.prototype.set=function(t,e){if(t.isEmpty())return new eu(e,this.children);var n=t.getFront(),r=(this.children.get(n)||eu.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new eu(this.value,i)},eu.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?eu.Empty:new eu(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?eu.Empty:new eu(this.value,i)}return this},eu.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},eu.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n,r=t.getFront(),i=(this.children.get(r)||eu.Empty).setTree(t.popFront(),e);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new eu(this.value,n)},eu.prototype.fold=function(t){return this.fold_($o.Empty,t)},eu.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},eu.prototype.findOnPath=function(t,e){return this.findOnPath_(t,$o.Empty,e)},eu.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},eu.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,$o.Empty,e)},eu.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):eu.Empty},eu.prototype.foreach=function(t){this.foreach_($o.Empty,t)},eu.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},eu.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},eu.Empty=new eu(null),eu);function eu(t,e){void 0===e&&(e=Js=Js||new is(Do)),this.value=t,this.children=e}var nu=(ru.prototype.operationForChild=function(t){return this.path.isEmpty()?new ru(this.source,$o.Empty):new ru(this.source,this.path.popFront())},ru);function ru(t,e){this.source=t,this.path=e,this.type=Hs.LISTEN_COMPLETE}var iu=(ou.prototype.operationForChild=function(t){return this.path.isEmpty()?new ou(this.source,$o.Empty,this.snap.getImmediateChild(t)):new ou(this.source,this.path.popFront(),this.snap)},ou);function ou(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Hs.OVERWRITE}var au=(su.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new $o(t));return e.isEmpty()?null:e.value?new iu(this.source,$o.Empty,e.value):new su(this.source,$o.Empty,e)}return vi(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new su(this.source,this.path.popFront(),this.children)},su.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},su);function su(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Hs.MERGE}var uu=(cu.prototype.isFullyInitialized=function(){return this.fullyInitialized_},cu.prototype.isFiltered=function(){return this.filtered_},cu.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},cu.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},cu.prototype.getNode=function(){return this.node_},cu);function cu(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var hu=(lu.prototype.updateEventSnap=function(t,e,n){return new lu(new uu(t,e,n),this.serverCache_)},lu.prototype.updateServerSnap=function(t,e,n){return new lu(this.eventCache_,new uu(t,e,n))},lu.prototype.getEventCache=function(){return this.eventCache_},lu.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},lu.prototype.getServerCache=function(){return this.serverCache_},lu.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},lu.Empty=new lu(new uu(gs.EMPTY_NODE,!1,!1),new uu(gs.EMPTY_NODE,!1,!1)),lu);function lu(t,e){this.eventCache_=t,this.serverCache_=e}var fu=(pu.valueChange=function(t){return new pu(pu.VALUE,t)},pu.childAddedChange=function(t,e){return new pu(pu.CHILD_ADDED,e,t)},pu.childRemovedChange=function(t,e){return new pu(pu.CHILD_REMOVED,e,t)},pu.childChangedChange=function(t,e,n){return new pu(pu.CHILD_CHANGED,e,t,n)},pu.childMovedChange=function(t,e){return new pu(pu.CHILD_MOVED,e,t)},pu.CHILD_ADDED="child_added",pu.CHILD_REMOVED="child_removed",pu.CHILD_CHANGED="child_changed",pu.CHILD_MOVED="child_moved",pu.VALUE="value",pu);function pu(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var du=(yu.prototype.updateChild=function(t,e,n,r,i,o){vi(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(fu.childRemovedChange(e,a)):vi(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(fu.childAddedChange(e,n)):o.trackChildChange(fu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},yu.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ja,function(t,r){e.hasChild(t)||n.trackChildChange(fu.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(Ja,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(fu.childChangedChange(e,r,i))}else n.trackChildChange(fu.childAddedChange(e,r))})),e.withIndex(this.index_)},yu.prototype.updatePriority=function(t,e){return t.isEmpty()?gs.EMPTY_NODE:t.updatePriority(e)},yu.prototype.filtersNodes=function(){return!1},yu.prototype.getIndexedFilter=function(){return this},yu.prototype.getIndex=function(){return this.index_},yu);function yu(t){this.index_=t}var mu=(vu.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;vi(e==fu.CHILD_ADDED||e==fu.CHILD_CHANGED||e==fu.CHILD_REMOVED,"Only child changes supported for tracking"),vi(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==fu.CHILD_ADDED&&i==fu.CHILD_REMOVED)this.changeMap.set(n,fu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==fu.CHILD_REMOVED&&i==fu.CHILD_ADDED)this.changeMap.delete(n);else if(e==fu.CHILD_REMOVED&&i==fu.CHILD_CHANGED)this.changeMap.set(n,fu.childRemovedChange(n,r.oldSnap));else if(e==fu.CHILD_CHANGED&&i==fu.CHILD_ADDED)this.changeMap.set(n,fu.childAddedChange(n,t.snapshotNode));else{if(e!=fu.CHILD_CHANGED||i!=fu.CHILD_CHANGED)throw gi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,fu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},vu.prototype.getChanges=function(){return Array.from(this.changeMap.values())},vu);function vu(){this.changeMap=new Map}function gu(){}var bu=new(gu.prototype.getCompleteChild=function(t){return null},gu.prototype.getChildAfterChild=function(t,e,n){return null},gu),wu=(_u.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new uu(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},_u.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},_u);function _u(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Eu=function(t,e){this.viewCache=t,this.changes=e},Tu=(Su.prototype.assertIndexed=function(t){vi(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),vi(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Su.prototype.applyOperation=function(t,e,n,r){var i,o,a=new mu;if(e.type===Hs.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(vi(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Hs.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(vi(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Hs.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Hs.LISTEN_COMPLETE)throw gi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Su.maybeAddValueEvent_(t,i,h),new Eu(i,h)},Su.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(fu.valueChange(e.getCompleteEventSnap()))}},Su.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(vi(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof gs?u:gs.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){vi(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Su.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,bu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new wu(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Su.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new wu(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):gs.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Su.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Su.prototype.applyUserMerge_=function(t,e,n,r,i,o){var a=this,s=t;return n.foreach(function(n,u){var c=e.child(n);Su.cacheHasChild_(t,c.getFront())&&(s=a.applyUserOverwrite_(s,c,u,r,i,o))}),n.foreach(function(n,u){var c=e.child(n);Su.cacheHasChild_(t,c.getFront())||(s=a.applyUserOverwrite_(s,c,u,r,i,o))}),s},Su.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},Su.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:tu.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new $o(e),l,r,i,o,a)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new $o(e),f,r,i,o,a)}}),c},Su.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=tu.Empty;return s.getNode().forEachChild(Ba,function(t,e){u=u.set(new $o(t),e)}),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=tu.Empty;return n.foreach(function(t,n){var r=e.child(t);s.isCompleteForPath(r)&&(c=c.set(t,s.getNode().getChild(r)))}),this.applyServerMerge_(t,e,c,r,i,a,o)},Su.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,bu,r)},Su.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new wu(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();vi(h instanceof gs,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,gs.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite($o.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Su);function Su(t){this.filter_=t}var Iu=(Cu.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===fu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(fu.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,fu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,fu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,fu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,fu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,fu.VALUE,t,n,e),i},Cu.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},Cu.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Cu.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw gi("Should only compare child_ events.");var n=new Oa(t.childName,t.snapshotNode),r=new Oa(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Cu);function Cu(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Nu,Au=(ku.prototype.getQuery=function(){return this.query_},ku.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},ku.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},ku.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},ku.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},ku.prototype.removeEventRegistration=function(t,e){var n=[];if(e){vi(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},ku.prototype.applyOperation=function(t,e,n){t.type===Hs.MERGE&&null!==t.source.queryId&&(vi(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),vi(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),vi(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},ku.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ja,function(t,e){n.push(fu.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(fu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},ku.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},ku);function ku(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new du(n.getIndex()),i=n.getNodeFilter();this.processor_=new Tu(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(gs.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(gs.EMPTY_NODE,a.getNode(),null),c=new uu(s,o.isFullyInitialized(),r.filtersNodes()),h=new uu(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new hu(h,c),this.eventGenerator_=new Iu(this.query_)}var Du=(Object.defineProperty(Ru,"__referenceConstructor",{get:function(){return vi(Nu,"Reference.ts has not been loaded"),Nu},set:function(t){vi(!Nu,"__referenceConstructor has already been defined"),Nu=t},enumerable:!0,configurable:!0}),Ru.prototype.isEmpty=function(){return 0===this.views.size},Ru.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return vi(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=li(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Ru.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof gs?n.calcCompleteEventChildren(r):gs.EMPTY_NODE,!1);var c=new hu(new uu(u,s,!1),new uu(r,i,!1));a=new Au(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Ru.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=li(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=fi(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Ru.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Ru.prototype.getQueryViews=function(){var t,e,n=[];try{for(var r=li(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},Ru.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=li(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Ru.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Ru.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Ru.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Ru.prototype.getCompleteView=function(){var t,e;try{for(var n=li(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},Ru);function Ru(){this.views=new Map}var Ou=(Pu.prototype.addWrite=function(t,e){if(t.isEmpty())return new Pu(new tu(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=$o.relativePath(r,t);return i=i.updateChild(o,e),new Pu(this.writeTree_.set(r,i))}var a=new tu(e);return new Pu(this.writeTree_.setTree(t,a))},Pu.prototype.addWrites=function(t,e){var n=this;return Ho(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},Pu.prototype.removeWrite=function(t){return t.isEmpty()?Pu.Empty:new Pu(this.writeTree_.setTree(t,tu.Empty))},Pu.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Pu.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild($o.relativePath(e.path,t)):null},Pu.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ja,function(e,n){t.push(new Oa(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new Oa(e,n.value))}),t},Pu.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Pu(null!=e?new tu(e):this.writeTree_.subtree(t))},Pu.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Pu.prototype.apply=function(t){return function t(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(vi(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r}($o.Empty,this.writeTree_,t)},Pu.Empty=new Pu(new tu(null)),Pu);function Pu(t){this.writeTree_=t}var Mu=(xu.prototype.childWrites=function(t){return new Lu(t,this)},xu.prototype.addOverwrite=function(t,e,n,r){vi(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},xu.prototype.addMerge=function(t,e,n){vi(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},xu.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},xu.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});vi(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Ho(r.children,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))}),!0)},xu.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},xu.prototype.calcCompleteEventCache=function(t,e,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(t);if(!r&&i.isEmpty())return e;if(r||null!=e||i.hasCompleteWrite($o.Empty)){var o=xu.layerTree_(this.allWrites_,function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t);return u=e||gs.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(t);if(s.isEmpty())return e;if(null!=e||s.hasCompleteWrite($o.Empty)){var u=e||gs.EMPTY_NODE;return s.apply(u)}return null},xu.prototype.calcCompleteEventChildren=function(t,e){var n=gs.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ja,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ja,function(t,e){var r=i.childCompoundWrite(new $o(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},xu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){vi(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},xu.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},xu.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},xu.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode($o.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},xu.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},xu.prototype.resetTree_=function(){this.visibleWrites_=xu.layerTree_(this.allWrites_,xu.DefaultFilter_,$o.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},xu.DefaultFilter_=function(t){return t.visible},xu.layerTree_=function(t,e,n){for(var r=Ou.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=$o.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=$o.relativePath(a,n),r=r.addWrite($o.Empty,o.snap.getChild(s)));else{if(!o.children)throw gi("WriteRecord should have .snap or .children");if(n.contains(a))s=$o.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=$o.relativePath(a,n)).isEmpty())r=r.addWrites($o.Empty,o.children);else{var u=Ui(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite($o.Empty,c)}}}}}return r},xu);function xu(){this.visibleWrites_=Ou.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Lu=(Fu.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Fu.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Fu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Fu.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Fu.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Fu.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Fu.prototype.child=function(t){return new Fu(this.treePath_.child(t),this.writeTree_)},Fu);function Fu(t,e){this.treePath_=t,this.writeTree_=e}var Uu=(qu.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new iu(Ys.User,t,e)):[]},qu.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=tu.fromObject(e);return this.applyOperationToSyncPoints_(new au(Ys.User,t,r))},qu.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=tu.Empty;return null!=n.snap?r=r.set($o.Empty,!0):Ho(n.children,function(t,e){r=r.set(new $o(t),e)}),this.applyOperationToSyncPoints_(new $s(n.path,r,e))}return[]},qu.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new iu(Ys.Server,t,e))},qu.prototype.applyServerMerge=function(t,e){var n=tu.fromObject(e);return this.applyOperationToSyncPoints_(new au(Ys.Server,t,n))},qu.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new nu(Ys.Server,t))},qu.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=qu.parseQueryKey_(r),o=i.path,a=i.queryId,s=$o.relativePath(o,t),u=new iu(Ys.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},qu.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=qu.parseQueryKey_(r),o=i.path,a=i.queryId,s=$o.relativePath(o,t),u=tu.fromObject(e),c=new au(Ys.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},qu.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=qu.parseQueryKey_(n),i=r.path,o=r.queryId,a=$o.relativePath(i,t),s=new nu(Ys.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},qu.prototype.addEventRegistration=function(t,e){var n=t.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,function(t,e){var o=$o.relativePath(t,n);r=r||e.getCompleteServerCache(o),i=i||e.hasCompleteView()});var o,a=this.syncPointTree_.get(n);a?(i=i||a.hasCompleteView(),r=r||a.getCompleteServerCache($o.Empty)):(a=new Du,this.syncPointTree_=this.syncPointTree_.set(n,a)),null!=r?o=!0:(o=!1,r=gs.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild(function(t,e){var n=e.getCompleteServerCache($o.Empty);n&&(r=r.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=qu.makeQueryKey_(t);vi(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=qu.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(n),l=a.addEventRegistration(t,e,h,r,o);if(!s&&!i){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},qu.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(qu.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(qu.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(qu.makeQueryKey_(t));r.listenProvider_.stopListening(qu.queryForListening_(t),e)})),this.removeTags_(u)}return a},qu.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=$o.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},qu.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Ho(n,function(t,e){r=r.concat(e)}),r})},qu.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=qu.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},qu.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},qu.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(qu.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)vi(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Ho(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(qu.queryForListening_(c),this.tagForQuery_(c))}return o},qu.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||gs.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},qu.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},qu.parseQueryKey_=function(t){var e=t.indexOf("$");return vi(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new $o(t.substr(0,e))}},qu.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},qu.prototype.tagForQuery_=function(t){var e=qu.makeQueryKey_(t);return this.queryToTagMap.get(e)},qu.getNextQueryTag_=function(){return qu.nextQueryTag_++},qu.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);vi(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},qu.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites($o.Empty))},qu.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get($o.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache($o.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},qu.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get($o.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache($o.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))}),o&&(a=a.concat(o.applyOperation(t,r,n))),a},qu.nextQueryTag_=1,qu);function qu(t){this.listenProvider_=t,this.syncPointTree_=tu.Empty,this.pendingWriteTree_=new Mu,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Vu=(Bu.prototype.getNode=function(t){return this.rootNode_.getChild(t)},Bu.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},Bu);function Bu(){this.rootNode_=gs.EMPTY_NODE}var ju=(Wu.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(So("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Wu.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Wu.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Wu.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ao(t)},Wu);function Wu(t){this.app_=t}var Qu=function(t){this.accessToken=t},Ku=(Hu.prototype.getToken=function(t){return Promise.resolve(new Qu("owner"))},Hu.prototype.addTokenChangeListener=function(t){},Hu.prototype.removeTokenChangeListener=function(t){},Hu.prototype.notifyForInvalidToken=function(){Ao('Database emulator unexpectedly rejected fake "owner" credentials.')},Hu);function Hu(t){this.app_=t}var Gu=(zu.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Fi(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},zu.prototype.get=function(){return wi(this.counters_)},zu);function zu(){this.counters_={}}var Yu=(Xu.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Gu),this.collections_[e]},Xu.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Xu.collections_={},Xu.reporters_={},Xu);function Xu(){}var Ju=($u.prototype.get=function(){var t=this.collection_.get(),e=ui({},t);return this.last_&&Ho(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},$u);function $u(t){this.collection_=t,this.last_=null}var Zu=(tc.prototype.includeStat=function(t){this.statsToReport_[t]=!0},tc.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;Ho(e,function(e,i){0<i&&Fi(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),Yo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},tc);function tc(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Ju(t);var n=1e4+2e4*Math.random();Yo(this.reportStats_.bind(this),Math.floor(n))}var ec=(nc.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new rc(i)),e.add(r)}e&&this.eventLists_.push(e)},nc.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},nc.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},nc.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},nc);function nc(){this.eventLists_=[],this.recursionDepth_=0}var rc=(ic.prototype.add=function(t){this.events_.push(t)},ic.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Vo&&So("event: "+e.toString()),zo(n)}}},ic.prototype.getPath=function(){return this.path_},ic);function ic(t){this.path_=t,this.events_=[]}var oc=(ac.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=pi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},ac.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},ac.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},ac.prototype.validateEventType_=function(t){vi(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},ac);function ac(t){this.allowedEvents_=t,this.listeners_={},vi(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var sc,uc=(si(cc,sc=oc),cc.getInstance=function(){return new cc},cc.prototype.getInitialEvent=function(t){return vi("visible"===t,"Unknown event type: "+t),[this.visible_]},cc);function cc(){var t,e,n=sc.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),n.visible_=!0,e&&document.addEventListener(e,function(){var e=!document[t];e!==n.visible_&&(n.visible_=e,n.trigger("visible",e))},!1),n}var hc,lc=(si(fc,hc=oc),fc.getInstance=function(){return new fc},fc.prototype.getInitialEvent=function(t){return vi("online"===t,"Unknown event type: "+t),[this.online_]},fc.prototype.currentlyOnline=function(){return this.online_},fc);function fc(){var t=hc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ii()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var pc=(dc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},dc.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&zo(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},dc);function dc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var yc=(mc.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new pc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new vc(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=fi(t,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==i)n.id=o,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=fi(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(na)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},mc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},mc.forceAllow=function(){mc.forceAllow_=!0},mc.forceDisallow=function(){mc.forceDisallow_=!0},mc.isAvailable=function(){return mc.forceAllow_||!mc.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Ni()},mc.prototype.markConnectionHealthy=function(){},mc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},mc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},mc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},mc.prototype.send=function(t){var e=xi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Oo(function(t){var e=di(t);return bi.encodeByteArray(e,!0)}(e),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},mc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},mc.prototype.incrementIncomingBytes_=function(t){var e=xi(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},mc);function mc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Io(t),this.stats_=Yu.getCollection(e),this.urlFn=function(t){return e.connectionURL(ia,t)}}var vc=(gc.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||So("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},gc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},gc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},gc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},gc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},gc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},gc.prototype.addTag=function(t,e){var n=this;setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){So("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},gc);function gc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Uo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=gc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){So("frame writing exception"),t.stack&&So(t.stack),So(t)}}var bc="",wc=null;"undefined"!=typeof MozWebSocket?wc=MozWebSocket:"undefined"!=typeof WebSocket&&(wc=WebSocket);var _c=(Ec.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(na)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(ra,r)},Ec.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Mo.set("previous_websocket_failure",!0);try{if(Ni()){var i=mi.NODE_ADMIN?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+bc+"/"+r.platform+"/"+i}},a=r.env,s=0==this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;s&&(o.proxy={origin:s}),this.mySock=new wc(this.connURL,[],o)}else this.mySock=new wc(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var u=t.message||t.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},Ec.prototype.start=function(){},Ec.forceDisallow=function(){Ec.forceDisallow_=!0},Ec.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==wc&&!Ec.forceDisallow_},Ec.previouslyFailed=function(){return Mo.isInMemoryStorage||!0===Mo.get("previous_websocket_failure")},Ec.prototype.markConnectionHealthy=function(){Mo.remove("previous_websocket_failure")},Ec.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Mi(e);this.onMessage(n)}},Ec.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},Ec.prototype.extractFrameCount_=function(t){if(vi(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},Ec.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},Ec.prototype.send=function(t){this.resetKeepAlive();var e=xi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Oo(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},Ec.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},Ec.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},Ec.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},Ec.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},Ec.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},Ec.responsesRequiredToBeHealthy=2,Ec.healthyTimeout=3e4,Ec);function Ec(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Io(this.connId),this.stats_=Yu.getCollection(e),this.connURL=Ec.connectionURL_(e,n,r)}var Tc=(Object.defineProperty(Sc,"ALL_TRANSPORTS",{get:function(){return[yc,_c]},enumerable:!0,configurable:!0}),Sc.prototype.initTransports_=function(t){var e,n,r=_c&&_c.isAvailable(),i=r&&!_c.previouslyFailed();if(t.webSocketOnly&&(r||Ao("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[_c];else{var o=this.transports_=[];try{for(var a=li(Sc.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Sc.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Sc.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Sc);function Sc(t){this.initTransports_(t)}var Ic=(Cc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Yo(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Cc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Cc.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},Cc.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},Cc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Cc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Cc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Cc.prototype.onSecondaryMessageReceived_=function(t){var e=Ro("t",t),n=Ro("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Cc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Cc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Cc.prototype.onPrimaryMessageReceived_=function(t){var e=Ro("t",t),n=Ro("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Cc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Cc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Cc.prototype.onControl_=function(t){var e=Ro("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Co("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Co("Unknown control packet command: "+e)}},Cc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Ao("Protocol version mismatch detected"),this.tryStartUpgrade_())},Cc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Cc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Yo(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Cc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Cc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Cc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Cc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Cc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Mo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Cc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Cc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Cc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Cc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Cc);function Cc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Io("c:"+this.id+":"),this.transportManager_=new Tc(e),this.log_("Connection created"),this.start_()}var Nc=(Ac.prototype.put=function(t,e,n,r){},Ac.prototype.merge=function(t,e,n,r){},Ac.prototype.refreshAuthToken=function(t){},Ac.prototype.onDisconnectPut=function(t,e,n){},Ac.prototype.onDisconnectMerge=function(t,e,n){},Ac.prototype.onDisconnectCancel=function(t,e){},Ac.prototype.reportStats=function(t){},Ac);function Ac(){}var kc,Dc=(si(Rc,kc=Nc),Rc.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(xi(i)),vi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Rc.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),vi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),vi(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Rc.prototype.sendListen_=function(t){var e=this,n=t.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};t.tag&&(o.q=n.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,function(o){var a=o.d,s=o.s;Rc.warnOnListenWarnings_(a,n),(e.listens.get(r)&&e.listens.get(r).get(i))===t&&(e.log_("listen response",o),"ok"!==s&&e.removeListen_(r,i),t.onComplete&&t.onComplete(s,a))})},Rc.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Fi(t,"w")){var n=Ui(t,"w");Array.isArray(n)&&~n.indexOf("no_index")&&Ao('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+e.getQueryParams().getIndex().toString()+'" at '+e.path.toString()+" to your security rules for better performance.")}},Rc.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Rc.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Li(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Rc.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=function(t){var n=Li(e).claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}()?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},Rc.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),vi(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Rc.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Rc.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Rc.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Rc.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Rc.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Rc.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Rc.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Rc.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Rc.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},Rc.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},Rc.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+xi(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Rc.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Co("Unrecognized action received from server: "+xi(t)+"\nAre you using the latest client?")},Rc.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Rc.prototype.scheduleConnect_=function(t){var e=this;vi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Rc.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Rc.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Rc.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Rc.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Rc.nextConnectionId_++,i=this,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,n())};this.realtime_={close:u,sendRequest:function(t){vi(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)}};var c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(c).then(function(u){a?So("getToken() completed but was canceled"):(So("getToken() completed. Creating connection."),i.authToken_=u&&u.accessToken,s=new Ic(r,i.repoInfo_,t,e,n,function(t){Ao(t+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")},o))}).then(null,function(t){i.log_("Failed to get token: "+t),a||u()})}},Rc.prototype.interrupt=function(t){So("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Rc.prototype.resume=function(t){So("Resuming connection for reason: "+t),delete this.interruptReasons_[t],qi(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Rc.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Rc.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Rc.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Ko(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Rc.prototype.removeListen_=function(t,e){var n,r=new $o(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Rc.prototype.onAuthRevoked_=function(t,e){So("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Rc.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Rc.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth();try{for(var i=li(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,li(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Rc.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+bc.replace(/\./g,"-")]=1,Ii()?t["framework.cordova"]=1:Ci()&&(t["framework.reactnative"]=1),this.reportStats(t)},Rc.prototype.shouldReconnect_=function(){var t=lc.getInstance().currentlyOnline();return qi(this.interruptReasons_)&&t},Rc.nextPersistentConnectionId_=0,Rc.nextConnectionId_=0,Rc);function Rc(t,e,n,r,i,o){var a=kc.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Rc.nextPersistentConnectionId_++,a.log_=Io("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ni())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),uc.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&lc.getInstance().on("online",a.onOnline_,a),a}var Oc,Pc=(si(Mc,Oc=Nc),Mc.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Mc.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(vi(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Mc.prototype.listen=function(t,e,n,r){var i=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=Mc.getListenId_(t,n),s={};this.listens_[a]=s;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,function(t,e){var u=e;404===t&&(t=u=null),null===t&&i.onDataUpdate_(o,u,!1,n),Ui(i.listens_,a)===s&&r(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Mc.prototype.unlisten=function(t,e){var n=Mc.getListenId_(t,e);delete this.listens_[n]},Mc.prototype.refreshAuthToken=function(t){},Mc.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}(e);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var t=null;if(200<=s.status&&s.status<300){try{t=Mi(s.responseText)}catch(t){Ao("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&Ao("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()})},Mc);function Mc(t,e,n){var r=Oc.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Io("p:rest:"),r.listens_={},r}var xc="repo_interrupt",Lc=(Fc.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Fc.prototype.name=function(){return this.repoInfo_.namespace},Fc.prototype.serverTime=function(){var t=this.infoData_.getNode(new $o(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Fc.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Fc.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new $o(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Vi(e,function(t){return Ss(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Ss(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Vi(e,function(t){return Ss(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Ss(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Fc.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Fc.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Fc.prototype.onServerInfoUpdate_=function(t){var e=this;Ho(t,function(t,n){e.updateInfo_(t,n)})},Fc.prototype.updateInfo_=function(t,e){var n=new $o("/.info/"+t),r=Ss(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Fc.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Fc.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=Ss(e,n),s=zs(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),function(e,n){var o="ok"===e;o||Ao("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Fc.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(Ho(e,function(t,e){i=!1;var n=Ss(e);a[t]=zs(n,o)}),i)So("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||Ao("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)}),Ho(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},Fc.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=function(t,e){var n=new Ws;return t.forEachTree(new $o(""),function(t,r){n.remember(t,zs(r,e))}),n}(this.onDisconnect_,e),r=[];n.forEachTree($o.Empty,function(e,n){r=r.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new Ws,this.eventQueue_.raiseEventsForChangedPath($o.Empty,r)},Fc.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},Fc.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Ss(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},Fc.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Ss(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},Fc.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(qi(e))return So("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&Ho(e,function(e,n){var i=Ss(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},Fc.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Fc.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Fc.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(xc)},Fc.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(xc)},Fc.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Ju(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Ho(e,function(t,e){for(var r=t,i=t.length;i<n+2;i++)r+=" ";console.log(r+e)})}},Fc.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Fc.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),So.apply(void 0,pi([n],t))},Fc.prototype.callOnCompleteCallback=function(t,e,n){t&&zo(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(Fc.prototype,"database",{get:function(){return this.__database||(this.__database=new nh(this))},enumerable:!0,configurable:!0}),Fc);function Fc(t,e,n){var i,o=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ec,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Ws,this.persistentConnection_=null,i=void 0!==r&&r.env[Fo]?new Ku(n):new ju(n),this.stats_=Yu.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Pc(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var a=n.options.databaseAuthVariableOverride;if(null!=a){if("object"!=typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{xi(a)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Dc(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){o.server_.refreshAuthToken(t)}),this.statsReporter_=Yu.getOrCreateReporter(t,function(){return new Zu(o.stats_,o.server_)}),this.transactions_init_(),this.infoData_=new Vu,this.infoSyncTree_=new Uu({startListening:function(t,e,n,r){var i=[],a=o.infoData_.getNode(t.path);return a.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Uu({startListening:function(t,e,n,r){return o.server_.listen(t,n,e,function(e,n){var i=r(e,n);o.eventQueue_.raiseEventsForChangedPath(t.path,i)}),[]},stopListening:function(t,e){o.server_.unlisten(t,e)}})}var Uc=(qc.prototype.getStartPost=function(){return this.startPost_},qc.prototype.getEndPost=function(){return this.endPost_},qc.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},qc.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Oa(e,n))||(n=gs.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},qc.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=gs.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(gs.EMPTY_NODE);var i=this;return e.forEachChild(Ja,function(t,e){i.matches(new Oa(t,e))||(r=r.updateImmediateChild(t,gs.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},qc.prototype.updatePriority=function(t,e){return t},qc.prototype.filtersNodes=function(){return!0},qc.prototype.getIndexedFilter=function(){return this.indexedFilter_},qc.prototype.getIndex=function(){return this.index_},qc.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},qc.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},qc);function qc(t){this.indexedFilter_=new du(t.getIndex()),this.index_=t.getIndex(),this.startPost_=qc.getStartPost_(t),this.endPost_=qc.getEndPost_(t)}var Vc=(Bc.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Oa(e,n))||(n=gs.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},Bc.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=gs.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=gs.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(gs.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,gs.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},Bc.prototype.updatePriority=function(t,e){return t},Bc.prototype.filtersNodes=function(){return!0},Bc.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},Bc.prototype.getIndex=function(){return this.index_},Bc.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;vi(s.numChildren()==this.limit_,"");var u=new Oa(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(fu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(fu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,gs.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(fu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(fu.childRemovedChange(c.name,c.node)),i.trackChildChange(fu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,gs.EMPTY_NODE)):t},Bc);function Bc(t){this.rangedFilter_=new Uc(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var jc=(Wc.prototype.hasStart=function(){return this.startSet_},Wc.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Wc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Wc.prototype.getIndexStartValue=function(){return vi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Wc.prototype.getIndexStartName=function(){return vi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:jo},Wc.prototype.hasEnd=function(){return this.endSet_},Wc.prototype.getIndexEndValue=function(){return vi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Wc.prototype.getIndexEndName=function(){return vi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wo},Wc.prototype.hasLimit=function(){return this.limitSet_},Wc.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Wc.prototype.getLimit=function(){return vi(this.limitSet_,"Only valid if limit has been set"),this.limit_},Wc.prototype.getIndex=function(){return this.index_},Wc.prototype.copy_=function(){var t=new Wc;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Wc.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Wc.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Wc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Wc.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Wc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Wc.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Wc.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Wc.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Wc.prototype.getQueryObject=function(){var t=Wc.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Ja&&(e[t.INDEX]=this.index_.toString()),e},Wc.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Wc.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ja},Wc.prototype.getNodeFilter=function(){return this.loadsAllData()?new du(this.getIndex()):this.hasLimit()?new Vc(this):new Uc(this)},Wc.prototype.toRestQueryStringParameters=function(){var t,e=Wc.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Ja?e.PRIORITY_INDEX:this.index_===Ns?e.VALUE_INDEX:this.index_===Ba?e.KEY_INDEX:(vi(this.index_ instanceof As,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=xi(t),this.startSet_&&(n[e.START_AT]=xi(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+xi(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=xi(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+xi(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Wc.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Wc.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Wc.DEFAULT=new Wc,Wc);function Wc(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ja}var Qc,Kc=(si(Hc,Qc=Bs),Hc.prototype.getKey=function(){return Yi("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Hc.prototype.child=function(t){return Yi("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof $o||(null===this.path.getFront()?function(t,e,n,r){ma("Reference.child",1,n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),!1)}(0,0,t):ma("Reference.child",1,t,!1)),new Hc(this.repo,this.path.child(t))},Hc.prototype.getParent=function(){Yi("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Hc(this.repo,t)},Hc.prototype.getRoot=function(){Yi("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Hc.prototype.databaseProp=function(){return this.repo.database},Hc.prototype.set=function(t,e){Yi("Reference.set",1,2,arguments.length),va("Reference.set",this.path),la("Reference.set",1,t,this.path,!1),Ji("Reference.set",2,e,!0);var n=new Ei;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Hc.prototype.update=function(t,e){if(Yi("Reference.update",1,2,arguments.length),va("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Ao("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fa("Reference.update",1,t,this.path,!1),Ji("Reference.update",2,e,!0);var i=new Ei;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Hc.prototype.setWithPriority=function(t,e,n){if(Yi("Reference.setWithPriority",2,3,arguments.length),va("Reference.setWithPriority",this.path),la("Reference.setWithPriority",1,t,this.path,!1),pa("Reference.setWithPriority",2,e,!1),Ji("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Ei;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Hc.prototype.remove=function(t){return Yi("Reference.remove",0,1,arguments.length),va("Reference.remove",this.path),Ji("Reference.remove",1,t,!0),this.set(null,t)},Hc.prototype.transaction=function(t,e,n){if(Yi("Reference.transaction",1,3,arguments.length),va("Reference.transaction",this.path),Ji("Reference.transaction",1,t,!1),Ji("Reference.transaction",2,e,!0),function(t,e,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(Xi("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new Ei;return"function"==typeof e&&r.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new Ca(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},Hc.prototype.setPriority=function(t,e){Yi("Reference.setPriority",1,2,arguments.length),va("Reference.setPriority",this.path),pa("Reference.setPriority",1,t,!1),Ji("Reference.setPriority",2,e,!0);var n=new Ei;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Hc.prototype.push=function(t,e){Yi("Reference.push",0,2,arguments.length),va("Reference.push",this.path),la("Reference.push",1,t,this.path,!0),Ji("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Ra(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Hc.prototype.onDisconnect=function(){return va("Reference.onDisconnect",this.path),new Sa(this.repo,this.path)},Object.defineProperty(Hc.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Hc.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Hc);function Hc(t,e){if(!(t instanceof Lc))throw new Error("new Reference() no longer supported - use app.database().");return Qc.call(this,t,e,jc.DEFAULT,!1)||this}Bs.__referenceConstructor=Kc,Du.__referenceConstructor=Kc;var Gc,zc,Yc=function(){this.children={},this.childCount=0,this.value=null},Xc=(Jc.prototype.subTree=function(t){for(var e,n=t instanceof $o?t:new $o(t),r=this;null!==(e=n.getFront());)r=new Jc(e,r,Ui(r.node_.children,e)||new Yc),n=n.popFront();return r},Jc.prototype.getValue=function(){return this.node_.value},Jc.prototype.setValue=function(t){vi(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Jc.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Jc.prototype.hasChildren=function(){return 0<this.node_.childCount},Jc.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Jc.prototype.forEachChild=function(t){var e=this;Ho(this.node_.children,function(n,r){t(new Jc(n,e,r))})},Jc.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},Jc.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Jc.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},Jc.prototype.path=function(){return new $o(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Jc.prototype.name=function(){return this.name_},Jc.prototype.parent=function(){return this.parent_},Jc.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Jc.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Fi(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Jc);function Jc(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Yc),this.name_=t,this.parent_=e,this.node_=n}(zc=Gc=Gc||{})[zc.RUN=0]="RUN",zc[zc.SENT=1]="SENT",zc[zc.COMPLETED=2]="COMPLETED",zc[zc.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",zc[zc.NEEDS_ABORT=4]="NEEDS_ABORT",Lc.MAX_TRANSACTION_RETRIES_=25,Lc.prototype.transactions_init_=function(){this.transactionQueueTree_=new Xc},Lc.prototype.startTransaction=function(t,e,n,r){function i(){}this.log_("transaction on "+t);var o=new Kc(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Uo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Ds(a.currentInputSnapshot,new Kc(this,a.path),Ja);a.onComplete(null,!1,c)}}else{Ta("transaction failed: Data returned ",u,a.path),a.status=Gc.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;"object"==typeof u&&null!==u&&Fi(u,".priority")?(f=Ui(u,".priority"),vi(ha(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||gs.EMPTY_NODE).getPriority().val(),f=f;var p=this.generateServerValues(),d=Ss(u,f),y=zs(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Lc.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||gs.EMPTY_NODE},Lc.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);vi(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Gc.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Lc.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];vi(u.status===Gc.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Gc.SENT,u.retryCount++;var c=$o.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=Gc.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new Kc(n,e[a].path),c=new Ds(s,u,Ja);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)zo(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===Gc.SENT_NEEDS_ABORT?e[a].status=Gc.NEEDS_ABORT:e[a].status=Gc.RUN;else for(Ao("transaction at "+l.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=Gc.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}},a)},Lc.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Lc.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Gc.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=$o.relativePath(e,s.path),c=!1,h=void 0;if(vi(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Gc.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Gc.RUN)if(s.retryCount>=Lc.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){Ta("transaction failed: Data returned ",f,s.path);var p=Ss(f);"object"==typeof f&&null!=f&&Fi(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=zs(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Gc.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new Kc(this,t[a].path),g=t[a].currentInputSnapshot,b=new Ds(g,v,Ja);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<r.length;a++)zo(r[a]);this.sendReadyTransactions_()}},Lc.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Lc.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Lc.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Lc.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Gc.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Lc.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Lc.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===Gc.SENT_NEEDS_ABORT||(e[o].status===Gc.SENT?(vi(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Gc.SENT_NEEDS_ABORT,e[o].abortReason="set"):(vi(e[o].status===Gc.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)zo(n[o])}};var $c,Zc="databaseURL",th=(eh.getInstance=function(){return $c=$c||new eh},eh.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},eh.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},eh.prototype.databaseFromApp=function(t,e){var n=e||t.options[Zc];void 0===n&&No("Can't determine Firebase Database URL.  Be sure to include "+Zc+" option when calling firebase.initializeApp().");var i=sa(n),o=i.repoInfo,a=void 0;return void 0!==r&&(a=r.env[Fo]),a&&(o=(i=sa(n="http://"+a+"?ns="+o.namespace)).repoInfo),ga("Invalid Firebase Database URL",1,i),i.path.isEmpty()||No("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t).database},eh.prototype.deleteRepo=function(t){var e=Ui(this.repos_,t.app.name);e&&Ui(e,t.repoInfo_.toURLString())===t||No("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},eh.prototype.createRepo=function(t,e){var n=Ui(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Ui(n,t.toURLString());return r&&No("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Lc(t,this.useRestClient_,e),n[t.toURLString()]=r},eh.prototype.forceRestClient=function(t){this.useRestClient_=t},eh);function eh(){this.repos_={},this.useRestClient_=!1}var nh=(Object.defineProperty(rh.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),rh.prototype.ref=function(t){return this.checkDeleted_("ref"),Yi("database.ref",0,1,arguments.length),t instanceof Kc?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},rh.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Yi(e,1,1,arguments.length);var n=sa(t);ga(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&No(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},rh.prototype.checkDeleted_=function(t){null===this.repo_&&No("Cannot call "+t+" on a deleted database.")},rh.prototype.goOffline=function(){Yi("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},rh.prototype.goOnline=function(){Yi("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},rh.ServerValue={TIMESTAMP:{".sv":"timestamp"}},rh);function rh(t){(this.repo_=t)instanceof Lc||No("Don't call new Database() directly - please use firebase.database()."),this.root_=new Kc(t,$o.Empty),this.INTERNAL=new ih(this)}var ih=(oh.prototype.delete=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return this.database.checkDeleted_("delete"),th.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},oh);function oh(t){this.database=t}var ah=Object.freeze({forceLongPolling:function(){_c.forceDisallow(),yc.forceAllow()},forceWebSockets:function(){yc.forceDisallow()},isWebSocketsAvailable:function(){return _c.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),sh=Dc;Dc.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Dc.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var uh,ch,hh=Ic,lh=oa,fh=Object.freeze({DataConnection:sh,RealTimeConnection:hh,hijackHash:function(t){var e=Dc.prototype.put;return Dc.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Dc.prototype.put=e}},ConnectionTarget:lh,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){th.getInstance().forceRestClient(t)}}),ph=nh.ServerValue;uh=(ch=mo).SDK_VERSION,bc=uh,ch.INTERNAL.registerService("database",function(t,e,n){return th.getInstance().databaseFromApp(t,n)},{Reference:Kc,Query:Bs,Database:nh,DataSnapshot:Ds,enableLogging:To,INTERNAL:ah,ServerValue:ph,TEST_ACCESS:fh},null,!0);var dh,yh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},mh=mh||{},vh=yh;function gh(t){return"string"==typeof t}function bh(t){return"number"==typeof t}function wh(t,e){t=t.split("."),e=e||vh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function _h(){}function Eh(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Th(t){return"array"==Eh(t)}function Sh(t){var e=Eh(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Ih(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ch="closure_uid_"+(1e9*Math.random()>>>0),Nh=0;function Ah(t,e,n){return t.call.apply(t.bind,arguments)}function kh(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Dh(t,e,n){return(Dh=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ah:kh).apply(null,arguments)}function Rh(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var Oh=Date.now||function(){return+new Date};function Ph(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,(t.prototype.constructor=t).yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Mh(){this.j=this.j,this.i=this.i}Mh.prototype.j=!1,Mh.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[Ch]||(this[Ch]=++Nh))},Mh.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var xh=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(gh(t))return gh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Lh=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=gh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Fh(){return Array.prototype.concat.apply([],arguments)}function Uh(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function qh(t){return/^[\s\xa0]*$/.test(t)}var Vh,Bh=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function jh(t,e){return-1!=t.indexOf(e)}function Wh(t,e){return t<e?-1:e<t?1:0}t:{var Qh=vh.navigator;if(Qh){var Kh=Qh.userAgent;if(Kh){Vh=Kh;break t}}Vh=""}function Hh(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Gh(t){var e,n={};for(e in t)n[e]=t[e];return n}var zh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yh(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<zh.length;i++)e=zh[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Xh(t){return Xh[" "](t),t}Xh[" "]=_h;var Jh,$h,Zh=jh(Vh,"Opera"),tl=jh(Vh,"Trident")||jh(Vh,"MSIE"),el=jh(Vh,"Edge"),nl=el||tl,rl=jh(Vh,"Gecko")&&!(jh(Vh.toLowerCase(),"webkit")&&!jh(Vh,"Edge"))&&!(jh(Vh,"Trident")||jh(Vh,"MSIE"))&&!jh(Vh,"Edge"),il=jh(Vh.toLowerCase(),"webkit")&&!jh(Vh,"Edge");function ol(){var t=vh.document;return t?t.documentMode:void 0}t:{var al="",sl=($h=Vh,rl?/rv:([^\);]+)(\)|;)/.exec($h):el?/Edge\/([\d\.]+)/.exec($h):tl?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec($h):il?/WebKit\/(\S+)/.exec($h):Zh?/(?:Version)[ \/]?(\S+)/.exec($h):void 0);if(sl&&(al=sl?sl[1]:""),tl){var ul=ol();if(null!=ul&&ul>parseFloat(al)){Jh=String(ul);break t}}Jh=al}var cl,hl={};function ll(t){return function(e,n){var r=hl;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=function(){for(var e=0,n=Bh(String(Jh)).split("."),r=Bh(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Wh(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Wh(0==a[2].length,0==s[2].length)||Wh(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}()}(t)}var fl=vh.document;cl=fl&&tl?ol()||("CSS1Compat"==fl.compatMode?parseInt(Jh,10):5):void 0;var pl=!tl||9<=Number(cl),dl=tl&&!ll("9"),yl=function(){if(!vh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{vh.addEventListener("test",_h,e),vh.removeEventListener("test",_h,e)}catch(t){}return t}();function ml(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function vl(t,e){if(ml.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rl){t:{try{Xh(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=gh(t.pointerType)?t.pointerType:gl[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}ml.prototype.b=function(){this.Ja=!1},Ph(vl,ml);var gl={2:"touch",3:"pen",4:"mouse"};vl.prototype.b=function(){vl.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,dl)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var bl="closure_listenable_"+(1e6*Math.random()|0),wl=0;function _l(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++wl,this.X=this.Z=!1}function El(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Tl(t){this.src=t,this.a={},this.b=0}function Sl(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=xh(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(El(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Il(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Tl.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Il(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new _l(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Cl="closure_lm_"+(1e6*Math.random()|0),Nl={};function Al(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Th(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Ll(r),e&&e[bl]?e.Ba(n,r,Ih(i)?!!i.capture:!!i,o):kl(e,n,r,!0,i,o)}(t,e,n,r,i);if(Th(e)){for(var o=0;o<e.length;o++)Al(t,e[o],n,r,i);return null}return n=Ll(n),t&&t[bl]?t.Aa(e,n,Ih(r)?!!r.capture:!!r,i):kl(t,e,n,!1,r,i)}function kl(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Ih(i)?!!i.capture:!!i;if(a&&!pl)return null;var s=Ml(t);if(s||(t[Cl]=s=new Tl(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Pl,e=pl?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)yl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rl(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Dl(t){if(!bh(t)&&t&&!t.X){var e=t.src;if(e&&e[bl])Sl(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rl(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ml(e))?(Sl(n,t),0==n.b&&(n.src=null,e[Cl]=null)):El(t)}}}function Rl(t){return t in Nl?Nl[t]:Nl[t]="on"+t}function Ol(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Dl(t),n.call(r,e)}function Pl(t,e){return!!t.X||Ol(t,pl?new vl(e,this):e=new vl(e||wh("window.event"),this))}function Ml(t){return(t=t[Cl])instanceof Tl?t:null}var xl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ll(t){return"function"==Eh(t)?t:(t[xl]||(t[xl]=function(e){return t.handleEvent(e)}),t[xl])}function Fl(){Mh.call(this),this.c=new Tl(this),(this.J=this).B=null}function Ul(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Sl(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Ph(Fl,Mh),Fl.prototype[bl]=!0,(dh=Fl.prototype).addEventListener=function(t,e,n,r){Al(this,t,e,n,r)},dh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Th(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Ih(i)?!!i.capture:!!i,r=Ll(r),e&&e[bl]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Il(a=e.a[n],r,i,o))&&(El(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Ml(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Il(n,r,i,o)),(r=-1<e?n[e]:null)&&Dl(r))}(this,t,e,n,r)},dh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(gh(t))t=new ml(t,n);else if(t instanceof ml)t.target=t.target||n;else{var i=t;Yh(t=new ml(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Ul(a,r,!0,t)&&i}if(i=Ul(a=t.a=n,r,!0,t)&&i,i=Ul(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ul(a=t.a=e[o],r,!1,t)&&i;return i},dh.G=function(){if(Fl.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)El(n[r]);delete e.a[t],e.b--}}this.B=null},dh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},dh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var ql=vh.JSON.stringify;function Vl(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Bl(){this.b=this.a=null}Vl.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var jl,Wl=new Vl(function(){return new Ql},function(t){t.reset()});function Ql(){this.next=this.b=this.a=null}function Kl(t){vh.setTimeout(function(){throw t},0)}function Hl(t,e){jl||function(){var t=vh.Promise.resolve(void 0);jl=function(){t.then(Yl)}}(),Gl||(jl(),Gl=!0),zl.add(t,e)}Bl.prototype.add=function(t,e){var n=Wl.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ql.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Gl=!(Ql.prototype.reset=function(){this.next=this.b=this.a=null}),zl=new Bl;function Yl(){for(var t;r=n=void 0,r=null,(n=zl).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Kl(t)}var e=Wl;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Gl=!1}function Xl(t,e){Fl.call(this),this.b=t||1,this.a=e||vh,this.f=Dh(this.gb,this),this.g=Oh()}function Jl(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function $l(t,e,n){if("function"==Eh(t))n&&(t=Dh(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Dh(t.handleEvent,t)}return 2147483647<Number(e)?-1:vh.setTimeout(t,e||0)}function Zl(t,e,n){Mh.call(this),this.f=null!=n?Dh(t,n):t,this.c=e,this.b=Dh(this.ab,this),this.a=[]}function tf(t){t.U=$l(t.b,t.c),t.f.apply(null,t.a)}function ef(t){Mh.call(this),this.b=t,this.a={}}Ph(Xl,Fl),(dh=Xl.prototype).ba=!1,dh.L=null,dh.gb=function(){if(this.ba){var t=Oh()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Jl(this),this.start()))}},dh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Oh())},dh.G=function(){Xl.N.G.call(this),Jl(this),delete this.a},Ph(Zl,Mh),(dh=Zl.prototype).ea=!1,dh.U=null,dh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:tf(this)},dh.G=function(){Zl.N.G.call(this),this.U&&(vh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},dh.ab=function(){this.U=null,this.ea&&(this.ea=!1,tf(this))},Ph(ef,Mh);var nf=[];function rf(t,e,n,r){Th(n)||(n&&(nf[0]=n.toString()),n=nf);for(var i=0;i<n.length;i++){var o=Al(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function of(t){Hh(t.a,function(t,e){this.a.hasOwnProperty(e)&&Dl(t)},t),t.a={}}function af(){}ef.prototype.G=function(){ef.N.G.call(this),of(this)},ef.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sf=new Fl;function uf(t){ml.call(this,"serverreachability",t)}function cf(t){sf.dispatchEvent(new uf(sf,t))}function hf(t){ml.call(this,"statevent",t)}function lf(t){sf.dispatchEvent(new hf(sf,t))}function ff(t){ml.call(this,"timingevent",t)}function pf(t,e){if("function"!=Eh(t))throw Error("Fn must not be null and must be a function");return vh.setTimeout(function(){t()},e)}Ph(uf,ml),Ph(hf,ml),Ph(ff,ml);var df={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},yf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function mf(){}function vf(t){var e;return(e=t.a)||(e=t.a={}),e}function gf(){}mf.prototype.a=null;var bf,wf={OPEN:"a",ib:"b",Na:"c",rb:"d"};function _f(){ml.call(this,"d")}function Ef(){ml.call(this,"c")}function Tf(){}function Sf(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new ef(this),this.O=If,t=nl?125:void 0,this.P=new Xl(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Ph(_f,ml),Ph(Ef,ml),Ph(Tf,mf),bf=new Tf;var If=45e3,Cf={},Nf={};function Af(t,e,n){t.F=1,t.f=Zf(Hf(e)),t.l=n,t.H=!0,Df(t,null)}function kf(t,e,n,r){t.F=1,t.f=Zf(Hf(e)),t.l=null,t.H=n,Df(t,r)}function Df(t,e){t.v=Oh(),Pf(t),t.D=Hf(t.f),$f(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Zl(Dh(t.Ka,t,t.a),t.J)),rf(t.I,t.a,"readystatechange",t.eb),e=t.h?Gh(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),cf(1)}function Rf(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Of(t,n);if(i==Nf){4==e&&(t.c=4,lf(14),r=!1);break}if(i==Cf){t.c=4,lf(15),r=!1;break}Uf(t,i)}4==e&&0==n.length&&(t.c=1,lf(16),r=!1),t.b=t.b&&r,r||(Ff(t),Lf(t))}function Of(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Nf:(n=Number(e.substring(n,r)),isNaN(n)?Cf:(r+=1)+n>e.length?Nf:(e=e.substr(r,n),t.A=r+n,e))}function Pf(t){t.R=Oh()+t.O,Mf(t,t.O)}function Mf(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=pf(Dh(t.bb,t),e)}function xf(t){t.i&&(vh.clearTimeout(t.i),t.i=null)}function Lf(t){t.g.Da()||t.m||t.g.na(t)}function Ff(t){xf(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Jl(t.P),of(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Uf(t,e){try{t.g.Ga(t,e),cf(4)}catch(t){}}function qf(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Sh(t)||gh(t))Lh(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Sh(t)||gh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(gh(t))return t.split("");if(Sh(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Vf(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Vf)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Bf(t,e){Wf(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&jf(t))}function jf(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Wf(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Wf(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Wf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(dh=Sf.prototype).setTimeout=function(t){this.O=t},dh.eb=function(t){t=t.target;var e=this.B;e&&3==Kp(t)?e.Ua():this.Ka(t)},dh.Ka=function(t){try{if(t==this.a)t:{var e=Kp(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!nl&&!this.a.aa())){this.m||4!=e||7==n||cf(8==n||r<=0?3:2),xf(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Hp(this.a,"X-HTTP-Initial-Response");if(a&&!qh(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,lf(12),Ff(this),Lf(this);break t}this.s=!0,Uf(this,s)}this.H?(Rf(this,e,o),nl&&this.b&&3==e&&(rf(this.I,this.P,"tick",this.cb),this.P.start())):Uf(this,o),4==e&&Ff(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Pf(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,lf(12)):(this.c=0,lf(13)),Ff(this),Lf(this)}}}catch(t){}},dh.cb=function(){if(this.a){var t=Kp(this.a),e=this.a.aa();this.A<e.length&&(xf(this),Rf(this,t,e),this.b&&4!=t&&Pf(this))}},dh.cancel=function(){this.m=!0,Ff(this)},dh.bb=function(){this.i=null;var t=Oh();0<=t-this.R?(2!=this.F&&(cf(3),lf(17)),Ff(this),this.c=2,Lf(this)):Mf(this,this.R-t)},(dh=Vf.prototype).C=function(){jf(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},dh.K=function(){return jf(this),this.a.concat()},dh.get=function(t,e){return Wf(this.b,t)?this.b[t]:e},dh.set=function(t,e){Wf(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},dh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qf=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Kf(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Kf?(this.h=void 0!==e?e:t.h,Gf(this,t.f),this.j=t.j,zf(this,t.b),Yf(this,t.i),this.a=t.a,Xf(this,pp(t.c)),this.g=t.g):t&&(n=String(t).match(Qf))?(this.h=!!e,Gf(this,n[1]||"",!0),this.j=tp(n[2]||""),zf(this,n[3]||"",!0),Yf(this,n[4]),this.a=tp(n[5]||"",!0),Xf(this,n[6]||"",!0),this.g=tp(n[7]||"")):(this.h=!!e,this.c=new up(null,this.h))}function Hf(t){return new Kf(t)}function Gf(t,e,n){t.f=n?tp(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function zf(t,e,n){t.b=n?tp(e,!0):e}function Yf(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Xf(t,e,n){e instanceof up?(t.c=e,function(t,e){e&&!t.f&&(cp(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(hp(this,e),fp(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=ep(e,ap)),t.c=new up(e,t.h))}function Jf(t,e,n){t.c.set(e,n)}function $f(t,e,n){Th(n)||(n=[String(n)]),fp(t.c,e,n)}function Zf(t){return Jf(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Oh()).toString(36)),t}function tp(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ep(t,e,n){return gh(t)?(t=encodeURI(t).replace(e,np),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function np(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Kf.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ep(e,rp,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(ep(e,rp,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(ep(n,"/"==n.charAt(0)?op:ip,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",ep(n,sp)),t.join("")},Kf.prototype.resolve=function(t){var e=Hf(this),n=!!t.f;n?Gf(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?zf(e,t.b):n=null!=t.i;var r=t.a;if(n)Yf(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(jh(i,"./")||jh(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Xf(e,pp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var rp=/[#\/\?@]/g,ip=/[#\?:]/g,op=/[#\?]/g,ap=/[#\?@]/g,sp=/#/g;function up(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function cp(t){t.a||(t.a=new Vf,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function hp(t,e){cp(t),e=dp(t,e),Wf(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Bf(t.a,e))}function lp(t,e){return cp(t),e=dp(t,e),Wf(t.a.b,e)}function fp(t,e,n){hp(t,e),0<n.length&&(t.c=null,t.a.set(dp(t,e),Uh(n)),t.b+=n.length)}function pp(t){var e=new up;return e.c=t.c,t.a&&(e.a=new Vf(t.a),e.b=t.b),e}function dp(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function yp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function mp(t){var e=t.a.F.a;if(null!=e)lf(4),e?(lf(10),id(t.a,t,!1)):(lf(11),id(t.a,t,!0));else{t.b=new Sf(t,void 0,void 0),t.b.h=t.h,e=cd(e=t.a,e.Y()?t.f:null,t.i),lf(4),$f(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Jf(e,n,r),kf(t.b,e,!1,t.f)}}function vp(){this.a=this.b=null}function gp(){this.a=new Vf}function bp(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Ch]||(t[Ch]=++Nh)):e.charAt(0)+t}function wp(t,e){this.b=t,this.a=e}function _p(t){this.g=t||Ep,t=vh.PerformanceNavigationTiming?0<(t=vh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(vh.ka&&vh.ka.Ea&&vh.ka.Ea()&&vh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new gp),this.b=null,this.c=[]}(dh=up.prototype).add=function(t,e){cp(this),this.c=null,t=dp(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},dh.forEach=function(t,e){cp(this),this.a.forEach(function(n,r){Lh(n,function(n){t.call(e,n,r,this)},this)},this)},dh.K=function(){cp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},dh.C=function(t){cp(this);var e=[];if(gh(t))lp(this,t)&&(e=Fh(e,this.a.get(dp(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Fh(e,t[n])}return e},dh.set=function(t,e){return cp(this),this.c=null,lp(this,t=dp(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},dh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},dh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Ph(function(){},function(){}),(dh=yp.prototype).M=null,dh.$=function(t){return this.a.$(t)},dh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},dh.Da=function(){return!1},dh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Hp(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Hp(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void sd(e,2)}this.f=r[0]}else(e=this.a).m=this.c,sd(e,2)}else 1==this.M&&(this.g?lf(6):"11111"==e?(lf(5),this.g=!0,(!tl||10<=Number(cl))&&(this.c=200,this.b.cancel(),lf(11),id(this.a,this,!0))):(lf(7),this.g=!1))},dh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,mp(this)):1==this.M&&(this.g?(lf(11),id(this.a,this,!0)):(lf(10),id(this.a,this,!1)));else{0==this.M?lf(8):1==this.M&&lf(9);var t=this.a;t.m=this.c,sd(t,2)}},dh.Y=function(){return this.a.Y()},dh.ma=function(){return this.a.ma()},gp.prototype.add=function(t){this.a.set(bp(t),t)},gp.prototype.C=function(){return this.a.C()};var Ep=10;function Tp(t,e){!t.a&&(jh(e,"spdy")||jh(e,"quic")||jh(e,"h2"))&&(t.f=t.g,t.a=new gp,t.b&&(Np(t,t.b),t.b=null))}function Sp(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Ip(t){return t.b?1:t.a?t.a.a.c:0}function Cp(t,e){return t.b?t.b==e:!!t.a&&(e=bp(e),Wf(t.a.a.b,e))}function Np(t,e){t.a?t.a.add(e):t.b=e}function Ap(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=bp(e),n=Wf(t.a.a.b,n)),n&&Bf(t.a.a,bp(e)))}function kp(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Uh(t.c);var e=t.c;return Lh(t.a.C(),function(t){e=e.concat(t.j)}),e}function Dp(){}function Rp(){this.a=new Dp}function Op(t,e,n){var r=n||"";try{qf(t,function(t,n){var i=t;Ih(t)&&(i=ql(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Pp(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}_p.prototype.cancel=function(){this.c=kp(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Lh(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Dp.prototype.stringify=function(t){return vh.JSON.stringify(t,void 0)},Dp.prototype.parse=function(t){return vh.JSON.parse(t,void 0)};var Mp=vh.JSON.parse;function xp(t){Fl.call(this),this.headers=new Vf,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Lp,this.D=this.F=!1}Ph(xp,Fl);var Lp="",Fp=/^https?$/i,Up=["POST","PUT"];function qp(t){return"content-type"==t.toLowerCase()}function Vp(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Bp(t),Wp(t)}function Bp(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function jp(t){if(t.b&&void 0!==mh&&(!t.s[1]||4!=Kp(t)||2!=t.T()))if(t.l&&4==Kp(t))$l(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Kp(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Qf)[1]||null;if(!o&&vh.self&&vh.self.location){var a=vh.self.location.protocol;o=a.substr(0,a.length-1)}i=!Fp.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Bp(t))}finally{Wp(t)}}}function Wp(t,e){if(t.a){Qp(t);var n=t.a,r=t.s[0]?_h:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Qp(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(vh.clearTimeout(t.m),t.m=null)}function Kp(t){return t.a?t.a.readyState:0}function Hp(t,e){return t.a?t.a.getResponseHeader(e):null}function Gp(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Hh(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),gh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Jf(t,e,n),t}function zp(t){this.f=[],this.F=new vp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!wh("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=wh("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=wh("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=wh("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=wh("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new _p(t&&t.concurrentRequestLimit),this.ja=new Rp,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Yp(t){if(Xp(t),3==t.u){var e=t.P++,n=Hf(t.B);Jf(n,"SID",t.H),Jf(n,"RID",e),Jf(n,"TYPE","terminate"),td(t,n),(e=new Sf(t,e,void 0)).F=2,e.f=Zf(Hf(n)),n=!1,vh.navigator&&vh.navigator.sendBeacon&&(n=vh.navigator.sendBeacon(e.f.toString(),"")),!n&&vh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Oh(),Pf(e)}ud(t)}function Xp(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(vh.clearTimeout(t.l),t.l=null),od(t),t.b.cancel(),t.h&&(bh(t.h)&&vh.clearTimeout(t.h),t.h=null)}function Jp(t,e){t.f.push(new wp(t.Ra++,e)),3==t.u&&$p(t)}function $p(t){Sp(t.b)||t.h||(t.h=!0,Hl(t.Ia,t),t.A=0)}function Zp(t,e){var n;n=e?e.W:t.P++;var r=Hf(t.B);Jf(r,"SID",t.H),Jf(r,"RID",n),Jf(r,"AID",t.O),td(t,r),t.g&&t.i&&Gp(r,t.g,t.i),n=new Sf(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=ed(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Np(t.b,n),Af(n,r,e)}function td(t,e){t.c&&qf({},function(t,n){Jf(e,n,t)})}function ed(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Dh(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Op(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function nd(t){t.a||t.l||(t.S=1,Hl(t.Ha,t),t.v=0)}function rd(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=pf(Dh(t.Ha,t),ad(t,t.v)),t.v++,0))}function id(t,e,n){var r=e.l;r&&Tp(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=cd(t,null,t.ha),$p(t)}function od(t){null!=t.s&&(vh.clearTimeout(t.s),t.s=null)}function ad(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function sd(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Dh(t.fb,t);n||(n=new Kf("//www.google.com/images/cleardot.gif"),vh.location&&"http"==vh.location.protocol||Gf(n,"https"),Zf(n)),function(t,e){var n=new af;if(vh.Image){var r=new Image;r.onload=Rh(Pp,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Rh(Pp,n,r,"TestLoadImage: error",!1,e),r.onabort=Rh(Pp,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Rh(Pp,n,r,"TestLoadImage: timeout",!1,e),vh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else lf(2);t.u=0,t.c&&t.c.ta(e),ud(t),Xp(t)}function ud(t){t.u=0,t.m=-1,t.c&&(0==kp(t.b).length&&0==t.f.length||(t.b.c.length=0,Uh(t.f),t.f.length=0),t.c.sa())}function cd(t,e,n){var r=function(t){return t instanceof Kf?Hf(t):new Kf(t,void 0)}(n);if(""!=r.b)e&&zf(r,e+"."+r.b),Yf(r,r.i);else{var i,o=vh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Kf(null,void 0);return t&&Gf(i,t),e&&zf(i,e),n&&Yf(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Hh(t.V,function(t,e){Jf(r,e,t)}),e=t.j,n=t.I,e&&n&&Jf(r,e,n),Jf(r,"VER",t.wa),td(t,r),r}function hd(){}function ld(){if(tl&&!(10<=Number(cl)))throw Error("Environmental error: no available transport.")}function fd(t,e){Fl.call(this),this.a=new zp(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!qh(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qh(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new yd(this)}function pd(t){_f.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function dd(){Ef.call(this),this.status=1}function yd(t){this.a=t}(dh=xp.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?vf(this.H):vf(bf),this.a.onreadystatechange=Dh(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Vp(this,t)}t=n||"";var i=new Vf(this.headers);r&&qf(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=qp,n=t.length,r=gh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:gh(t)?t.charAt(e):t[e]}(i.K()),n=vh.FormData&&t instanceof vh.FormData,0<=xh(Up,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Qp(this),0<this.o&&((this.D=function(t){return tl&&ll(9)&&bh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Dh(this.Ca,this)):this.m=$l(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vp(this,t)}},dh.Ca=function(){void 0!==mh&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},dh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Wp(this))},dh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Wp(this,!0)),xp.N.G.call(this)},dh.Fa=function(){this.j||(this.w||this.l||this.g?jp(this):this.$a())},dh.$a=function(){jp(this)},dh.T=function(){try{return 2<Kp(this)?this.a.status:-1}catch(t){return-1}},dh.za=function(){try{return 2<Kp(this)?this.a.statusText:""}catch(t){return""}},dh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},dh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Mp(e)}},dh.ya=function(){return this.h},dh.Ya=function(){return gh(this.f)?this.f:String(this.f)},(dh=zp.prototype).wa=8,dh.u=1,dh.Da=function(){return 0==this.u},dh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Sf(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?Yh(r=Gh(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&gh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=ed(this,n,e),Jf(i=Hf(this.B),"RID",t),Jf(i,"CVER",22),this.o&&this.j&&Jf(i,"X-HTTP-Session-Id",this.j),td(this,i),this.g&&r&&Gp(i,this.g,r),Np(this.b,n),this.W?(Jf(i,"$req",e),Jf(i,"SID","null"),n.S=!0,Af(n,i,null)):Af(n,i,e),this.u=2}}else 3==this.u&&(t?Zp(this,t):0==this.f.length||Sp(this.b)||Zp(this))},dh.Ha=function(){this.l=null,this.a=new Sf(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Hf(this.pa);Jf(t,"RID","rpc"),Jf(t,"SID",this.H),Jf(t,"CI",this.ia?"0":"1"),Jf(t,"AID",this.O),td(this,t),Jf(t,"TYPE","xmlhttp"),this.g&&this.i&&Gp(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),kf(this.a,t,!0,this.ga)},dh.Ga=function(t,e){if(0!=this.u&&(this.a==t||Cp(this.b,t)))if(this.m=t.o,!t.s&&Cp(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Th(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;od(this),this.a.cancel(),this.a=null}rd(this),lf(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=pf(Dh(this.Za,this),6e3));if(Ip(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else sd(this,11)}else if(!t.s&&this.a!=t||od(this),!qh(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&bh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Hp(r,"X-Client-Wire-Protocol"))&&Tp(this.b,i),this.j&&(r=Hp(r,"X-HTTP-Session-Id")))&&(this.I=r,Jf(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=cd(this,this.Y()?this.ga:null,this.ha),r.s?(Ap(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(xf(r),Pf(r)),this.a=r):nd(this),0<this.f.length&&$p(this)}else"stop"!=r[0]&&"close"!=r[0]||sd(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?sd(this,7):Yp(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},dh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,rd(this),lf(19))},dh.na=function(t){var e=null;if(this.a==t){od(this),this.a=null;var n=2}else{if(!Cp(this.b,t))return;e=t.j,Ap(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Oh()-t.v,sf.dispatchEvent(new ff(sf,t.l?t.l.length:0,e,this.A)),$p(this)):nd(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Ip(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=pf(Dh(t.Ia,t,e),ad(t,t.A)),t.A++,0)))}(this,t)||2==n&&rd(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:sd(this,5);break;case 4:sd(this,10);break;case 3:sd(this,6);break;default:sd(this,2)}}},dh.fb=function(t){lf(t?2:1)},dh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new xp(this.La)).F=this.R,t},dh.ma=function(){return!!this.c&&!0},dh.Y=function(){return this.R},(dh=hd.prototype).va=function(){},dh.ua=function(){},dh.ta=function(){},dh.sa=function(){},dh.Ta=function(){},ld.prototype.a=function(t,e){return new fd(t,e)},Ph(fd,Fl),(dh=fd.prototype).addEventListener=function(t,e,n,r){fd.N.addEventListener.call(this,t,e,n,r)},dh.removeEventListener=function(t,e,n,r){fd.N.removeEventListener.call(this,t,e,n,r)},dh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;lf(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new yp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Gp(e,t.g,t.i)),(t=t.w).i=n,e=cd(t.a,null,t.i),lf(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,mp(t)):($f(e,"MODE","init"),!t.a.o&&t.a.j&&$f(e,"X-HTTP-Session-Id",t.a.j),t.b=new Sf(t,void 0,void 0),t.b.h=t.h,kf(t.b,e,!1,null),t.M=0)},dh.close=function(){Yp(this.a)},dh.Xa=function(t){if(gh(t)){var e={};e.__data__=t,Jp(this.a,e)}else this.h?((e={}).__data__=ql(t),Jp(this.a,e)):Jp(this.a,t)},dh.G=function(){this.a.c=null,delete this.f,Yp(this.a),delete this.a,fd.N.G.call(this)},Ph(pd,_f),Ph(dd,Ef),Ph(yd,hd),yd.prototype.va=function(){this.a.dispatchEvent("a")},yd.prototype.ua=function(t){this.a.dispatchEvent(new pd(t))},yd.prototype.ta=function(t){this.a.dispatchEvent(new dd(t))},yd.prototype.sa=function(){this.a.dispatchEvent("b")};var md=Rh(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},ld);ld.prototype.createWebChannel=ld.prototype.a,fd.prototype.send=fd.prototype.Xa,fd.prototype.open=fd.prototype.Wa,fd.prototype.close=fd.prototype.close,df.NO_ERROR=0,df.TIMEOUT=8,df.HTTP_ERROR=6,yf.COMPLETE="complete",(gf.EventType=wf).OPEN="a",wf.CLOSE="b",wf.ERROR="c",wf.MESSAGE="d",Fl.prototype.listen=Fl.prototype.Aa,xp.prototype.listenOnce=xp.prototype.Ba,xp.prototype.getLastError=xp.prototype.Ya,xp.prototype.getLastErrorCode=xp.prototype.ya,xp.prototype.getStatus=xp.prototype.T,xp.prototype.getStatusText=xp.prototype.za,xp.prototype.getResponseJson=xp.prototype.Va,xp.prototype.getResponseText=xp.prototype.aa,xp.prototype.send=xp.prototype.ca;var vd,gd,bd={createWebChannelTransport:md,ErrorCode:df,EventType:yf,WebChannel:gf,XhrIo:xp},wd=bd.createWebChannelTransport,_d=bd.ErrorCode,Ed=bd.EventType,Td=bd.WebChannel,Sd=bd.XhrIo,Id=mo.SDK_VERSION,Cd=new ro("@firebase/firestore");function Nd(){return Cd.logLevel===Qi.DEBUG?vd.DEBUG:Cd.logLevel===Qi.SILENT?vd.SILENT:vd.ERROR}function Ad(t){switch(t){case vd.DEBUG:Cd.logLevel=Qi.DEBUG;break;case vd.ERROR:Cd.logLevel=Qi.ERROR;break;case vd.SILENT:Cd.logLevel=Qi.SILENT;break;default:Cd.error("Firestore ("+Id+"): Invalid value passed to `setLogLevel`")}}function kd(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Cd.logLevel<=Qi.DEBUG){var i=n.map(Rd);Cd.debug.apply(Cd,["Firestore ("+Id+") ["+t+"]: "+e].concat(i))}}function Dd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Cd.logLevel<=Qi.ERROR){var r=e.map(Rd);Cd.error.apply(Cd,["Firestore ("+Id+"): "+t].concat(r))}}function Rd(t){if("string"==typeof t)return t;var e=Md.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Od(t){var e="FIRESTORE ("+Id+") INTERNAL ASSERTION FAILED: "+t;throw Dd(e),new Error(e)}function Pd(t,e){t||Od(e)}(gd=vd=vd||{})[gd.DEBUG=0]="DEBUG",gd[gd.ERROR=1]="ERROR",gd[gd.SILENT=2]="SILENT";var Md=(xd.setPlatform=function(t){xd.platform&&Od("Platform already defined"),xd.platform=t},xd.getPlatform=function(){return xd.platform||Od("Platform not set"),xd.platform},xd);function xd(){}function Ld(){return Md.getPlatform().emptyByteString}var Fd,Ud={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},qd=(si(Vd,Fd=Error),Vd);function Vd(t,e){var n=Fd.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Bd(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new qd(Ud.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function jd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wd(t,e){return void 0!==t?t:e}function Qd(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Kd(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hd(t){for(var e in Pd(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Gd(t,e){if(0!==e.length)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+cy(e.length,"argument")+".")}function zd(t,e,n){if(e.length!==n)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires "+cy(n,"argument")+", but was called with "+cy(e.length,"argument")+".")}function Yd(t,e,n){if(e.length<n)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires at least "+cy(n,"argument")+", but was called with "+cy(e.length,"argument")+".")}function Xd(t,e,n,r){if(e.length<n||e.length>r)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+cy(e.length,"argument")+".")}function Jd(t,e,n,r){ny(t,e,uy(n)+" argument",r)}function $d(t,e,n,r){void 0!==r&&Jd(t,e,n,r)}function Zd(t,e,n,r){ny(t,e,n+" option",r)}function ty(t,e,n,r){void 0!==r&&Zd(t,e,n,r)}function ey(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(iy(u))}var c=iy(r);throw new qd(Ud.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ny(t,e,n,r){if(!("object"===e?ry(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=iy(r);throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ry(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function iy(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Od("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function oy(t,e,n){if(void 0===n)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+uy(e)+" argument, but it was undefined.")}function ay(t,e,n){Kd(e,function(e,r){if(n.indexOf(e)<0)throw new qd(Ud.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function sy(t,e,n,r){var i=iy(r);return new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires its "+uy(n)+" argument to be a "+e+", but it was: "+i)}function uy(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function cy(t,e){return t+" "+e+(1===t?"":"s")}var hy=(ly.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Pd(20===e.length,"Invalid auto ID: "+e),e},ly);function ly(){}function fy(t,e){return t<e?-1:e<t?1:0}function py(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function dy(t){return t+"\0"}function yy(){if("undefined"==typeof Uint8Array)throw new qd(Ud.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function my(){if(!Md.getPlatform().base64Available)throw new qd(Ud.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var vy=(gy.fromBase64String=function(t){zd("Blob.fromBase64String",arguments,1),Jd("Blob.fromBase64String","string",1,t),my();try{return new gy(Md.getPlatform().atob(t))}catch(t){throw new qd(Ud.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},gy.fromUint8Array=function(t){if(zd("Blob.fromUint8Array",arguments,1),yy(),!(t instanceof Uint8Array))throw sy("Blob.fromUint8Array","Uint8Array",1,t);return new gy(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},gy.prototype.toBase64=function(){return zd("Blob.toBase64",arguments,0),my(),Md.getPlatform().btoa(this._binaryString)},gy.prototype.toUint8Array=function(){zd("Blob.toUint8Array",arguments,0),yy();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},gy.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},gy.prototype.isEqual=function(t){return this._binaryString===t._binaryString},gy.prototype._compareTo=function(t){return fy(this._binaryString,t._binaryString)},gy);function gy(t){my(),this._binaryString=t}var by=Bd(vy,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),wy=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},_y="(default)",Ey=(Object.defineProperty(Ty.prototype,"isDefaultDatabase",{get:function(){return this.database===_y},enumerable:!0,configurable:!0}),Ty.prototype.isEqual=function(t){return t instanceof Ty&&t.projectId===this.projectId&&t.database===this.database},Ty.prototype.compareTo=function(t){return fy(this.projectId,t.projectId)||fy(this.database,t.database)},Ty);function Ty(t,e){this.projectId=t,this.database=e||_y}var Sy=(Iy.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Iy.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Iy.INVALID=-1,Iy);function Iy(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Cy="__name__",Ny=(Object.defineProperty(Ay.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Ay.prototype.isEqual=function(t){return 0===Ay.comparator(this,t)},Ay.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ay?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Ay.prototype.limit=function(){return this.offset+this.length},Ay.prototype.popFirst=function(t){return t=void 0===t?1:t,Pd(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Ay.prototype.popLast=function(){return Pd(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Ay.prototype.firstSegment=function(){return Pd(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Ay.prototype.lastSegment=function(){return this.get(this.length-1)},Ay.prototype.get=function(t){return Pd(t<this.length,"Index out of range"),this.segments[this.offset+t]},Ay.prototype.isEmpty=function(){return 0===this.length},Ay.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ay.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ay.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ay.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ay.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Ay);function Ay(t,e,n){void 0===e?e=0:e>t.length&&Od("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Od("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var ky,Dy=(si(Ry,ky=Ny),Ry.prototype.construct=function(t,e,n){return new Ry(t,e,n)},Ry.prototype.canonicalString=function(){return this.toArray().join("/")},Ry.prototype.toString=function(){return this.canonicalString()},Ry.fromString=function(t){if(0<=t.indexOf("//"))throw new qd(Ud.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Ry(t.split("/").filter(function(t){return 0<t.length}))},Ry.EMPTY_PATH=new Ry([]),Ry);function Ry(){return null!==ky&&ky.apply(this,arguments)||this}var Oy,Py=/^[_a-zA-Z][_a-zA-Z0-9]*$/,My=(si(xy,Oy=Ny),xy.prototype.construct=function(t,e,n){return new xy(t,e,n)},xy.isValidIdentifier=function(t){return Py.test(t)},xy.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),xy.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},xy.prototype.toString=function(){return this.canonicalString()},xy.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Cy},xy.keyField=function(){return new xy([Cy])},xy.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new qd(Ud.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new qd(Ud.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new qd(Ud.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new qd(Ud.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new xy(e)},xy.EMPTY_PATH=new xy([]),xy);function xy(){return null!==Oy&&Oy.apply(this,arguments)||this}var Ly=(Fy.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Fy.prototype.isEqual=function(t){return null!==t&&0===Dy.comparator(this.path,t.path)},Fy.prototype.toString=function(){return this.path.toString()},Fy.comparator=function(t,e){return Dy.comparator(t.path,e.path)},Fy.isDocumentKey=function(t){return t.length%2==0},Fy.fromSegments=function(t){return new Fy(new Dy(t.slice()))},Fy.fromPathString=function(t){return new Fy(Dy.fromString(t))},Fy.EMPTY=new Fy(new Dy([])),Fy);function Fy(t){this.path=t,Pd(Fy.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Uy,qy,Vy=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})};(qy=Uy=Uy||{}).All="all",qy.ListenStreamIdle="listen_stream_idle",qy.ListenStreamConnectionBackoff="listen_stream_connection_backoff",qy.WriteStreamIdle="write_stream_idle",qy.WriteStreamConnectionBackoff="write_stream_connection_backoff",qy.OnlineStateTimeout="online_state_timeout",qy.ClientMetadataRefresh="client_metadata_refresh",qy.LruGarbageCollection="lru_garbage_collection",qy.RetryTransaction="retry_transaction";var By=(jy.createAndSchedule=function(t,e,n,r,i){var o=new jy(t,e,Date.now()+n,r,i);return o.start(n),o},jy.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},jy.prototype.skipDelay=function(){return this.handleDelayElapsed()},jy.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qd(Ud.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},jy.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},jy.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},jy);function jy(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Vy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var Wy=(Object.defineProperty(Qy.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Qy.prototype.enqueueAndForget=function(t){this.enqueue(t)},Qy.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Qy.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Qy.prototype.enqueueAndInitiateShutdown=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},Qy.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Qy.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Dd("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n},Qy.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Pd(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=By.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Qy.prototype.verifyNotFailed=function(){this.failure&&Od("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Qy.prototype.verifyOperationInProgress=function(){Pd(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Qy.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Qy.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Qy.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Pd(t===Uy.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Uy.All&&i.timerId===t)break}return e.drain()})},Qy.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Qy.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Pd(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Qy);function Qy(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var Ky="",Hy="",Gy="",zy="";function Yy(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Jy(e)),e=Xy(t.get(n),e);return Jy(e)}function Xy(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Ky+Gy;break;case Ky:n+=Ky+zy;break;default:n+=o}}return n}function Jy(t){return t+Ky+Hy}function $y(t){var e=t.length;if(Pd(2<=e,"Invalid path "+t),2===e)return Pd(t.charAt(0)===Ky&&t.charAt(1)===Hy,"Non-empty path "+t+" had length 2"),Dy.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Ky,o);switch((a<0||n<a)&&Od('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Hy:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Gy:i+=t.substring(o,a),i+="\0";break;case zy:i+=t.substring(o,a+1);break;default:Od('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Dy(r)}var Zy=(tm.now=function(){return tm.fromMillis(Date.now())},tm.fromDate=function(t){return tm.fromMillis(t.getTime())},tm.fromMillis=function(t){var e=Math.floor(t/1e3);return new tm(e,1e6*(t-1e3*e))},tm.prototype.toDate=function(){return new Date(this.toMillis())},tm.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},tm.prototype._compareTo=function(t){return this.seconds===t.seconds?fy(this.nanoseconds,t.nanoseconds):fy(this.seconds,t.seconds)},tm.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},tm.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},tm);function tm(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new qd(Ud.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new qd(Ud.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qd(Ud.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new qd(Ud.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var em=(nm.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new nm(new Zy(e,t%1e6*1e3))},nm.fromTimestamp=function(t){return new nm(t)},nm.forDeletedDoc=function(){return nm.MIN},nm.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},nm.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},nm.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},nm.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},nm.prototype.toTimestamp=function(){return this.timestamp},nm.MIN=new nm(new Zy(0,0)),nm);function nm(t){this.timestamp=t}var rm=(im.prototype.insert=function(t,e){return new im(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,sm.BLACK,null,null))},im.prototype.remove=function(t){return new im(this.comparator,this.root.remove(t,this.comparator).copy(null,null,sm.BLACK,null,null))},im.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},im.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},im.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(im.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),im.prototype.minKey=function(){return this.root.minKey()},im.prototype.maxKey=function(){return this.root.maxKey()},im.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},im.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},im.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},im.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},im.prototype.getIterator=function(){return new om(this.root,null,this.comparator,!1)},im.prototype.getIteratorFrom=function(t){return new om(this.root,t,this.comparator,!1)},im.prototype.getReverseIterator=function(){return new om(this.root,null,this.comparator,!0)},im.prototype.getReverseIteratorFrom=function(t){return new om(this.root,t,this.comparator,!0)},im);function im(t,e){this.comparator=t,this.root=e||sm.EMPTY}var om=(am.prototype.getNext=function(){Pd(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},am.prototype.hasNext=function(){return 0<this.nodeStack.length},am.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},am);function am(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var sm=(um.prototype.copy=function(t,e,n,r,i){return new um(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},um.prototype.isEmpty=function(){return!1},um.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},um.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},um.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},um.prototype.minKey=function(){return this.min().key},um.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},um.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},um.prototype.removeMin=function(){if(this.left.isEmpty())return um.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},um.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return um.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},um.prototype.isRed=function(){return this.color},um.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},um.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},um.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},um.prototype.rotateLeft=function(){var t=this.copy(null,null,um.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},um.prototype.rotateRight=function(){var t=this.copy(null,null,um.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},um.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},um.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},um.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Od("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Od("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Od("Black depths differ");return t+(this.isRed()?0:1)},um.EMPTY=null,um.RED=!0,um.BLACK=!1,um);function um(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:um.RED,this.left=null!=r?r:um.EMPTY,this.right=null!=i?i:um.EMPTY,this.size=this.left.size+1+this.right.size}var cm=(Object.defineProperty(hm.prototype,"key",{get:function(){throw Od("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(hm.prototype,"value",{get:function(){throw Od("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(hm.prototype,"color",{get:function(){throw Od("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(hm.prototype,"left",{get:function(){throw Od("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(hm.prototype,"right",{get:function(){throw Od("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),hm.prototype.copy=function(t,e,n,r,i){return this},hm.prototype.insert=function(t,e,n){return new sm(t,e)},hm.prototype.remove=function(t,e){return this},hm.prototype.isEmpty=function(){return!0},hm.prototype.inorderTraversal=function(t){return!1},hm.prototype.reverseTraversal=function(t){return!1},hm.prototype.minKey=function(){return null},hm.prototype.maxKey=function(){return null},hm.prototype.isRed=function(){return!1},hm.prototype.checkMaxDepth=function(){return!0},hm.prototype.check=function(){return 0},hm);function hm(){this.size=0}sm.EMPTY=new cm;var lm=(fm.fromMapKeys=function(t){var e=new fm(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},fm.prototype.has=function(t){return null!==this.data.get(t)},fm.prototype.first=function(){return this.data.minKey()},fm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(fm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),fm.prototype.indexOf=function(t){return this.data.indexOf(t)},fm.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},fm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},fm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},fm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},fm.prototype.getIterator=function(){return new pm(this.data.getIterator())},fm.prototype.getIteratorFrom=function(t){return new pm(this.data.getIteratorFrom(t))},fm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},fm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},fm.prototype.isEmpty=function(){return this.data.isEmpty()},fm.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},fm.prototype.isEqual=function(t){if(!(t instanceof fm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},fm.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},fm.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},fm.prototype.copy=function(t){var e=new fm(this.comparator);return e.data=t,e},fm);function fm(t){this.comparator=t,this.data=new rm(this.comparator)}var pm=(dm.prototype.getNext=function(){return this.iter.getNext().key},dm.prototype.hasNext=function(){return this.iter.hasNext()},dm);function dm(t){this.iter=t}var ym=new rm(Ly.comparator);function mm(){return ym}function vm(){return mm()}var gm=new rm(Ly.comparator);function bm(){return gm}var wm=new rm(Ly.comparator);function _m(){return wm}var Em=new lm(Ly.comparator);function Tm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Em,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Sm=new lm(fy);function Im(){return Sm}var Cm=(Nm.prototype.applyToRemoteDocument=function(t,e,n){e&&Pd(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Pd(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Nm.prototype.applyToLocalView=function(t,e){e&&Pd(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Nm.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},Nm.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Tm())},Nm.prototype.isEqual=function(t){return this.batchId===t.batchId&&py(this.mutations,t.mutations)&&py(this.baseMutations,t.baseMutations)},Nm);function Nm(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Pd(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Am=(km.from=function(t,e,n,r){Pd(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=_m(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new km(t,e,n,r,i)},km);function km(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Dm=(Rm.prototype.catch=function(t){return this.next(void 0,t)},Rm.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Od("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Rm(function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}})},Rm.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},Rm.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Rm?e:Rm.resolve(e)}catch(t){return Rm.reject(t)}},Rm.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Rm.resolve(e)},Rm.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Rm.reject(e)},Rm.resolve=function(t){return new Rm(function(e,n){e(t)})},Rm.reject=function(t){return new Rm(function(e,n){n(t)})},Rm.waitFor=function(t){return new Rm(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Rm.or=function(t){for(var e=Rm.resolve(!1),n=function(t){e=e.next(function(e){return e?Rm.resolve(e):t()})},r=0,i=t;r<i.length;r++)n(i[r]);return e},Rm.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},Rm);function Rm(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Om,Pm,Mm=(xm.forUser=function(t,e,n,r){return Pd(""!==t.uid,"UserID must not be an empty string."),new xm(t.isAuthenticated()?t.uid:"",e,n,r)},xm.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qm(t).iterate({index:Kv.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},xm.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=Um(n),Bm(t).put(e)})},xm.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},xm.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Um(e),Bm(t).put(n)})},xm.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Vm(t),a=qm(t);return a.add({}).next(function(s){Pd("number"==typeof s,"Auto-generated key is not a number");var u=new Cm(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=Gv.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,Gv.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return Dm.waitFor(h).next(function(){return u})})},xm.prototype.lookupMutationBatch=function(t,e){var n=this;return qm(t).get(e).next(function(t){return t?(Pd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},xm.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Dm.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null})},xm.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return qm(t).iterate({index:Kv.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Pd(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},xm.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return qm(t).iterate({index:Kv.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},xm.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qm(t).loadAll(Kv.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},xm.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Gv.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Vm(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=$y(u);if(s===n.userId&&e.path.isEqual(h))return qm(t).get(c).next(function(t){if(!t)throw Od("Dangling document-mutation reference found: "+r+" which points to "+c);Pd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},xm.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new lm(fy),i=[];return e.forEach(function(e){var o=Gv.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=Vm(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=$y(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),Dm.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},xm.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Pd(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Pd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Gv.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new lm(fy);return Vm(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=$y(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},xm.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(qm(t).get(e).next(function(t){if(null===t)throw Od("Dangling document-mutation reference found, which points to "+e);Pd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Dm.waitFor(i).next(function(){return r})},xm.prototype.removeMutationBatch=function(t,e){var n=this;return Fm(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),Dm.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},xm.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},xm.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Dm.resolve();var r=IDBKeyRange.lowerBound(Gv.prefixForUser(e.userId)),i=[];return Vm(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=$y(t[1]);i.push(o)}else r.done()}).next(function(){Pd(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},xm.prototype.containsKey=function(t,e){return Lm(t,this.userId,e)},xm.prototype.getMutationQueueMetadata=function(t){var e=this;return Bm(t).get(this.userId).next(function(t){return t||new Wv(e.userId,-1,"")})},xm);function xm(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Lm(t,e,n){var r=Gv.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return Vm(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function Fm(t,e,n){var r=t.store(Kv.store),i=t.store(Gv.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Pd(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Gv.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Dm.waitFor(o).next(function(){return c})}function Um(t){return t instanceof Uint8Array?(Pd("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function qm(t){return Vg.getStore(t,Kv.store)}function Vm(t){return Vg.getStore(t,Gv.store)}function Bm(t){return Vg.getStore(t,Wv.store)}(Pm=Om=Om||{})[Pm.QueryCache=0]="QueryCache",Pm[Pm.SyncEngine=1]="SyncEngine";var jm=(Wm.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Wm.prototype.after=function(t){return this.seek(t+2),this.next()},Wm.prototype.seek=function(t){Pd((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Wm.forQueryCache=function(){return new Wm(Om.QueryCache,2)},Wm.forSyncEngine=function(){return new Wm(Om.SyncEngine)},Wm);function Wm(t,e){Pd((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Qm="SimpleDb",Km=(Hm.openOrCreate=function(t,e,n){return Pd(Hm.isAvailable(),"IndexedDB not supported in current environment."),kd(Qm,"Opening database:",t),new Dm(function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new Hm(e))},o.onblocked=function(){i(new qd(Ud.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new qd(Ud.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){kd(Qm,'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result,i=new Ym(o.transaction);n.createOrUpgrade(r,i,e.oldVersion,Fv).next(function(){kd(Qm,"Database upgrade to version "+Fv+" complete")})}}).toPromise()},Hm.delete=function(t){return kd(Qm,"Removing database:",t),Zm(window.indexedDB.deleteDatabase(t)).toPromise()},Hm.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===r.env.USE_MOCK_PERSISTENCE;var t=Si(),e=Hm.getIOSVersion(t),n=0<e&&e<10,i=Hm.getAndroidVersion(t),o=0<i&&i<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||o)},Hm.getStore=function(t,e){return t.store(e)},Hm.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Hm.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Hm.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},Hm.prototype.runTransaction=function(t,e,n){var r=Ym.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Dm.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Hm.prototype.close=function(){this.db.close()},Hm);function Hm(t){this.db=t,12.2===Hm.getIOSVersion(Si())&&Dd("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Gm=(Object.defineProperty(zm.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(zm.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(zm.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),zm.prototype.done=function(){this.shouldStop=!0},zm.prototype.skip=function(t){this.nextKey=t},zm.prototype.delete=function(){return Zm(this.dbCursor.delete())},zm);function zm(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Ym=(Xm.open=function(t,e,n){return new Xm(t.transaction(n,e))},Object.defineProperty(Xm.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Xm.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(kd(Qm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Xm.prototype.store=function(t){var e=this.transaction.objectStore(t);return Pd(!!e,"Object store not part of transaction: "+t),new Jm(e)},Xm);function Xm(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Vy,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=ev(t.target.error);e.completionDeferred.reject(n)}}var Jm=($m.prototype.put=function(t,e){return Zm(void 0!==e?(kd(Qm,"PUT",this.store.name,t,e),this.store.put(e,t)):(kd(Qm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},$m.prototype.add=function(t){return kd(Qm,"ADD",this.store.name,t,t),Zm(this.store.add(t))},$m.prototype.get=function(t){var e=this;return Zm(this.store.get(t)).next(function(n){return void 0===n&&(n=null),kd(Qm,"GET",e.store.name,t,n),n})},$m.prototype.delete=function(t){return kd(Qm,"DELETE",this.store.name,t),Zm(this.store.delete(t))},$m.prototype.count=function(){return kd(Qm,"COUNT",this.store.name),Zm(this.store.count())},$m.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},$m.prototype.deleteAll=function(t,e){kd(Qm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},$m.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},$m.prototype.iterateSerial=function(t){var e=this.cursor({});return new Dm(function(n,r){e.onerror=function(t){var e=ev(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},$m.prototype.iterateCursor=function(t,e){var n=[];return new Dm(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Gm(i),a=e(i.primaryKey,i.value,o);if(a instanceof Dm){var s=a.catch(function(t){return o.done(),Dm.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return Dm.waitFor(n)})},$m.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Pd(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},$m.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},$m);function $m(t){this.store=t}function Zm(t){return new Dm(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ev(t.target.error);n(e)}})}var tv=!1;function ev(t){var e=Km.getIOSVersion(Si());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new qd("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return tv||(tv=!0,setTimeout(function(){throw r},0)),r}}return t}var nv=(rv.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},rv.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return em.fromTimestamp(new Zy(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},rv.prototype.getHighestSequenceNumber=function(t){return av(t.simpleDbTransaction)},rv.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},rv.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},rv.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},rv.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return iv(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Pd(0<e.targetCount,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},rv.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return iv(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return Dm.waitFor(o)}).next(function(){return i})},rv.prototype.forEachTarget=function(t,e){var n=this;return iv(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},rv.prototype.retrieveMetadata=function(t){return ov(t.simpleDbTransaction)},rv.prototype.saveMetadata=function(t,e){return function(t){return Vg.getStore(t,og.store)}(t).put(og.key,e)},rv.prototype.saveQueryData=function(t,e){return iv(t).put(this.serializer.toDbTarget(e))},rv.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},rv.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},rv.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return iv(t).iterate({range:i,index:eg.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},rv.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=sv(t);return e.forEach(function(e){var a=Yy(e.path);i.push(o.put(new rg(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),Dm.waitFor(i)},rv.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=sv(t);return Dm.forEach(e,function(e){var o=Yy(e.path);return Dm.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},rv.prototype.removeMatchingKeysForTargetId=function(t,e){var n=sv(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},rv.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=sv(t),i=Tm();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=$y(t[1]),o=new Ly(r);i=i.add(o)}).next(function(){return i})},rv.prototype.containsKey=function(t,e){var n=Yy(e.path),r=IDBKeyRange.bound([n],[dy(n)],!1,!0),i=0;return sv(t).iterate({index:rg.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},rv.prototype.getQueryDataForTarget=function(t,e){var n=this;return iv(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},rv);function rv(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=jm.forQueryCache()}function iv(t){return Vg.getStore(t,eg.store)}function ov(t){return Km.getStore(t,og.store).get(og.key).next(function(t){return Pd(null!==t,"Missing metadata row."),t})}function av(t){return ov(t).next(function(t){return t.highestListenSequenceNumber})}function sv(t){return Vg.getStore(t,rg.store)}var uv=(cv.compareByKey=function(t,e){return Ly.comparator(t.key,e.key)},cv);function cv(t,e){this.key=t,this.version=e}var hv,lv=(si(fv,hv=uv),fv.prototype.field=function(t){return this.data.field(t)},fv.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},fv.prototype.value=function(){return this.data.value()},fv.prototype.isEqual=function(t){return t instanceof fv&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},fv.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(fv.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),fv.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Od("Trying to compare documents on fields that don't exist")},fv);function fv(t,e,n,r,i){var o=hv.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}var pv,dv=(si(yv,pv=uv),yv.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(yv.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),yv.prototype.isEqual=function(t){return t instanceof yv&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},yv);function yv(t,e,n){var r=pv.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var mv,vv=(si(gv,mv=uv),gv.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(gv.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),gv.prototype.isEqual=function(t){return t instanceof gv&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},gv);function gv(){return null!==mv&&mv.apply(this,arguments)||this}var bv=(wv.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},wv.prototype.has=function(t){return void 0!==this.get(t)},wv.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},wv.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},wv.prototype.forEach=function(t){Kd(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},wv.prototype.isEmpty=function(){return Hd(this.inner)},wv);function wv(t){this.mapKeyFn=t,this.inner={}}var _v=(Ev.prototype.addEntry=function(t){this.assertNotApplied(),this.changes.set(t.key,t)},Ev.prototype.removeEntry=function(t){this.assertNotApplied(),this.changes.set(t,null)},Ev.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Dm.resolve(n):this.getFromCache(t,e)},Ev.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Ev.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Ev.prototype.assertNotApplied=function(){Pd(!this.changesApplied,"Changes have already been applied.")},Ev);function Ev(){this.changes=new bv(function(t){return t.toString()}),this.changesApplied=!1}var Tv,Sv="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Iv=(Object.defineProperty(Cv.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),Cv.prototype.start=function(t){var e=Km.getStore(t,hg.store);return this.synchronizeLastDocumentChangeId(e)},Cv.prototype.addEntry=function(t,e,n){var r=this;return kv(t).put(Rv(e),n).next(function(){r.indexManager.addToCollectionParentIndex(t,e.path.popLast())})},Cv.prototype.removeEntry=function(t,e){var n=kv(t),r=Rv(e);return n.delete(r)},Cv.prototype.updateMetadata=function(t,e,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.setMetadata(t,i).next(function(){if(r.keepDocumentChangeLog)return Dv(t).put({changes:r.serializer.toDbResourcePaths(e)})})})},Cv.prototype.getEntry=function(t,e){var n=this;return kv(t).get(Rv(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},Cv.prototype.getSizedEntry=function(t,e){var n=this;return kv(t).get(Rv(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Ov(t)}:null})},Cv.prototype.getEntries=function(t,e){var n=this,r=vm();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},Cv.prototype.getSizedEntries=function(t,e){var n=this,r=vm(),i=new rm(Ly.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Ov(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},Cv.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Dm.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return kv(t).iterate({range:r},function(t,e,r){for(var a=Ly.fromSegments(t);o&&Ly.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},Cv.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;Pd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=bm(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return kv(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof lv&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},Cv.prototype.getNewDocumentChanges=function(t){var e=this;Pd(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Tm(),r=mm(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Dv(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return Dm.reject(new qd(Ud.DATA_LOSS,Sv))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new dv(n,em.forDeletedDoc());r=r.insert(n,e)}))}),Dm.waitFor(i)}).next(function(){return r})},Cv.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Dv(t).delete(n)},Cv.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},Cv.prototype.newChangeBuffer=function(){return new Cv.RemoteDocumentChangeBuffer(this)},Cv.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Cv.prototype.getMetadata=function(t){return Av(t).get(Zv.key).next(function(t){return Pd(!!t,"Missing document cache metadata"),t})},Cv.prototype.setMetadata=function(t,e){return Av(t).put(Zv.key,e)},Cv.RemoteDocumentChangeBuffer=(si(Nv,Tv=_v),Nv.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=Tm();return this.changes.forEach(function(o,a){var s=e.documentSizes.get(o);if(Pd(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){var u=e.documentCache.serializer.toDbRemoteDocument(a),c=Ov(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else r-=s,n.push(e.documentCache.removeEntry(t,o));i=i.add(o)}),n.push(this.documentCache.updateMetadata(t,i,r)),Dm.waitFor(n)},Nv.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},Nv.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},Nv),Cv);function Cv(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function Nv(t){var e=Tv.call(this)||this;return e.documentCache=t,e.documentSizes=new bv(function(t){return t.toString()}),e}function Av(t){return Vg.getStore(t,Zv.store)}function kv(t){return Vg.getStore(t,Jv.store)}function Dv(t){return Vg.getStore(t,hg.store)}function Rv(t){return t.path.toArray()}function Ov(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Od("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Pv=(Mv.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Dm.resolve()},Mv.prototype.getCollectionParents=function(t,e){return Dm.resolve(this.collectionParentIndex.getEntries(e))},Mv);function Mv(){this.collectionParentIndex=new xv}var xv=(Lv.prototype.add=function(t){Pd(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new lm(Dy.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},Lv.prototype.getEntries=function(t){return(this.index[t]||new lm(Dy.comparator)).toArray()},Lv);function Lv(){this.index={}}var Fv=8,Uv=(qv.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Pd(n<r&&0<=n&&r<=Fv,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(Bv.store)}(t),function(t){t.createObjectStore(Wv.store,{keyPath:Wv.keyPath}),t.createObjectStore(Kv.store,{keyPath:Kv.keyPath,autoIncrement:!0}).createIndex(Kv.userMutationsIndex,Kv.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Gv.store)}(t),cg(t),function(t){t.createObjectStore(Jv.store)}(t));var o=Dm.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(rg.store),t.deleteObjectStore(eg.store),t.deleteObjectStore(og.store)}(t),cg(t)),o=o.next(function(){return function(t){var e=t.store(og.store),n=new og(0,0,em.MIN.toTimestamp(),0);return e.put(og.key,n)}(e)})),n<4&&4<=r&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(Kv.store).loadAll().next(function(n){t.deleteObjectStore(Kv.store),t.createObjectStore(Kv.store,{keyPath:Kv.keyPath,autoIncrement:!0}).createIndex(Kv.userMutationsIndex,Kv.userMutationsKeyPath,{unique:!0});var r=e.store(Kv.store),i=n.map(function(t){return r.put(t)});return Dm.waitFor(i)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(fg.store,{keyPath:fg.keyPath})}(t),function(t){t.createObjectStore(hg.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&5<=r&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(o=o.next(function(){return function(t){t.createObjectStore(Zv.store)}(t),i.addDocumentGlobal(e)})),n<7&&7<=r&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&8<=r&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},qv.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Jv.store).iterate(function(t,n){e+=Ov(n)}).next(function(){var n=new Zv(e);return t.store(Zv.store).put(Zv.key,n)})},qv.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Wv.store),r=t.store(Kv.store);return n.loadAll().next(function(n){return Dm.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Kv.userMutationsIndex,i).next(function(r){return Dm.forEach(r,function(r){Pd(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Fm(t,n.userId,i).next(function(){})})})})})},qv.prototype.ensureSequenceNumbers=function(t){var e=t.store(rg.store),n=t.store(Jv.store);return av(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new Dy(n),a=[0,Yy(o)];r.push(e.get(a).next(function(n){return n?Dm.resolve():function(n){return e.put(new rg(0,Yy(n),t))}(o)}))}).next(function(){return Dm.waitFor(r)})})},qv.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Yy(n)})}}t.createObjectStore(sg.store,{keyPath:sg.keyPath});var r=e.store(sg.store),i=new xv;return e.store(Jv.store).iterate({keysOnly:!0},function(t,e){return n(new Dy(t).popLast())}).next(function(){return e.store(Gv.store).iterate({keysOnly:!0},function(t,e){t[0];var r=t[1];return n((t[2],$y(r)).popLast())})})},qv);function qv(t){this.serializer=t}var Vv=function(t,e){this.seconds=t,this.nanoseconds=e},Bv=(jv.store="owner",jv.key="owner",jv);function jv(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Wv=(Qv.store="mutationQueues",Qv.keyPath="userId",Qv);function Qv(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Kv=(Hv.store="mutations",Hv.keyPath="batchId",Hv.userMutationsIndex="userMutationsIndex",Hv.userMutationsKeyPath=["userId","batchId"],Hv);function Hv(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Gv=(zv.prefixForUser=function(t){return[t]},zv.prefixForPath=function(t,e){return[t,Yy(e)]},zv.key=function(t,e,n){return[t,Yy(e),n]},zv.store="documentMutations",zv.PLACEHOLDER=new zv,zv);function zv(){}var Yv=function(t,e){this.path=t,this.readTime=e},Xv=function(t,e){this.path=t,this.version=e},Jv=($v.store="remoteDocuments",$v);function $v(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var Zv=(tg.store="remoteDocumentGlobal",tg.key="remoteDocumentGlobalKey",tg);function tg(t){this.byteSize=t}var eg=(ng.store="targets",ng.keyPath="targetId",ng.queryTargetsIndexName="queryTargetsIndex",ng.queryTargetsKeyPath=["canonicalId","targetId"],ng);function ng(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var rg=(ig.store="targetDocuments",ig.keyPath=["targetId","path"],ig.documentTargetsIndex="documentTargetsIndex",ig.documentTargetsKeyPath=["path","targetId"],ig);function ig(t,e,n){this.targetId=t,this.path=e,Pd(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var og=(ag.key="targetGlobalKey",ag.store="targetGlobal",ag);function ag(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var sg=(ug.store="collectionParents",ug.keyPath=["collectionId","parent"],ug);function ug(t,e){this.collectionId=t,this.parent=e}function cg(t){t.createObjectStore(rg.store,{keyPath:rg.keyPath}).createIndex(rg.documentTargetsIndex,rg.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(eg.store,{keyPath:eg.keyPath}).createIndex(eg.queryTargetsIndexName,eg.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(og.store)}var hg=(lg.store="remoteDocumentChanges",lg.keyPath="id",lg);function lg(t){this.changes=t}var fg=(pg.store="clientMetadata",pg.keyPath="clientId",pg);function pg(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var dg,yg,mg=[Wv.store,Kv.store,Gv.store,Jv.store,eg.store,Bv.store,og.store,rg.store].concat([fg.store,hg.store]).concat([Zv.store]).concat([sg.store]),vg=(gg.prototype.addToCollectionParentIndex=function(t,e){if(Pd(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Pd(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return bg(t).put({collectionId:n,parent:Yy(r)})}return Dm.resolve()},gg.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[dy(e),""],!1,!0);return bg(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push($y(o.parent))}return n})},gg);function gg(){this.collectionParentsCache=new xv}function bg(t){return Vg.getStore(t,sg.store)}(yg=dg=dg||{})[yg.Listen=0]="Listen",yg[yg.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",yg[yg.LimboResolution=2]="LimboResolution";var wg=(_g.prototype.copy=function(t){return new _g(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},_g.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},_g);function _g(t,e,n,r,i,o){void 0===i&&(i=em.MIN),void 0===o&&(o=Ld()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var Eg=(Tg.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Ly.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new dv(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Ly.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new vv(e,n)):Od("Unexpected DbRemoteDocument")},Tg.prototype.toDbRemoteDocument=function(t){if(t instanceof lv){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Jv(null,null,e,n)}if(t instanceof dv){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Jv(null,new Yv(r,i),null,n)}return t instanceof vv?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Jv(new Xv(r,i),null,null,!0)):Od("Unexpected MaybeDocumment")},Tg.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Vv(e.seconds,e.nanoseconds)},Tg.prototype.fromDbTimestamp=function(t){var e=new Zy(t.seconds,t.nanoseconds);return em.fromTimestamp(e)},Tg.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Kv(t,e.batchId,e.localWriteTime.toMillis(),r,i)},Tg.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Zy.fromMillis(t.localWriteTimeMs);return new Cm(t.batchId,i,n,r)},Tg.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Yy(t.path))}),e},Tg.prototype.fromDbResourcePaths=function(t){for(var e=Tm(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Ly($y(i)))}return e},Tg.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new wg(e,t.targetId,dg.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},Tg.prototype.toDbTarget=function(t){Pd(dg.Listen===t.purpose,"Only queries with purpose "+dg.Listen+" may be stored, got "+t.purpose);var e,n,i=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Pd("YES"===r.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new eg(t.targetId,t.query.canonicalId(),i,n,t.sequenceNumber,e)},Tg);function Tg(t){this.remoteSerializer=t}function Sg(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=fy(n,i);return 0===a?fy(r,o):a}var Ig=(Cg.prototype.nextIndex=function(){return++this.previousIndex},Cg.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Sg(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Cg.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Cg);function Cg(t){this.maxElements=t,this.buffer=new lm(Sg),this.previousIndex=0}var Ng={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ag=(kg.withCacheSize=function(t){return new kg(t,kg.DEFAULT_COLLECTION_PERCENTILE,kg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},kg.COLLECTION_DISABLED=-1,kg.MINIMUM_CACHE_SIZE_BYTES=1048576,kg.DEFAULT=new kg(kg.DEFAULT_CACHE_SIZE_BYTES=41943040,kg.DEFAULT_COLLECTION_PERCENTILE=10,kg.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),kg.DISABLED=new kg(kg.COLLECTION_DISABLED,0,0),kg);function kg(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var Dg=(Rg.prototype.start=function(){Pd(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ag.COLLECTION_DISABLED&&this.scheduleGC()},Rg.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Rg.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Rg.prototype.scheduleGC=function(){var t=this;Pd(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;kd("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Uy.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(jg)})},Rg);function Rg(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var Og=(Pg.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},Pg.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Dm.resolve(Sy.INVALID);var r=new Ig(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},Pg.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},Pg.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},Pg.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Ag.COLLECTION_DISABLED?(kd("LruGarbageCollector","Garbage collection skipped; disabled"),Dm.resolve(Ng)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(kd("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ng):n.runGarbageCollection(t,e)})},Pg.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},Pg.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return r=e>c.params.maximumSequenceNumbersToCollect?(kd("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),c.params.maximumSequenceNumbersToCollect):e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Nd()<=vd.DEBUG&&kd("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms"),Dm.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},Pg);function Pg(t,e){this.delegate=t,this.params=e}var Mg,xg="IndexedDbPersistence",Lg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fg="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ug=(si(qg,Mg=function(){}),qg);function qg(t,e){var n=Mg.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var Vg=(Bg.getStore=function(t,e){if(t instanceof Ug)return Km.getStore(t.simpleDbTransaction,e);throw Od("IndexedDbPersistence must use instances of IndexedDbTransaction")},Bg.createIndexedDbPersistence=function(t,e,n,r,i,o){return ci(this,void 0,void 0,function(){var a;return hi(this,function(s){switch(s.label){case 0:return[4,(a=new Bg(t,e,n,r,i,o)).start()];case 1:return s.sent(),[2,a]}})})},Bg.createMultiClientIndexedDbPersistence=function(t,e,n,r,i,o,a){return ci(this,void 0,void 0,function(){var s;return hi(this,function(u){switch(u.label){case 0:return[4,(s=new Bg(t,e,n,r,i,o,a)).start()];case 1:return u.sent(),[2,s]}})})},Bg.prototype.start=function(){var t=this;return Pd(!this.started,"IndexedDbPersistence double-started!"),Pd(null!==this.window,"Expected 'window' to be defined"),Km.openOrCreate(this.dbName,Fv,new Uv(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[og.store],function(e){return av(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new Sy(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},Bg.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",mg,function(e){return t.remoteDocumentCache.start(e)})},Bg.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return ci(e,void 0,void 0,function(){return hi(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},Bg.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return ci(e,void 0,void 0,function(){return hi(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},Bg.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ci(e,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Bg.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",mg,function(e){return Qg(e).put(new fg(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},Bg.prototype.verifyPrimaryLease=function(t){var e=this;return Wg(t).get(Bv.key).next(function(t){return Dm.resolve(e.isLocalClient(t))})},Bg.prototype.removeClientMetadata=function(t){return Qg(t).delete(this.clientId)},Bg.prototype.maybeGarbageCollectMultiClientState=function(){return ci(this,void 0,void 0,function(){var t,e,n=this;return hi(this,function(r){switch(r.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),e=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(r){var i=Bg.getStore(r,fg.store);return i.loadAll().next(function(r){t=n.filterActiveClients(r,18e5),e=r.filter(function(e){return-1===t.indexOf(e)})}).next(function(){return Dm.forEach(e,function(t){return i.delete(t.clientId)})}).next(function(){if(0<(t=t.filter(function(t){return t.clientId!==n.clientId})).length){var e=t.map(function(t){return t.lastProcessedDocumentChangeId||0}),i=Math.min.apply(Math,e);return n.remoteDocumentCache.removeDocumentChangesThroughChangeId(r,i)}})})]);case 1:r.sent(),e.forEach(function(t){n.window.localStorage.removeItem(n.zombiedClientLocalStorageKey(t.clientId))}),r.label=2;case 2:return[2]}})})},Bg.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Uy.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Bg.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Bg.prototype.canActAsPrimary=function(t){var e=this;return Wg(t).get(Bv.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new qd(Ud.FAILED_PRECONDITION,Fg);return!1}}return!(!e.networkEnabled||!e.inForeground)||Qg(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&kd(xg,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Bg.prototype.shutdown=function(){return ci(this,void 0,void 0,function(){var t=this;return hi(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Bv.store,fg.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Bg.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Bg.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[fg.store],function(e){return Qg(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},Bg.clearPersistence=function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return Bg.isAvailable()?(e=t+Bg.MAIN_DATABASE,[4,Km.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})},Object.defineProperty(Bg.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Bg.prototype.getMutationQueue=function(t){return Pd(this.started,"Cannot initialize MutationQueue before persistence is started."),Mm.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Bg.prototype.getQueryCache=function(){return Pd(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},Bg.prototype.getRemoteDocumentCache=function(){return Pd(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Bg.prototype.getIndexManager=function(){return Pd(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Bg.prototype.runTransaction=function(t,e,n){var r=this;return kd(xg,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",mg,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Dd("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new qd(Ud.FAILED_PRECONDITION,Lg);return n(new Ug(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Ug(i,r.listenSequence.next()))})})},Bg.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Wg(t).get(Bv.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new qd(Ud.FAILED_PRECONDITION,Fg)})},Bg.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Bv(this.clientId,this.allowTabSynchronization,Date.now());return Wg(t).put(Bv.key,e)},Bg.isAvailable=function(){return Km.isAvailable()},Bg.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Bg.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Wg(t);return n.get(Bv.key).next(function(t){return e.isLocalClient(t)?(kd(xg,"Releasing primary lease."),n.delete(Bv.key)):Dm.resolve()})},Bg.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Dd("Detected an update time that is in the future: "+t+" > "+n),1))},Bg.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Bg.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Pd(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Bg.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Bg.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Pd("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Bg.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return kd(xg,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Dd(xg,"Failed to get zombied client id.",t),!1}},Bg.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Dd("Failed to set zombie client id.",t)}},Bg.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Bg.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Bg.MAIN_DATABASE="main",Bg);function Bg(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!Bg.isAvailable())throw new qd(Ud.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new Yg(this,o),this.dbName=t+Bg.MAIN_DATABASE,this.serializer=new Eg(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new nv(this.referenceDelegate,this.serializer),this.indexManager=new vg,this.remoteDocumentCache=new Iv(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new qd(Ud.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}function jg(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){if(!function(t){return t.code===Ud.FAILED_PRECONDITION&&t.message===Lg}(t))throw t;return kd(xg,"Unexpectedly lost primary lease"),[2]})})}function Wg(t){return t.store(Bv.store)}function Qg(t){return t.store(fg.store)}var Kg,Hg,Gg,zg,Yg=(Xg.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},Xg.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Xg.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Xg.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},Xg.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Xg.prototype.addReference=function(t,e){return Jg(t,e)},Xg.prototype.removeReference=function(t,e){return Jg(t,e)},Xg.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Xg.prototype.removeMutationReference=function(t,e){return Jg(t,e)},Xg.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Dm.resolve(!0):function(t,e){var n=!1;return Bm(t).iterateSerial(function(r){return Lm(t,r,e).next(function(t){return t&&(n=!0),Dm.resolve(!t)})}).next(function(){return n})}(t,e)},Xg.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return o++,r.getEntry(t,a).next(function(){return r.removeEntry(a),sv(t).delete([0,Yy(a.path)])})});i.push(u)}}).next(function(){return Dm.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},Xg.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},Xg.prototype.updateLimboDocument=function(t,e){return Jg(t,e)},Xg.prototype.forEachOrphanedDocument=function(t,e){var n,r=sv(t),i=Sy.INVALID;return r.iterate({index:rg.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==Sy.INVALID&&e(new Ly($y(n)),i),i=s,n=a):i=Sy.INVALID}).next(function(){i!==Sy.INVALID&&e(new Ly($y(n)),i)})},Xg.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Xg);function Xg(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Og(this,e)}function Jg(t,e){return sv(t).put(function(t,e){return new rg(0,Yy(t.path),e)}(e,t.currentSequenceNumber))}(Hg=Kg=Kg||{})[Hg.NullValue=0]="NullValue",Hg[Hg.BooleanValue=1]="BooleanValue",Hg[Hg.NumberValue=2]="NumberValue",Hg[Hg.TimestampValue=3]="TimestampValue",Hg[Hg.StringValue=4]="StringValue",Hg[Hg.BlobValue=5]="BlobValue",Hg[Hg.RefValue=6]="RefValue",Hg[Hg.GeoPointValue=7]="GeoPointValue",Hg[Hg.ArrayValue=8]="ArrayValue",Hg[Hg.ObjectValue=9]="ObjectValue",(zg=Gg=Gg||{})[zg.Default=0]="Default",zg[zg.Estimate=1]="Estimate",zg[zg.Previous=2]="Previous";var $g=(Zg.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Zg(Gg.Estimate,e);case"previous":return new Zg(Gg.Previous,e);case"none":case void 0:return new Zg(Gg.Default,e);default:return Od("fromSnapshotOptions() called with invalid options.")}},Zg);function Zg(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var tb=(eb.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},eb.prototype.defaultCompareTo=function(t){return Pd(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),fy(this.typeOrder,t.typeOrder)},eb);function eb(){}var nb,rb=(si(ib,nb=tb),ib.prototype.value=function(t){return null},ib.prototype.isEqual=function(t){return t instanceof ib},ib.prototype.compareTo=function(t){return t instanceof ib?0:this.defaultCompareTo(t)},ib.INSTANCE=new ib,ib);function ib(){var t=nb.call(this)||this;return t.typeOrder=Kg.NullValue,t.internalValue=null,t}var ob,ab=(si(sb,ob=tb),sb.prototype.value=function(t){return this.internalValue},sb.prototype.isEqual=function(t){return t instanceof sb&&this.internalValue===t.internalValue},sb.prototype.compareTo=function(t){return t instanceof sb?fy(this,t):this.defaultCompareTo(t)},sb.of=function(t){return t?sb.TRUE:sb.FALSE},sb.TRUE=new sb(!0),sb.FALSE=new sb(!1),sb);function sb(t){var e=ob.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.BooleanValue,e}var ub,cb=(si(hb,ub=tb),hb.prototype.value=function(t){return this.internalValue},hb.prototype.compareTo=function(t){return t instanceof hb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},hb);function hb(t){var e=ub.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.NumberValue,e}function lb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var fb,pb=(si(db,fb=cb),db.prototype.isEqual=function(t){return t instanceof db&&lb(this.internalValue,t.internalValue)},db);function db(){return null!==fb&&fb.apply(this,arguments)||this}var yb,mb=(si(vb,yb=cb),vb.prototype.isEqual=function(t){return t instanceof vb&&lb(this.internalValue,t.internalValue)},vb.NAN=new vb(NaN),vb.POSITIVE_INFINITY=new vb(1/0),vb.NEGATIVE_INFINITY=new vb(-1/0),vb);function vb(){return null!==yb&&yb.apply(this,arguments)||this}var gb,bb=(si(wb,gb=tb),wb.prototype.value=function(t){return this.internalValue},wb.prototype.isEqual=function(t){return t instanceof wb&&this.internalValue===t.internalValue},wb.prototype.compareTo=function(t){return t instanceof wb?fy(this.internalValue,t.internalValue):this.defaultCompareTo(t)},wb);function wb(t){var e=gb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.StringValue,e}var _b,Eb=(si(Tb,_b=tb),Tb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Tb.prototype.isEqual=function(t){return t instanceof Tb&&this.internalValue.isEqual(t.internalValue)},Tb.prototype.compareTo=function(t){return t instanceof Tb?this.internalValue._compareTo(t.internalValue):t instanceof Ib?-1:this.defaultCompareTo(t)},Tb);function Tb(t){var e=_b.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.TimestampValue,e}var Sb,Ib=(si(Cb,Sb=tb),Cb.prototype.value=function(t){return t&&t.serverTimestampBehavior===Gg.Estimate?new Eb(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Gg.Previous&&this.previousValue?this.previousValue.value(t):null},Cb.prototype.isEqual=function(t){return t instanceof Cb&&this.localWriteTime.isEqual(t.localWriteTime)},Cb.prototype.compareTo=function(t){return t instanceof Cb?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Eb?1:this.defaultCompareTo(t)},Cb.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Cb);function Cb(t,e){var n=Sb.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Kg.TimestampValue,n}var Nb,Ab=(si(kb,Nb=tb),kb.prototype.value=function(t){return this.internalValue},kb.prototype.isEqual=function(t){return t instanceof kb&&this.internalValue.isEqual(t.internalValue)},kb.prototype.compareTo=function(t){return t instanceof kb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},kb);function kb(t){var e=Nb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.BlobValue,e}var Db,Rb=(si(Ob,Db=tb),Ob.prototype.value=function(t){return this.key},Ob.prototype.isEqual=function(t){return t instanceof Ob&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Ob.prototype.compareTo=function(t){if(t instanceof Ob){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Ly.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Ob);function Ob(t,e){var n=Db.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Kg.RefValue,n}var Pb,Mb=(si(xb,Pb=tb),xb.prototype.value=function(t){return this.internalValue},xb.prototype.isEqual=function(t){return t instanceof xb&&this.internalValue.isEqual(t.internalValue)},xb.prototype.compareTo=function(t){return t instanceof xb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},xb);function xb(t){var e=Pb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.GeoPointValue,e}var Lb,Fb=(si(Ub,Lb=tb),Ub.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},Ub.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Ub.prototype.isEqual=function(t){if(t instanceof Ub){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Ub.prototype.compareTo=function(t){if(t instanceof Ub){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=fy(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return fy(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Ub.prototype.set=function(t,e){if(Pd(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Ub||(n=Ub.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Ub.prototype.delete=function(t){if(Pd(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ub(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Ub){var n=e.delete(t.popFirst());return new Ub(this.internalValue.insert(t.firstSegment(),n))}return this},Ub.prototype.contains=function(t){return null!==this.field(t)},Ub.prototype.field=function(t){Pd(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ub?e.internalValue.get(t):null}),e},Ub.prototype.fieldMask=function(){var t=new lm(My.comparator);return this.internalValue.forEach(function(e,n){var r=new My([e]);if(n instanceof Ub){var i=n.fieldMask().fields;i.isEmpty()?t=t.add(r):i.forEach(function(e){t=t.add(r.child(e))})}else t=t.add(r)}),jb.fromSet(t)},Ub.prototype.toString=function(){return this.internalValue.toString()},Ub.prototype.child=function(t){return this.internalValue.get(t)||void 0},Ub.prototype.setChild=function(t,e){return new Ub(this.internalValue.insert(t,e))},Ub.EMPTY=new Ub(new rm(fy)),Ub);function Ub(t){var e=Lb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.ObjectValue,e}var qb,Vb=(si(Bb,qb=tb),Bb.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},Bb.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Bb.prototype.forEach=function(t){this.internalValue.forEach(t)},Bb.prototype.isEqual=function(t){if(t instanceof Bb){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Bb.prototype.compareTo=function(t){if(t instanceof Bb){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return fy(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Bb.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Bb);function Bb(t){var e=qb.call(this)||this;return e.internalValue=t,e.typeOrder=Kg.ArrayValue,e}var jb=(Wb.fromSet=function(t){return new Wb(t)},Wb.fromArray=function(t){var e=new lm(My.comparator);return t.forEach(function(t){return e=e.add(t)}),new Wb(e)},Wb.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},Wb.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Wb);function Wb(t){this.fields=t}var Qb=(Kb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Kb);function Kb(t,e){this.field=t,this.transform=e}var Hb,Gb,zb=function(t,e){this.version=t,this.transformResults=e};(Gb=Hb=Hb||{})[Gb.Set=0]="Set",Gb[Gb.Patch=1]="Patch",Gb[Gb.Transform=2]="Transform",Gb[Gb.Delete=3]="Delete";var Yb=(Xb.exists=function(t){return new Xb(void 0,t)},Xb.updateTime=function(t){return new Xb(t)},Object.defineProperty(Xb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Xb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof lv&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof lv:(Pd(this.isNone,"Precondition should be empty"),!0)},Xb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Xb.NONE=new Xb,Xb);function Xb(t,e){this.updateTime=t,this.exists=e,Pd(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Jb=($b.prototype.verifyKeyMatches=function(t){null!=t&&Pd(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},$b.getPostMutationVersion=function(t){return t instanceof lv?t.version:em.MIN},$b);function $b(){}var Zb,tw=(si(ew,Zb=Jb),ew.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Pd(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new lv(this.key,n,this.value,{hasCommittedMutations:!0})},ew.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Jb.getPostMutationVersion(t);return new lv(this.key,r,this.value,{hasLocalMutations:!0})},ew.prototype.extractBaseValue=function(t){return null},ew.prototype.isEqual=function(t){return t instanceof ew&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},ew);function ew(t,e,n){var r=Zb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Hb.Set,r}var nw,rw=(si(iw,nw=Jb),iw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Pd(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new vv(this.key,e.version);var n=this.patchDocument(t);return new lv(this.key,e.version,n,{hasCommittedMutations:!0})},iw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Jb.getPostMutationVersion(t),i=this.patchDocument(t);return new lv(this.key,r,i,{hasLocalMutations:!0})},iw.prototype.extractBaseValue=function(t){return null},iw.prototype.isEqual=function(t){return t instanceof iw&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},iw.prototype.patchDocument=function(t){var e;return e=t instanceof lv?t.data:Fb.EMPTY,this.patchObject(e)},iw.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},iw);function iw(t,e,n,r){var i=nw.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Hb.Patch,i}var ow,aw=(si(sw,ow=Jb),sw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Pd(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new vv(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new lv(this.key,i,o,{hasCommittedMutations:!0})},sw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new lv(this.key,r.version,o,{hasLocalMutations:!0})},sw.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof lv?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Fb.EMPTY.set(i.field,a):e.set(i.field,a))}return e},sw.prototype.isEqual=function(t){return t instanceof sw&&this.key.isEqual(t.key)&&py(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},sw.prototype.requireDocument=function(t){Pd(t instanceof lv,"Unknown MaybeDocument type "+t);var e=t;return Pd(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},sw.prototype.serverTransformResults=function(t,e){var n=[];Pd(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof lv&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},sw.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof lv&&(u=e.field(a.field)),null===u&&n instanceof lv&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},sw.prototype.transformObject=function(t,e){Pd(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},sw);function sw(t,e){var n=ow.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Hb.Transform,n.precondition=Yb.exists(!0),n}var uw,cw=(si(hw,uw=Jb),hw.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Pd(null==e.transformResults,"Transform results received by DeleteMutation."),new dv(this.key,e.version,{hasCommittedMutations:!0})},hw.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Pd(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new dv(this.key,em.forDeletedDoc())):t},hw.prototype.extractBaseValue=function(t){return null},hw.prototype.isEqual=function(t){return t instanceof hw&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},hw);function hw(t,e){var n=uw.call(this)||this;return n.key=t,n.precondition=e,n.type=Hb.Delete,n}var lw=(fw.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},fw.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t})},fw.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=vm();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)}),r},fw.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},fw.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=mm();return i.forEach(function(t,e){e=e||new dv(t,em.forDeletedDoc()),o=o.insert(t,e)}),o})},fw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},fw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Ly(e)).next(function(t){var e=bm();return t instanceof lv&&(e=e.insert(t.key,t)),e})},fw.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;Pd(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=bm();return this.indexManager.getCollectionParents(t,r).next(function(o){return Dm.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},fw.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next(function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof lv?n.insert(c,l):n.remove(c)}})}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},fw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Tm(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof rw&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof lv&&(c=c.insert(t,e))}),c})},fw);function fw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var pw=(dw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},dw.prototype.addReference=function(t,e){var n=new yw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},dw.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},dw.prototype.removeReference=function(t,e){this.removeRef(new yw(t,e))},dw.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},dw.prototype.removeReferencesForId=function(t){var e=this,n=Ly.EMPTY,r=new yw(n,t),i=new yw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},dw.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},dw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},dw.prototype.referencesForId=function(t){var e=Ly.EMPTY,n=new yw(e,t),r=new yw(e,t+1),i=Tm();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},dw.prototype.containsKey=function(t){var e=new yw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},dw);function dw(){this.refsByKey=new lm(yw.compareByKey),this.refsByTarget=new lm(yw.compareByTargetId)}var yw=(mw.compareByKey=function(t,e){return Ly.comparator(t.key,e.key)||fy(t.targetOrBatchId,e.targetOrBatchId)},mw.compareByTargetId=function(t,e){return fy(t.targetOrBatchId,e.targetOrBatchId)||Ly.comparator(t.key,e.key)},mw);function mw(t,e){this.key=t,this.targetOrBatchId=e}var vw=(gw.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new lw(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=Tm(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++)f=m[y],a=a.add(f.key)}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},gw.prototype.localWrite=function(t){var e=this,n=Zy.now(),r=t.reduce(function(t,e){return t.add(e.key)},Tm());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new rw(u.key,c,c.fieldMask(),Yb.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},gw.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):Dm.resolve(null)})})},gw.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},gw.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Pd(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},gw.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})},gw.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},gw.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},gw.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},gw.prototype.applyRemoteEvent=function(t){var e=this,n=this.remoteDocuments.newChangeBuffer(),r=t.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[];Qd(t.targetChanges,function(t,n){var a=e.queryDataByTarget[t];if(a){o.push(e.queryCache.removeMatchingKeys(i,n.removedDocuments,t).next(function(){return e.queryCache.addMatchingKeys(i,n.addedDocuments,t)}));var s=n.resumeToken;if(0<s.length){var u=a.copy({resumeToken:s,snapshotVersion:r});e.queryDataByTarget[t]=u,gw.shouldPersistQueryData(a,u,n)&&o.push(e.queryCache.updateQueryData(i,u))}}});var a=mm(),s=Tm();if(t.documentUpdates.forEach(function(t,e){s=s.add(t)}),o.push(n.getEntries(i,s).next(function(r){t.documentUpdates.forEach(function(s,u){var c=r.get(s);null==c||0<u.version.compareTo(c.version)||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(n.addEntry(u),a=a.insert(s,u)):u instanceof dv&&u.version.isEqual(em.MIN)?(n.removeEntry(s),a=a.insert(s,u)):kd("LocalStore","Ignoring outdated watch update for ",s,". Current version:",c.version," Watch version:",u.version),t.resolvedLimboDocuments.has(s)&&o.push(e.persistence.referenceDelegate.updateLimboDocument(i,s))})})),!r.isEqual(em.MIN)){var u=e.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return Pd(0<=r.compareTo(t),"Watch stream reverted to previous snapshot?? "+r+" < "+t),e.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,r)});o.push(u)}return Dm.waitFor(o).next(function(){return n.apply(i)}).next(function(){return e.localDocuments.getLocalViewOfDocuments(i,a)})})},gw.shouldPersistQueryData=function(t,e,n){return Pd(0<e.resumeToken.length,"Attempted to persist query data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},gw.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Dm.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),Dm.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},gw.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},gw.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},gw.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,Dm.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new wg(t,i,dg.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return Pd(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r})})},gw.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){Pd(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?Dm.resolve():Dm.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},gw.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},gw.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},gw.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},gw.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},gw.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},gw.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Dm.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);Pd(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):Pd(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},gw.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},gw.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},gw.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},gw.RESUME_TOKEN_MAX_AGE_MICROS=3e8,gw);function gw(t,e){this.persistence=t,this.localViewReferences=new pw,this.queryDataByTarget={},Pd(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new lw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var bw=(ww.prototype.checkEmpty=function(t){return Dm.resolve(0===this.mutationQueue.length)},ww.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Pd(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Pd(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Dm.resolve()},ww.prototype.getLastStreamToken=function(t){return Dm.resolve(this.lastStreamToken)},ww.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Dm.resolve()},ww.prototype.addMutationBatch=function(t,e,n,r){Pd(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Pd(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Cm(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new yw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Dm.resolve(o)},ww.prototype.lookupMutationBatch=function(t,e){return Dm.resolve(this.findMutationBatch(e))},ww.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Pd(null!=n,"Failed to find local mutation batch."),Dm.resolve(n.keys())},ww.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Dm.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},ww.prototype.getHighestUnacknowledgedBatchId=function(){return Dm.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},ww.prototype.getAllMutationBatches=function(t){return Dm.resolve(this.mutationQueue.slice())},ww.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new yw(e,0),i=new yw(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Pd(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Pd(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),Dm.resolve(o)},ww.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new lm(fy);return e.forEach(function(t){var e=new yw(t,0),i=new yw(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Pd(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),Dm.resolve(this.findMutationBatches(r))},ww.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Pd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Ly.isDocumentKey(i)||(i=i.child(""));var o=new yw(new Ly(i),0),a=new lm(fy);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Dm.resolve(this.findMutationBatches(a))},ww.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},ww.prototype.removeMutationBatch=function(t,e){var n=this;Pd(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Dm.forEach(e.mutations,function(i){var o=new yw(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},ww.prototype.removeCachedMutationKeys=function(t){},ww.prototype.containsKey=function(t,e){var n=new yw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Dm.resolve(e.isEqual(r&&r.key))},ww.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Pd(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Dm.resolve()},ww.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Pd(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},ww.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},ww.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Pd(n.batchId===t,"If found batch must match"),n},ww);function ww(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ld(),this.batchesByDocumentKey=new lm(yw.compareByKey)}var _w=(Ew.prototype.getTargetCount=function(t){return Dm.resolve(this.targetCount)},Ew.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),Dm.resolve()},Ew.prototype.getLastRemoteSnapshotVersion=function(t){return Dm.resolve(this.lastRemoteSnapshotVersion)},Ew.prototype.getHighestSequenceNumber=function(t){return Dm.resolve(this.highestSequenceNumber)},Ew.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Dm.resolve(e)},Ew.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Dm.resolve()},Ew.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},Ew.prototype.addQueryData=function(t,e){return Pd(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Dm.resolve()},Ew.prototype.updateQueryData=function(t,e){return Pd(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Dm.resolve()},Ew.prototype.removeQueryData=function(t,e){return Pd(0<this.targetCount,"Removing a target from an empty cache"),Pd(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Dm.resolve()},Ew.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),Dm.waitFor(o).next(function(){return i})},Ew.prototype.getQueryCount=function(t){return Dm.resolve(this.targetCount)},Ew.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Dm.resolve(n)},Ew.prototype.getQueryDataForTarget=function(t,e){return Od("Not yet implemented.")},Ew.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),Dm.waitFor(i)},Ew.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),Dm.waitFor(i)},Ew.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Dm.resolve()},Ew.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Dm.resolve(n)},Ew.prototype.containsKey=function(t,e){return Dm.resolve(this.references.containsKey(e))},Ew);function Ew(t){this.persistence=t,this.queries=new bv(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=em.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new pw,this.targetCount=0,this.targetIdGenerator=jm.forQueryCache()}var Tw,Sw=(Iw.prototype.addEntry=function(t,e){var n=e.key,r=this.docs.get(n),i=r?r.size:0,o=this.sizer(e);return this.docs=this.docs.insert(n,{maybeDocument:e,size:o}),this.newDocumentChanges=this.newDocumentChanges.add(n),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())},Iw.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Iw.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Dm.resolve(n?n.maybeDocument:null)},Iw.prototype.getEntries=function(t,e){var n=this,r=vm();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Dm.resolve(r)},Iw.prototype.getDocumentsMatchingQuery=function(t,e){Pd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=bm(),r=new Ly(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof lv&&e.matches(s)&&(n=n.insert(s.key,s))}return Dm.resolve(n)},Iw.prototype.forEachDocumentKey=function(t,e){return Dm.forEach(this.docs,function(t){return e(t)})},Iw.prototype.getNewDocumentChanges=function(t){var e=this,n=mm();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new dv(t,em.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=Tm(),Dm.resolve(n)},Iw.prototype.newChangeBuffer=function(){return new Iw.RemoteDocumentChangeBuffer(this)},Iw.prototype.getSize=function(t){return Dm.resolve(this.size)},Iw.RemoteDocumentChangeBuffer=(si(Cw,Tw=_v),Cw.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i?n.push(e.documentCache.addEntry(t,i)):e.documentCache.removeEntry(r)}),Dm.waitFor(n)},Cw.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},Cw.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},Cw),Iw);function Iw(t,e){this.indexManager=t,this.sizer=e,this.docs=new rm(Ly.comparator),this.newDocumentChanges=Tm(),this.size=0}function Cw(t){var e=Tw.call(this)||this;return e.documentCache=t,e}var Nw=(Aw.createLruPersistence=function(t,e,n){return new Aw(t,function(t){return new Ow(t,new Eg(e),n)})},Aw.createEagerPersistence=function(t){return new Aw(t,function(t){return new Dw(t)})},Aw.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Aw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Aw.prototype.getActiveClients=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return[2,[this.clientId]]})})},Aw.prototype.setPrimaryStateListener=function(t){return t(!0)},Aw.prototype.setDatabaseDeletedListener=function(){},Aw.prototype.setNetworkEnabled=function(t){},Aw.prototype.getIndexManager=function(){return this.indexManager},Aw.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new bw(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Aw.prototype.getQueryCache=function(){return this.queryCache},Aw.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Aw.prototype.runTransaction=function(t,e,n){var r=this;kd("MemoryPersistence","Starting transaction:",t);var i=new kw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},Aw.prototype.mutationQueuesContainKey=function(t,e){return Dm.or(function(t){var e=[];return Kd(t,function(t,n){return e.push(n)}),e}(this.mutationQueues).map(function(n){return function(){return n.containsKey(t,e)}}))},Aw);function Aw(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Sy(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new _w(this),this.indexManager=new Pv,this.remoteDocumentCache=new Sw(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var kw=function(t){this.currentSequenceNumber=t},Dw=(Object.defineProperty(Rw.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Od("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Rw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Rw.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Dm.resolve()},Rw.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Dm.resolve()},Rw.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Dm.resolve()},Rw.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},Rw.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},Rw.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Dm.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(t){t||n.removeEntry(r)})}).next(function(){return e._orphanedDocuments=null,n.apply(t)})},Rw.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Rw.prototype.documentSize=function(t){return 0},Rw.prototype.isReferenced=function(t,e){var n=this;return Dm.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Dm.resolve(n.inMemoryPins.containsKey(e))}])},Rw);function Rw(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var Ow=(Pw.prototype.onTransactionStarted=function(){},Pw.prototype.onTransactionCommitted=function(t){return Dm.resolve()},Pw.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},Pw.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},Pw.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Pw.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Dm.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?Dm.resolve():e(i)})})},Pw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Pw.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},Pw.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,function(i){return n.isPinned(t,i,e).next(function(t){t||(r++,o.removeEntry(i))})}).next(function(){return o.apply(t)}).next(function(){return r})},Pw.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Dm.resolve()},Pw.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},Pw.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Dm.resolve()},Pw.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Dm.resolve()},Pw.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Dm.resolve()},Pw.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Od("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},Pw.prototype.isPinned=function(t,e,n){var r=this;return Dm.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Dm.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Dm.resolve(void 0!==t&&n<t)}])},Pw.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Pw);function Pw(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new bv(function(t){return Yy(t.path)}),this.garbageCollector=new Og(this,n)}var Mw=Number,xw=Mw.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Lw=Mw.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Fw=Mw.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Uw(t){return null==t}function qw(t){return Fw(t)&&t<=Lw&&xw<=t}var Vw=(Bw.prototype.reset=function(){this.currentBaseMs=0},Bw.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Bw.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&kd("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Bw.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Bw.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Bw);function Bw(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var jw,Ww,Qw="PersistentStream";(Ww=jw=jw||{})[Ww.Initial=0]="Initial",Ww[Ww.Starting=1]="Starting",Ww[Ww.Open=2]="Open",Ww[Ww.Error=3]="Error",Ww[Ww.Backoff=4]="Backoff";var Kw=(Hw.prototype.isStarted=function(){return this.state===jw.Starting||this.state===jw.Open||this.state===jw.Backoff},Hw.prototype.isOpen=function(){return this.state===jw.Open},Hw.prototype.start=function(){this.state!==jw.Error?(Pd(this.state===jw.Initial,"Already started"),this.auth()):this.performBackoff()},Hw.prototype.stop=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(jw.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hw.prototype.inhibitBackoff=function(){Pd(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=jw.Initial,this.backoff.reset()},Hw.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},Hw.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Hw.prototype.handleIdleCloseTimer=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return this.isOpen()?[2,this.close(jw.Initial)]:[2]})})},Hw.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Hw.prototype.close=function(t,e){return ci(this,void 0,void 0,function(){return hi(this,function(n){switch(n.label){case 0:return Pd(this.isStarted(),"Only started streams should be closed."),Pd(t===jw.Error||Uw(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==jw.Error?this.backoff.reset():e&&e.code===Ud.RESOURCE_EXHAUSTED?(Dd(e.toString()),Dd("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Ud.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},Hw.prototype.tearDown=function(){},Hw.prototype.auth=function(){var t=this;Pd(this.state===jw.Initial,"Must be in initial state to auth"),this.state=jw.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new qd(Ud.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},Hw.prototype.startStream=function(t){var e=this;Pd(this.state===jw.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Pd(e.state===jw.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=jw.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Hw.prototype.performBackoff=function(){var t=this;Pd(this.state===jw.Error,"Should only perform backoff when in Error state"),this.state=jw.Backoff,this.backoff.backoffAndRun(function(){return ci(t,void 0,void 0,function(){return hi(this,function(t){return Pd(this.state===jw.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=jw.Initial,this.start(),Pd(this.isStarted(),"PersistentStream should have started"),[2]})})})},Hw.prototype.handleStreamClose=function(t){return Pd(this.isStarted(),"Can't handle server close on non-started stream"),kd(Qw,"close with error: "+t),this.stream=null,this.close(jw.Error,t)},Hw.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(kd(Qw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Hw);function Hw(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=jw.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Vw(t,e)}var Gw,zw=(si(Yw,Gw=Kw),Yw.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},Yw.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},Yw.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},Yw.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},Yw);function Yw(t,e,n,r,i){var o=Gw.call(this,t,Uy.ListenStreamConnectionBackoff,Uy.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Xw,Jw=(si($w,Xw=Kw),Object.defineProperty($w.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),$w.prototype.start=function(){this.handshakeComplete_=!1,Xw.prototype.start.call(this)},$w.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},$w.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},$w.prototype.onMessage=function(t){if(Pd(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Pd(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},$w.prototype.writeHandshake=function(){Pd(this.isOpen(),"Writing handshake requires an opened stream"),Pd(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},$w.prototype.writeMutations=function(t){var e=this;Pd(this.isOpen(),"Writing mutations requires an opened stream"),Pd(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Pd(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},$w);function $w(t,e,n,r,i){var o=Xw.call(this,t,Uy.WriteStreamConnectionBackoff,Uy.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Ld(),o}var Zw=(t_.prototype.newPersistentWriteStream=function(t){return new Jw(this.queue,this.connection,this.credentials,this.serializer,t)},t_.prototype.newPersistentWatchStream=function(t){return new zw(this.queue,this.connection,this.credentials,this.serializer,t)},t_.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t_.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=mm();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Pd(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t_.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Ud.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t_.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Ud.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t_);function t_(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var e_,n_,r_,i_,o_=(a_.prototype.lookup=function(t){return ci(this,void 0,void 0,function(){var e,n=this;return hi(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new qd(Ud.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof dv||t instanceof lv?n.recordVersion(t):Od("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},a_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},a_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},a_.prototype.delete=function(t){this.write([new cw(t,this.precondition(t))]),this.writtenDocs.add(t)},a_.prototype.commit=function(){return ci(this,void 0,void 0,function(){var t;return hi(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new qd(Ud.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},a_.prototype.recordVersion=function(t){var e;if(t instanceof lv)e=t.version;else{if(!(t instanceof dv))throw Od("Document in a transaction was a "+t.constructor.name);e=em.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new qd(Ud.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},a_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Yb.updateTime(e):Yb.NONE},a_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Yb.exists(!0);if(e.isEqual(em.forDeletedDoc()))throw new qd(Ud.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Yb.updateTime(e)},a_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},a_.prototype.ensureCommitNotCalled=function(){Pd(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},a_);function a_(t){this.datastore=t,this.readVersions=_m(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(n_=e_=e_||{})[n_.Unknown=0]="Unknown",n_[n_.Online=1]="Online",n_[n_.Offline=2]="Offline",(i_=r_=r_||{})[i_.RemoteStore=0]="RemoteStore",i_[i_.SharedClientState=1]="SharedClientState";var s_,u_,c_=(h_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(e_.Unknown),Pd(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Uy.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Pd(t.state===e_.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(e_.Offline),Promise.resolve()}))},h_.prototype.handleWatchStreamFailure=function(t){this.state===e_.Online?(this.setAndBroadcast(e_.Unknown),Pd(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Pd(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(e_.Offline)))},h_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===e_.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},h_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},h_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Dd(e),this.shouldWarnClientIsOffline=!1):kd("OnlineStateTracker",e)},h_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},h_);function h_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=e_.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function l_(t){switch(t){case Ud.OK:return Od("Treated status OK as error");case Ud.CANCELLED:case Ud.UNKNOWN:case Ud.DEADLINE_EXCEEDED:case Ud.RESOURCE_EXHAUSTED:case Ud.INTERNAL:case Ud.UNAVAILABLE:case Ud.UNAUTHENTICATED:return!1;case Ud.INVALID_ARGUMENT:case Ud.NOT_FOUND:case Ud.ALREADY_EXISTS:case Ud.PERMISSION_DENIED:case Ud.FAILED_PRECONDITION:case Ud.ABORTED:case Ud.OUT_OF_RANGE:case Ud.UNIMPLEMENTED:case Ud.DATA_LOSS:return!0;default:return Od("Unknown status code: "+t)}}function f_(t){if(void 0===t)return Dd("GRPC error has no .code"),Ud.UNKNOWN;switch(t){case s_.OK:return Ud.OK;case s_.CANCELLED:return Ud.CANCELLED;case s_.UNKNOWN:return Ud.UNKNOWN;case s_.DEADLINE_EXCEEDED:return Ud.DEADLINE_EXCEEDED;case s_.RESOURCE_EXHAUSTED:return Ud.RESOURCE_EXHAUSTED;case s_.INTERNAL:return Ud.INTERNAL;case s_.UNAVAILABLE:return Ud.UNAVAILABLE;case s_.UNAUTHENTICATED:return Ud.UNAUTHENTICATED;case s_.INVALID_ARGUMENT:return Ud.INVALID_ARGUMENT;case s_.NOT_FOUND:return Ud.NOT_FOUND;case s_.ALREADY_EXISTS:return Ud.ALREADY_EXISTS;case s_.PERMISSION_DENIED:return Ud.PERMISSION_DENIED;case s_.FAILED_PRECONDITION:return Ud.FAILED_PRECONDITION;case s_.ABORTED:return Ud.ABORTED;case s_.OUT_OF_RANGE:return Ud.OUT_OF_RANGE;case s_.UNIMPLEMENTED:return Ud.UNIMPLEMENTED;case s_.DATA_LOSS:return Ud.DATA_LOSS;default:return Od("Unknown status code: "+t)}}(u_=s_=s_||{})[u_.OK=0]="OK",u_[u_.CANCELLED=1]="CANCELLED",u_[u_.UNKNOWN=2]="UNKNOWN",u_[u_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",u_[u_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",u_[u_.NOT_FOUND=5]="NOT_FOUND",u_[u_.ALREADY_EXISTS=6]="ALREADY_EXISTS",u_[u_.PERMISSION_DENIED=7]="PERMISSION_DENIED",u_[u_.UNAUTHENTICATED=16]="UNAUTHENTICATED",u_[u_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",u_[u_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",u_[u_.ABORTED=10]="ABORTED",u_[u_.OUT_OF_RANGE=11]="OUT_OF_RANGE",u_[u_.UNIMPLEMENTED=12]="UNIMPLEMENTED",u_[u_.INTERNAL=13]="INTERNAL",u_[u_.UNAVAILABLE=14]="UNAVAILABLE",u_[u_.DATA_LOSS=15]="DATA_LOSS";var p_,d_,y_,m_,v_=(g_.emptySet=function(t){return new g_(t.comparator)},g_.prototype.has=function(t){return null!=this.keyedMap.get(t)},g_.prototype.get=function(t){return this.keyedMap.get(t)},g_.prototype.first=function(){return this.sortedSet.minKey()},g_.prototype.last=function(){return this.sortedSet.maxKey()},g_.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},g_.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(g_.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),g_.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},g_.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},g_.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},g_.prototype.isEqual=function(t){if(!(t instanceof g_))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},g_.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},g_.prototype.copy=function(t,e){var n=new g_;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},g_);function g_(t){this.comparator=t?function(e,n){return t(e,n)||Ly.comparator(e.key,n.key)}:function(t,e){return Ly.comparator(t.key,e.key)},this.keyedMap=bm(),this.sortedSet=new rm(this.comparator)}(d_=p_=p_||{})[d_.Added=0]="Added",d_[d_.Removed=1]="Removed",d_[d_.Modified=2]="Modified",d_[d_.Metadata=3]="Metadata",(m_=y_=y_||{})[m_.Local=0]="Local",m_[m_.Synced=1]="Synced";var b_=(w_.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==p_.Added&&n.type===p_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===p_.Metadata&&n.type!==p_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===p_.Modified&&n.type===p_.Modified?this.changeMap=this.changeMap.insert(e,{type:p_.Modified,doc:t.doc}):t.type===p_.Modified&&n.type===p_.Added?this.changeMap=this.changeMap.insert(e,{type:p_.Added,doc:t.doc}):t.type===p_.Removed&&n.type===p_.Added?this.changeMap=this.changeMap.remove(e):t.type===p_.Removed&&n.type===p_.Modified?this.changeMap=this.changeMap.insert(e,{type:p_.Removed,doc:n.doc}):t.type===p_.Added&&n.type===p_.Removed?this.changeMap=this.changeMap.insert(e,{type:p_.Modified,doc:t.doc}):Od("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},w_.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},w_);function w_(){this.changeMap=new rm(Ly.comparator)}var __=(E_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:p_.Added,doc:t})}),new E_(t,e,v_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(E_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),E_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},E_);function E_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var T_=(S_.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=I_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new S_(em.MIN,r,Im(),mm(),Tm())},S_);function S_(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var I_=(C_.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new C_(Ld(),e,Tm(),Tm(),Tm())},C_);function C_(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var N_,A_,k_=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},D_=function(t,e){this.targetId=t,this.existenceFilter=e};(A_=N_=N_||{})[A_.NoChange=0]="NoChange",A_[A_.Added=1]="Added",A_[A_.Removed=2]="Removed",A_[A_.Current=3]="Current",A_[A_.Reset=4]="Reset";var R_=function(t,e,n,r){void 0===n&&(n=Ld()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},O_=(Object.defineProperty(P_.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(P_.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),P_.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},P_.prototype.toTargetChange=function(){var t=Tm(),e=Tm(),n=Tm();return this.documentChanges.forEach(function(r,i){switch(i){case p_.Added:t=t.add(r);break;case p_.Modified:e=e.add(r);break;case p_.Removed:n=n.add(r);break;default:Od("Encountered invalid change type: "+i)}}),new I_(this._resumeToken,this._current,t,e,n)},P_.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=F_()},P_.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},P_.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},P_.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},P_.prototype.recordTargetResponse=function(){this.pendingResponses-=1},P_.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},P_);function P_(){this.pendingResponses=0,this.documentChanges=F_(),this._resumeToken=Ld(),this._current=!1,this._hasPendingChanges=!0}var M_=(x_.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof lv?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof dv&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},x_.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case N_.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case N_.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case N_.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Pd(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case N_.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case N_.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Od("Unknown target watch change state: "+t.state)}})},x_.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Qd(this.targetStates,e)},x_.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Ly(i.path);this.removeDocumentFromTarget(e,o,new dv(o,em.forDeletedDoc()))}else Pd(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},x_.prototype.createRemoteEvent=function(t){var e=this,n={};Qd(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new Ly(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new dv(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=Tm();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===dg.LimboResolution||(i=!1)}),i&&(r=r.add(t))});var i=new T_(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=mm(),this.pendingDocumentTargetMapping=L_(),this.pendingTargetResets=new lm(fy),i},x_.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?p_.Modified:p_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},x_.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,p_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},x_.prototype.removeTarget=function(t){delete this.targetStates[t]},x_.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},x_.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},x_.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new O_),this.targetStates[t]},x_.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new lm(fy),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},x_.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||kd("WatchChangeAggregator","Detected inactive target",t),e},x_.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},x_.prototype.resetTarget=function(t){var e=this;Pd(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new O_,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},x_.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},x_);function x_(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=mm(),this.pendingDocumentTargetMapping=L_(),this.pendingTargetResets=new lm(fy)}function L_(){return new rm(Ly.comparator)}function F_(){return new rm(Ly.comparator)}var U_="RemoteStore",q_=(V_.prototype.start=function(){return this.enableNetwork()},V_.prototype.enableNetwork=function(){return ci(this,void 0,void 0,function(){var t;return hi(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(e_.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},V_.prototype.disableNetwork=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(e_.Offline),[2]}})})},V_.prototype.disableNetworkInternal=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(kd(U_,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},V_.prototype.shutdown=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return kd(U_,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(e_.Unknown),[2]}})})},V_.prototype.listen=function(t){Pd(!jd(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},V_.prototype.unlisten=function(t){Pd(jd(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Hd(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(e_.Unknown))},V_.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},V_.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},V_.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},V_.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},V_.prototype.startWatchStream=function(){Pd(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new M_(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},V_.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Hd(this.listenTargets)},V_.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},V_.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},V_.prototype.onWatchStreamOpen=function(){return ci(this,void 0,void 0,function(){var t=this;return hi(this,function(e){return Qd(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},V_.prototype.onWatchStreamClose=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){return void 0===t&&Pd(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(e_.Unknown),[2]})})},V_.prototype.onWatchStreamChange=function(t,e){return ci(this,void 0,void 0,function(){var n;return hi(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(e_.Online),t instanceof R_&&t.state===N_.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof k_?this.watchChangeAggregator.handleDocumentChange(t):t instanceof D_?this.watchChangeAggregator.handleExistenceFilter(t):(Pd(t instanceof R_,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(em.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},V_.prototype.raiseWatchSnapshot=function(t){var e=this;Pd(!t.isEqual(em.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return Qd(n.targetChanges,function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:Ld()}),e.sendUnwatchRequest(t);var r=new wg(n.query,t,dg.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},V_.prototype.handleTargetError=function(t){var e=this;Pd(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return ci(e,void 0,void 0,function(){return hi(this,function(e){return jd(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},V_.prototype.fillWritePipeline=function(){return ci(this,void 0,void 0,function(){var t,e;return hi(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},V_.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},V_.prototype.outstandingWrites=function(){return this.writePipeline.length},V_.prototype.addToWritePipeline=function(t){Pd(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},V_.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},V_.prototype.startWriteStream=function(){Pd(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},V_.prototype.onWriteStreamOpen=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return this.writeStream.writeHandshake(),[2]})})},V_.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(jg)},V_.prototype.onMutationResult=function(t,e){var n=this;Pd(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Am.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},V_.prototype.onWriteStreamClose=function(t){return ci(this,void 0,void 0,function(){var e=this;return hi(this,function(n){return void 0===t&&Pd(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},V_.prototype.handleHandshakeError=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){return l_(t.code)?(kd(U_,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ld(),[2,this.localStore.setLastStreamToken(Ld()).catch(jg)]):[2]})})},V_.prototype.handleWriteError=function(t){return ci(this,void 0,void 0,function(){var e,n=this;return hi(this,function(r){return function(t){return l_(t)&&t!==Ud.ABORTED}(t.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2]})})},V_.prototype.createTransaction=function(){return new o_(this.datastore)},V_.prototype.restartNetwork=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(e_.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},V_.prototype.handleCredentialChange=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(kd(U_,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},V_.prototype.applyPrimaryState=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(e_.Unknown),e.label=4;case 4:return[2]}})})},V_);function V_(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ci(o,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(kd(U_,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new c_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var B_=(Object.defineProperty(j_.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(j_.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),j_.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},j_.prototype._compareTo=function(t){return fy(this._lat,t._lat)||fy(this._long,t._long)},j_);function j_(t,e){if(zd("GeoPoint",arguments,2),Jd("GeoPoint","number",1,t),Jd("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new qd(Ud.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new qd(Ud.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var W_=(Q_.atPath=function(t){return new Q_(t)},Object.defineProperty(Q_.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[vE]:this.memoizedOrderBy=[new yE(t),vE];else{Pd(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:lE.ASCENDING;this.memoizedOrderBy.push(a===lE.ASCENDING?vE:gE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),Q_.prototype.addFilter=function(t){Pd(null==this.getInequalityFilterField()||!(t instanceof z_)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Pd(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},Q_.prototype.addOrderBy=function(t){Pd(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new Q_(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},Q_.prototype.withLimit=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},Q_.prototype.withStartAt=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},Q_.prototype.withEndAt=function(t){return new Q_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},Q_.prototype.asCollectionQueryAtPath=function(t){return new Q_(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},Q_.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Uw(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},Q_.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Uw(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},Q_.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Q_.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Pd(n,"orderBy used that doesn't compare on key field"),0},Q_.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},Q_.prototype.hasLimit=function(){return!Uw(this.limit)},Q_.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},Q_.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof z_&&n.isInequality())return n.field}return null},Q_.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof z_&&0<=t.indexOf(r.op))return r.op}return null},Q_.prototype.isDocumentQuery=function(){return Ly.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},Q_.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},Q_.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Ly.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},Q_.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},Q_.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Q_.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},Q_.prototype.assertValidBound=function(t){Pd(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Q_);function Q_(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}var K_=(H_.fromString=function(t){switch(t){case"<":return H_.LESS_THAN;case"<=":return H_.LESS_THAN_OR_EQUAL;case"==":return H_.EQUAL;case">=":return H_.GREATER_THAN_OR_EQUAL;case">":return H_.GREATER_THAN;case"array-contains":return H_.ARRAY_CONTAINS;case"in":return H_.IN;case"array-contains-any":return H_.ARRAY_CONTAINS_ANY;default:return Od("Unknown FieldFilter operator: "+t)}},H_.prototype.toString=function(){return this.name},H_.prototype.isEqual=function(t){return this.name===t.name},H_.LESS_THAN=new H_("<"),H_.LESS_THAN_OR_EQUAL=new H_("<="),H_.EQUAL=new H_("=="),H_.GREATER_THAN=new H_(">"),H_.GREATER_THAN_OR_EQUAL=new H_(">="),H_.ARRAY_CONTAINS=new H_("array-contains"),H_.IN=new H_("in"),H_.ARRAY_CONTAINS_ANY=new H_("array-contains-any"),H_);function H_(t){this.name=t}var G_,z_=(si(Y_,G_=function(){}),Y_.create=function(t,e,n){if(t.isKeyField())return e===K_.IN?(Pd(n instanceof Vb,"Comparing on key with IN, but filter value not an ArrayValue"),Pd(n.internalValue.every(function(t){return t instanceof Rb}),"Comparing on key with IN, but an array value was not a RefValue"),new tE(t,n)):(Pd(n instanceof Rb,"Comparing on key, but filter value not a RefValue"),Pd(e!==K_.ARRAY_CONTAINS&&e!==K_.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new J_(t,e,n));if(n.isEqual(rb.INSTANCE)){if(e!==K_.EQUAL)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Y_(t,e,n)}if(n.isEqual(mb.NAN)){if(e!==K_.EQUAL)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Y_(t,e,n)}return e===K_.ARRAY_CONTAINS?new rE(t,n):e===K_.IN?(Pd(n instanceof Vb,"IN filter has invalid value: "+n.toString()),new aE(t,n)):e===K_.ARRAY_CONTAINS_ANY?(Pd(n instanceof Vb,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new cE(t,n)):new Y_(t,e,n)},Y_.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},Y_.prototype.matchesComparison=function(t){switch(this.op){case K_.LESS_THAN:return t<0;case K_.LESS_THAN_OR_EQUAL:return t<=0;case K_.EQUAL:return 0===t;case K_.GREATER_THAN:return 0<t;case K_.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Od("Unknown FieldFilter operator: "+this.op)}},Y_.prototype.isInequality=function(){return 0<=[K_.LESS_THAN,K_.LESS_THAN_OR_EQUAL,K_.GREATER_THAN,K_.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Y_.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},Y_.prototype.isEqual=function(t){return t instanceof Y_&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Y_.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},Y_);function Y_(t,e,n){var r=G_.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var X_,J_=(si($_,X_=z_),$_.prototype.matches=function(t){var e=this.value,n=Ly.comparator(t.key,e.key);return this.matchesComparison(n)},$_);function $_(){return null!==X_&&X_.apply(this,arguments)||this}var Z_,tE=(si(eE,Z_=z_),eE.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},eE);function eE(t,e){var n=Z_.call(this,t,K_.IN,e)||this;return n.value=e,n}var nE,rE=(si(iE,nE=z_),iE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Vb&&e.contains(this.value)},iE);function iE(t,e){return nE.call(this,t,K_.ARRAY_CONTAINS,e)||this}var oE,aE=(si(sE,oE=z_),sE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},sE);function sE(t,e){var n=oE.call(this,t,K_.IN,e)||this;return n.value=e,n}var uE,cE=(si(hE,uE=z_),hE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Vb&&n.internalValue.some(function(t){return e.value.contains(t)})},hE);function hE(t,e){var n=uE.call(this,t,K_.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var lE=(fE.prototype.toString=function(){return this.name},fE.ASCENDING=new fE("asc"),fE.DESCENDING=new fE("desc"),fE);function fE(t){this.name=t}var pE=(dE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},dE.prototype.sortsBeforeDocument=function(t,e){Pd(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Pd(o instanceof Rb,"Bound has a non-key value where the key path is being used."),n=Ly.comparator(o.key,e.key);else{var a=e.field(i.field);Pd(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===lE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},dE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},dE);function dE(t,e){this.position=t,this.before=e}var yE=(mE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?lv.compareByKey(t,e):lv.compareByField(this.field,t,e);switch(this.dir){case lE.ASCENDING:return n;case lE.DESCENDING:return-1*n;default:return Od("Unknown direction: "+this.dir)}},mE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},mE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},mE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},mE);function mE(t,e){this.field=t,void 0===e&&(e=lE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var vE=new yE(My.keyField(),lE.ASCENDING),gE=new yE(My.keyField(),lE.DESCENDING),bE=(wE.prototype.applyToLocalView=function(t,e){return new Ib(e,t)},wE.prototype.applyToRemoteDocument=function(t,e){return e},wE.prototype.computeBaseValue=function(t){return null},wE.prototype.isEqual=function(t){return t instanceof wE},wE.instance=new wE,wE);function wE(){}var _E=(EE.prototype.applyToLocalView=function(t,e){return this.apply(t)},EE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},EE.prototype.apply=function(t){for(var e=NE(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Vb(e)},EE.prototype.computeBaseValue=function(t){return null},EE.prototype.isEqual=function(t){return t instanceof EE&&py(t.elements,this.elements)},EE);function EE(t){this.elements=t}var TE=(SE.prototype.applyToLocalView=function(t,e){return this.apply(t)},SE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},SE.prototype.apply=function(t){for(var e=NE(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Vb(e)},SE.prototype.computeBaseValue=function(t){return null},SE.prototype.isEqual=function(t){return t instanceof SE&&py(t.elements,this.elements)},SE);function SE(t){this.elements=t}var IE=(CE.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof pb&&this.operand instanceof pb){var r=n.internalValue+this.operand.internalValue;return new pb(r)}return r=n.internalValue+this.operand.internalValue,new mb(r)},CE.prototype.applyToRemoteDocument=function(t,e){return Pd(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},CE.prototype.computeBaseValue=function(t){return t instanceof cb?t:new pb(0)},CE.prototype.isEqual=function(t){return t instanceof CE&&this.operand.isEqual(t.operand)},CE);function CE(t){this.operand=t}function NE(t){return t instanceof Vb?t.internalValue.slice():[]}var AE=(kE.prototype.isEqual=function(t){return t&&t.count===this.count},kE);function kE(t){this.count=t}var DE,RE,OE=((DE={})[lE.ASCENDING.name]="ASCENDING",DE[lE.DESCENDING.name]="DESCENDING",DE),PE=((RE={})[K_.LESS_THAN.name]="LESS_THAN",RE[K_.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",RE[K_.GREATER_THAN.name]="GREATER_THAN",RE[K_.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",RE[K_.EQUAL.name]="EQUAL",RE[K_.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",RE[K_.IN.name]="IN",RE[K_.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",RE),ME=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xE(t,e){Pd(!Uw(t),e+" is missing")}function LE(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Od("can't parse "+t)}var FE=(UE.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},UE.prototype.unsafeCastProtoByteString=function(t){return t},UE.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Ud.UNKNOWN:f_(t.code);return new qd(e,t.message||"")},UE.prototype.toInt32Value=function(t){return Uw(t)?void 0:{value:t}},UE.prototype.fromInt32Value=function(t){var e;return Uw(e="object"==typeof t?t.value:t)?null:e},UE.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},UE.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Pd(!!t,"Cannot deserialize null or undefined timestamp.");var e=LE(t.seconds||"0"),n=t.nanos||0;return new Zy(e,n)},UE.prototype.fromIso8601String=function(t){var e=0,n=ME.exec(t);if(Pd(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Zy(o,e)},UE.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},UE.prototype.fromBlob=function(t){return"string"==typeof t?(Pd(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),vy.fromBase64String(t)):(Pd(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),vy.fromUint8Array(t))},UE.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},UE.prototype.fromVersion=function(t){return Pd(!!t,"Trying to deserialize version that isn't set"),em.fromTimestamp(this.fromTimestamp(t))},UE.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},UE.prototype.fromResourceName=function(t){var e=Dy.fromString(t);return Pd(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},UE.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},UE.prototype.fromName=function(t){var e=this.fromResourceName(t);return Pd(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Pd(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Ly(this.extractLocalPathFromResourceName(e))},UE.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},UE.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Dy.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(UE.prototype,"encodedDatabaseId",{get:function(){return new Dy(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),UE.prototype.fullyQualifiedPrefixPath=function(t){return new Dy(["projects",t.projectId,"databases",t.database])},UE.prototype.extractLocalPathFromResourceName=function(t){return Pd(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},UE.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},UE.prototype.toValue=function(t){if(t instanceof rb)return{nullValue:"NULL_VALUE"};if(t instanceof ab)return{booleanValue:t.value()};if(t instanceof pb)return{integerValue:""+t.value()};if(t instanceof mb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof bb?{stringValue:t.value()}:t instanceof Fb?{mapValue:this.toMapValue(t)}:t instanceof Vb?{arrayValue:this.toArrayValue(t)}:t instanceof Eb?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Mb?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ab?{bytesValue:this.toBytes(t.value())}:t instanceof Rb?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Od("Unknown FieldValue "+JSON.stringify(t))},UE.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return rb.INSTANCE;if("booleanValue"in t)return ab.of(t.booleanValue);if("integerValue"in t)return new pb(LE(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return mb.NAN;if("Infinity"===t.doubleValue)return mb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return mb.NEGATIVE_INFINITY}return new mb(t.doubleValue)}if("stringValue"in t)return new bb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){xE(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Vb(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return xE(t.timestampValue,"timestampValue"),new Eb(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){xE(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Mb(new B_(r,i))}if("bytesValue"in t){xE(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Ab(o)}if("referenceValue"in t){xE(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Ey(a.get(1),a.get(3)),u=new Ly(this.extractLocalPathFromResourceName(a));return new Rb(s,u)}return Od("Unknown Value proto "+JSON.stringify(t))},UE.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},UE.prototype.toDocument=function(t){return Pd(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},UE.prototype.fromDocument=function(t,e){return new lv(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},UE.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},UE.prototype.fromFields=function(t){var e=this,n=t,r=Fb.EMPTY;return Kd(n,function(t,n){r=r.set(new My([t]),e.fromValue(n))}),r},UE.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},UE.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},UE.prototype.fromFound=function(t){Pd(!!t.found,"Tried to deserialize a found document from a missing document."),xE(t.found.name,"doc.found.name"),xE(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new lv(e,n,r,{},t.found)},UE.prototype.fromMissing=function(t){Pd(!!t.missing,"Tried to deserialize a missing document from a found document."),Pd(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new dv(e,n)},UE.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Od("invalid batch get response: "+JSON.stringify(t))},UE.prototype.toWatchTargetChangeState=function(t){switch(t){case N_.Added:return"ADD";case N_.Current:return"CURRENT";case N_.NoChange:return"NO_CHANGE";case N_.Removed:return"REMOVE";case N_.Reset:return"RESET";default:return Od("Unknown WatchTargetChangeState: "+t)}},UE.prototype.toTestWatchChange=function(t){if(t instanceof D_)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof k_){if(t.newDoc instanceof lv){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof dv)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof R_){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return s_.OK;switch(t){case Ud.OK:return s_.OK;case Ud.CANCELLED:return s_.CANCELLED;case Ud.UNKNOWN:return s_.UNKNOWN;case Ud.DEADLINE_EXCEEDED:return s_.DEADLINE_EXCEEDED;case Ud.RESOURCE_EXHAUSTED:return s_.RESOURCE_EXHAUSTED;case Ud.INTERNAL:return s_.INTERNAL;case Ud.UNAVAILABLE:return s_.UNAVAILABLE;case Ud.UNAUTHENTICATED:return s_.UNAUTHENTICATED;case Ud.INVALID_ARGUMENT:return s_.INVALID_ARGUMENT;case Ud.NOT_FOUND:return s_.NOT_FOUND;case Ud.ALREADY_EXISTS:return s_.ALREADY_EXISTS;case Ud.PERMISSION_DENIED:return s_.PERMISSION_DENIED;case Ud.FAILED_PRECONDITION:return s_.FAILED_PRECONDITION;case Ud.ABORTED:return s_.ABORTED;case Ud.OUT_OF_RANGE:return s_.OUT_OF_RANGE;case Ud.UNIMPLEMENTED:return s_.UNIMPLEMENTED;case Ud.DATA_LOSS:return s_.DATA_LOSS;default:return Od("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Od("Unrecognized watch change: "+JSON.stringify(t))},UE.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){xE(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new R_(n,r,i,a||null)}else if("documentChange"in t){xE(t.documentChange,"documentChange"),xE(t.documentChange.document,"documentChange.name"),xE(t.documentChange.document.name,"documentChange.document.name"),xE(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new lv(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new k_(f,p,l.key,l)}else if("documentDelete"in t){xE(t.documentDelete,"documentDelete"),xE(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):em.forDeletedDoc(),l=new dv(u,c),p=d.removedTargetIds||[],e=new k_([],p,l.key,l)}else if("documentRemove"in t){xE(t.documentRemove,"documentRemove"),xE(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[],e=new k_([],p,u,null)}else{if(!("filter"in t))return Od("Unknown change type "+JSON.stringify(t));xE(t.filter,"filter"),xE(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new AE(v),b=m.targetId;e=new D_(b,g)}return e},UE.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?N_.NoChange:"ADD"===t?N_.Added:"REMOVE"===t?N_.Removed:"CURRENT"===t?N_.Current:"RESET"===t?N_.Reset:Od("Got unexpected TargetChange.state: "+t)},UE.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return em.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?em.MIN:e.readTime?this.fromVersion(e.readTime):em.MIN},UE.prototype.toMutation=function(t){var e,n=this;if(t instanceof tw)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof cw)e={delete:this.toName(t.key)};else if(t instanceof rw)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof aw))return Od("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},UE.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Yb.NONE;if(t.update){xE(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new rw(r,i,o,n)}return new tw(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new cw(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Pd(!0===n.exists,'Transforms only support precondition "exists == true"'),new aw(r,a)}return Od("unknown mutation proto: "+JSON.stringify(t))},UE.prototype.toPrecondition=function(t){return Pd(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Od("Unknown precondition")},UE.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Yb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Yb.exists(t.exists):Yb.NONE},UE.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new zb(r,i)},UE.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Pd(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},UE.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof bE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof _E)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof TE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof IE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Od("Unknown transform: "+t.transform)},UE.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Pd("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=bE.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new _E(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new TE(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Pd(i instanceof cb,"NUMERIC_ADD transform requires a NumberValue"),n=new IE(i)}else Od("Unknown transform proto: "+JSON.stringify(t));var o=My.fromServerFormat(t.fieldPath);return new Qb(o,n)},UE.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},UE.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Pd(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return W_.atPath(this.fromQueryPath(n))},UE.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Pd(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Pd(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},UE.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Pd(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new W_(e,i,s,a,u,c,h)},UE.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},UE.prototype.toLabel=function(t){switch(t){case dg.Listen:return null;case dg.ExistenceFilterMismatch:return"existence-filter-mismatch";case dg.LimboResolution:return"limbo-document";default:return Od("Unrecognized query purpose: "+t)}},UE.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},UE.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof z_?e.toUnaryOrFieldFilter(t):Od("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},UE.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Od("Unknown filter: "+JSON.stringify(t)):[]},UE.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},UE.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},UE.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},UE.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new pE(r,n)},UE.prototype.toDirection=function(t){return OE[t.name]},UE.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return lE.ASCENDING;case"DESCENDING":return lE.DESCENDING;default:return}},UE.prototype.toOperatorName=function(t){return PE[t.name]},UE.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return K_.EQUAL;case"GREATER_THAN":return K_.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return K_.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return K_.LESS_THAN;case"LESS_THAN_OR_EQUAL":return K_.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return K_.ARRAY_CONTAINS;case"IN":return K_.IN;case"ARRAY_CONTAINS_ANY":return K_.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Od("Unspecified operator");default:return Od("Unknown operator")}},UE.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},UE.prototype.fromFieldPathReference=function(t){return My.fromServerFormat(t.fieldPath)},UE.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},UE.prototype.fromPropertyOrder=function(t){return new yE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},UE.prototype.fromFieldFilter=function(t){return z_.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},UE.prototype.toUnaryOrFieldFilter=function(t){if(t.op===K_.EQUAL){if(t.value.isEqual(mb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(rb.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},UE.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return z_.create(e,K_.EQUAL,mb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return z_.create(n,K_.EQUAL,rb.INSTANCE);case"OPERATOR_UNSPECIFIED":return Od("Unspecified filter");default:return Od("Unknown filter")}},UE.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},UE.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return My.fromServerFormat(t)});return jb.fromArray(e)},UE);function UE(t,e){this.databaseId=t,this.options=e}var qE=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},VE=(BE.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new qE,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},BE.prototype.unlisten=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i;return hi(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},BE.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(r);o.viewSnap=r}}},BE.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},BE.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].applyOnlineStateChange(t)})},BE);function BE(t){this.syncEngine=t,this.queries=new bv(function(t){return t.canonicalId()}),this.onlineState=e_.Unknown,this.syncEngine.subscribe(this)}var jE=(WE.prototype.onViewSnapshot=function(t){if(Pd(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==p_.Metadata&&e.push(i)}t=new __(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},WE.prototype.onError=function(t){this.queryObserver.error(t)},WE.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},WE.prototype.shouldRaiseInitialEvent=function(t,e){if(Pd(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==e_.Offline;return this.options.waitForSyncWhenOnline&&n?(Pd(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===e_.Offline},WE.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},WE.prototype.raiseInitialEvent=function(t){Pd(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=__.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},WE);function WE(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=e_.Unknown,this.options=n||{}}var QE=(KE.fromSnapshot=function(t,e){for(var n=Tm(),r=Tm(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case p_.Added:n=n.add(a.doc.key);break;case p_.Removed:r=r.add(a.doc.key)}}return new KE(t,n,r)},KE);function KE(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var HE=function(t){this.key=t},GE=function(t){this.key=t},zE=(Object.defineProperty(YE.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),YE.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new b_,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof lv?e:null;h&&(Pd(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:p_.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:p_.Modified,doc:h}),p=!0,u&&0<n.query.docComparator(h,u)&&(s=!0)):!c&&h?(r.track({type:p_.Added,doc:h}),p=!0):c&&!h&&(r.track({type:p_.Removed,doc:c}),p=!0,u&&(s=!0)),p&&(o=h?(a=a.add(h),f?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:p_.Removed,doc:c})}return Pd(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},YE.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},YE.prototype.applyChanges=function(t,e,n){var r=this;Pd(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case p_.Added:return 1;case p_.Modified:case p_.Metadata:return 2;case p_.Removed:return 0;default:return Od("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?y_.Synced:y_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new __(this.query,t.documentSet,i,o,t.mutatedKeys,s===y_.Local,u,!1),limboChanges:a}:{limboChanges:a}},YE.prototype.applyOnlineStateChange=function(t){return this.current&&t===e_.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new b_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},YE.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},YE.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Pd(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},YE.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Tm(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new GE(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new HE(t))}),n},YE.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Tm();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},YE.prototype.computeInitialSnapshot=function(){return __.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===y_.Local)},YE);function YE(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Tm(),this.mutatedKeys=Tm(),this.documentSet=new v_(t.docComparator.bind(t))}var XE=(JE.prototype.run=function(){this.runWithBackOff()},JE.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return ci(t,void 0,void 0,function(){var t,e,n=this;return hi(this,function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.handleTransactionError(t)})})}).catch(function(t){n.handleTransactionError(t)}),[2]})})})},JE.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!Uw(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},JE.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},JE.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!l_(e)},JE);function JE(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new Vw(this.asyncQueue,Uy.RetryTransaction)}var $E="SyncEngine",ZE=function(t,e,n){this.query=t,this.targetId=e,this.view=n},tT=function(t){this.key=t,this.receivedDocument=!1},eT=(Object.defineProperty(nT.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),nT.prototype.subscribe=function(t){Pd(null!==t,"SyncEngine listener cannot be null"),Pd(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},nT.prototype.listen=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i,o;return hi(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},nT.prototype.initializeViewAndComputeSnapshot=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return hi(this,function(h){switch(h.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=h.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return i=h.sent(),o=new zE(n,i),a=o.computeDocChanges(r),s=I_.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==e_.Offline),Pd(0===(u=o.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),Pd(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new ZE(n,t.targetId,o),this.queryViewsByQuery.set(n,c),this.queryViewsByTarget[t.targetId]=c,[2,u.snapshot]}})})},nT.prototype.synchronizeViewAndComputeSnapshot=function(t){return ci(this,void 0,void 0,function(){var e,n,r;return hi(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}})})},nT.prototype.unlisten=function(t){return ci(this,void 0,void 0,function(){var e,n=this;return hi(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),Pd(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(jg)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},nT.prototype.write=function(t,e){return ci(this,void 0,void 0,function(){var n;return hi(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},nT.prototype.runTransaction=function(t,e,n){new XE(t,this.remoteStore,e,n).run()},nT.prototype.applyRemoteEvent=function(t){return ci(this,void 0,void 0,function(){var e,n=this;return hi(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),Kd(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Pd(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?r.receivedDocument=!0:0<e.modifiedDocuments.size?Pd(r.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Pd(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,jg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},nT.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===r_.RemoteStore||!this.isPrimary&&e===r_.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Pd(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},nT.prototype.rejectListen=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return hi(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new rm(Ly.comparator)).insert(r,new dv(r,em.forDeletedDoc())),o=Tm().add(r),a=new T_(em.MIN,{},new lm(fy),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return Pd(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then(function(){return u.removeAndCleanupQuery(s)}).catch(jg)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}})})},nT.prototype.applyBatchState=function(t,e,n){return ci(this,void 0,void 0,function(){var r;return hi(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(kd($E,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Od("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},nT.prototype.applySuccessfulWrite=function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,jg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},nT.prototype.rejectFailedWrite=function(t,e){return ci(this,void 0,void 0,function(){var n;return hi(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,jg(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},nT.prototype.registerPendingWritesCallback=function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||kd($E,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?t.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n)),[2]}})})},nT.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},nT.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new qd(Ud.CANCELLED,t))})}),this.pendingWritesCallbacks.clear()},nT.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new rm(fy)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},nT.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Pd(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},nT.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},nT.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},nT.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof HE?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof GE?(kd($E,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Od("Unknown limbo change: "+JSON.stringify(i))}},nT.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){kd($E,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=W_.atPath(e.path);this.limboResolutionsByTarget[n]=new tT(e),this.remoteStore.listen(new wg(r,n,dg.LimboResolution,Sy.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},nT.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},nT.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o=this;return hi(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=QE.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},nT.prototype.assertSubscribed=function(t){Pd(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},nT.prototype.handleCredentialChange=function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},nT.prototype.applyPrimaryState=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return hi(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Qd(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},nT.prototype.resetLimboDocuments=function(){var t=this;Qd(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new rm(Ly.comparator)},nT.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return hi(this,function(h){switch(h.label){case 0:e=[],n=[],r=0,i=t,h.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return h.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=h.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=h.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Pd(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Pd(!!(c=h.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=h.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:h.sent(),h.label=9;case 9:e.push(a),h.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},nT.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},nT.prototype.applyTargetState=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i,o,a,s;return hi(this,function(u){switch(u.label){case 0:if(this.isPrimary)return kd($E,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return u.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=u.sent(),i=T_.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return u.sent(),[3,11];case 4:return function(t){return t.code===Ud.DATA_LOSS&&t.message===Sv}(o=u.sent())?(a=[],Qd(this.queryViewsByTarget,function(t){return a.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)]):[3,6];case 5:return u.sent(),[3,7];case 6:throw o;case 7:return[3,8];case 8:return s=this.queryViewsByTarget[t],this.removeAndCleanupQuery(s),[4,this.localStore.releaseQuery(s.query,!0)];case 9:return u.sent(),this.syncEngineListener.onWatchError(s.query,n),[3,11];case 10:Od("Unexpected target state: "+e),u.label=11;case 11:return[2]}})})},nT.prototype.applyActiveTargetsChange=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l=this;return hi(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],Pd(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return Pd(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return hi(this,function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(jg)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},nT.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},nT.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},nT.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Tm().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Tm()},nT);function nT(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new bv(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new rm(Ly.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new pw,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=jm.forSyncEngine(),this.isPrimary=void 0,this.onlineState=e_.Unknown}var rT=(iT.prototype.isAuthenticated=function(){return null!=this.uid},iT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},iT.prototype.isEqual=function(t){return t.uid===this.uid},iT.UNAUTHENTICATED=new iT(null),iT.GOOGLE_CREDENTIALS=new iT("google-credentials-uid"),iT.FIRST_PARTY=new iT("first-party-uid"),iT);function iT(t){this.uid=t}var oT="SharedClientState",aT="firestore_clients",sT="firestore_mutations",uT="firestore_targets",cT=(hT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new qd(r.error.code,r.error.message)),i?new hT(t,e,r.state,o):(Dd(oT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},hT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},hT);function hT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Pd(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var lT=(fT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new qd(n.error.code,n.error.message)),r?new fT(t,n.state,i):(Dd(oT,"Failed to parse target state for ID '"+t+"': "+e),null)},fT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},fT);function fT(t,e,n){this.targetId=t,this.state=e,Pd(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var pT=(dT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Im(),o=0;r&&o<n.activeTargetIds.length;++o)r=qw(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new dT(t,i):(Dd(oT,"Failed to parse client data for instance '"+t+"': "+e),null)},dT);function dT(t,e){this.clientId=t,this.activeTargetIds=e}var yT=(mT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in e_&&"string"==typeof e.clientId?new mT(e.clientId,e_[e.onlineState]):(Dd(oT,"Failed to parse online state: "+t),null)},mT);function mT(t,e){this.clientId=t,this.onlineState=e}var vT=(gT.prototype.addQueryTarget=function(t){Pd(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},gT.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},gT.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},gT);function gT(){this.activeTargetIds=Im()}var bT=(wT.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},wT.prototype.start=function(){return ci(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return hi(this,function(f){switch(f.label){case 0:return Pd(!this.started,"WebStorageSharedClientState already started"),Pd(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Pd(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=pT.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},wT.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},wT.prototype.getAllActiveQueryTargets=function(){var t=Im();return Kd(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},wT.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},wT.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},wT.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},wT.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=lT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},wT.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},wT.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},wT.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},wT.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},wT.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},wT.prototype.setOnlineState=function(t){this.persistOnlineState(t)},wT.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},wT.prototype.getItem=function(t){var e=this.storage.getItem(t);return kd(oT,"READ",t,e),e},wT.prototype.setItem=function(t,e){kd(oT,"SET",t,e),this.storage.setItem(t,e)},wT.prototype.removeItem=function(t){kd(oT,"REMOVE",t),this.storage.removeItem(t)},wT.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(kd(oT,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Dd("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ci(e,void 0,void 0,function(){var e,n,r,i,o,a;return hi(this,function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Pd(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Sy.INVALID;if(null!=t)try{var n=JSON.parse(t);Pd("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Dd(oT,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Sy.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(wT.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),wT.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},wT.prototype.persistMutationState=function(t,e,n){var r=new cT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},wT.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},wT.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:e_[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},wT.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new lT(t,e,n);this.setItem(r,i.toWebStorageJSON())},wT.prototype.toWebStorageClientStateKey=function(t){return Pd(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),aT+"_"+this.persistenceKey+"_"+t},wT.prototype.toWebStorageQueryTargetMetadataKey=function(t){return uT+"_"+this.persistenceKey+"_"+t},wT.prototype.toWebStorageMutationBatchKey=function(t){var e=sT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},wT.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},wT.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Pd(null!==n,"Cannot parse client state key '"+t+"'"),pT.fromWebStorageEntry(n,e)},wT.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Pd(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cT.fromWebStorageEntry(new rT(i),r,e)},wT.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Pd(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return lT.fromWebStorageEntry(r,e)},wT.prototype.fromWebStorageOnlineState=function(t){return yT.fromWebStorageEntry(t)},wT.prototype.handleMutationBatchEvent=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){return t.user.uid!==this.currentUser.uid?(kd(oT,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},wT.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},wT.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return ci(n,void 0,void 0,function(){return hi(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return ci(n,void 0,void 0,function(){return hi(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},wT.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},wT);function wT(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!wT.isAvailable(this.platform))throw new qd(Ud.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new vT,this.clientStateKeyRe=new RegExp("^"+aT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+sT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+uT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var _T=(ET.prototype.addPendingMutation=function(t){},ET.prototype.updateMutationState=function(t,e,n){},ET.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},ET.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},ET.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},ET.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},ET.prototype.clearQueryState=function(t){delete this.queryState[t]},ET.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},ET.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},ET.prototype.start=function(){return this.localState=new vT,Promise.resolve()},ET.prototype.handleUserChange=function(t,e,n){},ET.prototype.setOnlineState=function(t){},ET.prototype.shutdown=function(){},ET.prototype.writeSequenceNumber=function(t){},ET);function ET(){this.localState=new vT,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var TT="FirestoreClient",ST=(IT.prototype.lruParams=function(){return Ag.withCacheSize(this.cacheSizeBytes)},IT);function IT(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var CT=function(){},NT=(AT.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new Vy,r=new Vy,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},AT.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},AT.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ST?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},AT.prototype.canFallback=function(t){return t instanceof qd?t.code===Ud.FAILED_PRECONDITION||t.code===Ud.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},AT.prototype.verifyNotShutdown=function(){if(this.asyncQueue.isShuttingDown)throw new qd(Ud.FAILED_PRECONDITION,"The client has already been shutdown.")},AT.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Vg.buildStoragePrefix(this.databaseInfo),i=new FE(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ci(n,void 0,void 0,function(){var n,o;return hi(this,function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!bT.isAvailable(this.platform))throw new qd(Ud.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.synchronizeTabs?(this.sharedClientState=new bT(this.asyncQueue,this.platform,r,this.clientId,t),[4,Vg.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=a.sent(),[3,4];case 2:return this.sharedClientState=new _T,[4,Vg.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent(),a.label=4;case 4:return[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},AT.prototype.startMemoryPersistence=function(){return this.persistence=Nw.createEagerPersistence(this.clientId),this.sharedClientState=new _T,Promise.resolve(null)},AT.prototype.initializeRest=function(t,e){var n=this;return kd(TT,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return ci(n,void 0,void 0,function(){var n,i,o,a,s,u=this;return hi(this,function(c){switch(c.label){case 0:return this.localStore=new vw(this.persistence,t),e&&(this.lruScheduler=new Dg(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),i=this.platform.newSerializer(this.databaseInfo.databaseId),o=new Zw(this.asyncQueue,r,this.credentials,i),a=function(t){return u.syncEngine.applyOnlineStateChange(t,r_.RemoteStore)},s=function(t){return u.syncEngine.applyOnlineStateChange(t,r_.SharedClientState)},this.remoteStore=new q_(this.localStore,o,this.asyncQueue,a,n),this.syncEngine=new eT(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new VE(this.syncEngine),[4,this.sharedClientState.start()];case 1:return c.sent(),[4,this.remoteStore.start()];case 2:return c.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return ci(u,void 0,void 0,function(){return hi(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return c.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ci(u,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return c.sent(),[2]}})})})},AT.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),kd(TT,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},AT.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},AT.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return ci(t,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},AT.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotShutdown();var e=new Vy;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},AT.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new jE(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},AT.prototype.unlisten=function(t){var e=this;this.clientShutdown||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},AT.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof lv)return t;if(t instanceof dv)return null;throw new qd(Ud.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},AT.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=Tm(),r=new zE(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},AT.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new Vy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},AT.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(AT.prototype,"clientShutdown",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),AT.prototype.transaction=function(t){var e=this;this.verifyNotShutdown();var n=new Vy;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},AT);function AT(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=hy.newId()}var kT=(DT.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},DT.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},DT.prototype.mute=function(){this.muted=!0},DT.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},DT);function DT(t){this.observer=t,this.muted=!1}var RT=(OT.documentId=function(){return OT._DOCUMENT_ID},OT.prototype.isEqual=function(t){if(!(t instanceof OT))throw sy("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},OT._DOCUMENT_ID=new OT(My.keyField().canonicalString()),OT);function OT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new qd(Ud.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+cy(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(Jd("FieldPath","string",n,t[n]),0===t[n].length)throw new qd(Ud.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new My(t)}var PT=new RegExp("[~\\*/\\[\\]]"),MT=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},xT=(LT.prototype.getToken=function(){return Promise.resolve(null)},LT.prototype.invalidateToken=function(){},LT.prototype.setChangeListener=function(t){Pd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(rT.UNAUTHENTICATED)},LT.prototype.removeChangeListener=function(){Pd(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},LT);function LT(){this.changeListener=null}var FT=(UT.prototype.getToken=function(){var t=this;Pd(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new qd(Ud.ABORTED,"getToken aborted due to token change.");return n?(Pd("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new MT(n.accessToken,t.currentUser)):null})},UT.prototype.invalidateToken=function(){this.forceRefresh=!0},UT.prototype.setChangeListener=function(t){Pd(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},UT.prototype.removeChangeListener=function(){Pd(null!=this.tokenListener,"removeChangeListener() called twice"),Pd(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},UT.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Pd(null===t||"string"==typeof t,"Received invalid UID: "+t),new rT(t)},UT);function UT(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=rT.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var qT=(Object.defineProperty(VT.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),VT);function VT(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=rT.FIRST_PARTY}var BT=(jT.prototype.getToken=function(){return Promise.resolve(new qT(this.gapi,this.sessionIndex))},jT.prototype.setChangeListener=function(t){t(rT.FIRST_PARTY)},jT.prototype.removeChangeListener=function(){},jT.prototype.invalidateToken=function(){},jT);function jT(t,e){this.gapi=t,this.sessionIndex=e}function WT(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var QT=(KT.delete=function(){return Gd("FieldValue.delete",arguments),GT.instance},KT.serverTimestamp=function(){return Gd("FieldValue.serverTimestamp",arguments),XT.instance},KT.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yd("FieldValue.arrayUnion",arguments,1),new ZT(t)},KT.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Yd("FieldValue.arrayRemove",arguments,1),new nS(t)},KT.increment=function(t){return Jd("FieldValue.increment","number",1,t),zd("FieldValue.increment",arguments,1),new oS(t)},KT.prototype.isEqual=function(t){return this===t},KT);function KT(t){this._methodName=t}var HT,GT=(si(zT,HT=QT),zT.instance=new zT,zT);function zT(){return HT.call(this,"FieldValue.delete")||this}var YT,XT=(si(JT,YT=QT),JT.instance=new JT,JT);function JT(){return YT.call(this,"FieldValue.serverTimestamp")||this}var $T,ZT=(si(tS,$T=QT),tS);function tS(t){var e=$T.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var eS,nS=(si(rS,eS=QT),rS);function rS(t){var e=eS.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var iS,oS=(si(aS,iS=QT),aS);function aS(t){var e=iS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var sS=Bd(QT,"Use FieldValue.<field>() instead."),uS=/^__.*__$/,cS=(hS.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new rw(t,this.data,this.fieldMask,e)):n.push(new tw(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new aw(t,this.fieldTransforms)),n},hS);function hS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var lS,fS,pS=(dS.prototype.toMutations=function(t,e){var n=[new rw(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new aw(t,this.fieldTransforms)),n},dS);function dS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function yS(t){switch(t){case lS.Set:case lS.MergeSet:case lS.Update:return!0;case lS.Argument:return!1;default:throw Od("Unexpected case for UserDataSource: "+t)}}(fS=lS=lS||{})[fS.Set=0]="Set",fS[fS.Update=1]="Update",fS[fS.MergeSet=2]="MergeSet",fS[fS.Argument=3]="Argument";var mS=(vS.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new vS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},vS.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new vS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},vS.prototype.childContextForArray=function(t){return new vS(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},vS.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new qd(Ud.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},vS.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},vS.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},vS.prototype.validatePathSegment=function(t){if(yS(this.dataSource)&&uS.test(t))throw this.createError("Document fields cannot begin and end with __")},vS);function vS(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var gS=function(t,e){this.databaseId=t,this.key=e},bS=(wS.prototype.parseSetData=function(t,e){var n=new mS(lS.Set,t,My.EMPTY_PATH);ES("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new cS(r,null,n.fieldTransforms)},wS.prototype.parseMergeData=function(t,e,n){var r=new mS(lS.MergeSet,t,My.EMPTY_PATH);ES("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new lm(My.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof RT)l=h._internalPath;else{if("string"!=typeof h)throw Od("Expected stringOrFieldPath to be a string or a FieldPath");l=SS(t,h)}if(!r.contains(l))throw new qd(Ud.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=jb.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=jb.fromArray(r.fieldMask),o=r.fieldTransforms;return new cS(a,i,o)},wS.prototype.parseUpdateData=function(t,e){var n=this,r=new mS(lS.Update,t,My.EMPTY_PATH);ES("Data must be an object, but it was:",r,e);var i=new lm(My.comparator),o=Fb.EMPTY;Kd(e,function(e,a){var s=SS(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof GT)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=jb.fromSet(i);return new pS(o,a,r.fieldTransforms)},wS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new mS(lS.Update,t,My.EMPTY_PATH),o=[TS(t,e)],a=[n];if(r.length%2!=0)throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(TS(t,r[s])),a.push(r[s+1]);var u=new lm(My.comparator),c=Fb.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof GT)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=jb.fromSet(u);return new pS(c,d,i.fieldTransforms)},wS.prototype.parseQueryValue=function(t,e){var n=new mS(lS.Argument,t,My.EMPTY_PATH),r=this.parseData(e,n);return Pd(null!=r,"Parsed data should not be null."),Pd(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},wS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=IS(t);throw e.createError(n)}},wS.prototype.parseData=function(t,e){if(_S(t=this.runPreConverter(t,e)))return ES("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof QT)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},wS.prototype.parseObject=function(t,e){var n=this,r=new rm(fy);return Hd(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):Kd(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Fb(r)},wS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=rb.INSTANCE),n.push(s),r++}return new Vb(n)},wS.prototype.parseSentinelFieldValue=function(t,e){if(!yS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof GT){if(e.dataSource!==lS.MergeSet)throw e.dataSource===lS.Update?(Pd(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof XT)e.fieldTransforms.push(new Qb(e.path,bE.instance));else if(t instanceof ZT){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new _E(n);e.fieldTransforms.push(new Qb(e.path,r))}else if(t instanceof nS){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new TE(n);e.fieldTransforms.push(new Qb(e.path,i))}else if(t instanceof oS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new IE(o);e.fieldTransforms.push(new Qb(e.path,a))}else Od("Unknown FieldValue type: "+t)},wS.prototype.parseScalarValue=function(t,e){if(null===t)return rb.INSTANCE;if("number"==typeof t)return qw(t)?new pb(t):new mb(t);if("boolean"==typeof t)return ab.of(t);if("string"==typeof t)return new bb(t);if(t instanceof Date)return new Eb(Zy.fromDate(t));if(t instanceof Zy)return new Eb(new Zy(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof B_)return new Mb(t);if(t instanceof vy)return new Ab(t);if(t instanceof gS)return new Rb(t.databaseId,t.key);throw e.createError("Unsupported field value: "+iy(t))},wS.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new mS(lS.Argument,t,My.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},wS);function wS(t){this.preConverter=t}function _S(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Zy||t instanceof B_||t instanceof vy||t instanceof gS||t instanceof QT)}function ES(t,e,n){if(!_S(n)||!ry(n)){var r=iy(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function TS(t,e){if(e instanceof RT)return e._internalPath;if("string"==typeof e)return SS(t,e);throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function SS(t,e){try{return function(t){if(0<=t.search(PT))throw new qd(Ud.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(RT.bind.apply(RT,[void 0].concat(t.split("."))))}catch(e){throw new qd(Ud.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=IS(e);throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function IS(t){return t instanceof Error?t.message:t.toString()}var CS=Ag.COLLECTION_DISABLED,NS=(AS.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},AS);function AS(t){if(void 0===t.host){if(void 0!==t.ssl)throw new qd(Ud.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Zd("settings","non-empty string","host",t.host),this.host=t.host,ty("settings","boolean","ssl",t.ssl),this.ssl=Wd(t.ssl,!0);if(ay("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),ty("settings","object","credentials",t.credentials),this.credentials=t.credentials,ty("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Dd("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Dd("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Wd(t.timestampsInSnapshots,!0),ty("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ag.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==CS&&t.cacheSizeBytes<Ag.MINIMUM_CACHE_SIZE_BYTES)throw new qd(Ud.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ag.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}ty("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var kS=(DS.prototype.settings=function(t){if(zd("Firestore.settings",arguments,1),Jd("Firestore.settings","object",1,t),jd(t,"persistence"))throw new qd(Ud.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new NS(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new qd(Ud.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new xT;switch(t.type){case"gapi":var e=t.client;return Pd(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new BT(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new qd(Ud.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},DS.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},DS.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},DS.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new qd(Ud.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Dd("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Wd(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new ST(this._settings.cacheSizeBytes,e))},DS.prototype.clearPersistence=function(){var t=this,e=Vg.buildStoragePrefix(this.makeDatabaseInfo()),n=new Vy;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return ci(t,void 0,void 0,function(){var t;return hi(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new qd(Ud.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Vg.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},DS.prototype._shutdown=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(DS.prototype,"_isShutdown",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientShutdown},enumerable:!0,configurable:!0}),DS.prototype._waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},DS.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new CT),this._firestoreClient},DS.prototype.makeDatabaseInfo=function(){return new wy(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},DS.prototype.configureClient=function(t){Pd(!!this._settings.host,"FirestoreSettings.host is not set"),Pd(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new NT(Md.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},DS.prototype.createDataConverter=function(t){return new bS(function(e){if(e instanceof xS){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new qd(Ud.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new gS(t,e._key)}return e})},DS.databaseIdFromApp=function(t){var e=t.options;if(!jd(e,"projectId"))throw new qd(Ud.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new qd(Ud.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ey(n)},Object.defineProperty(DS.prototype,"app",{get:function(){if(!this._firebaseApp)throw new qd(Ud.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),DS.prototype.collection=function(t){return zd("Firestore.collection",arguments,1),Jd("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new YS(Dy.fromString(t),this)},DS.prototype.doc=function(t){return zd("Firestore.doc",arguments,1),Jd("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),xS.forPath(Dy.fromString(t),this)},DS.prototype.collectionGroup=function(t){if(zd("Firestore.collectionGroup",arguments,1),Jd("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new qd(Ud.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new QS(new W_(Dy.EMPTY_PATH,t),this)},DS.prototype.runTransaction=function(t){var e=this;return zd("Firestore.runTransaction",arguments,1),Jd("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new RS(e,n))})},DS.prototype.batch=function(){return this.ensureClientConfigured(),new PS(this)},Object.defineProperty(DS,"logLevel",{get:function(){switch(Nd()){case vd.DEBUG:return"debug";case vd.ERROR:return"error";case vd.SILENT:return"silent";default:return Od("Unknown log level: "+Nd())}},enumerable:!0,configurable:!0}),DS.setLogLevel=function(t){switch(zd("Firestore.setLogLevel",arguments,1),Jd("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ad(vd.DEBUG);break;case"error":Ad(vd.ERROR);break;case"silent":Ad(vd.SILENT);break;default:throw new qd(Ud.INVALID_ARGUMENT,"Invalid log level: "+t)}},DS.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},DS);function DS(t){var e=this;if(this._firebaseApp=null,this._queue=new Wy,this.INTERNAL={delete:function(){return ci(e,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=DS.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new FT(n)}else{var r=t;if(!r.projectId)throw new qd(Ud.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Ey(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new xT}this._settings=new NS({}),this._dataConverter=this.createDataConverter(this._databaseId)}var RS=(OS.prototype.get=function(t){var e=this;zd("Transaction.get",arguments,1);var n=tI("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Od("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof dv)return new qS(e._firestore,n._key,null,!1,!1);if(r instanceof lv)return new qS(e._firestore,n._key,r,!1,!1);throw Od("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},OS.prototype.set=function(t,e,n){Xd("Transaction.set",arguments,2,3);var r=tI("Transaction.set",t,this._firestore),i=(n=JS("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},OS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof RT?(Yd("Transaction.update",arguments,3),r=tI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(zd("Transaction.update",arguments,2),r=tI("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},OS.prototype.delete=function(t){zd("Transaction.delete",arguments,1);var e=tI("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},OS);function OS(t,e){this._firestore=t,this._transaction=e}var PS=(MS.prototype.set=function(t,e,n){Xd("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=tI("WriteBatch.set",t,this._firestore),i=(n=JS("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Yb.NONE)),this},MS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof RT?(Yd("WriteBatch.update",arguments,3),r=tI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(zd("WriteBatch.update",arguments,2),r=tI("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Yb.exists(!0))),this},MS.prototype.delete=function(t){zd("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=tI("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new cw(e._key,Yb.NONE)),this},MS.prototype.commit=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},MS.prototype.verifyNotCommitted=function(){if(this._committed)throw new qd(Ud.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},MS);function MS(t){this._firestore=t,this._mutations=[],this._committed=!1}var xS=(LS.forPath=function(t,e){if(t.length%2!=0)throw new qd(Ud.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new LS(new Ly(t),e)},Object.defineProperty(LS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(LS.prototype,"parent",{get:function(){return new YS(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(LS.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),LS.prototype.collection=function(t){if(zd("DocumentReference.collection",arguments,1),Jd("DocumentReference.collection","non-empty string",1,t),!t)throw new qd(Ud.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Dy.fromString(t);return new YS(this._key.path.child(e),this.firestore)},LS.prototype.isEqual=function(t){if(!(t instanceof LS))throw sy("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},LS.prototype.set=function(t,e){Xd("DocumentReference.set",arguments,1,2);var n=(e=JS("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Yb.NONE))},LS.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof RT?(Yd("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(zd("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Yb.exists(!0)))},LS.prototype.delete=function(){return zd("DocumentReference.delete",arguments,0),this._firestoreClient.write([new cw(this._key,Yb.NONE)])},LS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Xd("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||WT(t[i])||(ay("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),ty("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=WT(t[i])?t[i]:(Jd("DocumentReference.onSnapshot","function",i,t[i]),$d("DocumentReference.onSnapshot","function",i+1,t[i+1]),$d("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},LS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new kT({next:function(t){if(e.next){Pd(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new qS(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(W_.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},LS.prototype.get=function(t){var e=this;return Xd("DocumentReference.get",arguments,0,1),ZS("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new qS(e.firestore,e._key,t,!0,t instanceof lv&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},LS.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new qd(Ud.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new qd(Ud.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},LS);function LS(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var FS=(US.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},US);function US(t,e){this.hasPendingWrites=t,this.fromCache=e}var qS=(VS.prototype.data=function(t){return Xd("DocumentSnapshot.data",arguments,0,1),t=$S("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,$g.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},VS.prototype.get=function(t,e){if(Xd("DocumentSnapshot.get",arguments,1,2),e=$S("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(TS("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,$g.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(VS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"ref",{get:function(){return new xS(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(VS.prototype,"metadata",{get:function(){return new FS(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),VS.prototype.isEqual=function(t){if(!(t instanceof VS))throw sy("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},VS.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},VS.prototype.convertValue=function(t,e){if(t instanceof Fb)return this.convertObject(t,e);if(t instanceof Vb)return this.convertArray(t,e);if(t instanceof Rb){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Dd("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new xS(n,this._firestore)}return t.value(e)},VS.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},VS);function VS(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var BS,jS=(si(WS,BS=qS),WS.prototype.data=function(t){var e=BS.prototype.data.call(this,t);return Pd("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},WS);function WS(){return null!==BS&&BS.apply(this,arguments)||this}var QS=(KS.prototype.where=function(t,e,n){zd("Query.where",arguments,3),oy("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new qd(Ud.INVALID_ARGUMENT,"Invalid value "+iy(r)+" provided to function Query.where() for its "+uy(2)+" argument. Acceptable values: "+e.join(", "))}(0,["<","<=","==",">=",">","array-contains"],0,e);var r,i=TS("Query.where",t),o=K_.fromString(e);if(i.isKeyField()){if(o===K_.ARRAY_CONTAINS||o===K_.ARRAY_CONTAINS_ANY)throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===K_.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Vb(a)}else r=this.parseDocumentIdValue(n)}else o!==K_.IN&&o!==K_.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=z_.create(i,o,r);return this.validateNewFilter(h),new KS(this._query.addFilter(h),this.firestore)},KS.prototype.orderBy=function(t,e){var n;if(Xd("Query.orderBy",arguments,1,2),$d("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=lE.ASCENDING;else{if("desc"!==e)throw new qd(Ud.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=lE.DESCENDING}if(null!==this._query.startAt)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=TS("Query.orderBy",t),i=new yE(r,n);return this.validateNewOrderBy(i),new KS(this._query.addOrderBy(i),this.firestore)},KS.prototype.limit=function(t){if(zd("Query.limit",arguments,1),Jd("Query.limit","number",1,t),t<=0)throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new KS(this._query.withLimit(t),this.firestore)},KS.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yd("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new KS(this._query.withStartAt(r),this.firestore)},KS.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yd("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new KS(this._query.withStartAt(r),this.firestore)},KS.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yd("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new KS(this._query.withEndAt(r),this.firestore)},KS.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Yd("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new KS(this._query.withEndAt(r),this.firestore)},KS.prototype.isEqual=function(t){if(!(t instanceof KS))throw sy("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},KS.prototype.boundFromDocOrFields=function(t,e,n,r){if(oy(t,1,e),e instanceof qS){if(0<n.length)throw new qd(Ud.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new qd(Ud.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},KS.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Rb(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Ib)throw new qd(Ud.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new pE(r,n)},KS.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new qd(Ud.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Dy.fromString(a));if(!Ly.isDocumentKey(s))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Ly(s);i.push(new Rb(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new pE(i,n)},KS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Xd("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||WT(t[i])||(ay("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),ty("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=WT(t[i])?t[i]:(Jd("Query.onSnapshot","function",i,t[i]),$d("Query.onSnapshot","function",i+1,t[i+1]),$d("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},KS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new kT({next:function(t){e.next&&e.next(new HS(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},KS.prototype.get=function(t){var e=this;return Xd("Query.get",arguments,0,1),ZS("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new HS(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},KS.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new qd(Ud.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},KS.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Dy.fromString(t));if(!Ly.isDocumentKey(e))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Rb(this.firestore._databaseId,new Ly(e))}if(t instanceof xS){var n=t;return new Rb(this.firestore._databaseId,n._key)}throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+iy(t)+".")},KS.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new qd(Ud.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},KS.prototype.validateNewFilter=function(t){if(t instanceof z_){var e=[K_.ARRAY_CONTAINS,K_.ARRAY_CONTAINS_ANY],n=[K_.IN,K_.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new qd(Ud.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new qd(Ud.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},KS.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},KS.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new qd(Ud.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},KS);function KS(t,e){this._query=t,this.firestore=e}var HS=(Object.defineProperty(GS.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),GS.prototype.forEach=function(t,e){var n=this;Xd("QuerySnapshot.forEach",arguments,1,2),Jd("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(GS.prototype,"query",{get:function(){return new QS(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),GS.prototype.docChanges=function(t){t&&(ay("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ty("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new qd(Ud.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new jS(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return Pd(e.type===p_.Added,"Invalid event type for first snapshot"),Pd(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==p_.Metadata}).map(function(e){var r=new jS(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==p_.Added&&(Pd(0<=(i=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),e.type!==p_.Removed&&(a=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case p_.Added:return"added";case p_.Modified:case p_.Metadata:return"modified";case p_.Removed:return"removed";default:return Od("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},GS.prototype.isEqual=function(t){if(!(t instanceof GS))throw sy("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},GS.prototype.convertToDocumentImpl=function(t){return new jS(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},GS);function GS(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new FS(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(HS.prototype.docChanges,t,{get:function(){return function(){throw new qd(Ud.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var zS,YS=(si(XS,zS=QS),Object.defineProperty(XS.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(XS.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new xS(new Ly(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(XS.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),XS.prototype.doc=function(t){if(Xd("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=hy.newId()),Jd("CollectionReference.doc","non-empty string",1,t),""===t)throw new qd(Ud.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Dy.fromString(t);return xS.forPath(this._query.path.child(e),this.firestore)},XS.prototype.add=function(t){zd("CollectionReference.add",arguments,1),Jd("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},XS);function XS(t,e){var n=zS.call(this,W_.atPath(t),e)||this;if(t.length%2!=1)throw new qd(Ud.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function JS(t,e){if(void 0===e)return{merge:!1};if(ay(t,e,["merge","mergeFields"]),ty(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+iy(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new qd(Ud.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+iy(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof RT}),void 0!==e.mergeFields&&void 0!==e.merge)throw new qd(Ud.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function $S(t,e){return void 0===e?{}:(ay(t,e,["serverTimestamps"]),ey(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ZS(t,e){$d(t,"object",1,e),e&&(ay(t,e,["source"]),ey(t,0,"source",e.source,["default","server","cache"]))}function tI(t,e,n){if(e instanceof xS){if(e.firestore!==n)throw new qd(Ud.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw sy(t,"DocumentReference",1,e)}var eI=Bd(kS,"Use firebase.firestore() instead."),nI=Bd(RS,"Use firebase.firestore().runTransaction() instead."),rI=Bd(PS,"Use firebase.firestore().batch() instead."),iI=Bd(xS,"Use firebase.firestore().doc() instead."),oI=Bd(qS),aI=Bd(jS),sI=Bd(QS),uI=Bd(HS),cI=Bd(YS,"Use firebase.firestore().collection() instead."),hI={Firestore:eI,GeoPoint:B_,Timestamp:Zy,Blob:by,Transaction:nI,WriteBatch:rI,DocumentReference:iI,DocumentSnapshot:oI,Query:sI,QueryDocumentSnapshot:aI,QuerySnapshot:uI,CollectionReference:cI,FieldPath:RT,FieldValue:sS,setLogLevel:kS.setLogLevel,CACHE_SIZE_UNLIMITED:CS},lI=(fI.prototype.addCallback=function(t){},fI.prototype.shutdown=function(){},fI);function fI(){}var pI="ConnectivityMonitor",dI=(yI.prototype.addCallback=function(t){this.callbacks.push(t)},yI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},yI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},yI.prototype.onNetworkAvailable=function(){kd(pI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},yI.prototype.onNetworkUnavailable=function(){kd(pI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},yI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},yI);function yI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var mI=(vI.prototype.onOpen=function(t){Pd(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},vI.prototype.onClose=function(t){Pd(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},vI.prototype.onMessage=function(t){Pd(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},vI.prototype.close=function(){this.closeFn()},vI.prototype.send=function(t){this.sendFn(t)},vI.prototype.callOnOpen=function(){Pd(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},vI.prototype.callOnClose=function(t){Pd(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},vI.prototype.callOnMessage=function(t){Pd(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},vI);function vI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var gI="Connection",bI={BatchGetDocuments:"batchGet",Commit:"commit"},wI="gl-js/ fire/"+Id,_I=(EI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=wI},EI.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new Sd;s.listenOnce(Ed.COMPLETE,function(){try{switch(s.getLastErrorCode()){case _d.NO_ERROR:var e=s.getResponseJson();kd(gI,"XHR received:",JSON.stringify(e)),o(e);break;case _d.TIMEOUT:kd(gI,'RPC "'+t+'" timed out'),a(new qd(Ud.DEADLINE_EXCEEDED,"Request time out"));break;case _d.HTTP_ERROR:var n=s.getStatus();if(kd(gI,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=function(t){var e=r.status.toLowerCase().replace("_","-");return 0<=Object.values(Ud).indexOf(e)?e:Ud.UNKNOWN}();a(new qd(i,r.message))}else a(new qd(Ud.UNKNOWN,"Server responded with status "+s.getStatus()))}else kd(gI,'RPC "'+t+'" failed'),a(new qd(Ud.UNAVAILABLE,"Connection failed."));break;default:Od('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{kd(gI,'RPC "'+t+'" completed.')}});var u=JSON.stringify(e);kd(gI,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},EI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},EI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=wd(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ci()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}kd(gI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new mI({sendFn:function(t){c?kd(gI,"Not sending because WebChannel is closed:",t):(u||(kd(gI,"Opening WebChannel transport."),s.open(),u=!0),kd(gI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Td.EventType.OPEN,function(){c||kd(gI,"WebChannel transport opened.")}),a(Td.EventType.CLOSE,function(){c||(c=!0,kd(gI,"WebChannel transport closed"),h.callOnClose())}),a(Td.EventType.ERROR,function(t){c||(c=!0,kd(gI,"WebChannel transport errored:",t),h.callOnClose(new qd(Ud.UNAVAILABLE,"The operation could not be completed")))}),a(Td.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Pd(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){kd(gI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=s_[i];if(void 0!==e)return f_(e)}(),a=r.message;void 0===o&&(o=Ud.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new qd(o,a)),s.close()}else kd(gI,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},EI.prototype.makeUrl=function(t){var e=bI[t];Pd(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},EI);function EI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var TI=(Object.defineProperty(SI.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(SI.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),SI.prototype.loadConnection=function(t){return Promise.resolve(new _I(t))},SI.prototype.newConnectivityMonitor=function(){return dI.isAvailable()?new dI:new lI},SI.prototype.newSerializer=function(t){return new FE(t,{useProto3Json:!0})},SI.prototype.formatJSON=function(t){return JSON.stringify(t)},SI.prototype.atob=function(t){return atob(t)},SI.prototype.btoa=function(t){return btoa(t)},SI);function SI(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Md.setPlatform(new TI),function(t){t.INTERNAL.registerService("firestore",function(t){return new kS(t)},function(t){Pd(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(hI))}(mo);var II,CI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},NI=(si(AI,II=Error),AI);function AI(t,e,n){var r=II.call(this,e)||this;return Object.setPrototypeOf(r,AI.prototype),r.code=t,r.details=n,r}var kI=(DI.prototype.getAuthToken=function(){return ci(this,void 0,void 0,function(){var t;return hi(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},DI.prototype.getInstanceIdToken=function(){return ci(this,void 0,void 0,function(){var t;return hi(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},DI.prototype.getContext=function(){return ci(this,void 0,void 0,function(){var t,e;return hi(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},DI);function DI(t){this.app=t}function RI(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var OI=(PI.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return RI(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},PI.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?RI(t,function(t){return e.decode(t)}):t},PI);function PI(){}var MI,xI,LI=(Object.defineProperty(FI.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),FI.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},FI.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},FI.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},FI.prototype.postJSON=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i;return hi(this,function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}})})},FI.prototype.call=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h;return hi(this,function(l){switch(l.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=l.sent()).authToken&&o.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&o.append("Firebase-Instance-ID-Token",a.instanceIdToken),s=n.timeout||7e4,[4,Promise.race([this.postJSON(r,i,o),function(t){return new Promise(function(e,n){setTimeout(function(){n(new NI("deadline-exceeded","deadline-exceeded"))},t)})}(s),this.cancelAllRequests])];case 2:if(!(u=l.sent()))throw new NI("cancelled","Firebase Functions instance was deleted.");if(c=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!CI[s])return new NI("internal","internal");r=CI[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new NI(r,i,o)}(u.status,u.json,this.serializer))throw c;if(!u.json)throw new NI("internal","Response is not valid JSON object.");if(void 0===(h=u.json.data)&&(h=u.json.result),void 0===h)throw new NI("internal","Response is missing data field.");return[2,{data:this.serializer.decode(h)}]}})})},FI);function FI(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new OI,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new kI(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}MI={Functions:LI},mo.INTERNAL.registerService("functions",function(t,e,n){return new LI(t,n)},MI,void 0,!0);var UI,qI,VI,BI,jI=((xI={})["only-available-in-window"]="This method is available in a Window context.",xI["only-available-in-sw"]="This method is available in a service worker context.",xI["should-be-overriden"]="This method should be overriden by extended classes.",xI["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",xI["permission-default"]="The required permissions were not granted and dismissed instead.",xI["permission-blocked"]="The required permissions were not granted and blocked instead.",xI["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",xI["notifications-blocked"]="Notifications have been blocked.",xI["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",xI["sw-registration-expected"]="A service worker registration was the expected input.",xI["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",xI["invalid-saved-token"]="Unable to access details of the saved token.",xI["sw-reg-redundant"]="The service worker being used for push was made redundant.",xI["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",xI["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",xI["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",xI["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",xI["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",xI["token-update-no-token"]="FCM returned no token when updating the user to push.",xI["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",xI["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",xI["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",xI["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",xI["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",xI["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",xI["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",xI["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",xI["failed-to-delete-token"]="Unable to delete the currently saved token.",xI["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",xI["bad-scope"]="The service worker scope must be a string with at least one character.",xI["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",xI["bad-subscription"]="The subscription must be a valid PushSubscription.",xI["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",xI["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",xI["failed-delete-vapid-key"]="The VAPID key could not be deleted.",xI["invalid-public-vapid-key"]="The public VAPID key must be a string.",xI["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",xI["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",xI),WI=new Ri("messaging","Messaging",jI),QI=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),KI="https://fcm.googleapis.com";function HI(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function GI(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,pi(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(qI=UI=UI||{}).TYPE_OF_MSG="firebase-messaging-msg-type",qI.DATA="firebase-messaging-msg-data",(BI=VI=VI||{}).PUSH_MSG_RECEIVED="push-msg-received",BI.NOTIFICATION_CLICKED="notification-clicked";var zI=(YI.prototype.getToken=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h,l;return hi(this,function(f){switch(f.label){case 0:r=GI(e.getKey("p256dh")),i=GI(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,HI(n.buffer,QI.buffer)||(a=GI(n),o+="&application_pub_key="+a),(s=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:s,body:o},f.label=1;case 1:return f.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/subscribe",u)];case 2:return[4,f.sent().json()];case 3:return c=f.sent(),[3,5];case 4:throw h=f.sent(),WI.create("token-subscribe-failed",{errorInfo:h});case 5:if(c.error)throw l=c.error.message,WI.create("token-subscribe-failed",{errorInfo:l});if(!c.token)throw WI.create("token-subscribe-no-token");if(!c.pushSet)throw WI.create("token-subscribe-no-push-set");return[2,{token:c.token,pushSet:c.pushSet}]}})})},YI.prototype.updateToken=function(t,e,n,r,i){return ci(this,void 0,void 0,function(){var o,a,s,u,c,h,l,f,p;return hi(this,function(d){switch(d.label){case 0:o=GI(r.getKey("p256dh")),a=GI(r.getKey("auth")),s="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+a,HI(i.buffer,QI.buffer)||(u=GI(i),s+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:s},d.label=1;case 1:return d.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/subscribe",h)];case 2:return[4,d.sent().json()];case 3:return l=d.sent(),[3,5];case 4:throw f=d.sent(),WI.create("token-update-failed",{errorInfo:f});case 5:if(l.error)throw p=l.error.message,WI.create("token-update-failed",{errorInfo:p});if(!l.token)throw WI.create("token-update-no-token");return[2,l.token]}})})},YI.prototype.deleteToken=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i,o,a,s,u;return hi(this,function(c){switch(c.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/unsubscribe",o)];case 2:return[4,c.sent().json()];case 3:if((a=c.sent()).error)throw s=a.error.message,WI.create("token-unsubscribe-failed",{errorInfo:s});return[3,5];case 4:throw u=c.sent(),WI.create("token-unsubscribe-failed",{errorInfo:u});case 5:return[2]}})})},YI);function YI(){}function XI(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var JI="undefined",$I="fcm_token_object_Store",ZI=(tC.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},tC.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},tC.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},tC.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},tC.prototype.closeDatabase=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},tC.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),ci(this,void 0,void 0,function(){var n,r,i,o;return hi(this,function(a){switch(a.label){case 0:return[4,this.getDb()];case 1:return n=a.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}(t(i))];case 2:return o=a.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}})})},tC.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},tC);function tC(){this.dbPromise=null}var eC,nC=(si(rC,eC=ZI),rC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:!function(){var t=indexedDB.open(JI);t.onerror=function(t){},t.onsuccess=function(e){!function(t){if(t.objectStoreNames.contains($I)){var e=t.transaction($I).objectStore($I),n=new zI,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(JI)}}}(t.result)}}();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=ui({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=XI(e.vapidKey)),"string"==typeof e.auth&&(n.auth=XI(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=XI(e.p256dh).buffer),t.update(n),t.continue()}}}},rC.prototype.getTokenDetailsFromToken=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){if(!t)throw WI.create("bad-token");return iC({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},rC.prototype.getTokenDetailsFromSWScope=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){if(!t)throw WI.create("bad-scope");return iC({swScope:t}),[2,this.get(t)]})})},rC.prototype.saveTokenDetails=function(t){return ci(this,void 0,void 0,function(){return hi(this,function(e){if(!t.swScope)throw WI.create("bad-scope");if(!t.vapidKey)throw WI.create("bad-vapid-key");if(!t.endpoint||!t.auth||!t.p256dh)throw WI.create("bad-subscription");if(!t.fcmSenderId)throw WI.create("bad-sender-id");if(!t.fcmToken)throw WI.create("bad-token");if(!t.fcmPushSet)throw WI.create("bad-push-set");return iC(t),[2,this.put(t)]})})},rC.prototype.deleteToken=function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(WI.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw WI.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},rC);function rC(){var t=null!==eC&&eC.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function iC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw WI.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw WI.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw WI.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw WI.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw WI.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw WI.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw WI.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw WI.create("bad-push-set")}var oC,aC=(si(sC,oC=ZI),sC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},sC.prototype.getVapidFromSWScope=function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw WI.create("bad-scope");return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},sC.prototype.saveVapidDetails=function(t,e){return ci(this,void 0,void 0,function(){var n;return hi(this,function(r){if("string"!=typeof t||0===t.length)throw WI.create("bad-scope");if(null===e||65!==e.length)throw WI.create("bad-vapid-key");return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},sC.prototype.deleteVapidDetails=function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw WI.create("delete-scope-not-found");return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},sC);function sC(){var t=null!==oC&&oC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var uC="messagingSenderId",cC=(hC.prototype.getToken=function(){return ci(this,void 0,void 0,function(){var t,e,n,r,i;return hi(this,function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw WI.create("notifications-blocked");return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}})})},hC.prototype.manageExistingToken=function(t,e,n,r){return ci(this,void 0,void 0,function(){return hi(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!HI(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=HI(t.getKey("auth"),n.auth),o=HI(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}})})},hC.prototype.updateToken=function(t,e,n,r){return ci(this,void 0,void 0,function(){var i,o,a;return hi(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=s.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return s.sent(),[2,i];case 4:return a=s.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw s.sent(),a;case 6:return[2]}})})},hC.prototype.getNewToken=function(t,e,n){return ci(this,void 0,void 0,function(){var r,i;return hi(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}})})},hC.prototype.deleteToken=function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},hC.prototype.deleteTokenFromDB=function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}})})},hC.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then(function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})})},hC.prototype.requestPermission=function(){throw WI.create("only-available-in-window")},hC.prototype.useServiceWorker=function(t){throw WI.create("only-available-in-window")},hC.prototype.usePublicVapidKey=function(t){throw WI.create("only-available-in-window")},hC.prototype.onMessage=function(t,e,n){throw WI.create("only-available-in-window")},hC.prototype.onTokenRefresh=function(t,e,n){throw WI.create("only-available-in-window")},hC.prototype.setBackgroundMessageHandler=function(t){throw WI.create("only-available-in-sw")},hC.prototype.delete=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},hC.prototype.getNotificationPermission_=function(){return Notification.permission},hC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},hC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},hC.prototype.getIidModel=function(){return this.iidModel},hC);function hC(t){var e=this;if(!t.options[uC]||"string"!=typeof t.options[uC])throw WI.create("bad-sender-id");this.messagingSenderId=t.options[uC],this.tokenDetailsModel=new nC,this.vapidDetailsModel=new aC,this.iidModel=new zI,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var lC,fC="FCM_MSG",pC=(si(dC,lC=cC),dC.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},dC.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},dC.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},dC.prototype.onPush_=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i,o,a;return hi(this,function(s){switch(s.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(s){return[2]}return[4,this.hasVisibleClients_()];case 1:return s.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=s.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return s.sent(),[2];case 5:return[2]}})})},dC.prototype.onSubChange_=function(t){return ci(this,void 0,void 0,function(){var t,e,n,r;return hi(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),WI.create("unable-to-resubscribe",{errorInfo:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},dC.prototype.onNotificationClick_=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i;return hi(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data[fC]?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data[fC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=mC(VI.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},dC.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=ui({},t.notification);return n.data=ui({},t.notification.data,((e={})[fC]=t,e)),n}},dC.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw WI.create("bg-handler-function-expected");this.bgMessageHandler=t},dC.prototype.getWindowClient_=function(t){return ci(this,void 0,void 0,function(){var e,n,r,i;return hi(this,function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,yC()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},dC.prototype.attemptToMessageClient_=function(t,e){return ci(this,void 0,void 0,function(){return hi(this,function(n){if(!t)throw WI.create("no-window-client-to-msg");return t.postMessage(e),[2]})})},dC.prototype.hasVisibleClients_=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){switch(t.label){case 0:return[4,yC()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},dC.prototype.sendMessageToWindowClients_=function(t){return ci(this,void 0,void 0,function(){var e,n,r=this;return hi(this,function(i){switch(i.label){case 0:return[4,yC()];case 1:return e=i.sent(),n=mC(VI.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},dC.prototype.getSWRegistration_=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return[2,self.registration]})})},dC.prototype.getPublicVapidKey_=function(){return ci(this,void 0,void 0,function(){var t,e;return hi(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw WI.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,QI]:[2,e]}})})},dC);function dC(t){var e=lC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function yC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function mC(t,e){var n;return(n={})[UI.TYPE_OF_MSG]=t,n[UI.DATA]=e,n}var vC,gC,bC=(si(wC,vC=cC),wC.prototype.requestPermission=function(){return ci(this,void 0,void 0,function(){var t;return hi(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?WI.create("permission-blocked"):WI.create("permission-default")}})})},wC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw WI.create("sw-registration-expected");if(null!=this.registrationToUse)throw WI.create("use-sw-before-get-token");this.registrationToUse=t},wC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw WI.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw WI.create("use-public-key-before-get-token");var e=XI(t);if(65!==e.length)throw WI.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},wC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},wC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},wC.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(WI.create("sw-reg-redundant"))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(WI.create("sw-reg-redundant"));else n(t);else r(WI.create("no-sw-in-reg"))})},wC.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw WI.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},wC.prototype.getPublicVapidKey_=function(){return ci(this,void 0,void 0,function(){return hi(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,QI]})})},wC.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[UI.TYPE_OF_MSG]){var n=e.data;switch(n[UI.TYPE_OF_MSG]){case VI.PUSH_MSG_RECEIVED:case VI.NOTIFICATION_CLICKED:var r=n[UI.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},wC);function wC(t){var e=vC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Wi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Wi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function _C(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}gC={isSupported:_C},mo.INTERNAL.registerService("messaging",function(t){if(!_C())throw WI.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new pC(t):new bC(t)},gC);var EC="firebasestorage.googleapis.com",TC="storageBucket",SC=(IC.prototype.codeProp=function(){return this.code},IC.prototype.codeEquals=function(t){return NC(t)===this.codeProp()},IC.prototype.serverResponseProp=function(){return this.serverResponse_},IC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(IC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),IC);function IC(t,e){this.code_=NC(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var CC={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function NC(t){return"storage/"+t}function AC(){return new SC(CC.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function kC(){return new SC(CC.CANCELED,"User canceled the upload/download.")}function DC(){return new SC(CC.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function RC(t,e,n){return new SC(CC.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function OC(){return new SC(CC.APP_DELETED,"The Firebase app was deleted.")}function PC(t,e){return new SC(CC.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function MC(t){throw new SC(CC.INTERNAL_ERROR,"Internal error: "+t)}var xC={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function LC(t){switch(t){case xC.RAW:case xC.BASE64:case xC.BASE64URL:case xC.DATA_URL:return;default:throw"Expected one of the event types: ["+xC.RAW+", "+xC.BASE64+", "+xC.BASE64URL+", "+xC.DATA_URL+"]."}}var FC=function(t,e){this.data=t,this.contentType=e||null};function UC(t,e){switch(t){case xC.RAW:return new FC(qC(e));case xC.BASE64:case xC.BASE64URL:return new FC(VC(t,e));case xC.DATA_URL:return new FC(function(t){var e=new WC(t);return e.base64?VC(xC.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw PC(xC.DATA_URL,"Malformed data URL.")}return qC(e)}(e.rest)}(e),new WC(e).contentType)}throw AC()}function qC(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function VC(t,e){switch(t){case xC.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw PC(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case xC.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw PC(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw PC(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var BC,jC,WC=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw PC(xC.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)},QC={STATE_CHANGED:"state_changed"},KC="running",HC="pausing",GC="paused",zC="success",YC="canceling",XC="canceled",JC="error",$C={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ZC(t){switch(t){case KC:case HC:case YC:return $C.RUNNING;case GC:return $C.PAUSED;case zC:return $C.SUCCESS;case XC:return $C.CANCELED;case JC:default:return $C.ERROR}}function tN(t){return null!=t}function eN(t){return void 0!==t}function nN(t){return"function"==typeof t}function rN(t){return"object"==typeof t}function iN(t){return"string"==typeof t||t instanceof String}function oN(t){return"number"==typeof t||t instanceof Number}function aN(t){return sN()&&t instanceof Blob}function sN(){return"undefined"!=typeof Blob}(jC=BC=BC||{})[jC.NO_ERROR=0]="NO_ERROR",jC[jC.NETWORK_ERROR=1]="NETWORK_ERROR",jC[jC.ABORT=2]="ABORT";var uN=(cN.prototype.send=function(t,e,n,r){if(this.sent_)throw MC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),tN(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return tN(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},cN.prototype.getErrorCode=function(){if(!this.sent_)throw MC("cannot .getErrorCode() before sending");return this.errorCode_},cN.prototype.getStatus=function(){if(!this.sent_)throw MC("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},cN.prototype.getResponseText=function(){if(!this.sent_)throw MC("cannot .getResponseText() before sending");return this.xhr_.responseText},cN.prototype.abort=function(){this.xhr_.abort()},cN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},cN.prototype.addUploadProgressListener=function(t){tN(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},cN.prototype.removeUploadProgressListener=function(t){tN(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},cN);function cN(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=BC.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=BC.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=BC.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}var hN=(lN.prototype.createXhrIo=function(){return new uN},lN);function lN(){}function fN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(sN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var pN=(dN.prototype.size=function(){return this.size_},dN.prototype.type=function(){return this.type_},dN.prototype.slice=function(t,e){if(aN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new dN(n)}return new dN(new Uint8Array(this.data_.buffer,t,e-t),!0)},dN.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(sN()){var n=t.map(function(t){return t instanceof dN?t.data_:t});return new dN(fN.apply(null,n))}var r=t.map(function(t){return iN(t)?UC(xC.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new dN(o,!0)},dN.prototype.uploadData=function(){return this.data_},dN);function dN(t,e){var n=0,r="";aN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var yN=(Object.defineProperty(mN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(mN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),mN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},mN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},mN.makeFromBucketSpec=function(t){var e;try{e=mN.makeFromUrl(t)}catch(e){return new mN(t,"")}if(""===e.path)return e;throw function(t){return new SC(CC.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(t)},mN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=EC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new mN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new SC(CC.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},mN);function mN(t,e){this.bucket=t,this.path_=e}function vN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return rN(t)&&!Array.isArray(t)}(e)?e:null}function gN(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function bN(t){return"https://"+EC+"/v0"+t}function wN(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}function _N(t,e){return e}var EN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||_N},TN=null;function SN(t,e,n){var r=vN(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new yN(n,r);return e.makeStorageReference(i)}})}(r,t),r}(t,r,n)}function IN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function CN(t){if(!rN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!rN(n))throw"Expected object for 'customMetadata' mapping."}else if(rN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var NN="maxResults",AN=1e3,kN="pageToken",DN="prefixes",RN="items";function ON(t){if(!rN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===NN){if(!oN(n=t[NN])||!Number.isInteger(n)||t[NN]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[NN])throw"Expected maxResults to be less than or equal to "+AN+"."}else{if(e!==kN)throw"Unknown option: "+e;if(t[kN]&&!iN(t[kN]))throw"Expected pageToken to be string."}var n}var PN=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function MN(t){if(!t)throw AC()}function xN(t,e){return function(n,r){var i=SN(t,r,e);return MN(null!==i),i}}function LN(t){return function(e,n){var r=function(t,e){var n=vN(e);return null===n?null:function(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new SC(CC.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+TC+"' property when initializing the app?");if(e[DN])for(var i=0,o=e[DN];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new yN(r,a));n.prefixes.push(s)}if(e[RN])for(var u=0,c=e[RN];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new yN(r,h.name)),n.items.push(s)}return n}(t,n)}(t,n);return MN(null!==r),r}}function FN(t,e){return function(n,r){var i=SN(t,r,e);return MN(null!==i),function(t,e){var n=vN(e);if(null===n)return null;if(!iN(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return bN("/b/"+i(n)+"/o/"+i(r))+wN({alt:"media",token:e})})[0]}(i,r)}}function UN(t){return function(e,n){var r;return(r=401===e.getStatus()?new SC(CC.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?function(t){return new SC(CC.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(t.bucket):403===e.getStatus()?function(t){return new SC(CC.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(t.path):n).setServerResponseProp(n.serverResponseProp()),r}}function qN(t){var e=UN(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=function(t){return new SC(CC.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(t.path)),i.setServerResponseProp(r.serverResponseProp()),i}}function VN(t,e,n){var r=bN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new PN(r,"GET",xN(t,n),i);return o.errorHandler=qN(e),o}function BN(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var jN=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function WN(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){MN(!1)}return MN(!!n&&-1!==(e||["active"]).indexOf(n)),n}var QN=function(t,e,n){if(nN(t)||tN(e)||tN(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},KN=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function HN(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new SC(CC.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,t,n.length);for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?RC(o,t,e.message):RC(o,t,e)}}var GN=function(t,e){var n=this;this.validator=function(e){n.optional&&!eN(e)||t(e)},this.optional=!!e};function zN(t,e){function n(t){if(!iN(t))throw"Expected string."}var r;return r=t?function(t,e){return function(n){t(n),e(n)}}(n,t):n,new GN(r,e)}function YN(t){return new GN(CN,t)}function XN(){return new GN(function(t){if(!(oN(t)&&0<=t))throw"Expected a number 0 or greater."})}function JN(t,e){return new GN(function(e){if(!(null===e||tN(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function $N(t){return new GN(function(t){if(null!==t&&!nN(t))throw"Expected a Function."},t)}function ZN(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var tA=(eA.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},eA.prototype.shouldDoResumable_=function(t){return 262144<t.size()},eA.prototype.start_=function(){this.state_===KC&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},eA.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case KC:t(n);break;case YC:e.transition_(XC);break;case HC:e.transition_(GC)}})},eA.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=BN(e,r,i),s={name:a.fullPath},u=bN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=IN(a,n),l=t.maxUploadRetryTime(),f=new PN(u,"POST",function(t){var e;WN(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){MN(!1)}return MN(iN(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=UN(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},eA.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new PN(n,"POST",function(t){var e=WN(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){MN(!1)}n||MN(!1);var i=Number(n);return MN(!isNaN(i)),new jN(i,r.size(),"final"===e)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=UN(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);(t.request_=i).getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},eA.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new jN(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=function(t,e,n,r,i,o,a,s){var u=new jN(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new SC(CC.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;0<i&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw DC();var y=e.maxUploadRetryTime(),m=new PN(n,"POST",function(t,n){var i,a=WN(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?xN(e,o)(t,n):null,new jN(s,c,"final"===a,i)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=s||null,m.errorHandler=UN(t),m}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(i){return t.error_=i,void t.transition_(JC)}var a=t.authWrapper_.makeRequest(o,i);(t.request_=a).getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(zC)):t.completeTransitions_()},t.errorHandler_)})},eA.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},eA.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=VN(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(zC)},t.metadataErrorHandler_)})},eA.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=BN(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+IN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=pN.getBlob(c,r,h);if(null===l)throw DC();var f={name:u.fullPath},p=bN(o),d=t.maxUploadRetryTime(),y=new PN(p,"POST",xN(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=UN(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(zC)},t.errorHandler_)})},eA.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},eA.prototype.transition_=function(t){if(this.state_!==t)switch(t){case YC:case HC:this.state_=t,null!==this.request_&&this.request_.cancel();break;case KC:var e=this.state_===GC;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case GC:this.state_=t,this.notifyObservers_();break;case XC:this.error_=kC(),this.state_=t,this.notifyObservers_();break;case JC:case zC:this.state_=t,this.notifyObservers_()}},eA.prototype.completeTransitions_=function(){switch(this.state_){case HC:this.transition_(GC);break;case YC:this.transition_(XC);break;case KC:this.start_()}},Object.defineProperty(eA.prototype,"snapshot",{get:function(){var t=ZC(this.state_);return new KN(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),eA.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=$N(!0).validator,a=JN(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(eN(t.next)||eN(t.error)||eN(t.complete)))throw"";return}catch(t){throw i}}HN("on",[zN(function(){if(t!==QC.STATE_CHANGED)throw"Expected one of the event types: ["+QC.STATE_CHANGED+"]."}),JN(s,!0),$N(!0),$N(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&HN("on",t,arguments);var o=new QN(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[JN(function(t){if(null===t)throw i;s(t)}),$N(!0),$N(!0)];return eN(e)||eN(n)||eN(r)?c(null)(e,n,r):c(h)},eA.prototype.then=function(t,e){return this.promise_.then(t,e)},eA.prototype.catch=function(t){return this.then(null,t)},eA.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},eA.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},eA.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach(function(e){t.notifyObserver_(e)})},eA.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(ZC(this.state_)){case $C.SUCCESS:ZN(this.resolve_.bind(null,this.snapshot))();break;case $C.CANCELED:case $C.ERROR:ZN(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},eA.prototype.notifyObserver_=function(t){switch(ZC(this.state_)){case $C.RUNNING:case $C.PAUSED:t.next&&ZN(t.next.bind(t,this.snapshot))();break;case $C.SUCCESS:t.complete&&ZN(t.complete.bind(t))();break;case $C.CANCELED:case $C.ERROR:t.error&&ZN(t.error.bind(t,this.error_))();break;default:t.error&&ZN(t.error.bind(t,this.error_))()}},eA.prototype.resume=function(){HN("resume",[],arguments);var t=this.state_===GC||this.state_===HC;return t&&this.transition_(KC),t},eA.prototype.pause=function(){HN("pause",[],arguments);var t=this.state_===KC;return t&&this.transition_(HC),t},eA.prototype.cancel=function(){HN("cancel",[],arguments);var t=this.state_===KC||this.state_===HC;return t&&this.transition_(YC),t},eA);function eA(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=KC,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(CC.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(JC))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(CC.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(JC))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var nA=(rA.prototype.toString=function(){return HN("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},rA.prototype.newRef=function(t,e){return new rA(t,e)},rA.prototype.mappings=function(){return function(){if(TN)return TN;var t=[];t.push(new EN("bucket")),t.push(new EN("generation")),t.push(new EN("metageneration")),t.push(new EN("name","fullPath",!0));var e=new EN("name");e.xform=function(t,e){return function(t){return!iN(t)||t.length<2?t:gN(t)}(e)},t.push(e);var n=new EN("size");return n.xform=function(t,e){return tN(e)?Number(e):e},t.push(n),t.push(new EN("timeCreated")),t.push(new EN("updated")),t.push(new EN("md5Hash",null,!0)),t.push(new EN("cacheControl",null,!0)),t.push(new EN("contentDisposition",null,!0)),t.push(new EN("contentEncoding",null,!0)),t.push(new EN("contentLanguage",null,!0)),t.push(new EN("contentType",null,!0)),t.push(new EN("metadata","customMetadata",!0)),TN=t}()},rA.prototype.child=function(t){HN("child",[zN()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new yN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(rA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new yN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(rA.prototype,"root",{get:function(){var t=new yN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(rA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(rA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(rA.prototype,"name",{get:function(){return gN(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(rA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),rA.prototype.put=function(t,e){return void 0===e&&(e=null),HN("put",[new GN(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||sN()&&t instanceof Blob))throw"Expected Blob or File."}),YN(!0)],arguments),this.throwIfRoot_("put"),new tA(this,this.authWrapper,this.location,this.mappings(),new pN(t),e)},rA.prototype.putString=function(t,e,n){void 0===e&&(e=xC.RAW),HN("putString",[zN(),zN(LC,!0),YN(!0)],arguments),this.throwIfRoot_("putString");var r=UC(e,t),i=Object.assign({},n);return!tN(i.contentType)&&tN(r.contentType)&&(i.contentType=r.contentType),new tA(this,this.authWrapper,this.location,this.mappings(),new pN(r.data,!0),i)},rA.prototype.delete=function(){var t=this;return HN("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=bN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new PN(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=qN(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},rA.prototype.listAll=function(){HN("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},rA.prototype.listAllHelper=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o;return hi(this,function(a){switch(a.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=a.sent(),(i=t.prefixes).push.apply(i,r.prefixes),(o=t.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},rA.prototype.list=function(t){HN("list",[new GN(ON,!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=t||{},i=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",0<"/".length&&(o.delimiter="/"),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=bN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new PN(a,"GET",LN(t),s);return u.urlParams=o,u.errorHandler=UN(e),u}(e.authWrapper,e.location,0,r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()})},rA.prototype.getMetadata=function(){var t=this;return HN("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(e){var n=VN(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},rA.prototype.updateMetadata=function(t){var e=this;return HN("updateMetadata",[YN()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=bN(e.fullServerUrl()),o=IN(n,r),a=t.maxOperationRetryTime(),s=new PN(i,"PATCH",xN(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=qN(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},rA.prototype.getDownloadURL=function(){var t=this;return HN("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e,n){var r=bN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new PN(r,"GET",FN(t,n),i);return o.errorHandler=qN(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new SC(CC.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},rA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new SC(CC.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},rA);function rA(t,e){this.authWrapper=t,this.location=e instanceof yN?e:yN.makeFromUrl(e)}var iA=(oA.prototype.getPromise=function(){return this.promise_},oA.prototype.cancel=function(t){},oA);function oA(t){this.promise_=Promise.reject(t)}var aA=(sA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},sA.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},sA);function sA(){this.map=new Map,this.id=-9007199254740991}var uA=(cA.extractBucket_=function(t){var e=t[TC]||null;return null==e?null:yN.makeFromBucketSpec(e).bucket},cA.prototype.getAuthToken=function(){return null!==this.app_&&tN(this.app_.INTERNAL)&&tN(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},cA.prototype.bucket=function(){if(this.deleted_)throw OC();return this.bucket_},cA.prototype.service=function(){return this.service_},cA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},cA.prototype.makeRequest=function(t,e){if(this.deleted_)return new iA(OC());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},cA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},cA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},cA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},cA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},cA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},cA);function cA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;tN(o)&&(this.bucket_=cA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new aA}var hA=(lA.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());eN(s)?i(s):i()}catch(e){o(e)}else null!==a?((r=AC()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?OC():kC()):o(r=new SC(CC.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new fA(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout(function(){i=null,t(l,s())},e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},n),p}(function(e,n){if(n)e(!1,new fA(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===BC.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new fA(a,n))}else{var s=n.getErrorCode()===BC.ABORT;e(!1,new fA(!1,null,s))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},lA.prototype.getPromise=function(){return this.promise_},lA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},lA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},lA);function lA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var fA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function pA(t,e,n){var r=wN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==mo?mo.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new hA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var dA=(yA.prototype.ref=function(t){if(HN("ref",[zN(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new nA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},yA.prototype.refFromURL=function(t){return HN("refFromURL",[zN(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{yN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new nA(this.authWrapper_,t)},Object.defineProperty(yA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),yA.prototype.setMaxUploadRetryTime=function(t){HN("setMaxUploadRetryTime",[XN()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},yA.prototype.setMaxOperationRetryTime=function(t){HN("setMaxOperationRetryTime",[XN()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(yA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(yA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),yA);function yA(t,e,n){if(this.bucket_=null,this.authWrapper_=new uA(t,function(t,e){return new nA(t,e)},pA,this,e),this.app_=t,null!=n)this.bucket_=yN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new yN(r,""))}this.internals_=new vA(this)}var mA,vA=(gA.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},gA);function gA(t){this.service_=t}function bA(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function wA(t,e,n){var r,i=new Promise(function(i,o){bA(r=t[e].apply(t,n)).then(i,o)});return i.request=r,i}function _A(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function EA(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return wA(this[e],r,arguments)})})}function TA(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function SA(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return function(t,e,n){var r=wA(t,e,n);return r.then(function(t){if(t)return new CA(t,r.request)})}(this[e],r,arguments)})})}function IA(t){this._index=t}function CA(t,e){this._cursor=t,this._request=e}function NA(t){this._store=t}function AA(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function kA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new AA(n)}function DA(t){this._db=t}mA={TaskState:$C,TaskEvent:QC,StringFormat:xC,Storage:dA,Reference:nA},mo.INTERNAL.registerService("storage",function(t,e,n){return new dA(t,new hN,n)},mA,void 0,!0),_A(IA,"_index",["name","keyPath","multiEntry","unique"]),EA(IA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),SA(IA,"_index",IDBIndex,["openCursor","openKeyCursor"]),_A(CA,"_cursor",["direction","key","primaryKey","value"]),EA(CA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(CA.prototype[t]=function(){var e=this,n=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,n),bA(e._request).then(function(t){if(t)return new CA(t,e._request)})})})}),NA.prototype.createIndex=function(){return new IA(this._store.createIndex.apply(this._store,arguments))},NA.prototype.index=function(){return new IA(this._store.index.apply(this._store,arguments))},_A(NA,"_store",["name","keyPath","indexNames","autoIncrement"]),EA(NA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),SA(NA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),TA(NA,"_store",IDBObjectStore,["deleteIndex"]),AA.prototype.objectStore=function(){return new NA(this._tx.objectStore.apply(this._tx,arguments))},_A(AA,"_tx",["objectStoreNames","mode"]),TA(AA,"_tx",IDBTransaction,["abort"]),kA.prototype.createObjectStore=function(){return new NA(this._db.createObjectStore.apply(this._db,arguments))},_A(kA,"_db",["name","version","objectStoreNames"]),TA(kA,"_db",IDBDatabase,["deleteObjectStore","close"]),DA.prototype.transaction=function(){return new AA(this._db.transaction.apply(this._db,arguments))},_A(DA,"_db",["name","version","objectStoreNames"]),TA(DA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[NA,IA].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e=function(t){return Array.prototype.slice.call(t)}(arguments),n=e[e.length-1],r=this._store||this._index,i=r[t].apply(r,e.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[IA,NA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():i(r)):i(r)})})})});var RA,OA=1e4,PA="w:0.2.5",MA="FIS_v2",xA="https://firebaseinstallations.googleapis.com/v1",LA=36e5,FA=((RA={})["missing-app-config-values"]="Missing App configuration values.",RA["create-installation-failed"]="Could not register Firebase Installation.",RA["generate-token-failed"]="Could not generate Auth Token.",RA["not-registered"]="Firebase Installation is not registered.",RA["installation-not-found"]="Firebase Installation not found.",RA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',RA["app-offline"]="Could not process request. Application offline.",RA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",RA),UA=new Ri("installations","Installations",FA);function qA(t){return t instanceof ki&&t.code.includes("request-failed")}function VA(t){if(!t||!t.options)throw UA.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw UA.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function BA(t){var e=t.projectId;return xA+"/projects/"+e+"/installations"}function jA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function WA(t,e){return ci(this,void 0,void 0,function(){var n,r;return hi(this,function(i){switch(i.label){case 0:return[4,e.json()];case 1:return n=i.sent(),r=n.error,[2,UA.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}})})}function QA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function KA(t,e){var n=e.refreshToken,r=QA(t);return r.append("Authorization",MA+" "+n),r}function HA(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return 500<=(e=n.sent()).status&&e.status<600?[2,t()]:[2,e]}})})}function GA(t){return new Promise(function(e){setTimeout(e,t)})}var zA=/^[cdef][\w-]{21}$/,YA="";function XA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,pi(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return zA.test(e)?e:YA}catch(t){return YA}}var JA="firebase-installations-database",$A=1,ZA="firebase-installations-store",tk=null;function ek(){return tk=tk||function(t,e,n){var r=wA(indexedDB,"open",[JA,$A]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new kA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new DA(t)})}(0,0,function(t){switch(t.oldVersion){case 0:t.createObjectStore(ZA)}})}function nk(t,e){return ci(this,void 0,void 0,function(){var n,r,i;return hi(this,function(o){switch(o.label){case 0:return n=ok(t),[4,ek()];case 1:return r=o.sent(),[4,(i=r.transaction(ZA,"readwrite")).objectStore(ZA).put(e,n)];case 2:return o.sent(),[4,i.complete];case 3:return o.sent(),[2,e]}})})}function rk(t){return ci(this,void 0,void 0,function(){var e,n,r;return hi(this,function(i){switch(i.label){case 0:return e=ok(t),[4,ek()];case 1:return n=i.sent(),[4,(r=n.transaction(ZA,"readwrite")).objectStore(ZA).delete(e)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}})})}function ik(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o,a,s;return hi(this,function(u){switch(u.label){case 0:return n=ok(t),[4,ek()];case 1:return r=u.sent(),i=r.transaction(ZA,"readwrite"),[4,(o=i.objectStore(ZA)).get(n)];case 2:return a=u.sent(),(s=e(a))===a?[2,s]:void 0!==s?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),[2,s]}})})}function ok(t){return t.appName+"!"+t.appId}function ak(t){return ci(this,void 0,void 0,function(){var e,n,r;return hi(this,function(i){switch(i.label){case 0:return[4,ik(t,function(n){var r=function(t){var e=t||{fid:XA(),registrationStatus:0};return uk(e)?{fid:e.fid,registrationStatus:0}:e}(n),i=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return[4,sk(t)];case 1:e=n.sent(),n.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,GA(100)];case 3:return n.sent(),[4,sk(t)];case 4:return e=n.sent(),[3,2];case 5:if(0===e.registrationStatus)throw UA.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(UA.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=function(t,e){return ci(this,void 0,void 0,function(){var n,r;return hi(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,function(t,n){var r=e.fid;return ci(this,void 0,void 0,function(){var e,n,i,o,a,s;return hi(this,function(u){switch(u.label){case 0:return e=BA(t),n=QA(t),i={fid:r,authVersion:MA,appId:t.appId,sdkVersion:PA},o={method:"POST",headers:n,body:JSON.stringify(i)},[4,HA(function(){return fetch(e,o)})];case 1:return(a=u.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,{fid:(s=u.sent()).fid||r,registrationStatus:2,refreshToken:s.refreshToken,authToken:jA(s.authToken)}];case 3:return[4,WA("Create Installation",a)];case 4:throw u.sent()}})})}(t)];case 1:return n=i.sent(),[2,nk(t,n)];case 2:return qA(r=i.sent())&&409===r.serverCode?[4,rk(t)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,nk(t,{fid:e.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}})})}(t,n);return{installationEntry:n,registrationPromise:r}}(t,r);return e=i.registrationPromise,i.installationEntry})];case 1:return(n=i.sent()).fid!==YA?[3,3]:(r={},[4,e]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:e}]}})})}function sk(t){return ik(t,function(t){if(!t)throw UA.create("installation-not-found");return uk(t)?{fid:t.fid,registrationStatus:0}:t})}function uk(t){return 1===t.registrationStatus&&t.registrationTime+OA<Date.now()}function ck(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o,a;return hi(this,function(s){switch(s.label){case 0:return n=function(t,n){var r=e.fid;return BA(t)+"/"+r+"/authTokens:generate"}(t),r=KA(t,e),i={installation:{sdkVersion:PA}},o={method:"POST",headers:r,body:JSON.stringify(i)},[4,HA(function(){return fetch(n,o)})];case 1:return(a=s.sent()).ok?[4,a.json()]:[3,3];case 2:return[2,jA(s.sent())];case 3:return[4,WA("Generate Auth Token",a)];case 4:throw s.sent()}})})}function hk(t){return ci(this,void 0,void 0,function(){var e,n,r;return hi(this,function(i){switch(i.label){case 0:return[4,ik(t,function(n){if(!fk(n))throw UA.create("not-registered");var r=n.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+LA}(t)}(r))return n;if(1===r.requestStatus)return e=function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:return[4,lk(t)];case 1:e=r.sent(),r.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,GA(100)];case 3:return r.sent(),[4,lk(t)];case 4:return e=r.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw UA.create("generate-token-failed");return[2,n]}})})}(t),n;if(!navigator.onLine)throw UA.create("app-offline");var i=function(t){var e={requestStatus:1,requestTime:Date.now()};return ui({},t,{authToken:e})}(n);return e=function(t,e){return ci(this,void 0,void 0,function(){var n,r,i;return hi(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,ck(t,e)];case 1:return n=o.sent(),i=ui({},e,{authToken:n}),[4,nk(t,i)];case 2:return o.sent(),[2,n];case 3:return!qA(r=o.sent())||401!==r.serverCode&&404!==r.serverCode?[3,5]:[4,rk(t)];case 4:return o.sent(),[3,7];case 5:return i=ui({},e,{authToken:{requestStatus:0}}),[4,nk(t,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}})})}(t,i),i})];case 1:return n=i.sent(),e?[4,e]:[3,3];case 2:return r=i.sent(),[3,4];case 3:r=n.authToken,i.label=4;case 4:return[2,r.token]}})})}function lk(t){return ik(t,function(t){if(!fk(t))throw UA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+OA<Date.now()}(t.authToken)?ui({},t,{authToken:{requestStatus:0}}):t})}function fk(t){return void 0!==t&&2===t.registrationStatus}function pk(t,e){return ci(this,void 0,void 0,function(){var n,r,i,o;return hi(this,function(a){switch(a.label){case 0:return n=function(t,n){var r=e.fid;return BA(t)+"/"+r}(t),r=KA(t,e),i={method:"DELETE",headers:r},[4,HA(function(){return fetch(n,i)})];case 1:return(o=a.sent()).ok?[3,3]:[4,WA("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}})})}mo.INTERNAL.registerService("installations",function(t){return VA(t),{app:t,getId:function(){return function(t){return ci(this,void 0,void 0,function(){var e,n,r,i;return hi(this,function(o){switch(o.label){case 0:return[4,ak(e=VA(t))];case 1:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&hk(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return function(t){return ci(this,void 0,void 0,function(){var e;return hi(this,function(n){switch(n.label){case 0:return[4,function(t){return ci(this,void 0,void 0,function(){var e,n,r;return hi(this,function(i){switch(i.label){case 0:return[4,ak(t)];case 1:return e=i.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return i.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw UA.create("create-installation-failed");i.label=4;case 4:return[2]}})})}(e=VA(t))];case 1:return n.sent(),[2,hk(e)]}})})}(t)},delete:function(){return function(t){return ci(this,void 0,void 0,function(){var e,n;return hi(this,function(r){switch(r.label){case 0:return[4,ik(e=VA(t),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw UA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw UA.create("app-offline");case 3:return[4,pk(e,n)];case 4:return r.sent(),[4,rk(e)];case 5:r.sent(),r.label=6;case 6:return[2]}})})}(t)}}});var dk,yk,mk,vk,gk="0.2.17",bk="FB-PERF-TRACE-MEASURE",wk="@firebase/performance/config",_k="@firebase/performance/configexpire",Ek="Performance",Tk=((dk={})["trace started"]="Trace {$traceName} was started before.",dk["trace stopped"]="Trace {$traceName} is not running.",dk["no window"]="Window is not available.",dk["no app id"]="App id is not available.",dk["no project id"]="Project id is not available.",dk["no api key"]="Api key is not available.",dk["invalid cc log"]="Attempted to queue invalid cc event",dk["FB not default"]="Performance can only start when Firebase app instance is the default one.",dk["RC response not ok"]="RC response is not ok",dk["invalid attribute name"]="Attribute name {$attributeName} is invalid.",dk["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",dk["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",dk),Sk=new Ri("performance",Ek,Tk),Ik=(Ck.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},Ck.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},Ck.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},Ck.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},Ck.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},Ck.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},Ck.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},Ck.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}}).observe({entryTypes:[t]})},Ck.getInstance=function(){return void 0===yk&&(yk=new Ck(mk)),yk},Ck);function Ck(t){if(!t)throw Sk.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var Nk,Ak,kk,Dk=(Rk.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Sk.create("no app id");return t},Rk.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Sk.create("no project id");return t},Rk.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Sk.create("no api key");return t},Rk.getInstance=function(){return void 0===vk&&(vk=new Rk),vk},Rk);function Rk(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function Ok(){return Nk}(kk=Ak=Ak||{})[kk.UNKNOWN=0]="UNKNOWN",kk[kk.VISIBLE=1]="VISIBLE",kk[kk.HIDDEN=2]="HIDDEN",kk[kk.PRERENDER=3]="PRERENDER",kk[kk.UNLOADED=4]="UNLOADED";var Pk=["firebase_","google_","ga_"],Mk=new RegExp("^[a-zA-Z]\\w*$");function xk(){switch(Ik.getInstance().document.visibilityState){case"visible":return Ak.VISIBLE;case"hidden":return Ak.HIDDEN;case"prerender":return Ak.PRERENDER;default:return Ak.UNKNOWN}}var Lk=new ro(Ek);Lk.logLevel=Qi.INFO;var Fk="0.0.1",Uk={loggingEnabled:!0},qk="FIREBASE_INSTALLATIONS_AUTH",Vk="Could not fetch config, will use default configs";function Bk(t){if(!t)return t;var e=Dk.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=Uk.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=jk(e.tracesSamplingRate),e.logNetworkAfterSampling=jk(e.networkRequestsSamplingRate),t}function jk(t){return Math.random()<=t}var Wk,Qk=1;function Kk(){return Qk=2,Wk=Wk||function(){var t=Ik.getInstance().document;return new Promise(function(e){if(t&&"complete"!==t.readyState){var n=function(){"complete"===t.readyState&&(t.removeEventListener("readystatechange",n),e())};t.addEventListener("readystatechange",n)}else e()})}().then(function(){return function(){var t=Dk.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){Nk=t}),t}()}).then(function(t){return function(t){var e=function(){var t=Ik.getInstance().localStorage,e=t.getItem(_k);if(e&&Number(e)>Date.now()){var n=t.getItem(wk);if(n)try{return JSON.parse(n)}catch(t){return}}}();return e?(Bk(e),Promise.resolve()):function(t){return function(){var t=Dk.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(e){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Dk.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Dk.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:qk+" "+e},body:JSON.stringify({app_instance_id:t,app_instance_id_token:e,app_id:Dk.getInstance().getAppId(),app_version:gk,sdk_version:Fk})});return fetch(r).then(function(t){if(t.ok)return t.json();throw Sk.create("RC response not ok")})}).catch(function(){Lk.info(Vk)})}(t).then(function(t){return Bk(t)}).then(function(t){return function(t){if(t){var e=Ik.getInstance().localStorage;e.setItem(wk,JSON.stringify(t)),e.setItem(_k,String(Date.now()+60*Dk.getInstance().configTimeToLive*60*1e3))}}(t)},function(){})}(t)}).then(function(){return Hk()},function(){return Hk()})}function Hk(){Qk=3}var Gk,zk=3,Yk=[];function Xk(){if(Gk)return Gk;var t=function(t){return function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];!function(t){if(!t.eventTime||!t.message)throw Sk.create("invalid cc log");Yk=Yk.concat([t])}({message:t.apply(void 0,r),eventTime:Date.now()})}}(Zk);return(Gk=new ro("@firebase/performance/cc")).logHandler=t,Gk}function Jk(t){var e=Dk.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Ik.getInstance().requiredApisAvailable()&&(t.isAuto&&xk()!==Ak.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===Qk?$k(t):Kk().then(function(){return $k(t)},function(){return $k(t)})))}function $k(t){Ok()&&setTimeout(function(){return Xk().log(t,1)},0)}function Zk(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:tD(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=eD(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=eD(n));var r={application_info:tD(),trace_metric:e};return JSON.stringify(r)}(t)}function tD(){return{google_app_id:Dk.getInstance().getAppId(),app_instance_id:Ok(),web_app_info:{sdk_version:gk,page_url:Ik.getInstance().getUrl(),service_worker_status:function(){var t=Ik.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:xk(),effective_connection_type:function(){var t=Ik.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function eD(t){return Object.keys(t).map(function(e){return{key:e,value:t[e]}})}!function t(e){setTimeout(function(){if(0!==zk){if(!Yk.length)return t(1e4);var e=Yk.slice();Yk=[];var n=e.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),r={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Dk.getInstance().logSource,log_event:n};fetch(Dk.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(r)}).then(function(t){return t.ok||Lk.info("Call to Firebase backend failed."),t.json()}).then(function(e){var n=Number(e.next_request_wait_millis),r=isNaN(n)?1e4:Math.max(1e4,n);zk=3,t(r)}).catch(function(){Yk=e.concat(Yk),zk--,Lk.info("Tries left: "+zk+"."),t(1e4)})}},e)}(5500);var nD=["_fp","_fcp","_fid"],rD=(iD.prototype.start=function(){if(1!==this.state)throw Sk.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},iD.prototype.stop=function(){if(2!==this.state)throw Sk.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Jk(this)},iD.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=ui({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}Jk(this)},iD.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},iD.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<nD.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw Sk.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},iD.prototype.getMetric=function(t){return this.counters[t]||0},iD.prototype.putAttribute=function(t,e){var n=function(t){return!(0===t.length||40<t.length||Pk.some(function(e){return t.startsWith(e)})||!t.match(Mk))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw Sk.create("invalid attribute name",{attributeName:t});if(!r)throw Sk.create("invalid attribute value",{attributeValue:e})}},iD.prototype.getAttribute=function(t){return this.customAttributes[t]},iD.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},iD.prototype.getAttributes=function(){return ui({},this.customAttributes)},iD.prototype.setStartTime=function(t){this.startTimeUs=t},iD.prototype.setDuration=function(t){this.durationUs=t},iD.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},iD.createOobTrace=function(t,e,n){var r=Ik.getInstance().getUrl();if(r){var i=new iD("_wt_"+r,!0),o=Math.floor(1e3*Ik.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}Jk(i)}},iD.createUserTimingTrace=function(t){Jk(new iD(t,!1,t))},iD);function iD(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Ik.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||bk+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function oD(t){var e=t;if(e&&void 0!==e.responseStart){var n=Ik.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=Dk.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return Xk().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var aD=5e3;function sD(){Ok()&&(setTimeout(function(){return function(){var t=Ik.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){rD.createOobTrace(e,n),r=void 0},aD);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),rD.createOobTrace(e,n,t))})}else rD.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Ik.getInstance(),e=0,n=t.getEntriesByType("resource");e<n.length;e++)oD(n[e]);t.setupObserver("resource",oD)}()},0),setTimeout(function(){return function(){for(var t=Ik.getInstance(),e=0,n=t.getEntriesByType("measure");e<n.length;e++)uD(n[e]);t.setupObserver("measure",uD)}()},0))}function uD(t){var e=t.name;e.substring(0,bk.length)!==bk&&rD.createUserTimingTrace(e)}var cD=(hD.prototype.trace=function(t){return new rD(t)},Object.defineProperty(hD.prototype,"instrumentationEnabled",{get:function(){return Dk.getInstance().instrumentationEnabled},set:function(t){Dk.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(hD.prototype,"dataCollectionEnabled",{get:function(){return Dk.getInstance().dataCollectionEnabled},set:function(t){Dk.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),hD);function hD(t){this.app=t,Ik.getInstance().requiredApisAvailable()?Kk().then(sD,sD):Lk.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return mo.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw Sk.create("FB not default");if("undefined"==typeof window)throw Sk.create("no window");return function(t){mk=t}(window),Dk.getInstance().firebaseAppInstance=t,new cD(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),mo}()}).call(this,n(28),n(129).setImmediate,n(39))},129:function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(130),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(28))},130:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},h=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},f.clearImmediate=p}function p(t){delete c[t]}function d(t){if(h)setTimeout(d,0,t);else{var e=c[t];if(e){h=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{p(t),h=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(28),n(39))}}]);