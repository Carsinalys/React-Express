(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{128:function(e,t){},135:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),o=a(9),c=a(12),r=a(11),l=a(81),_=a(101),m=a.n(_),h=a(6),i=a(16);var p=e=>{let t=e.rooms?e.rooms.map(t=>n.a.createElement("li",{key:t._id.toString(),className:"chat__room__item",onClick:()=>{e.choose(t.name),e.toggle(),e.resetLoadmore(),e.join(t.name),e.resetCounter(t.name),e.newMsgBanner()}},t.name,n.a.createElement("span",{className:"chat__room__item__newMsg"},e.newMsg[t.name]?` (${e.newMsg[t.name]})`:null))):null;return n.a.createElement("ul",{className:"chat__room__list"},t)},u=a(23),g=a(42),d=a(1);const N=u.b+location.origin.split(":")[1],v=m()(N);v.on("connect",()=>{v.on("messageFromExpress",e=>{console.log(e)})}),v.on("disconnect",()=>{console.log("disconnected")}),v.on("messageToNav",e=>{location.href.indexOf("chat")<0&&g.a.dispatch({type:d.L})});class E extends n.a.Component{constructor(){super(...arguments),this.state={showList:!1,badName:!1,badMessage:!1,longMesssage:!1,messageQty:100,currentLengthMessages:0,loadMore:!1},this.toggleSelectRoomsHandler=()=>{this.state.showList?this.setState({showList:!1}):this.setState({showList:!0})},this.sendUserNameHandler=()=>{if(this.props.chat.userNameValue.length<5||this.props.chat.userNameValue.length>20)this.setState({badName:!0});else{let e={name:this.props.chat.userNameValue};this.props.chatSetUserNameFun(e,this.props.auth.localId)}},this.sendMessageHanlder=()=>{if(0===this.props.chat.userName.length)this.setState({badName:!0});else if(this.props.chat.messageValue.length>100)this.setState({longMesssage:!0});else if(0===this.props.chat.messageValue.length)this.setState({badMessage:!0});else{let e={name:this.props.chat.userName,message:this.props.chat.messageValue,room:this.props.chat.room,id:this.props.auth.localId,createAt:(new Date).getTime()};v.emit("messageFromReact",e),this.props.chatResetMessageInputFun()}},this.resetLoadMoreHandler=()=>{this.setState({loadMore:!1})},this.scrollHandler=e=>{0===e.target.scrollTop&&this.state.messageQty===this.state.currentLengthMessages&&this.setState(e=>({messageQty:e.messageQty+100}))},this.keyDownHandler=e=>{"Enter"===e.key&&this.sendMessageHanlder()},this.joinRoomHandler=e=>{v.emit(e)}}componentDidMount(){this.props.chatGetUsersNamesFun(this.props.auth.localId),0===this.props.chat.messages.length?this.props.chatGetCurMessagesFun(this.props.chat.room):this.setState({currentLengthMessages:this.props.chat.messages.length}),v.on("messageToState",e=>{this.props.chatSetCurrentMessagesFun(e),this.props.chatmessageFromAnotherRoomFun(e),this.props.chatNewMessageBannerFun()});const e=document.querySelector(".chat__head__view__port");e.scrollTop=e.scrollHeight,this.props.getChatRoomsFun(),this.props.chatNewMessageOffFun(),v.emit("joinToDefault"),v.on("userCount",e=>{this.props.userCountFun(e)})}componentDidUpdate(e,t){if(e.chat.messages.length!==this.props.chat.messages.length&&this.setState({currentLengthMessages:this.props.chat.messages.length}),e.chat.messages.length!==this.props.chat.messages.length||0===e.chat.messages.length){const e=document.querySelector(".chat__head__view__port");e.scrollTop=e.scrollHeight}if(this.state.currentLengthMessages-t.currentLengthMessages==1||this.props.chat.room!==e.chat.room){const e=document.querySelector(".chat__head__view__port");e.scrollTop=e.scrollHeight}}render(){return n.a.createElement("section",{className:"chat__section"},this.props.auth.isAuthindicated?null:n.a.createElement(c.a,{to:"/"}),n.a.createElement(r.a,{toggle:this.state.longMesssage},n.a.createElement("div",{className:"pizza__view__order__small__modal",onClick:()=>this.setState({longMesssage:!1})},n.a.createElement("div",{className:"pizza__view__order__small__modal__content"},"Too long message (it must be 100 symbols max)"))),n.a.createElement(r.a,{toggle:this.state.badName},n.a.createElement("div",{className:"pizza__view__order__small__modal",onClick:()=>this.setState({badName:!1})},n.a.createElement("div",{className:"pizza__view__order__small__modal__content"},"User name must be longer 5 symbols and shorter 20 symbols length"))),n.a.createElement(r.a,{toggle:this.state.badMessage},n.a.createElement("div",{className:"pizza__view__order__small__modal",onClick:()=>this.setState({badMessage:!1})},n.a.createElement("div",{className:"pizza__view__order__small__modal__content"},"You must enter some text in the message field"))),n.a.createElement(r.a,{toggle:this.props.chat.modal},n.a.createElement("div",null,n.a.createElement(i.a,null))),n.a.createElement("div",{className:"chat__main__cover"},n.a.createElement("div",{className:"chat__rooms__cover"},n.a.createElement("div",{className:"chat__rooms__select__cover"},n.a.createElement("button",{onClick:this.toggleSelectRoomsHandler,className:"chat__create__room__btn chat__create__room__btn_relative"},"Choose room",this.props.chat.newMsg&&"0"!==this.props.chat.newMsg?n.a.createElement("span",{className:"chat__create__room__btn_newBanner"},"1"):null),n.a.createElement(l.a,{toggle:this.state.showList},n.a.createElement(p,{rooms:this.props.chat.rooms,choose:this.props.chatChooseRoomFun,toggle:this.toggleSelectRoomsHandler,resetLoadmore:this.resetLoadMoreHandler,join:this.joinRoomHandler,resetCounter:this.props.chatmessageFromAnotherRoomResetFun,newMsg:this.props.chat.newMsgCounter,newMsgBanner:this.props.chatNewMessageBannerFun}))),n.a.createElement("div",null,this.props.chat.userName.length>0?n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("p",null,"Your nickname: ",this.props.chat.userName)),n.a.createElement("div",null,n.a.createElement("span",{className:"chat__change__name__btn",onClick:this.props.chatDeleteUserNameFun},"Change nickname"))):n.a.createElement("div",{className:"chat__set__name__cover"},n.a.createElement("div",{className:"chat__set__name__cover__single"},n.a.createElement("input",{type:"text",placeholder:"Enter your name...",value:this.props.chat.userNameValue,onChange:e=>{const t=e;this.props.chatOnNameInputFun(t)},className:"chat__create__room__input"})),n.a.createElement("div",{className:"chat__set__name__cover__single"},n.a.createElement("button",{onClick:this.sendUserNameHandler,className:"chat__create__room__btn"},"Set name")))),"admin"===this.props.chat.role?n.a.createElement("div",{className:"chat__create__room__cover"},n.a.createElement("div",{className:"chat__create__room__btn__cover"},n.a.createElement("input",{type:"text",placeholder:"room name...",className:"chat__create__room__input",value:this.props.chat.roomValue,onChange:e=>{const t=e;this.props.chatOnInputFun(t)}})),n.a.createElement("div",{className:"chat__create__room__btn__cover"},n.a.createElement("button",{className:"chat__create__room__btn",onClick:()=>this.props.createChatRoomFun(this.props.chat.roomValue)},"Create room"))):null),n.a.createElement("div",{className:"chat__currnet__room__cover"},n.a.createElement("p",null,"Current room:"," ",n.a.createElement("span",{className:"chat__room__name"},""!=this.props.chat.room?this.props.chat.room:null))),n.a.createElement("div",{className:"chat__head__cover"},n.a.createElement("div",{className:"chat__head__info"},n.a.createElement("div",{className:"chat__head__title"},"Message window:"),n.a.createElement("div",{className:"chat__head__info__users"},n.a.createElement("div",null,this.props.chat.userCount),n.a.createElement("div",{className:"chat__head__info__users__pic"},n.a.createElement("img",{src:"/assets/img/man.svg",alt:""})))),n.a.createElement("div",{className:"chat__head__view__port",onScroll:e=>{const t=e;this.scrollHandler(t)}},this.props.chat.messages.length>0?this.props.chat.messages.map(e=>n.a.createElement("div",{key:e._id.toString(),className:this.props.auth.localId==e.id?"chat__message__cover relative":" relative"},n.a.createElement("span",{className:"chat__message__delete__single",onClick:()=>this.props.auth.localId===e.id&&this.props.chatDeleteMessageFun(e._id,this.props.chat.room)}),n.a.createElement("p",{className:"chat__message__name"},e.name),n.a.createElement("p",{className:"chat__message__date"},e.createAt.replace("T"," ").split(".")[0]),n.a.createElement("p",{className:"chat__message__message"},e.message))):null)),n.a.createElement("div",{className:"chat__footer__cover"},n.a.createElement("input",{type:"text",placeholder:"Your message",className:"chat__footer__send__input",value:this.props.chat.messageValue,onChange:()=>{const e=event;this.props.chatOnMessageInputFun(e)},onKeyPress:e=>{const t=e;this.keyDownHandler(t)}}),this.props.chat.sending?n.a.createElement("button",{className:"chat__footer__send__btn",onClick:this.sendMessageHanlder},"Send",n.a.createElement("img",{src:"/assets/img/pacman.svg",alt:"spinner",className:"chat__footer__send__btn__spinner"})):n.a.createElement("button",{className:"chat__footer__send__btn",onClick:this.sendMessageHanlder},"Send"))))}}t.default=Object(o.b)(e=>({auth:e.auth,chat:e.chat}),e=>({createChatRoomFun:t=>e(Object(h.y)(t)),chatOnInputFun:t=>e(Object(h.p)(t)),chatChooseRoomFun:t=>e(Object(h.h)(t)),chatOnMessageInputFun:t=>e(Object(h.q)(t)),chatSetUserNameFun:(t,a)=>e(Object(h.u)(t,a)),chatOnNameInputFun:t=>e(Object(h.r)(t)),chatDeleteUserNameFun:()=>e(Object(h.j)()),chatDeleteMessageFun:(t,a)=>e(Object(h.i)(t,a)),chatNewMessageOnFun:()=>e(Object(h.o)()),chatNewMessageOffFun:()=>e(Object(h.n)()),chatGetUsersNamesFun:t=>e(Object(h.l)(t)),chatSetCurrentMessagesFun:t=>e(Object(h.t)(t)),chatResetMessageInputFun:()=>e(Object(h.s)()),chatGetCurMessagesFun:t=>e(Object(h.k)(t)),getChatRoomsFun:()=>e(Object(h.J)()),userCountFun:t=>e(Object(h.fb)(t)),chatmessageFromAnotherRoomFun:t=>e(Object(h.v)(t)),chatmessageFromAnotherRoomResetFun:t=>e(Object(h.w)(t)),chatNewMessageBannerFun:()=>e(Object(h.m)())}))(E)},81:function(e,t,a){"use strict";var s=a(0),n=a.n(s),o=a(74);t.a=e=>n.a.createElement(o.a,{in:e.toggle,timeout:300,classNames:"select__global",mountOnEnter:!0,unmountOnExit:!0},e.children)}}]);